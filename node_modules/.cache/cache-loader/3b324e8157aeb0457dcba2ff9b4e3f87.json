{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.orders\\Order.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.orders\\Order.ts","mtime":1614842913762},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5IjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmltcG9ydCBkZWJ1ZyBmcm9tICdkZWJ1Zyc7CmltcG9ydCBTd2FwQXBwIGZyb20gJ3N3YXAuYXBwJzsKaW1wb3J0IEJpZ051bWJlciBmcm9tICdiaWdudW1iZXIuanMnOwppbXBvcnQgZXZlbnRzIGZyb20gJy4vZXZlbnRzJzsKCnZhciBPcmRlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgLyoqDQogICAqDQogICAqIEBwYXJhbSB7b2JqZWN0fSAgcGFyZW50DQogICAqIEBwYXJhbSB7b2JqZWN0fSAgZGF0YQ0KICAgKiBAcGFyYW0ge3N0cmluZ30gIGRhdGEuaWQNCiAgICogQHBhcmFtIHtvYmplY3R9ICBkYXRhLm93bmVyDQogICAqIEBwYXJhbSB7c3RyaW5nfSAgZGF0YS5vd25lci5wZWVyDQogICAqIEBwYXJhbSB7bnVtYmVyfSAgZGF0YS5vd25lci5yZXB1dGF0aW9uDQogICAqIEBwYXJhbSB7b2JqZWN0fSAgZGF0YS5vd25lci48Y3VycmVuY3k+DQogICAqIEBwYXJhbSB7c3RyaW5nfSAgZGF0YS5vd25lci48Y3VycmVuY3k+LmFkZHJlc3MNCiAgICogQHBhcmFtIHtzdHJpbmd9ICBkYXRhLm93bmVyLjxjdXJyZW5jeT4ucHVibGljS2V5DQogICAqIEBwYXJhbSB7c3RyaW5nfSAgZGF0YS5idXlDdXJyZW5jeQ0KICAgKiBAcGFyYW0ge3N0cmluZ30gIGRhdGEuc2VsbEN1cnJlbmN5DQogICAqIEBwYXJhbSB7bnVtYmVyfSAgZGF0YS5idXlBbW91bnQNCiAgICogQHBhcmFtIHtudW1iZXJ9ICBkYXRhLnNlbGxBbW91bnQNCiAgICovCiAgZnVuY3Rpb24gT3JkZXIoYXBwLCBwYXJlbnRDb2xsZWN0aW9uLCBkYXRhKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgT3JkZXIpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiaWQiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiaXNNeSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJpc1R1cmJvIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgIm93bmVyIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInBhcnRpY2lwYW50Iiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImJ1eUN1cnJlbmN5Iiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImV4Y2hhbmdlUmF0ZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJzZWxsQ3VycmVuY3kiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiYnV5QW1vdW50Iiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInNlbGxBbW91bnQiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY29sbGVjdGlvbiIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJyZXF1ZXN0cyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJpc1JlcXVlc3RlZCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJpc1Byb2Nlc3NpbmciLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiaXNQYXJ0aWFsIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImlzSGlkZGVuIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInBhcnRpYWxIYW5kbGVyIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImRlc3RpbmF0aW9uIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImFwcCIsIHZvaWQgMCk7CgogICAgdGhpcy5pZCA9IGRhdGEuaWQ7CiAgICB0aGlzLmlzTXkgPSBudWxsOwogICAgdGhpcy5pc1R1cmJvID0gbnVsbDsKICAgIHRoaXMub3duZXIgPSBudWxsOwogICAgdGhpcy5wYXJ0aWNpcGFudCA9IG51bGw7CiAgICB0aGlzLmJ1eUN1cnJlbmN5ID0gbnVsbDsKICAgIHRoaXMuZXhjaGFuZ2VSYXRlID0gbnVsbDsKICAgIHRoaXMuc2VsbEN1cnJlbmN5ID0gbnVsbDsKICAgIHRoaXMuYnV5QW1vdW50ID0gbnVsbDsKICAgIHRoaXMuc2VsbEFtb3VudCA9IG51bGw7CiAgICB0aGlzLmNvbGxlY3Rpb24gPSBwYXJlbnRDb2xsZWN0aW9uOwogICAgdGhpcy5yZXF1ZXN0cyA9IFtdOyAvLyBpbmNvbWUgcmVxdWVzdHMKCiAgICB0aGlzLmlzUmVxdWVzdGVkID0gZmFsc2U7IC8vIG91dGNvbWUgcmVxdWVzdCBzdGF0dXMKCiAgICB0aGlzLmlzUHJvY2Vzc2luZyA9IGZhbHNlOyAvLyBpZiBzd2FwIGlzUHJvY2Vzc2luZwoKICAgIHRoaXMuaXNQYXJ0aWFsID0gZmFsc2U7CiAgICB0aGlzLmlzSGlkZGVuID0gZmFsc2U7CiAgICB0aGlzLnBhcnRpYWxIYW5kbGVyID0gewogICAgICBidXlBbW91bnQ6IGZ1bmN0aW9uIGJ1eUFtb3VudCgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCiAgICAgIHNlbGxBbW91bnQ6IGZ1bmN0aW9uIHNlbGxBbW91bnQoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9OwogICAgdGhpcy5kZXN0aW5hdGlvbiA9IG51bGw7CgogICAgdGhpcy5fYXR0YWNoU3dhcEFwcChhcHApOwoKICAgIHRoaXMuX3VwZGF0ZShfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGRhdGEpLCB7fSwgewogICAgICBpc015OiBkYXRhLm93bmVyLnBlZXIgPT09IHRoaXMuYXBwLnNlcnZpY2VzLnJvb20ucGVlcgogICAgfSkpOwoKICAgIHRoaXMuX29uTW91bnQoKTsKICB9CgogIF9jcmVhdGVDbGFzcyhPcmRlciwgW3sKICAgIGtleTogIl9hdHRhY2hTd2FwQXBwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfYXR0YWNoU3dhcEFwcChhcHApIHsKICAgICAgU3dhcEFwcC5yZXF1aXJlZChhcHApOwogICAgICB0aGlzLmFwcCA9IGFwcDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfb25Nb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uTW91bnQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB0aGlzLmFwcC5zZXJ2aWNlcy5yb29tLm9uKCdyZXF1ZXN0IHN3YXAnLCBmdW5jdGlvbiAoX3JlZikgewogICAgICAgIHZhciBvcmRlcklkID0gX3JlZi5vcmRlcklkLAogICAgICAgICAgICBwYXJ0aWNpcGFudCA9IF9yZWYucGFydGljaXBhbnQsCiAgICAgICAgICAgIHBhcnRpY2lwYW50TWV0YWRhdGEgPSBfcmVmLnBhcnRpY2lwYW50TWV0YWRhdGEsCiAgICAgICAgICAgIGRlc3RpbmF0aW9uID0gX3JlZi5kZXN0aW5hdGlvbjsKCiAgICAgICAgaWYgKG9yZGVySWQgPT09IF90aGlzLmlkCiAgICAgICAgLyomJiB0aGlzLnJlcXVlc3RzLmxlbmd0aCA8IDEwKi8KICAgICAgICAmJiAhX3RoaXMucmVxdWVzdHMuZmluZChmdW5jdGlvbiAoX3JlZjIpIHsKICAgICAgICAgIHZhciBwZWVyID0gX3JlZjIucGFydGljaXBhbnQucGVlcjsKICAgICAgICAgIHJldHVybiBwZWVyID09PSBwYXJ0aWNpcGFudC5wZWVyOwogICAgICAgIH0pKSB7CiAgICAgICAgICB2YXIgcmVwdXRhdGlvbiA9IDA7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gdG9kbzogY2hlY2sgb3RoZXIgYmxvY2tjaGFpbnMKICAgICAgICAgICAgaWYgKHBhcnRpY2lwYW50LmV0aC5hZGRyZXNzID09PSBwYXJ0aWNpcGFudE1ldGFkYXRhLmFkZHJlc3MgfHwgcGFydGljaXBhbnQuYnRjLmFkZHJlc3MgPT09IHBhcnRpY2lwYW50TWV0YWRhdGEuYWRkcmVzcykgewogICAgICAgICAgICAgIHJlcHV0YXRpb24gPSBfdGhpcy5hcHAuZW52LnN3YXBzRXhwbG9yZXIuZ2V0VmVyaWZpZWRSZXB1dGF0aW9uKHBhcnRpY2lwYW50TWV0YWRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgZGVidWcoJ3N3YXAuY29yZTpvcmRlcicpKGVycik7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMucmVxdWVzdHMucHVzaCh7CiAgICAgICAgICAgIHBhcnRpY2lwYW50OiBwYXJ0aWNpcGFudCwKICAgICAgICAgICAgZGVzdGluYXRpb246IGRlc3RpbmF0aW9uLAogICAgICAgICAgICByZXB1dGF0aW9uOiByZXB1dGF0aW9uLAogICAgICAgICAgICBpc1BhcnRpYWw6IGZhbHNlCiAgICAgICAgICB9KTsKCiAgICAgICAgICBldmVudHMuZGlzcGF0Y2goJ25ldyBvcmRlciByZXF1ZXN0JywgewogICAgICAgICAgICBvcmRlcklkOiBvcmRlcklkLAogICAgICAgICAgICBwYXJ0aWNpcGFudDogcGFydGljaXBhbnQsCiAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBkZXN0aW5hdGlvbiwKICAgICAgICAgICAgcGFydGljaXBhbnRNZXRhZGF0YTogcGFydGljaXBhbnRNZXRhZGF0YQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5hcHAuc2VydmljZXMucm9vbS5vbigncmVxdWVzdCBwYXJ0aWFsIGZ1bGZpbG1lbnQnLCBmdW5jdGlvbiAoX3JlZjMpIHsKICAgICAgICB2YXIgb3JkZXJJZCA9IF9yZWYzLm9yZGVySWQsCiAgICAgICAgICAgIHBhcnRpY2lwYW50ID0gX3JlZjMucGFydGljaXBhbnQsCiAgICAgICAgICAgIHBhcnRpY2lwYW50TWV0YWRhdGEgPSBfcmVmMy5wYXJ0aWNpcGFudE1ldGFkYXRhLAogICAgICAgICAgICBkZXN0aW5hdGlvbiA9IF9yZWYzLmRlc3RpbmF0aW9uLAogICAgICAgICAgICB1cGRhdGVkT3JkZXIgPSBfcmVmMy51cGRhdGVkT3JkZXI7CiAgICAgICAgY29uc29sZS5sb2coJzwtIHJlcXVlc3QgcGFydGlhbCBmdWxmaWxtZW50Jyk7CgogICAgICAgIGlmIChvcmRlcklkID09PSBfdGhpcy5pZCkgewogICAgICAgICAgdmFyIGJ1eUFtb3VudCA9IHVwZGF0ZWRPcmRlci5idXlBbW91bnQsCiAgICAgICAgICAgICAgc2VsbEFtb3VudCA9IHVwZGF0ZWRPcmRlci5zZWxsQW1vdW50OyAvLyB0b2RvOiBhZGQgY2hlY2sgcmVwdXRhdGlvbiBsaWtlIGFzICdyZXF1ZXN0IHN3YXAnCgogICAgICAgICAgdmFyIHJlcHV0YXRpb24gPSAwOwogICAgICAgICAgdmFyIGZpbHRlcmVkVXBkYXRlZE9yZGVyID0gewogICAgICAgICAgICBidXlBbW91bnQ6IGJ1eUFtb3VudCwKICAgICAgICAgICAgc2VsbEFtb3VudDogc2VsbEFtb3VudAogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5yZXF1ZXN0cy5wdXNoKHsKICAgICAgICAgICAgcGFydGljaXBhbnQ6IHBhcnRpY2lwYW50LAogICAgICAgICAgICBkZXN0aW5hdGlvbjogZGVzdGluYXRpb24sCiAgICAgICAgICAgIHVwZGF0ZWRPcmRlcjogZmlsdGVyZWRVcGRhdGVkT3JkZXIKICAgICAgICAgIH0pOwoKICAgICAgICAgIGV2ZW50cy5kaXNwYXRjaCgnbmV3IHBhcnRpYWwgZnVsZmlsbWVudCByZXF1ZXN0JywgewogICAgICAgICAgICBvcmRlcklkOiBvcmRlcklkLAogICAgICAgICAgICBwYXJ0aWNpcGFudDogcGFydGljaXBhbnQsCiAgICAgICAgICAgIHVwZGF0ZWRPcmRlcjogZmlsdGVyZWRVcGRhdGVkT3JkZXIKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzLl9hdXRvUmVwbHlUb1BhcnRpYWwoJ2J1eUFtb3VudCcsIGZpbHRlcmVkVXBkYXRlZE9yZGVyLCBwYXJ0aWNpcGFudCk7CgogICAgICAgICAgX3RoaXMuX2F1dG9SZXBseVRvUGFydGlhbCgnc2VsbEFtb3VudCcsIGZpbHRlcmVkVXBkYXRlZE9yZGVyLCBwYXJ0aWNpcGFudCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfdXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlKHZhbHVlcykgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIE9iamVjdC5rZXlzKHZhbHVlcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX3RoaXMyW2tleV0gPSB2YWx1ZXNba2V5XTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGUodmFsdWVzKSB7CiAgICAgIHRoaXMuX3VwZGF0ZSh2YWx1ZXMpOwoKICAgICAgdGhpcy5jb2xsZWN0aW9uLl9zYXZlTXlPcmRlcnMoKTsKCiAgICAgIGV2ZW50cy5kaXNwYXRjaCgnc3dhcCB1cGRhdGUnLCB0aGlzLCB2YWx1ZXMpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9hdXRvUmVwbHlUb1BhcnRpYWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hdXRvUmVwbHlUb1BhcnRpYWwoY2hhbmdlZEtleSwgdXBkYXRlZE9yZGVyLCBwYXJ0aWNpcGFudCkgewogICAgICBjb25zb2xlLmxvZygnPj4+IF9hdXRvUmVwbHlUb1BhcnRpYWwnKTsKCiAgICAgIGlmICghdGhpcy5pc1BhcnRpYWwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghdXBkYXRlZE9yZGVyW2NoYW5nZWRLZXldKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB1cGRhdGVkT3JkZXJbY2hhbmdlZEtleV0gPSBuZXcgQmlnTnVtYmVyKHVwZGF0ZWRPcmRlcltjaGFuZ2VkS2V5XSk7CgogICAgICBpZiAodGhpc1tjaGFuZ2VkS2V5XS5jb21wYXJlZFRvKHVwZGF0ZWRPcmRlcltjaGFuZ2VkS2V5XSkgPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBoYW5kbGVyID0gdGhpcy5wYXJ0aWFsSGFuZGxlcltjaGFuZ2VkS2V5XTsKCiAgICAgIGlmICh0eXBlb2YgaGFuZGxlciAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCFwYXJ0aWNpcGFudCkgcmV0dXJuOwogICAgICB2YXIgcGVlciA9IHBhcnRpY2lwYW50LnBlZXI7CiAgICAgIHZhciBuZXdPcmRlciA9IGhhbmRsZXIodXBkYXRlZE9yZGVyLCB0aGlzKTsKCiAgICAgIGlmICghbmV3T3JkZXIgfHwgIW5ld09yZGVyLmJ1eUFtb3VudCB8fCAhbmV3T3JkZXIuc2VsbEFtb3VudCkgewogICAgICAgIHRoaXMuZGVjbGluZVJlcXVlc3RGb3JQYXJ0aWFsKHBhcnRpY2lwYW50LnBlZXIpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBidXlBbW91bnQgPSBuZXdPcmRlci5idXlBbW91bnQsCiAgICAgICAgICAgIHNlbGxBbW91bnQgPSBuZXdPcmRlci5zZWxsQW1vdW50OwogICAgICAgIHRoaXMuYWNjZXB0UmVxdWVzdEZvclBhcnRpYWwoewogICAgICAgICAgYnV5QW1vdW50OiBidXlBbW91bnQsCiAgICAgICAgICBzZWxsQW1vdW50OiBzZWxsQW1vdW50CiAgICAgICAgfSwgcGFydGljaXBhbnQucGVlcik7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqDQogICAgICogQHBhcmFtIGNhbGxiYWNrIC0gYXdhaXRpbmcgZm9yIHJlc3BvbnNlIC0gYWNjZXB0IC8gZGVjbGluZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZW5kUmVxdWVzdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VuZFJlcXVlc3QoY2FsbGJhY2ssIHJlcXVlc3RPcHRpb25zKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGRlc3RpbmF0aW9uQWRkcmVzcyA9IHJlcXVlc3RPcHRpb25zLmFkZHJlc3MsCiAgICAgICAgICBwYXJ0aWNpcGFudE1ldGFkYXRhID0gcmVxdWVzdE9wdGlvbnMucGFydGljaXBhbnRNZXRhZGF0YTsKCiAgICAgIGlmICh0aGlzLmFwcC5zZXJ2aWNlcy5yb29tLnBlZXIgPT09IHRoaXMub3duZXIucGVlcikgewogICAgICAgIGNvbnNvbGUud2FybignWW91IGFyZSB0aGUgb3duZXIgb2YgdGhpcyBPcmRlci4gWW91IGNhblwndCBzZW5kIHJlcXVlc3QgdG8geW91cnNlbGYuJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5pc1JlcXVlc3RlZCkgewogICAgICAgIGNvbnNvbGUud2FybignWW91IGhhdmUgYWxyZWFkeSByZXF1ZXN0ZWQgdGhpcyBzd2FwLicpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGUoewogICAgICAgIGlzUmVxdWVzdGVkOiB0cnVlCiAgICAgIH0pOwogICAgICB2YXIgcGFydGljaXBhbnQgPSB0aGlzLmFwcC5zZXJ2aWNlcy5hdXRoLmdldFB1YmxpY0RhdGEoKTsKICAgICAgdGhpcy5hcHAuc2VydmljZXMucm9vbS5zZW5kTWVzc2FnZVBlZXIodGhpcy5vd25lci5wZWVyLCB7CiAgICAgICAgZXZlbnQ6ICdyZXF1ZXN0IHN3YXAnLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIG9yZGVySWQ6IHRoaXMuaWQsCiAgICAgICAgICBwYXJ0aWNpcGFudDogcGFydGljaXBhbnQsCiAgICAgICAgICBwYXJ0aWNpcGFudE1ldGFkYXRhOiBwYXJ0aWNpcGFudE1ldGFkYXRhLAogICAgICAgICAgZGVzdGluYXRpb246IHsKICAgICAgICAgICAgYWRkcmVzczogZGVzdGluYXRpb25BZGRyZXNzCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5hcHAuc2VydmljZXMucm9vbS5vbignYWNjZXB0IHN3YXAgcmVxdWVzdCcsIGZ1bmN0aW9uIChfcmVmNCkgewogICAgICAgIHZhciBvcmRlcklkID0gX3JlZjQub3JkZXJJZDsKCiAgICAgICAgaWYgKG9yZGVySWQgPT09IHNlbGYuaWQpIHsKICAgICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTsKICAgICAgICAgIHNlbGYudXBkYXRlKHsKICAgICAgICAgICAgaXNQcm9jZXNzaW5nOiB0cnVlLAogICAgICAgICAgICBpc1JlcXVlc3RlZDogZmFsc2UsCiAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHNlbGYuZGVzdGluYXRpb24pLCB7fSwgewogICAgICAgICAgICAgIHBhcnRpY2lwYW50QWRkcmVzczogZGVzdGluYXRpb25BZGRyZXNzCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KTsKICAgICAgICAgIGNhbGxiYWNrKHRydWUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20ub24oJ2RlY2xpbmUgc3dhcCByZXF1ZXN0JywgZnVuY3Rpb24gKF9yZWY1KSB7CiAgICAgICAgdmFyIG9yZGVySWQgPSBfcmVmNS5vcmRlcklkOwoKICAgICAgICBpZiAob3JkZXJJZCA9PT0gc2VsZi5pZCkgewogICAgICAgICAgdGhpcy51bnN1YnNjcmliZSgpOwogICAgICAgICAgc2VsZi51cGRhdGUoewogICAgICAgICAgICBpc1JlcXVlc3RlZDogZmFsc2UKICAgICAgICAgIH0pOyAvLyBUT0RPIHRoaW5rIGFib3V0IHByZXZlbnRpbmcgdXNlciBmcm9tIHNlbnQgcmVxdWVzdHMgZXZlcnkgTiBzZWNvbmRzCgogICAgICAgICAgY2FsbGJhY2soZmFsc2UpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiYWNjZXB0UmVxdWVzdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWNjZXB0UmVxdWVzdChwYXJ0aWNpcGFudFBlZXIpIHsKICAgICAgdmFyIF90aGlzJHJlcXVlc3RzJGZpbmQgPSB0aGlzLnJlcXVlc3RzLmZpbmQoZnVuY3Rpb24gKF9yZWY2KSB7CiAgICAgICAgdmFyIHBlZXIgPSBfcmVmNi5wYXJ0aWNpcGFudC5wZWVyOwogICAgICAgIHJldHVybiBwZWVyID09PSBwYXJ0aWNpcGFudFBlZXI7CiAgICAgIH0pLAogICAgICAgICAgcGFydGljaXBhbnQgPSBfdGhpcyRyZXF1ZXN0cyRmaW5kLnBhcnRpY2lwYW50LAogICAgICAgICAgZGVzdGluYXRpb24gPSBfdGhpcyRyZXF1ZXN0cyRmaW5kLmRlc3RpbmF0aW9uOwoKICAgICAgdmFyIGFkZHJlc3MgPSBkZXN0aW5hdGlvbi5hZGRyZXNzOwogICAgICB0aGlzLnVwZGF0ZSh7CiAgICAgICAgaXNSZXF1ZXN0ZWQ6IGZhbHNlLAogICAgICAgIGlzUHJvY2Vzc2luZzogdHJ1ZSwKICAgICAgICBwYXJ0aWNpcGFudDogcGFydGljaXBhbnQsCiAgICAgICAgZGVzdGluYXRpb246IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5kZXN0aW5hdGlvbiksIHt9LCB7CiAgICAgICAgICBwYXJ0aWNpcGFudEFkZHJlc3M6IGFkZHJlc3MKICAgICAgICB9KSwKICAgICAgICByZXF1ZXN0czogW10KICAgICAgfSk7CiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20uc2VuZE1lc3NhZ2VQZWVyKHBhcnRpY2lwYW50UGVlciwgewogICAgICAgIGV2ZW50OiAnYWNjZXB0IHN3YXAgcmVxdWVzdCcsCiAgICAgICAgZGF0YTogewogICAgICAgICAgb3JkZXJJZDogdGhpcy5pZAogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVjbGluZVJlcXVlc3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlY2xpbmVSZXF1ZXN0KHBhcnRpY2lwYW50UGVlcikgewogICAgICB2YXIgdXBkYXRlZFJlcXVlc3RzID0gdGhpcy5yZXF1ZXN0cy5maWx0ZXIoZnVuY3Rpb24gKF9yZWY3KSB7CiAgICAgICAgdmFyIHBlZXIgPSBfcmVmNy5wYXJ0aWNpcGFudC5wZWVyOwogICAgICAgIHJldHVybiBwZWVyICE9PSBwYXJ0aWNpcGFudFBlZXI7CiAgICAgIH0pOwogICAgICB0aGlzLnVwZGF0ZSh7CiAgICAgICAgaXNSZXF1ZXN0ZWQ6IGZhbHNlLAogICAgICAgIHJlcXVlc3RzOiB1cGRhdGVkUmVxdWVzdHMKICAgICAgfSk7CiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20uc2VuZE1lc3NhZ2VQZWVyKHBhcnRpY2lwYW50UGVlciwgewogICAgICAgIGV2ZW50OiAnZGVjbGluZSBzd2FwIHJlcXVlc3QnLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIG9yZGVySWQ6IHRoaXMuaWQKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICoNCiAgICAgKiBAcGFyYW0gdXBkYXRlZE9yZGVyLmJ1eUFtb3VudCAtIG9wdGlvbmFsIFN0cmluZw0KICAgICAqIEBwYXJhbSB1cGRhdGVkT3JkZXIuc2VsbEFtb3VudCAtIG9wdGlvbmFsIFN0cmluZw0KICAgICAqIEBwYXJhbSBjYWxsYmFjayAtIGNhbGxiYWNrIHdpbGwgcmVjZWl2ZSB1cGRhdGVkIG9yZGVyDQogICAgICogQHBhcmFtIGNvbmRpdGlvbkhhbmRsZXIgLSBhdXRvcmVwbHkgdG8gbmV3IG9yZGVyIHByb3Bvc2FsDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNlbmRSZXF1ZXN0Rm9yUGFydGlhbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VuZFJlcXVlc3RGb3JQYXJ0aWFsKHVwZGF0ZWRPcmRlciwgcmVxdWVzdE9wdGlvbnMsIGNhbGxiYWNrLCBjb25kaXRpb25IYW5kbGVyKSB7CiAgICAgIGNvbnNvbGUubG9nKCc+Pj4gc2VuZFJlcXVlc3RGb3JQYXJ0aWFsJyk7CiAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGVkT3JkZXInLCB1cGRhdGVkT3JkZXIpOwogICAgICBjb25zb2xlLmxvZygncmVxdWVzdE9wdGlvbnMnLCByZXF1ZXN0T3B0aW9ucyk7CgogICAgICBpZiAoIXRoaXMuaXNQYXJ0aWFsKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW50IHJlcXVlc3QgcGFydGlhbCBmdWxmaWxtZW50IGZvciBvcmRlciAiLmNvbmNhdCh0aGlzLmlkKSk7CiAgICAgIH0KCiAgICAgIHZhciBfdXBkYXRlZE9yZGVyID0gdXBkYXRlZE9yZGVyLAogICAgICAgICAgYnV5QW1vdW50ID0gX3VwZGF0ZWRPcmRlci5idXlBbW91bnQsCiAgICAgICAgICBzZWxsQW1vdW50ID0gX3VwZGF0ZWRPcmRlci5zZWxsQW1vdW50OwogICAgICB1cGRhdGVkT3JkZXIgPSB7CiAgICAgICAgYnV5QW1vdW50OiBidXlBbW91bnQsCiAgICAgICAgc2VsbEFtb3VudDogc2VsbEFtb3VudAogICAgICB9OwoKICAgICAgaWYgKCF1cGRhdGVkT3JkZXIpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGJ1eUFtb3VudCwgc2VsbEFtb3VudCBnaXZlbi4gRXhpdCBwYXJ0aWFsIik7CiAgICAgIH0KCiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmFwcC5zZXJ2aWNlcy5yb29tLnBlZXIgPT09IHRoaXMub3duZXIucGVlcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1lvdSBhcmUgdGhlIG93bmVyIG9mIHRoaXMgT3JkZXIuIFlvdSBjYW5cJ3Qgc2VuZCByZXF1ZXN0IHRvIHlvdXJzZWxmLicpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGRlc3RpbmF0aW9uQWRkcmVzcyA9IHJlcXVlc3RPcHRpb25zLmFkZHJlc3MsCiAgICAgICAgICBwYXJ0aWNpcGFudE1ldGFkYXRhID0gcmVxdWVzdE9wdGlvbnMucGFydGljaXBhbnRNZXRhZGF0YTsKICAgICAgdmFyIHBhcnRpY2lwYW50ID0gdGhpcy5hcHAuc2VydmljZXMuYXV0aC5nZXRQdWJsaWNEYXRhKCk7IC8vY29uc29sZS5sb2coJy0+IHJlcXVlc3QgcGFydGlhbCBmdWxmaWxtZW50JykKCiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20uc2VuZE1lc3NhZ2VQZWVyKHRoaXMub3duZXIucGVlciwgewogICAgICAgIGV2ZW50OiAncmVxdWVzdCBwYXJ0aWFsIGZ1bGZpbG1lbnQnLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIG9yZGVySWQ6IHRoaXMuaWQsCiAgICAgICAgICBwYXJ0aWNpcGFudDogcGFydGljaXBhbnQsCiAgICAgICAgICBwYXJ0aWNpcGFudE1ldGFkYXRhOiBwYXJ0aWNpcGFudE1ldGFkYXRhLAogICAgICAgICAgZGVzdGluYXRpb246IHsKICAgICAgICAgICAgYWRkcmVzczogZGVzdGluYXRpb25BZGRyZXNzCiAgICAgICAgICB9LAogICAgICAgICAgdXBkYXRlZE9yZGVyOiB1cGRhdGVkT3JkZXIKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmFwcC5zZXJ2aWNlcy5yb29tLm9uKCdhY2NlcHQgcGFydGlhbCBmdWxmaWxtZW50JywgZnVuY3Rpb24gKF9yZWY4KSB7CiAgICAgICAgdmFyIG9yZGVySWQgPSBfcmVmOC5vcmRlcklkLAogICAgICAgICAgICBuZXdPcmRlcklkID0gX3JlZjgubmV3T3JkZXJJZCwKICAgICAgICAgICAgbmV3T3JkZXIgPSBfcmVmOC5uZXdPcmRlcjsKICAgICAgICBjb25zb2xlLmxvZygnPC0gYWNjZXB0IHBhcnRpYWwgZnVsZmlsbWVudCcpOwoKICAgICAgICBpZiAob3JkZXJJZCA9PT0gc2VsZi5pZCkgewogICAgICAgICAgdGhpcy51bnN1YnNjcmliZSgpOyAvL2NvbnNvbGUubG9nKCdvcmRlcklkJywgb3JkZXJJZCkKICAgICAgICAgIC8vY29uc29sZS5sb2coJ25ld09yZGVySWQnLCBuZXdPcmRlcklkKQogICAgICAgICAgLy8gbG9jYXRlIG5ldyBvcmRlcgogICAgICAgICAgLy9jb25zb2xlLmxvZygnY29sbGVjdGlvbiA9ICcsIHNlbGYuY29sbGVjdGlvbikKCiAgICAgICAgICB2YXIgX25ld09yZGVyID0gc2VsZi5jb2xsZWN0aW9uLmdldEJ5S2V5KG5ld09yZGVySWQpOwoKICAgICAgICAgIGlmICghX25ld09yZGVyKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1BhcnR5IGNyZWF0ZWQgbm8gb3JkZXIgd2l0aCBpZCA9JywgbmV3T3JkZXJJZCk7CiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCBmYWxzZSk7CiAgICAgICAgICB9IC8vIGNoZWNrIHRoYXQgdmFsdWVzIG1hdGNoIHVwZGF0ZWRPcmRlciBhbmQgb2xkIG9yZGVyCgoKICAgICAgICAgIHZhciBvayA9IF9uZXdPcmRlci5idXlDdXJyZW5jeSA9PT0gc2VsZi5idXlDdXJyZW5jeSAmJiBfbmV3T3JkZXIuc2VsbEN1cnJlbmN5ID09PSBzZWxmLnNlbGxDdXJyZW5jeTsKCiAgICAgICAgICBpZiAoIW9rKSB7CiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhfbmV3T3JkZXIsIGZhbHNlKTsKICAgICAgICAgIH0gLy8gaWYgY29uZGl0aW9uIHRvIGNoZWNrIGlzIG5vdCBnaXZlbiwKICAgICAgICAgIC8vIHdlIG5lZWQgbG9naWMgb24gY2xpZW50IGFwcCBzaWRlCgoKICAgICAgICAgIGlmICh0eXBlb2YgY29uZGl0aW9uSGFuZGxlciAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAvLyBUT0RPOiBwYXNzIGRlc3RpbmF0aW9uIGFuZCBwYXJ0aWNpcGFudE1ldGFkYXRhCiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhfbmV3T3JkZXIpOwogICAgICAgICAgfSAvLyBlbHNlLCB3ZSBjYW4gc3RhcnQgc3dhcCBhdXRvbWF0aWNhbGx5CgoKICAgICAgICAgIHZhciBuZXdPcmRlcklzR29vZCA9IGNvbmRpdGlvbkhhbmRsZXIoc2VsZiwgX25ld09yZGVyKTsKCiAgICAgICAgICBpZiAobmV3T3JkZXJJc0dvb2QpIHsKICAgICAgICAgICAgLy8gcmVxdWVzdCB0aGF0IG5ldyBvcmRlcgogICAgICAgICAgICBfbmV3T3JkZXIuc2VuZFJlcXVlc3QoZnVuY3Rpb24gKGFjY2VwdGVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKF9uZXdPcmRlciwgYWNjZXB0ZWQpOwogICAgICAgICAgICB9LCByZXF1ZXN0T3B0aW9ucyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjYWxsYmFjayhfbmV3T3JkZXIsIGZhbHNlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmFwcC5zZXJ2aWNlcy5yb29tLm9uKCdkZWNsaW5lIHBhcnRpYWwgZnVsZmlsbWVudCcsIGZ1bmN0aW9uIChfcmVmOSkgewogICAgICAgIHZhciBvcmRlcklkID0gX3JlZjkub3JkZXJJZDsKICAgICAgICBjb25zb2xlLmxvZygnPC0gZGVjbGluZSBwYXJ0aWFsIGZ1bGZpbG1lbnQnKTsKCiAgICAgICAgaWYgKG9yZGVySWQgPT09IHNlbGYuaWQpIHsKICAgICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTsgLy8gVE9ETyB0aGluayBhYm91dCBwcmV2ZW50aW5nIHVzZXIgZnJvbSBzZW50IHJlcXVlc3RzIGV2ZXJ5IE4gc2Vjb25kcwoKICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICoNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gbmV3VmFsdWVzIC0geyBidXlBbW91bnQsIHNlbGxBbW91bnQgfSAtIG5ldyBvcmRlciB2YWx1ZXMNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGFydGljaXBhbnRQZWVyIC0gcGFydGljaXBhbnQgcGVlciBpZA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhY2NlcHRSZXF1ZXN0Rm9yUGFydGlhbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWNjZXB0UmVxdWVzdEZvclBhcnRpYWwobmV3VmFsdWVzLCBwYXJ0aWNpcGFudFBlZXIpIHsKICAgICAgY29uc29sZS5sb2coJz4+PiBhY2NlcHRSZXF1ZXN0Rm9yUGFydGlhbCgpIG5ld1ZhbHVlcyA9JywgbmV3VmFsdWVzKTsKICAgICAgdmFyIGJ1eUN1cnJlbmN5ID0gdGhpcy5idXlDdXJyZW5jeSwKICAgICAgICAgIHNlbGxDdXJyZW5jeSA9IHRoaXMuc2VsbEN1cnJlbmN5LAogICAgICAgICAgaXNUdXJibyA9IHRoaXMuaXNUdXJibzsKICAgICAgdmFyIGJ1eUFtb3VudCA9IG5ld1ZhbHVlcy5idXlBbW91bnQsCiAgICAgICAgICBzZWxsQW1vdW50ID0gbmV3VmFsdWVzLnNlbGxBbW91bnQ7CiAgICAgIHZhciB1cGRhdGVkUmVxdWVzdHMgPSB0aGlzLnJlcXVlc3RzLmZpbHRlcihmdW5jdGlvbiAoX3JlZjEwKSB7CiAgICAgICAgdmFyIHBlZXIgPSBfcmVmMTAucGFydGljaXBhbnQucGVlcjsKICAgICAgICByZXR1cm4gcGVlciAhPT0gcGFydGljaXBhbnRQZWVyOwogICAgICB9KTsKICAgICAgdGhpcy51cGRhdGUoewogICAgICAgIGlzUmVxdWVzdGVkOiBmYWxzZSwKICAgICAgICByZXF1ZXN0czogdXBkYXRlZFJlcXVlc3RzCiAgICAgIH0pOwogICAgICBjb25zb2xlLmxvZygnQ3JlYXRlIG5ldyBwYXJ0aWFsIG9yZGVyLi4uJyk7CiAgICAgIHZhciBuZXdPcmRlciA9IHRoaXMuY29sbGVjdGlvbi5jcmVhdGUoewogICAgICAgIGJ1eUFtb3VudDogYnV5QW1vdW50LAogICAgICAgIHNlbGxBbW91bnQ6IHNlbGxBbW91bnQsCiAgICAgICAgYnV5Q3VycmVuY3k6IGJ1eUN1cnJlbmN5LAogICAgICAgIHNlbGxDdXJyZW5jeTogc2VsbEN1cnJlbmN5LAogICAgICAgIGlzVHVyYm86IGlzVHVyYm8KICAgICAgfSk7CiAgICAgIGNvbnNvbGUubG9nKCduZXcgb3JkZXIgPSAnLCBuZXdPcmRlcik7CiAgICAgIGNvbnNvbGUubG9nKCdhbmQgY29sbGVjdGlvbiA9ICcsIHRoaXMuY29sbGVjdGlvbik7CiAgICAgIGNvbnNvbGUubG9nKCdzZW5kIHRvIHBlZXIgJywgewogICAgICAgIG9yZGVySWQ6IHRoaXMuaWQsCiAgICAgICAgbmV3T3JkZXJJZDogbmV3T3JkZXIuaWQKICAgICAgfSk7CiAgICAgIGNvbnNvbGUubG9nKCctPiBhY2NlcHQgcGFydGlhbCBmdWxmaWxtZW50Jyk7CiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20uc2VuZE1lc3NhZ2VQZWVyKHBhcnRpY2lwYW50UGVlciwgewogICAgICAgIGV2ZW50OiAnYWNjZXB0IHBhcnRpYWwgZnVsZmlsbWVudCcsCiAgICAgICAgZGF0YTogewogICAgICAgICAgb3JkZXJJZDogdGhpcy5pZCwKICAgICAgICAgIG5ld09yZGVySWQ6IG5ld09yZGVyLmlkCiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZWNsaW5lUmVxdWVzdEZvclBhcnRpYWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlY2xpbmVSZXF1ZXN0Rm9yUGFydGlhbChwYXJ0aWNpcGFudFBlZXIpIHsKICAgICAgLy8gVE9ETyB0aGlzIHJlbW92ZXMgYWxsIHJlcXVlc3RzLCB3ZSBuZWVkIHRvIHJlbW92ZSBvbmx5IG9uZSByZWZlcmVuY2VkCiAgICAgIHZhciB1cGRhdGVkUmVxdWVzdHMgPSB0aGlzLnJlcXVlc3RzLmZpbHRlcihmdW5jdGlvbiAoX3JlZjExKSB7CiAgICAgICAgdmFyIHBlZXIgPSBfcmVmMTEucGFydGljaXBhbnQucGVlcjsKICAgICAgICByZXR1cm4gcGVlciAhPT0gcGFydGljaXBhbnRQZWVyOwogICAgICB9KTsKICAgICAgdGhpcy51cGRhdGUoewogICAgICAgIGlzUmVxdWVzdGVkOiBmYWxzZSwKICAgICAgICByZXF1ZXN0czogdXBkYXRlZFJlcXVlc3RzCiAgICAgIH0pOwogICAgICB0aGlzLmFwcC5zZXJ2aWNlcy5yb29tLnNlbmRNZXNzYWdlUGVlcihwYXJ0aWNpcGFudFBlZXIsIHsKICAgICAgICBldmVudDogJ2RlY2xpbmUgcGFydGlhbCBmdWxmaWxtZW50JywKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBvcmRlcklkOiB0aGlzLmlkCiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgLSBbJ2J1eUFtb3VudCcsJ3NlbGxBbW91bnQnXQ0KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGhhbmRsZXIgLSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb24gcGFydGlhbCByZXF1ZXN0IHRvIHRoYXQgb3JkZXINCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2V0UmVxdWVzdEhhbmRsZXJGb3JQYXJ0aWFsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRSZXF1ZXN0SGFuZGxlckZvclBhcnRpYWwodHlwZSwgaGFuZGxlcikgewogICAgICBpZiAoIXRoaXMuaXNNeSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiUmVxdWVzdEhhbmRsZXJFcnJvcjogTm90IGFuIG93bmVyIik7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlICE9PSAnYnV5QW1vdW50JyAmJiB0eXBlICE9PSAnc2VsbEFtb3VudCcpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlJlcXVlc3RIYW5kbGVyRXJyb3I6IEtleSA9ICciLmNvbmNhdCh0eXBlLCAiJyBpcyBub3QgaW4gWydidXlBbW91bnQnLCdzZWxsQW1vdW50J10iKSk7CiAgICAgIH0KCiAgICAgIHRoaXMucGFydGlhbEhhbmRsZXJbdHlwZV0gPSBoYW5kbGVyOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9XSk7CgogIHJldHVybiBPcmRlcjsKfSgpOwoKZXhwb3J0IGRlZmF1bHQgT3JkZXI7"},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/core/swap.orders/Order.ts"],"names":["debug","SwapApp","BigNumber","events","Order","app","parentCollection","data","id","isMy","isTurbo","owner","participant","buyCurrency","exchangeRate","sellCurrency","buyAmount","sellAmount","collection","requests","isRequested","isProcessing","isPartial","isHidden","partialHandler","destination","_attachSwapApp","_update","peer","services","room","_onMount","required","on","orderId","participantMetadata","find","reputation","eth","address","btc","env","swapsExplorer","getVerifiedReputation","err","push","dispatch","updatedOrder","console","log","filteredUpdatedOrder","_autoReplyToPartial","values","Object","keys","forEach","key","_saveMyOrders","changedKey","comparedTo","handler","newOrder","declineRequestForPartial","acceptRequestForPartial","callback","requestOptions","self","destinationAddress","warn","update","auth","getPublicData","sendMessagePeer","event","unsubscribe","participantAddress","participantPeer","updatedRequests","filter","conditionHandler","Error","error","newOrderId","getByKey","ok","newOrderIsGood","sendRequest","accepted","newValues","create","type"],"mappings":"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","sourcesContent":["import debug from 'debug'\r\nimport SwapApp from 'swap.app'\r\nimport BigNumber from 'bignumber.js'\r\nimport events from './events'\r\n\r\n\r\nclass Order {\r\n\r\n  id: string\r\n  isMy: any\r\n  isTurbo: boolean\r\n  owner: any\r\n  participant: any\r\n  buyCurrency: any\r\n  exchangeRate: any\r\n  sellCurrency: any\r\n  buyAmount: any\r\n  sellAmount: any\r\n  collection: any\r\n  requests: any\r\n  isRequested: any\r\n  isProcessing: any\r\n  isPartial: any\r\n  isHidden: any\r\n  partialHandler: any\r\n  destination: any\r\n  app: any\r\n\r\n  /**\r\n   *\r\n   * @param {object}  parent\r\n   * @param {object}  data\r\n   * @param {string}  data.id\r\n   * @param {object}  data.owner\r\n   * @param {string}  data.owner.peer\r\n   * @param {number}  data.owner.reputation\r\n   * @param {object}  data.owner.<currency>\r\n   * @param {string}  data.owner.<currency>.address\r\n   * @param {string}  data.owner.<currency>.publicKey\r\n   * @param {string}  data.buyCurrency\r\n   * @param {string}  data.sellCurrency\r\n   * @param {number}  data.buyAmount\r\n   * @param {number}  data.sellAmount\r\n   */\r\n  constructor(app, parentCollection, data) {\r\n    this.id             = data.id\r\n    this.isMy           = null\r\n    this.isTurbo        = null\r\n    this.owner          = null\r\n    this.participant    = null\r\n    this.buyCurrency    = null\r\n    this.exchangeRate   = null\r\n    this.sellCurrency   = null\r\n    this.buyAmount      = null\r\n    this.sellAmount     = null\r\n\r\n    this.collection       = parentCollection\r\n    this.requests         = [] // income requests\r\n    this.isRequested      = false // outcome request status\r\n    this.isProcessing     = false // if swap isProcessing\r\n    this.isPartial        = false\r\n    this.isHidden         = false\r\n\r\n    this.partialHandler   = {\r\n      buyAmount: () => false,\r\n      sellAmount: () => false,\r\n    }\r\n\r\n    this.destination = null\r\n\r\n\r\n    this._attachSwapApp(app)\r\n\r\n    this._update({\r\n      ...data,\r\n      isMy: data.owner.peer === this.app.services.room.peer,\r\n    })\r\n\r\n    this._onMount()\r\n  }\r\n\r\n  _attachSwapApp(app) {\r\n    SwapApp.required(app)\r\n\r\n    this.app = app\r\n  }\r\n\r\n  _onMount() {\r\n    this.app.services.room.on('request swap', ({ orderId, participant, participantMetadata, destination }) => {\r\n      if (orderId === this.id /*&& this.requests.length < 10*/ && !this.requests.find(({ participant: { peer } }) => peer === participant.peer)) {\r\n        let reputation = 0\r\n\r\n        try {\r\n          // todo: check other blockchains\r\n          if (participant.eth.address === participantMetadata.address || participant.btc.address === participantMetadata.address) {\r\n            reputation = this.app.env.swapsExplorer.getVerifiedReputation(participantMetadata)\r\n          }\r\n        } catch (err) {\r\n          debug('swap.core:order')(err)\r\n        }\r\n\r\n        this.requests.push({\r\n          participant,\r\n          destination,\r\n          reputation,\r\n          isPartial: false,\r\n        })\r\n\r\n        events.dispatch('new order request', {\r\n          orderId,\r\n          participant,\r\n          destination,\r\n          participantMetadata,\r\n        })\r\n      }\r\n    })\r\n\r\n    this.app.services.room.on('request partial fulfilment', ({ orderId, participant, participantMetadata, destination, updatedOrder }) => {\r\n      console.log('<- request partial fulfilment')\r\n      if (orderId === this.id) {\r\n        const { buyAmount, sellAmount } = updatedOrder\r\n\r\n        // todo: add check reputation like as 'request swap'\r\n        let reputation = 0\r\n\r\n        const filteredUpdatedOrder = {\r\n          buyAmount,\r\n          sellAmount,\r\n        }\r\n\r\n        this.requests.push({\r\n          participant,\r\n          destination,\r\n          updatedOrder: filteredUpdatedOrder,\r\n        })\r\n\r\n        events.dispatch('new partial fulfilment request', {\r\n          orderId,\r\n          participant,\r\n          updatedOrder: filteredUpdatedOrder,\r\n        })\r\n\r\n        this._autoReplyToPartial('buyAmount', filteredUpdatedOrder, participant)\r\n        this._autoReplyToPartial('sellAmount', filteredUpdatedOrder, participant)\r\n      }\r\n    })\r\n  }\r\n\r\n  _update(values) {\r\n    Object.keys(values).forEach((key) => {\r\n      this[key] = values[key]\r\n    })\r\n  }\r\n\r\n  update(values) {\r\n    this._update(values)\r\n    this.collection._saveMyOrders()\r\n\r\n    events.dispatch('swap update', this, values)\r\n  }\r\n\r\n  _autoReplyToPartial(changedKey, updatedOrder, participant) {\r\n    console.log('>>> _autoReplyToPartial')\r\n    if (!this.isPartial) {\r\n      return\r\n    }\r\n\r\n    if (!updatedOrder[changedKey]) {\r\n      return\r\n    }\r\n\r\n    updatedOrder[changedKey] = new BigNumber(updatedOrder[changedKey])\r\n\r\n    if (this[changedKey].comparedTo(updatedOrder[changedKey]) === 0) {\r\n      return\r\n    }\r\n\r\n    const handler = this.partialHandler[changedKey]\r\n\r\n    if (typeof handler !== 'function') {\r\n      return\r\n    }\r\n\r\n    if (!participant) return\r\n\r\n    const { peer } = participant\r\n\r\n    const newOrder = handler(updatedOrder, this)\r\n\r\n    if (!newOrder || !newOrder.buyAmount || !newOrder.sellAmount) {\r\n      this.declineRequestForPartial(participant.peer)\r\n    } else {\r\n      const { buyAmount, sellAmount } = newOrder\r\n\r\n      this.acceptRequestForPartial({ buyAmount, sellAmount }, participant.peer)\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param callback - awaiting for response - accept / decline\r\n   */\r\n  sendRequest(callback, requestOptions) {\r\n    const self = this\r\n\r\n    const {\r\n      address: destinationAddress,\r\n      participantMetadata,\r\n    } = requestOptions\r\n\r\n    if (this.app.services.room.peer === this.owner.peer) {\r\n      console.warn('You are the owner of this Order. You can\\'t send request to yourself.')\r\n      return\r\n    }\r\n\r\n    if (this.isRequested) {\r\n      console.warn('You have already requested this swap.')\r\n      return\r\n    }\r\n\r\n    this.update({\r\n      isRequested: true,\r\n    })\r\n\r\n    const participant = this.app.services.auth.getPublicData()\r\n\r\n    this.app.services.room.sendMessagePeer(this.owner.peer, {\r\n      event: 'request swap',\r\n      data: {\r\n        orderId: this.id,\r\n        participant,\r\n        participantMetadata,\r\n        destination: {\r\n          address: destinationAddress,\r\n        },\r\n      },\r\n    })\r\n\r\n    this.app.services.room.on('accept swap request', function ({ orderId }) {\r\n      if (orderId === self.id) {\r\n        this.unsubscribe()\r\n\r\n        self.update({\r\n          isProcessing: true,\r\n          isRequested: false,\r\n          destination: {\r\n            ...self.destination,\r\n            participantAddress: destinationAddress,\r\n          },\r\n        })\r\n\r\n        callback(true)\r\n      }\r\n    })\r\n\r\n    this.app.services.room.on('decline swap request', function ({ orderId }) {\r\n      if (orderId === self.id) {\r\n        this.unsubscribe()\r\n\r\n        self.update({\r\n          isRequested: false,\r\n        })\r\n\r\n        // TODO think about preventing user from sent requests every N seconds\r\n        callback(false)\r\n      }\r\n    })\r\n  }\r\n\r\n  acceptRequest(participantPeer) {\r\n    const { participant, destination } = this.requests.find(({ participant: { peer } }) => peer === participantPeer)\r\n\r\n    const { address } = destination\r\n\r\n    this.update({\r\n      isRequested: false,\r\n      isProcessing: true,\r\n      participant,\r\n      destination: {\r\n        ...this.destination,\r\n        participantAddress: address,\r\n      },\r\n      requests: [],\r\n    })\r\n\r\n    this.app.services.room.sendMessagePeer(participantPeer, {\r\n      event: 'accept swap request',\r\n      data: {\r\n        orderId: this.id,\r\n      },\r\n    })\r\n  }\r\n\r\n  declineRequest(participantPeer) {\r\n    const updatedRequests = this.requests.filter(({ participant: { peer } }) => {\r\n      return peer !== participantPeer\r\n    })\r\n\r\n    this.update({\r\n      isRequested: false,\r\n      requests: updatedRequests,\r\n    })\r\n\r\n    this.app.services.room.sendMessagePeer(participantPeer, {\r\n      event: 'decline swap request',\r\n      data: {\r\n        orderId: this.id,\r\n      },\r\n    })\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param updatedOrder.buyAmount - optional String\r\n   * @param updatedOrder.sellAmount - optional String\r\n   * @param callback - callback will receive updated order\r\n   * @param conditionHandler - autoreply to new order proposal\r\n   */\r\n  sendRequestForPartial(updatedOrder, requestOptions, callback, conditionHandler) {\r\n    console.log('>>> sendRequestForPartial')\r\n    console.log('updatedOrder', updatedOrder)\r\n    console.log('requestOptions', requestOptions)\r\n    if (!this.isPartial) {\r\n      throw new Error(`Cant request partial fulfilment for order ${this.id}`)\r\n    }\r\n\r\n    const { buyAmount, sellAmount } = updatedOrder\r\n    updatedOrder = { buyAmount, sellAmount }\r\n\r\n    if (!updatedOrder) {\r\n      throw new Error(`No buyAmount, sellAmount given. Exit partial`)\r\n    }\r\n\r\n    const self = this\r\n\r\n    if (this.app.services.room.peer === this.owner.peer) {\r\n      console.error('You are the owner of this Order. You can\\'t send request to yourself.')\r\n      return\r\n    }\r\n\r\n    const {\r\n      address: destinationAddress,\r\n      participantMetadata,\r\n    } = requestOptions\r\n\r\n    const participant = this.app.services.auth.getPublicData()\r\n\r\n    //console.log('-> request partial fulfilment')\r\n\r\n    this.app.services.room.sendMessagePeer(this.owner.peer, {\r\n      event: 'request partial fulfilment',\r\n      data: {\r\n        orderId: this.id,\r\n        participant,\r\n        participantMetadata,\r\n        destination: {\r\n          address: destinationAddress,\r\n        },\r\n        updatedOrder,\r\n      },\r\n    })\r\n\r\n    this.app.services.room.on('accept partial fulfilment', function ({ orderId, newOrderId, newOrder }) {\r\n      console.log('<- accept partial fulfilment')\r\n      if (orderId === self.id) {\r\n        this.unsubscribe()\r\n        //console.log('orderId', orderId)\r\n        //console.log('newOrderId', newOrderId)\r\n        // locate new order\r\n        //console.log('collection = ', self.collection)\r\n        const newOrder = self.collection.getByKey(newOrderId)\r\n\r\n        if (!newOrder) {\r\n          console.error('Party created no order with id =', newOrderId)\r\n          return callback(null, false)\r\n        }\r\n\r\n        // check that values match updatedOrder and old order\r\n        const ok = newOrder.buyCurrency === self.buyCurrency\r\n                && newOrder.sellCurrency === self.sellCurrency\r\n\r\n        if (!ok) {\r\n          return callback(newOrder, false)\r\n        }\r\n\r\n        // if condition to check is not given,\r\n        // we need logic on client app side\r\n        if (typeof conditionHandler !== 'function') {\r\n          // TODO: pass destination and participantMetadata\r\n          return callback(newOrder)\r\n        }\r\n\r\n        // else, we can start swap automatically\r\n        const newOrderIsGood = conditionHandler(self, newOrder)\r\n\r\n        if (newOrderIsGood) {\r\n          // request that new order\r\n          newOrder.sendRequest(accepted => callback(newOrder, accepted), requestOptions)\r\n        } else {\r\n          callback(newOrder, false)\r\n        }\r\n      }\r\n    })\r\n\r\n    this.app.services.room.on('decline partial fulfilment', function ({ orderId }) {\r\n      console.log('<- decline partial fulfilment')\r\n      if (orderId === self.id) {\r\n        this.unsubscribe()\r\n\r\n        // TODO think about preventing user from sent requests every N seconds\r\n        callback(null, false)\r\n      }\r\n    })\r\n\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {Object} newValues - { buyAmount, sellAmount } - new order values\r\n   * @param {String} participantPeer - participant peer id\r\n   */\r\n  acceptRequestForPartial(newValues, participantPeer) {\r\n    console.log('>>> acceptRequestForPartial() newValues =', newValues)\r\n    const { buyCurrency, sellCurrency, isTurbo } = this\r\n    const { buyAmount, sellAmount } = newValues\r\n\r\n    const updatedRequests = this.requests.filter(({ participant: { peer } }) => {\r\n      return peer !== participantPeer\r\n    })\r\n\r\n    this.update({\r\n      isRequested: false,\r\n      requests: updatedRequests,\r\n    })\r\n\r\n    console.log('Create new partial order...')\r\n\r\n    const newOrder = this.collection.create({\r\n      buyAmount,\r\n      sellAmount,\r\n      buyCurrency,\r\n      sellCurrency,\r\n      isTurbo\r\n    })\r\n\r\n    console.log('new order = ', newOrder)\r\n    console.log('and collection = ', this.collection)\r\n    console.log('send to peer ', {\r\n      orderId: this.id,\r\n      newOrderId: newOrder.id,\r\n    })\r\n\r\n    console.log('-> accept partial fulfilment')\r\n\r\n    this.app.services.room.sendMessagePeer(participantPeer, {\r\n      event: 'accept partial fulfilment',\r\n      data: {\r\n        orderId: this.id,\r\n        newOrderId: newOrder.id,\r\n      },\r\n    })\r\n  }\r\n\r\n  declineRequestForPartial(participantPeer) {\r\n    // TODO this removes all requests, we need to remove only one referenced\r\n    const updatedRequests = this.requests.filter(({ participant: { peer } }) => {\r\n      return peer !== participantPeer\r\n    })\r\n\r\n    this.update({\r\n      isRequested: false,\r\n      requests: updatedRequests,\r\n    })\r\n\r\n    this.app.services.room.sendMessagePeer(participantPeer, {\r\n      event: 'decline partial fulfilment',\r\n      data: {\r\n        orderId: this.id,\r\n      },\r\n    })\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {String} type - ['buyAmount','sellAmount']\r\n   * @param {function} handler - function to be called on partial request to that order\r\n   */\r\n  setRequestHandlerForPartial(type, handler) {\r\n    if (!this.isMy) {\r\n      throw new Error(`RequestHandlerError: Not an owner`)\r\n    }\r\n    if (type !== 'buyAmount' && type !== 'sellAmount') {\r\n      throw new Error(`RequestHandlerError: Key = '${type}' is not in ['buyAmount','sellAmount']`)\r\n    }\r\n\r\n    this.partialHandler[type] = handler\r\n\r\n    return this\r\n  }\r\n\r\n\r\n}\r\n\r\n\r\nexport default Order\r\n"]}]}