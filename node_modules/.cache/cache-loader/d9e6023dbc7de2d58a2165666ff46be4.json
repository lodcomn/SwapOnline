{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\pages\\CurrencyWallet\\CurrencyWallet.tsx","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\pages\\CurrencyWallet\\CurrencyWallet.tsx","mtime":1614852117577},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9leHRlbmRzIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXh0ZW5kcyI7CmltcG9ydCBfcmVhZE9ubHlFcnJvciBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3JlYWRPbmx5RXJyb3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2Fzc2VydFRoaXNJbml0aWFsaXplZCBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2Fzc2VydFRoaXNJbml0aWFsaXplZCI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbmhlcml0cyI7CmltcG9ydCBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2RlZmluZVByb3BlcnR5IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvdG9Db25zdW1hYmxlQXJyYXkiOwoKdmFyIF9kZWMsIF9kZWMyLCBfZGVjMywgX2NsYXNzLCBfdGVtcDsKCmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CgpmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOyBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkgcmV0dXJuIGZhbHNlOyBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTsgdHJ5IHsgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKLy8gQHRzLW5vY2hlY2sKaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCwgRnJhZ21lbnQgfSBmcm9tICdyZWFjdCc7CmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdyZWRhY3Rpb24nOwppbXBvcnQgYWN0aW9ucyBmcm9tICdyZWR1eC9hY3Rpb25zJzsKaW1wb3J0IHsgd2l0aFJvdXRlciB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nOwppbXBvcnQgaGVscGVycywgeyBsaW5rcywgY29uc3RhbnRzLCBldGhUb2tlbiB9IGZyb20gJ2hlbHBlcnMnOwppbXBvcnQgeyBnZXRUb2tlbldhbGxldCwgZ2V0Qml0Y29pbldhbGxldCwgZ2V0RXRoZXJXYWxsZXQsIGdldEdob3N0V2FsbGV0LCBnZXROZXh0V2FsbGV0IH0gZnJvbSAnaGVscGVycy9saW5rcyc7CmltcG9ydCBDU1NNb2R1bGVzIGZyb20gJ3JlYWN0LWNzcy1tb2R1bGVzJzsKaW1wb3J0IHN0eWxlcyBmcm9tICcuL0N1cnJlbmN5V2FsbGV0LnNjc3MnOwppbXBvcnQgc3R5bGVzSGVyZSBmcm9tICcuLi9IaXN0b3J5L0hpc3Rvcnkuc2Nzcyc7CmltcG9ydCBSb3cgZnJvbSAncGFnZXMvSGlzdG9yeS9Sb3cvUm93JzsKaW1wb3J0IFN3YXBzSGlzdG9yeSBmcm9tICdwYWdlcy9IaXN0b3J5L1N3YXBzSGlzdG9yeS9Td2Fwc0hpc3RvcnknOwppbXBvcnQgVGFibGUgZnJvbSAnY29tcG9uZW50cy90YWJsZXMvVGFibGUvVGFibGUnOwppbXBvcnQgUGFnZVNlbyBmcm9tICdjb21wb25lbnRzL1Nlby9QYWdlU2VvJzsKaW1wb3J0IHsgZ2V0U2VvUGFnZSB9IGZyb20gJ2hlbHBlcnMvc2VvJzsKaW1wb3J0IHsgaW5qZWN0SW50bCwgZGVmaW5lTWVzc2FnZXMgfSBmcm9tICdyZWFjdC1pbnRsJzsKaW1wb3J0IHsgbG9jYWxpc2VkVXJsIH0gZnJvbSAnaGVscGVycy9sb2NhbGUnOwppbXBvcnQgY29uZmlnIGZyb20gJ2FwcC1jb25maWcnOwppbXBvcnQgQmFsYW5jZUZvcm0gZnJvbSAnY29tcG9uZW50cy9CYWxhbmNlRm9ybS9CYWxhbmNlRm9ybSc7CmltcG9ydCB7IEJpZ051bWJlciB9IGZyb20gJ2JpZ251bWJlci5qcyc7CmltcG9ydCBDb250ZW50TG9hZGVyIGZyb20gJ2NvbXBvbmVudHMvbG9hZGVycy9Db250ZW50TG9hZGVyL0NvbnRlbnRMb2FkZXInOwppbXBvcnQgRmlsdGVyRm9ybSBmcm9tICdjb21wb25lbnRzL0ZpbHRlckZvcm0vRmlsdGVyRm9ybSc7CmltcG9ydCBEYXNoYm9hcmRMYXlvdXQgZnJvbSAnY29tcG9uZW50cy9sYXlvdXQvRGFzaGJvYXJkTGF5b3V0L0Rhc2hib2FyZExheW91dCc7CmltcG9ydCBnZXRDdXJyZW5jeUtleSBmcm9tICdoZWxwZXJzL2dldEN1cnJlbmN5S2V5JzsKaW1wb3J0IGxzRGF0YUNhY2hlIGZyb20gJ2hlbHBlcnMvbHNEYXRhQ2FjaGUnOwp2YXIgaXNXaWRnZXRCdWlsZCA9IGNvbmZpZyAmJiBjb25maWcuaXNXaWRnZXQ7CnZhciBpc0RhcmsgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMubG9jYWxTdG9yYWdlLmlzRGFyayk7CnZhciBDdXJyZW5jeVdhbGxldCA9IChfZGVjID0gY29ubmVjdChmdW5jdGlvbiAoX3JlZikgewogIHZhciBpc1NpZ25lZCA9IF9yZWYuc2lnblVwLmlzU2lnbmVkOwogIHJldHVybiB7CiAgICBpc1NpZ25lZDogaXNTaWduZWQKICB9Owp9KSwgX2RlYzIgPSBjb25uZWN0KGZ1bmN0aW9uIChfcmVmMikgewogIHZhciBjb3JlID0gX3JlZjIuY29yZSwKICAgICAgdXNlciA9IF9yZWYyLnVzZXIsCiAgICAgIF9yZWYyJGhpc3RvcnkgPSBfcmVmMi5oaXN0b3J5LAogICAgICB0cmFuc2FjdGlvbnMgPSBfcmVmMiRoaXN0b3J5LnRyYW5zYWN0aW9ucywKICAgICAgc3dhcEhpc3RvcnkgPSBfcmVmMiRoaXN0b3J5LnN3YXBIaXN0b3J5LAogICAgICBoaXN0b3J5ID0gX3JlZjIuaGlzdG9yeSwKICAgICAgX3JlZjIkdXNlciA9IF9yZWYyLnVzZXIsCiAgICAgIGV0aERhdGEgPSBfcmVmMiR1c2VyLmV0aERhdGEsCiAgICAgIGJ0Y0RhdGEgPSBfcmVmMiR1c2VyLmJ0Y0RhdGEsCiAgICAgIGdob3N0RGF0YSA9IF9yZWYyJHVzZXIuZ2hvc3REYXRhLAogICAgICBuZXh0RGF0YSA9IF9yZWYyJHVzZXIubmV4dERhdGEsCiAgICAgIGFjdGl2ZUZpYXQgPSBfcmVmMiR1c2VyLmFjdGl2ZUZpYXQsCiAgICAgIGFjdGl2ZUN1cnJlbmN5ID0gX3JlZjIkdXNlci5hY3RpdmVDdXJyZW5jeSwKICAgICAgYnRjTXVsdGlzaWdTTVNEYXRhID0gX3JlZjIkdXNlci5idGNNdWx0aXNpZ1NNU0RhdGEsCiAgICAgIGJ0Y011bHRpc2lnVXNlckRhdGEgPSBfcmVmMiR1c2VyLmJ0Y011bHRpc2lnVXNlckRhdGEsCiAgICAgIGlzRmV0Y2hpbmcgPSBfcmVmMiR1c2VyLmlzRmV0Y2hpbmcsCiAgICAgIGlzQmFsYW5jZUZldGNoaW5nID0gX3JlZjIkdXNlci5pc0JhbGFuY2VGZXRjaGluZywKICAgICAgdG9rZW5zRGF0YSA9IF9yZWYyJHVzZXIudG9rZW5zRGF0YSwKICAgICAgbXVsdGlzaWdTdGF0dXMgPSBfcmVmMiR1c2VyLm11bHRpc2lnU3RhdHVzLAogICAgICBtdWx0aXNpZ1BlbmRpbmdDb3VudCA9IF9yZWYyJHVzZXIubXVsdGlzaWdQZW5kaW5nQ291bnQ7CiAgcmV0dXJuIHsKICAgIGl0ZW1zOiBbZXRoRGF0YSwgYnRjRGF0YSwgZ2hvc3REYXRhLCBuZXh0RGF0YSwgYnRjTXVsdGlzaWdTTVNEYXRhLCBidGNNdWx0aXNpZ1VzZXJEYXRhXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KE9iamVjdC5rZXlzKHRva2Vuc0RhdGEpLm1hcChmdW5jdGlvbiAoaykgewogICAgICByZXR1cm4gdG9rZW5zRGF0YVtrXTsKICAgIH0pKSksCiAgICB0b2tlbnM6IF90b0NvbnN1bWFibGVBcnJheShPYmplY3Qua2V5cyh0b2tlbnNEYXRhKS5tYXAoZnVuY3Rpb24gKGspIHsKICAgICAgcmV0dXJuIHRva2Vuc0RhdGFba107CiAgICB9KSksCiAgICB1c2VyOiB1c2VyLAogICAgYWN0aXZlRmlhdDogYWN0aXZlRmlhdCwKICAgIGhpc3RvcnlUeDogaGlzdG9yeSwKICAgIGhpZGRlbkNvaW5zTGlzdDogY29yZS5oaWRkZW5Db2luc0xpc3QsCiAgICB0eEhpc3Rvcnk6IHRyYW5zYWN0aW9ucywKICAgIHN3YXBIaXN0b3J5OiBzd2FwSGlzdG9yeSwKICAgIGlzRmV0Y2hpbmc6IGlzRmV0Y2hpbmcsCiAgICBhY3RpdmVDdXJyZW5jeTogYWN0aXZlQ3VycmVuY3ksCiAgICBpc0JhbGFuY2VGZXRjaGluZzogaXNCYWxhbmNlRmV0Y2hpbmcsCiAgICBtdWx0aXNpZ1N0YXR1czogbXVsdGlzaWdTdGF0dXMsCiAgICBtdWx0aXNpZ1BlbmRpbmdDb3VudDogbXVsdGlzaWdQZW5kaW5nQ291bnQKICB9Owp9KSwgX2RlYzMgPSBDU1NNb2R1bGVzKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc3R5bGVzKSwgc3R5bGVzSGVyZSksIHsKICBhbGxvd011bHRpcGxlOiB0cnVlCn0pLCBfZGVjKF9jbGFzcyA9IF9kZWMyKF9jbGFzcyA9IGluamVjdEludGwoX2NsYXNzID0gd2l0aFJvdXRlcihfY2xhc3MgPSBfZGVjMyhfY2xhc3MgPSAoX3RlbXAgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoQ3VycmVuY3lXYWxsZXQsIF9Db21wb25lbnQpOwoKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEN1cnJlbmN5V2FsbGV0KTsKCiAgZnVuY3Rpb24gQ3VycmVuY3lXYWxsZXQocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ3VycmVuY3lXYWxsZXQpOwoKICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9tb3VudGVkIiwgZmFsc2UpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldFJvd3MiLCBmdW5jdGlvbiAodHhIaXN0b3J5KSB7CiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcm93czogdHhIaXN0b3J5CiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwdWxsVHJhbnNhY3Rpb25zIiwgZnVuY3Rpb24gKHRyYW5zYWN0aW9ucykgewogICAgICB2YXIgX3JlZjM7CgogICAgICBpZiAoIV90aGlzLl9tb3VudGVkKSByZXR1cm47CgogICAgICB2YXIgZGF0YSA9IChfcmVmMyA9IFtdKS5jb25jYXQuYXBwbHkoX3JlZjMsIFtbXV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0cmFuc2FjdGlvbnMpKSkuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBiLmRhdGUgLSBhLmRhdGU7CiAgICAgIH0pOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHR4SXRlbXM6IGRhdGEKICAgICAgfSk7CgogICAgICB2YXIgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgIGN1cnJlbmN5ID0gX3RoaXMkc3RhdGUuY3VycmVuY3ksCiAgICAgICAgICBhZGRyZXNzID0gX3RoaXMkc3RhdGUuYWRkcmVzczsKICAgICAgbHNEYXRhQ2FjaGUucHVzaCh7CiAgICAgICAga2V5OiAiVHhIaXN0b3J5XyIuY29uY2F0KGdldEN1cnJlbmN5S2V5KGN1cnJlbmN5LCB0cnVlKS50b0xvd2VyQ2FzZSgpLCAiXyIpLmNvbmNhdChhZGRyZXNzKSwKICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgIHRpbWU6IDM2MDAKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzZXRMb2NhbFN0b3JhZ2VJdGVtcyIsIGZ1bmN0aW9uICgpIHsKICAgICAgLy9ACiAgICAgIHZhciBpc0Nsb3NlZE5vdGlmeUJsb2NrQmFubmVyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oY29uc3RhbnRzLmxvY2FsU3RvcmFnZS5pc0Nsb3NlZE5vdGlmeUJsb2NrQmFubmVyKTsgLy9ACgogICAgICB2YXIgaXNDbG9zZWROb3RpZnlCbG9ja1NpZ25VcCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGNvbnN0YW50cy5sb2NhbFN0b3JhZ2UuaXNDbG9zZWROb3RpZnlCbG9ja1NpZ25VcCk7CiAgICAgIHZhciBpc1ByaXZhdGVLZXlzU2F2ZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMubG9jYWxTdG9yYWdlLnByaXZhdGVLZXlzU2F2ZWQpOwogICAgICB2YXIgd2FsbGV0VGl0bGUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMubG9jYWxTdG9yYWdlLndhbGxldFRpdGxlKTsKCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpc0Nsb3NlZE5vdGlmeUJsb2NrQmFubmVyOiBpc0Nsb3NlZE5vdGlmeUJsb2NrQmFubmVyLAogICAgICAgIGlzQ2xvc2VkTm90aWZ5QmxvY2tTaWduVXA6IGlzQ2xvc2VkTm90aWZ5QmxvY2tTaWduVXAsCiAgICAgICAgd2FsbGV0VGl0bGU6IHdhbGxldFRpdGxlLAogICAgICAgIGlzUHJpdmF0ZUtleXNTYXZlZDogaXNQcml2YXRlS2V5c1NhdmVkCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlUmVjZWl2ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMiA9IF90aGlzLnN0YXRlLAogICAgICAgICAgY3VycmVuY3kgPSBfdGhpcyRzdGF0ZTIuY3VycmVuY3ksCiAgICAgICAgICBhZGRyZXNzID0gX3RoaXMkc3RhdGUyLmFkZHJlc3M7CiAgICAgIGFjdGlvbnMubW9kYWxzLm9wZW4oY29uc3RhbnRzLm1vZGFscy5SZWNlaXZlTW9kYWwsIHsKICAgICAgICBjdXJyZW5jeTogY3VycmVuY3ksCiAgICAgICAgYWRkcmVzczogYWRkcmVzcwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhhbmRsZUludm9pY2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTMgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgIGN1cnJlbmN5ID0gX3RoaXMkc3RhdGUzLmN1cnJlbmN5LAogICAgICAgICAgYWRkcmVzcyA9IF90aGlzJHN0YXRlMy5hZGRyZXNzOwogICAgICBhY3Rpb25zLm1vZGFscy5vcGVuKGNvbnN0YW50cy5tb2RhbHMuSW52b2ljZU1vZGFsLCB7CiAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LnRvVXBwZXJDYXNlKCksCiAgICAgICAgdG9BZGRyZXNzOiBhZGRyZXNzCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlV2l0aGRyYXciLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wcyA9IF90aGlzLnByb3BzLAogICAgICAgICAgaGlzdG9yeSA9IF90aGlzJHByb3BzLmhpc3RvcnksCiAgICAgICAgICBoaWRkZW5Db2luc0xpc3QgPSBfdGhpcyRwcm9wcy5oaWRkZW5Db2luc0xpc3QsCiAgICAgICAgICBsb2NhbGUgPSBfdGhpcyRwcm9wcy5pbnRsLmxvY2FsZTsKICAgICAgdmFyIF90aGlzJHN0YXRlNCA9IF90aGlzLnN0YXRlLAogICAgICAgICAgaXRlbUN1cnJlbmN5ID0gX3RoaXMkc3RhdGU0Lml0ZW1DdXJyZW5jeSwKICAgICAgICAgIGN1cnJlbmN5ID0gX3RoaXMkc3RhdGU0LmN1cnJlbmN5LAogICAgICAgICAgYWRkcmVzcyA9IF90aGlzJHN0YXRlNC5hZGRyZXNzLAogICAgICAgICAgY29udHJhY3RBZGRyZXNzID0gX3RoaXMkc3RhdGU0LmNvbnRyYWN0QWRkcmVzcywKICAgICAgICAgIGRlY2ltYWxzID0gX3RoaXMkc3RhdGU0LmRlY2ltYWxzLAogICAgICAgICAgYmFsYW5jZSA9IF90aGlzJHN0YXRlNC5iYWxhbmNlLAogICAgICAgICAgaXNCYWxhbmNlRW1wdHkgPSBfdGhpcyRzdGF0ZTQuaXNCYWxhbmNlRW1wdHk7IC8vIGFjdGlvbnMuYW5hbHl0aWNzLmRhdGFFdmVudChgYmFsYW5jZXMtd2l0aGRyYXctJHtjdXJyZW5jeS50b0xvd2VyQ2FzZSgpfWApCgogICAgICB2YXIgd2l0aGRyYXdNb2RhbCA9IGNvbnN0YW50cy5tb2RhbHMuV2l0aGRyYXc7CiAgICAgIGlmIChpdGVtQ3VycmVuY3kuaXNTbXNQcm90ZWN0ZWQpIHdpdGhkcmF3TW9kYWwgPSB3aXRoZHJhd01vZGFsID0gY29uc3RhbnRzLm1vZGFscy5XaXRoZHJhd011bHRpc2lnU01TOwogICAgICBpZiAoaXRlbUN1cnJlbmN5LmlzVXNlclByb3RlY3RlZCkgd2l0aGRyYXdNb2RhbCA9IGNvbnN0YW50cy5tb2RhbHMuV2l0aGRyYXdNdWx0aXNpZ1VzZXI7CiAgICAgIHZhciB0YXJnZXRDdXJyZW5jeSA9IGdldEN1cnJlbmN5S2V5KGN1cnJlbmN5LnRvTG93ZXJDYXNlKCksIHRydWUpLnRvTG93ZXJDYXNlKCk7CiAgICAgIHZhciBpc1Rva2VuID0gaGVscGVycy5ldGhUb2tlbi5pc0V0aFRva2VuKHsKICAgICAgICBuYW1lOiBjdXJyZW5jeQogICAgICB9KTsKICAgICAgaGlzdG9yeS5wdXNoKGxvY2FsaXNlZFVybChsb2NhbGUsIChpc1Rva2VuID8gJy90b2tlbicgOiAnJykgKyAiLyIuY29uY2F0KHRhcmdldEN1cnJlbmN5LCAiLyIpLmNvbmNhdChhZGRyZXNzLCAiL3NlbmQiKSkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlR29XYWxsZXRIb21lIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3RoaXMkcHJvcHMyID0gX3RoaXMucHJvcHMsCiAgICAgICAgICBoaXN0b3J5ID0gX3RoaXMkcHJvcHMyLmhpc3RvcnksCiAgICAgICAgICBsb2NhbGUgPSBfdGhpcyRwcm9wczIuaW50bC5sb2NhbGU7CiAgICAgIGhpc3RvcnkucHVzaChsb2NhbGlzZWRVcmwobG9jYWxlLCBsaW5rcy53YWxsZXQpKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhhbmRsZUdvVHJhZGUiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBjdXJyZW5jeSA9IF90aGlzLnN0YXRlLmN1cnJlbmN5OwogICAgICB2YXIgX3RoaXMkcHJvcHMzID0gX3RoaXMucHJvcHMsCiAgICAgICAgICBoaXN0b3J5ID0gX3RoaXMkcHJvcHMzLmhpc3RvcnksCiAgICAgICAgICBsb2NhbGUgPSBfdGhpcyRwcm9wczMuaW50bC5sb2NhbGU7CiAgICAgIGhpc3RvcnkucHVzaChsb2NhbGlzZWRVcmwobG9jYWxlLCAiIi5jb25jYXQobGlua3MuZXhjaGFuZ2UsICIvYnRjLXRvLSIpLmNvbmNhdChjdXJyZW5jeS50b0xvd2VyQ2FzZSgpKSkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicm93UmVuZGVyIiwgZnVuY3Rpb24gKHJvdywgcm93SW5kZXgpIHsKICAgICAgdmFyIF90aGlzJHByb3BzNCA9IF90aGlzLnByb3BzLAogICAgICAgICAgaGlzdG9yeSA9IF90aGlzJHByb3BzNC5oaXN0b3J5LAogICAgICAgICAgYWN0aXZlRmlhdCA9IF90aGlzJHByb3BzNC5hY3RpdmVGaWF0OwogICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm93LCBfZXh0ZW5kcyh7CiAgICAgICAga2V5OiByb3dJbmRleAogICAgICB9LCByb3csIHsKICAgICAgICBhY3RpdmVGaWF0OiBhY3RpdmVGaWF0LAogICAgICAgIGhpc3Rvcnk6IGhpc3RvcnkKICAgICAgfSkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlRmlsdGVyQ2hhbmdlIiwgZnVuY3Rpb24gKF9yZWY0KSB7CiAgICAgIHZhciB0YXJnZXQgPSBfcmVmNC50YXJnZXQ7CiAgICAgIHZhciB2YWx1ZSA9IHRhcmdldC52YWx1ZTsKCiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZmlsdGVyVmFsdWU6IHZhbHVlCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJoYW5kbGVGaWx0ZXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTUgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgIGZpbHRlclZhbHVlID0gX3RoaXMkc3RhdGU1LmZpbHRlclZhbHVlLAogICAgICAgICAgdHhJdGVtcyA9IF90aGlzJHN0YXRlNS50eEl0ZW1zOwoKICAgICAgX3RoaXMubG9hZGluZygpOwoKICAgICAgaWYgKGZpbHRlclZhbHVlLnRvTG93ZXJDYXNlKCkgJiYgZmlsdGVyVmFsdWUubGVuZ3RoKSB7CiAgICAgICAgdmFyIG5ld1Jvd3MgPSB0eEl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoX3JlZjUpIHsKICAgICAgICAgIHZhciBhZGRyZXNzID0gX3JlZjUuYWRkcmVzczsKICAgICAgICAgIHJldHVybiBhZGRyZXNzICYmIGFkZHJlc3MudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXJWYWx1ZS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHhJdGVtczogbmV3Um93cwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBfdGhpcy5yZXNldEZpbHRlcigpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJsb2FkaW5nIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGlzTG9hZGluZzogdHJ1ZQogICAgICAgIH07CiAgICAgIH0pOwoKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgIH0sIDEwMDApOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVzZXRGaWx0ZXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmxvYWRpbmcoKTsKCiAgICAgIHZhciBfdGhpcyRzdGF0ZTYgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgIGFkZHJlc3MgPSBfdGhpcyRzdGF0ZTYuYWRkcmVzcywKICAgICAgICAgIGN1cnJlbmN5ID0gX3RoaXMkc3RhdGU2LmN1cnJlbmN5OwoKICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBmaWx0ZXJWYWx1ZTogYWRkcmVzcwogICAgICAgIH07CiAgICAgIH0pOwoKICAgICAgYWN0aW9ucy5oaXN0b3J5LnNldFRyYW5zYWN0aW9ucyhhZGRyZXNzLCBjdXJyZW5jeS50b0xvd2VyQ2FzZSgpLCBfdGhpcy5wdWxsVHJhbnNhY3Rpb25zKTsKICAgIH0pOwoKICAgIHZhciBfcHJvcHMkbWF0Y2gkcGFyYW1zID0gcHJvcHMubWF0Y2gucGFyYW1zLAogICAgICAgIF9wcm9wcyRtYXRjaCRwYXJhbXMkZiA9IF9wcm9wcyRtYXRjaCRwYXJhbXMuZnVsbE5hbWUsCiAgICAgICAgZnVsbE5hbWUgPSBfcHJvcHMkbWF0Y2gkcGFyYW1zJGYgPT09IHZvaWQgMCA/IG51bGwgOiBfcHJvcHMkbWF0Y2gkcGFyYW1zJGYsCiAgICAgICAgX3Byb3BzJG1hdGNoJHBhcmFtcyR0ID0gX3Byb3BzJG1hdGNoJHBhcmFtcy50aWNrZXIsCiAgICAgICAgdGlja2VyID0gX3Byb3BzJG1hdGNoJHBhcmFtcyR0ID09PSB2b2lkIDAgPyBudWxsIDogX3Byb3BzJG1hdGNoJHBhcmFtcyR0LAogICAgICAgIF9wcm9wcyRtYXRjaCRwYXJhbXMkYSA9IF9wcm9wcyRtYXRjaCRwYXJhbXMuYWRkcmVzcywKICAgICAgICBfYWRkcmVzcyA9IF9wcm9wcyRtYXRjaCRwYXJhbXMkYSA9PT0gdm9pZCAwID8gbnVsbCA6IF9wcm9wcyRtYXRjaCRwYXJhbXMkYSwKICAgICAgICBfcHJvcHMkbWF0Y2gkcGFyYW1zJGEyID0gX3Byb3BzJG1hdGNoJHBhcmFtcy5hY3Rpb24sCiAgICAgICAgYWN0aW9uID0gX3Byb3BzJG1hdGNoJHBhcmFtcyRhMiA9PT0gdm9pZCAwID8gbnVsbCA6IF9wcm9wcyRtYXRjaCRwYXJhbXMkYTIsCiAgICAgICAgX2xvY2FsZSA9IHByb3BzLmludGwubG9jYWxlLAogICAgICAgIF90eEhpc3RvcnkgPSBwcm9wcy50eEhpc3RvcnksCiAgICAgICAgaGlkZGVuQ29pbnNMaXN0ID0gcHJvcHMuaGlkZGVuQ29pbnNMaXN0OwoKICAgIHZhciBpdGVtcyA9IGFjdGlvbnMuY29yZS5nZXRXYWxsZXRzKHt9KTsKCiAgICBpZiAoIV9hZGRyZXNzICYmICF0aWNrZXIpIHsKICAgICAgaWYgKGZ1bGxOYW1lKSB7CiAgICAgICAgLy8g0JXRgdC70Lgg0Y3RgtC+INGC0L7QutC10L0gLSDQv9C10YDQtdC90LDQv9GA0LDQstC70Y/QtdC8INC90LAg0LDQtNGA0LXRgSAvdG9rZW4vbmFtZS9hZGRyZXNzCiAgICAgICAgaWYgKGV0aFRva2VuLmlzRXRoVG9rZW4oewogICAgICAgICAgbmFtZTogZnVsbE5hbWUKICAgICAgICB9KSkgewogICAgICAgICAgX3RoaXMuc3RhdGUgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzLnN0YXRlKSwgewogICAgICAgICAgICBpc1JlZGlyZWN0aW5nOiB0cnVlLAogICAgICAgICAgICByZWRpcmVjdFVybDogZ2V0VG9rZW5XYWxsZXQoZnVsbE5hbWUpCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihfdGhpcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZnVsbE5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImJpdGNvaW4iKSB7CiAgICAgICAgICBfdGhpcy5zdGF0ZSA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXMuc3RhdGUpLCB7CiAgICAgICAgICAgIGlzUmVkaXJlY3Rpbmc6IHRydWUsCiAgICAgICAgICAgIHJlZGlyZWN0VXJsOiBnZXRCaXRjb2luV2FsbGV0KCkKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKF90aGlzKTsKICAgICAgICB9CgogICAgICAgIGlmIChmdWxsTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiZ2hvc3QiKSB7CiAgICAgICAgICBfdGhpcy5zdGF0ZSA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXMuc3RhdGUpLCB7CiAgICAgICAgICAgIGlzUmVkaXJlY3Rpbmc6IHRydWUsCiAgICAgICAgICAgIHJlZGlyZWN0VXJsOiBnZXRHaG9zdFdhbGxldCgpCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihfdGhpcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZnVsbE5hbWUudG9Mb3dlckNhc2UoKSA9PT0gIm5leHQiKSB7CiAgICAgICAgICBfdGhpcy5zdGF0ZSA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXMuc3RhdGUpLCB7CiAgICAgICAgICAgIGlzUmVkaXJlY3Rpbmc6IHRydWUsCiAgICAgICAgICAgIHJlZGlyZWN0VXJsOiBnZXROZXh0V2FsbGV0KCkKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKF90aGlzKTsKICAgICAgICB9CgogICAgICAgIGlmIChmdWxsTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiZXRoZXJldW0iKSB7CiAgICAgICAgICBfdGhpcy5zdGF0ZSA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXMuc3RhdGUpLCB7CiAgICAgICAgICAgIGlzUmVkaXJlY3Rpbmc6IHRydWUsCiAgICAgICAgICAgIHJlZGlyZWN0VXJsOiBnZXRFdGhlcldhbGxldCgpCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihfdGhpcyk7CiAgICAgICAgfQogICAgICB9IC8vIEBUb0RPIHRocm93IGVycm9yCgogICAgfQoKICAgIHZhciB3YWxsZXRBZGRyZXNzID0gX2FkZHJlc3M7IC8vINC+0YHRgtCw0LLQu9GP0Y4g0LfQsNC/0LDRgdC90L7QuSDQstCw0YDQuNCw0L3RgiDQtNC70Y8g0YHRgtCw0YDRi9GFINGB0YHRi9C70L7QugoKICAgIGlmIChmdWxsTmFtZSkgewogICAgICAvL0AKICAgICAgdGlja2VyID0gKF9yZWFkT25seUVycm9yKCJ0aWNrZXIiKSwgZnVsbE5hbWUpOwogICAgfSAvLyBNdWx0aVdhbGxldCAtIGFmdGVyIFN3ZWVwIC0g0L3QsNC30LLQsNC90LjRjiDQstCw0LvRjtGC0Ysg0LTQvtCy0LXRgNGP0YLRjCDQvdC10LvRjNC30Y8gLSDQvdGD0LbQvdC+INC/0YDQvtCy0LXRgNGP0YLRjNGB0Y8g0YLQsNC60LbQtSDQsNC00YDQtdGBIC0g0Lgg0LLRi9Cx0LjRgNCw0YLRjCDQv9C+INCw0LTRgNC10YHRgwoKCiAgICB2YXIgX2l0ZW1DdXJyZW5jeSA9IGl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICBpZiAoZXRoVG9rZW4uaXNFdGhUb2tlbih7CiAgICAgICAgbmFtZTogdGlja2VyCiAgICAgIH0pKSB7CiAgICAgICAgaWYgKGl0ZW0uY3VycmVuY3kudG9Mb3dlckNhc2UoKSA9PT0gdGlja2VyLnRvTG93ZXJDYXNlKCkgJiYgaXRlbS5hZGRyZXNzLnRvTG93ZXJDYXNlKCkgPT09IHdhbGxldEFkZHJlc3MudG9Mb3dlckNhc2UoKSkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICghZXRoVG9rZW4uaXNFdGhUb2tlbih7CiAgICAgICAgICBuYW1lOiB0aWNrZXIKICAgICAgICB9KSAmJiBpdGVtLmFkZHJlc3MudG9Mb3dlckNhc2UoKSA9PT0gd2FsbGV0QWRkcmVzcy50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIGlmICghX2l0ZW1DdXJyZW5jeS5sZW5ndGgpIHsKICAgICAgX2l0ZW1DdXJyZW5jeSA9IGl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGlmIChpdGVtLmJhbGFuY2UgPiAwICYmIGl0ZW0uY3VycmVuY3kudG9Mb3dlckNhc2UoKSA9PT0gdGlja2VyLnRvTG93ZXJDYXNlKCkpIHJldHVybiB0cnVlOwogICAgICB9KTsKICAgIH0KCiAgICBpZiAoIV9pdGVtQ3VycmVuY3kubGVuZ3RoKSB7CiAgICAgIF9pdGVtQ3VycmVuY3kgPSBpdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbS5iYWxhbmNlID49IDAgJiYgaXRlbS5jdXJyZW5jeS50b0xvd2VyQ2FzZSgpID09PSB0aWNrZXIudG9Mb3dlckNhc2UoKSkgcmV0dXJuIHRydWU7CiAgICAgIH0pOwogICAgfQoKICAgIGlmIChfaXRlbUN1cnJlbmN5Lmxlbmd0aCkgewogICAgICBfaXRlbUN1cnJlbmN5ID0gX2l0ZW1DdXJyZW5jeVswXTsgLy9ACgogICAgICB2YXIgX2l0ZW1DdXJyZW5jeTIgPSBfaXRlbUN1cnJlbmN5LAogICAgICAgICAgY3VycmVuY3kgPSBfaXRlbUN1cnJlbmN5Mi5jdXJyZW5jeSwKICAgICAgICAgIGFkZHJlc3MgPSBfaXRlbUN1cnJlbmN5Mi5hZGRyZXNzLAogICAgICAgICAgY29udHJhY3RBZGRyZXNzID0gX2l0ZW1DdXJyZW5jeTIuY29udHJhY3RBZGRyZXNzLAogICAgICAgICAgZGVjaW1hbHMgPSBfaXRlbUN1cnJlbmN5Mi5kZWNpbWFscywKICAgICAgICAgIGJhbGFuY2UgPSBfaXRlbUN1cnJlbmN5Mi5iYWxhbmNlLAogICAgICAgICAgaW5mb0Fib3V0Q3VycmVuY3kgPSBfaXRlbUN1cnJlbmN5Mi5pbmZvQWJvdXRDdXJyZW5jeTsKICAgICAgdmFyIGhhc0NhY2hlZERhdGEgPSBsc0RhdGFDYWNoZS5nZXQoIlR4SGlzdG9yeV8iLmNvbmNhdChnZXRDdXJyZW5jeUtleShjdXJyZW5jeSwgdHJ1ZSkudG9Mb3dlckNhc2UoKSwgIl8iKS5jb25jYXQoYWRkcmVzcykpOwogICAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgICBpdGVtQ3VycmVuY3k6IF9pdGVtQ3VycmVuY3ksCiAgICAgICAgYWRkcmVzczogYWRkcmVzcywKICAgICAgICB3YWxsZXRBZGRyZXNzOiB3YWxsZXRBZGRyZXNzLAogICAgICAgIGJhbGFuY2U6IGJhbGFuY2UsCiAgICAgICAgZGVjaW1hbHM6IGRlY2ltYWxzLAogICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSwKICAgICAgICB0eEl0ZW1zOiBoYXNDYWNoZWREYXRhLAogICAgICAgIGNvbnRyYWN0QWRkcmVzczogY29udHJhY3RBZGRyZXNzLAogICAgICAgIGhpZGRlbkNvaW5zTGlzdDogaGlkZGVuQ29pbnNMaXN0LAogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgaW5mb0Fib3V0Q3VycmVuY3k6IGluZm9BYm91dEN1cnJlbmN5LAogICAgICAgIGZpbHRlclZhbHVlOiB3YWxsZXRBZGRyZXNzIHx8IGFkZHJlc3MgfHwgJycsCiAgICAgICAgdG9rZW46IGV0aFRva2VuLmlzRXRoVG9rZW4oewogICAgICAgICAgbmFtZTogdGlja2VyCiAgICAgICAgfSkKICAgICAgfTsKICAgIH0KCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoQ3VycmVuY3lXYWxsZXQsIFt7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy5fbW91bnRlZCA9IHRydWU7CiAgICAgIGNvbnNvbGUubG9nKCdDdXJyZW5jeVdhbGxldCBtb3VudGVkJyk7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTcgPSB0aGlzLnN0YXRlLAogICAgICAgICAgY3VycmVuY3kgPSBfdGhpcyRzdGF0ZTcuY3VycmVuY3ksCiAgICAgICAgICBpdGVtQ3VycmVuY3kgPSBfdGhpcyRzdGF0ZTcuaXRlbUN1cnJlbmN5LAogICAgICAgICAgdG9rZW4gPSBfdGhpcyRzdGF0ZTcudG9rZW4sCiAgICAgICAgICBpc1JlZGlyZWN0aW5nID0gX3RoaXMkc3RhdGU3LmlzUmVkaXJlY3RpbmcsCiAgICAgICAgICByZWRpcmVjdFVybCA9IF90aGlzJHN0YXRlNy5yZWRpcmVjdFVybCwKICAgICAgICAgIGJhbGFuY2UgPSBfdGhpcyRzdGF0ZTcuYmFsYW5jZSwKICAgICAgICAgIGluZm9BYm91dEN1cnJlbmN5ID0gX3RoaXMkc3RhdGU3LmluZm9BYm91dEN1cnJlbmN5LAogICAgICAgICAgaGlkZGVuQ29pbnNMaXN0ID0gX3RoaXMkc3RhdGU3LmhpZGRlbkNvaW5zTGlzdDsKICAgICAgYWN0aW9ucy51c2VyLmdldEJhbGFuY2VzKCk7CgogICAgICBpZiAoaXNSZWRpcmVjdGluZykgewogICAgICAgIHZhciBfdGhpcyRwcm9wczUgPSB0aGlzLnByb3BzLAogICAgICAgICAgICBoaXN0b3J5ID0gX3RoaXMkcHJvcHM1Lmhpc3RvcnksCiAgICAgICAgICAgIGxvY2FsZSA9IF90aGlzJHByb3BzNS5pbnRsLmxvY2FsZTsKICAgICAgICBoaXN0b3J5LnB1c2gobG9jYWxpc2VkVXJsKGxvY2FsZSwgcmVkaXJlY3RVcmwpKTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgIH0sIDEwMCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgX3RoaXMkcHJvcHM2ID0gdGhpcy5wcm9wcywKICAgICAgICAgIF90aGlzJHByb3BzNiRtYXRjaCRwYSA9IF90aGlzJHByb3BzNi5tYXRjaC5wYXJhbXMuYWRkcmVzcywKICAgICAgICAgIGFkZHJlc3MgPSBfdGhpcyRwcm9wczYkbWF0Y2gkcGEgPT09IHZvaWQgMCA/IG51bGwgOiBfdGhpcyRwcm9wczYkbWF0Y2gkcGEsCiAgICAgICAgICBhY3RpdmVDdXJyZW5jeSA9IF90aGlzJHByb3BzNi5hY3RpdmVDdXJyZW5jeSwKICAgICAgICAgIGFjdGl2ZUZpYXQgPSBfdGhpcyRwcm9wczYuYWN0aXZlRmlhdDsKCiAgICAgIGlmIChjdXJyZW5jeSkgey8vIGFjdGlvbnMuYW5hbHl0aWNzLmRhdGFFdmVudChgb3Blbi1wYWdlLSR7Y3VycmVuY3kudG9Mb3dlckNhc2UoKX0td2FsbGV0YCkKICAgICAgfQoKICAgICAgaWYgKHRva2VuKSB7CiAgICAgICAgYWN0aW9ucy50b2tlbi5nZXRCYWxhbmNlKGN1cnJlbmN5LnRvTG93ZXJDYXNlKCkpOwogICAgICB9IC8vIHNldCBiYWxhbmNlIGZvciB0aGUgYWRkcmVzcwoKCiAgICAgIGFkZHJlc3MgJiYgYWN0aW9uc1tnZXRDdXJyZW5jeUtleShjdXJyZW5jeS50b0xvd2VyQ2FzZSgpLCBmYWxzZSldLmZldGNoQmFsYW5jZShhZGRyZXNzKS50aGVuKGZ1bmN0aW9uIChiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5zZXRTdGF0ZSh7CiAgICAgICAgICBiYWxhbmNlOiBiYWxhbmNlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNldExvY2FsU3RvcmFnZUl0ZW1zKCk7IC8vIGlmIGFkZHJlc3MgaXMgbnVsbCwgdGFrZSB0cmFuc2FjdGlvbnMgZnJvbSBjdXJyZW50IHVzZXIKCiAgICAgIGFkZHJlc3MgPyBhY3Rpb25zLmhpc3Rvcnkuc2V0VHJhbnNhY3Rpb25zKGFkZHJlc3MsIGN1cnJlbmN5LnRvTG93ZXJDYXNlKCksIHRoaXMucHVsbFRyYW5zYWN0aW9ucykgOiBhY3Rpb25zLnVzZXIuc2V0VHJhbnNhY3Rpb25zKCk7CgogICAgICBpZiAoIWFkZHJlc3MpIHsKICAgICAgICBhY3Rpb25zLmNvcmUuZ2V0U3dhcEhpc3RvcnkoKTsKICAgICAgfQoKICAgICAgdmFyIF9jb25zdGFudHMkbW9kYWxzID0gY29uc3RhbnRzLm1vZGFscywKICAgICAgICAgIFdpdGhkcmF3ID0gX2NvbnN0YW50cyRtb2RhbHMuV2l0aGRyYXcsCiAgICAgICAgICBXaXRoZHJhd011bHRpc2lnU01TID0gX2NvbnN0YW50cyRtb2RhbHMuV2l0aGRyYXdNdWx0aXNpZ1NNUywKICAgICAgICAgIFdpdGhkcmF3TXVsdGlzaWdVc2VyID0gX2NvbnN0YW50cyRtb2RhbHMuV2l0aGRyYXdNdWx0aXNpZ1VzZXI7CiAgICAgIHZhciB0YXJnZXRDdXJyZW5jeSA9IGdldEN1cnJlbmN5S2V5KGN1cnJlbmN5LnRvTG93ZXJDYXNlKCksIHRydWUpOwogICAgICB2YXIgaXNUb2tlbiA9IGhlbHBlcnMuZXRoVG9rZW4uaXNFdGhUb2tlbih7CiAgICAgICAgbmFtZTogY3VycmVuY3kKICAgICAgfSk7CiAgICAgIHZhciB3aXRoZHJhd1VybCA9IChpc1Rva2VuID8gJy90b2tlbicgOiAnJykgKyAiLyIuY29uY2F0KHRhcmdldEN1cnJlbmN5LCAiLyIpLmNvbmNhdChhZGRyZXNzLCAiL3NlbmQiKTsKICAgICAgdmFyIHJlY2VpdmVVcmwgPSAoaXNUb2tlbiA/ICcvdG9rZW4nIDogJycpICsgIi8iLmNvbmNhdCh0YXJnZXRDdXJyZW5jeSwgIi8iKS5jb25jYXQoYWRkcmVzcywgIi9yZWNlaXZlIik7CgogICAgICBpZiAodGhpcy5wcm9wcy5oaXN0b3J5LmxvY2F0aW9uLnBhdGhuYW1lLnRvTG93ZXJDYXNlKCkgPT09IHdpdGhkcmF3VXJsLnRvTG93ZXJDYXNlKCkgJiYgYmFsYW5jZSAhPT0gMCkgewogICAgICAgIHZhciBtb2RhbFR5cGUgPSBXaXRoZHJhdzsgLy8gaWYgKGl0ZW1DdXJyZW5jeS5pc1Ntc1Byb3RlY3RlZCkgbW9kYWxUeXBlID0gV2l0aGRyYXdNdWx0aXNpZ1NNUwogICAgICAgIC8vIGlmIChpdGVtQ3VycmVuY3kuaXNVc2VyUHJvdGVjdGVkKSBtb2RhbFR5cGUgPSBXaXRoZHJhd011bHRpc2lnVXNlcgoKICAgICAgICBhY3Rpb25zLm1vZGFscy5vcGVuKG1vZGFsVHlwZSwgewogICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgYWRkcmVzczogYWRkcmVzcywKICAgICAgICAgIGJhbGFuY2U6IGJhbGFuY2UsCiAgICAgICAgICBpbmZvQWJvdXRDdXJyZW5jeTogaW5mb0Fib3V0Q3VycmVuY3ksCiAgICAgICAgICBoaWRkZW5Db2luc0xpc3Q6IGhpZGRlbkNvaW5zTGlzdCwKICAgICAgICAgIGN1cnJlbmN5UmF0ZTogaXRlbUN1cnJlbmN5LmN1cnJlbmN5UmF0ZQogICAgICAgIH0pOwoKICAgICAgICBpZiAoYWN0aXZlQ3VycmVuY3kudG9VcHBlckNhc2UoKSAhPT0gYWN0aXZlRmlhdCkgewogICAgICAgICAgYWN0aW9ucy51c2VyLnB1bGxBY3RpdmVDdXJyZW5jeShjdXJyZW5jeS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnByb3BzLmhpc3RvcnkubG9jYXRpb24ucGF0aG5hbWUudG9Mb3dlckNhc2UoKSA9PT0gcmVjZWl2ZVVybC50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgYWN0aW9ucy5tb2RhbHMub3Blbihjb25zdGFudHMubW9kYWxzLlJlY2VpdmVNb2RhbCwgewogICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LAogICAgICAgICAgYWRkcmVzczogYWRkcmVzcwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50RGlkVXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIGN1cnJlbmN5ID0gdGhpcy5zdGF0ZS5jdXJyZW5jeTsKICAgICAgdmFyIGFjdGl2ZUZpYXQgPSB0aGlzLnByb3BzLmFjdGl2ZUZpYXQ7CiAgICAgIHZhciBwcmV2RmlhdCA9IHByZXZQcm9wcy5hY3RpdmVGaWF0OwogICAgICB2YXIgX3RoaXMkcHJvcHM3ID0gdGhpcy5wcm9wcywKICAgICAgICAgIF90aGlzJHByb3BzNyRtYXRjaCRwYSA9IF90aGlzJHByb3BzNy5tYXRjaC5wYXJhbXMsCiAgICAgICAgICBfdGhpcyRwcm9wczckbWF0Y2gkcGEyID0gX3RoaXMkcHJvcHM3JG1hdGNoJHBhLmFkZHJlc3MsCiAgICAgICAgICBhZGRyZXNzID0gX3RoaXMkcHJvcHM3JG1hdGNoJHBhMiA9PT0gdm9pZCAwID8gbnVsbCA6IF90aGlzJHByb3BzNyRtYXRjaCRwYTIsCiAgICAgICAgICBfdGhpcyRwcm9wczckbWF0Y2gkcGEzID0gX3RoaXMkcHJvcHM3JG1hdGNoJHBhLmZ1bGxOYW1lLAogICAgICAgICAgZnVsbE5hbWUgPSBfdGhpcyRwcm9wczckbWF0Y2gkcGEzID09PSB2b2lkIDAgPyBudWxsIDogX3RoaXMkcHJvcHM3JG1hdGNoJHBhMywKICAgICAgICAgIF90aGlzJHByb3BzNyRtYXRjaCRwYTQgPSBfdGhpcyRwcm9wczckbWF0Y2gkcGEudGlja2VyLAogICAgICAgICAgdGlja2VyID0gX3RoaXMkcHJvcHM3JG1hdGNoJHBhNCA9PT0gdm9pZCAwID8gbnVsbCA6IF90aGlzJHByb3BzNyRtYXRjaCRwYTQsCiAgICAgICAgICBfdGhpcyRwcm9wczckbWF0Y2gkcGE1ID0gX3RoaXMkcHJvcHM3JG1hdGNoJHBhLmFjdGlvbiwKICAgICAgICAgIGFjdGlvbiA9IF90aGlzJHByb3BzNyRtYXRjaCRwYTUgPT09IHZvaWQgMCA/IG51bGwgOiBfdGhpcyRwcm9wczckbWF0Y2gkcGE1LAogICAgICAgICAgaGlkZGVuQ29pbnNMaXN0ID0gX3RoaXMkcHJvcHM3LmhpZGRlbkNvaW5zTGlzdCwKICAgICAgICAgIGFjdGl2ZUN1cnJlbmN5ID0gX3RoaXMkcHJvcHM3LmFjdGl2ZUN1cnJlbmN5OwogICAgICB2YXIgX3ByZXZQcm9wcyRtYXRjaCRwYXJhID0gcHJldlByb3BzLm1hdGNoLnBhcmFtcy5hZGRyZXNzLAogICAgICAgICAgcHJldkFkZHJlc3MgPSBfcHJldlByb3BzJG1hdGNoJHBhcmEgPT09IHZvaWQgMCA/IG51bGwgOiBfcHJldlByb3BzJG1hdGNoJHBhcmE7CgogICAgICBpZiAocHJldkFkZHJlc3MgIT09IGFkZHJlc3MpIHsKICAgICAgICBhZGRyZXNzID8gYWN0aW9ucy5oaXN0b3J5LnNldFRyYW5zYWN0aW9ucyhhZGRyZXNzLCBjdXJyZW5jeS50b0xvd2VyQ2FzZSgpLCB0aGlzLnB1bGxUcmFuc2FjdGlvbnMpIDogYWN0aW9ucy51c2VyLnNldFRyYW5zYWN0aW9ucygpOwogICAgICB9CgogICAgICBpZiAocHJldlByb3BzLmxvY2F0aW9uLnBhdGhuYW1lICE9PSB0aGlzLnByb3BzLmxvY2F0aW9uLnBhdGhuYW1lIHx8IHByZXZQcm9wcy5pc0JhbGFuY2VGZXRjaGluZyAhPT0gdGhpcy5wcm9wcy5pc0JhbGFuY2VGZXRjaGluZykgewogICAgICAgIHZhciBpdGVtcyA9IGFjdGlvbnMuY29yZS5nZXRXYWxsZXRzKHt9KTsKCiAgICAgICAgaWYgKCFhZGRyZXNzICYmICF0aWNrZXIpIHsKICAgICAgICAgIGlmIChmdWxsTmFtZSkgewogICAgICAgICAgICAvLyDQldGB0LvQuCDRjdGC0L4g0YLQvtC60LXQvSAtINC/0LXRgNC10L3QsNC/0YDQsNCy0LvRj9C10Lwg0L3QsCDQsNC00YDQtdGBIC90b2tlbi9uYW1lL2FkZHJlc3MKICAgICAgICAgICAgaWYgKGV0aFRva2VuLmlzRXRoVG9rZW4oewogICAgICAgICAgICAgIG5hbWU6IGZ1bGxOYW1lCiAgICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5zdGF0ZSksIHsKICAgICAgICAgICAgICAgIGlzUmVkaXJlY3Rpbmc6IHRydWUsCiAgICAgICAgICAgICAgICByZWRpcmVjdFVybDogZ2V0VG9rZW5XYWxsZXQoZnVsbE5hbWUpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZnVsbE5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImJpdGNvaW4iKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5zdGF0ZSksIHsKICAgICAgICAgICAgICAgIGlzUmVkaXJlY3Rpbmc6IHRydWUsCiAgICAgICAgICAgICAgICByZWRpcmVjdFVybDogZ2V0Qml0Y29pbldhbGxldCgpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZnVsbE5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImdob3N0IikgewogICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRoaXMuc3RhdGUpLCB7CiAgICAgICAgICAgICAgICBpc1JlZGlyZWN0aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgcmVkaXJlY3RVcmw6IGdldEdob3N0V2FsbGV0KCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmdWxsTmFtZS50b0xvd2VyQ2FzZSgpID09PSAibmV4dCIpIHsKICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLnN0YXRlKSwgewogICAgICAgICAgICAgICAgaXNSZWRpcmVjdGluZzogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlZGlyZWN0VXJsOiBnZXROZXh0V2FsbGV0KCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmdWxsTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiZXRoZXJldW0iKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5zdGF0ZSksIHsKICAgICAgICAgICAgICAgIGlzUmVkaXJlY3Rpbmc6IHRydWUsCiAgICAgICAgICAgICAgICByZWRpcmVjdFVybDogZ2V0RXRoZXJXYWxsZXQoKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBAVG9ETyB0aHJvdyBlcnJvcgoKICAgICAgICB9CgogICAgICAgIHZhciB3YWxsZXRBZGRyZXNzID0gYWRkcmVzczsgLy8g0L7RgdGC0LDQstC70Y/RjiDQt9Cw0L/QsNGB0L3QvtC5INCy0LDRgNC40LDQvdGCINC00LvRjyDRgdGC0LDRgNGL0YUg0YHRgdGL0LvQvtC6CgogICAgICAgIGlmIChmdWxsTmFtZSkgewogICAgICAgICAgdGlja2VyID0gZnVsbE5hbWU7CiAgICAgICAgfSAvLyBNdWx0aVdhbGxldCAtIGFmdGVyIFN3ZWVwIC0g0L3QsNC30LLQsNC90LjRjiDQstCw0LvRjtGC0Ysg0LTQvtCy0LXRgNGP0YLRjCDQvdC10LvRjNC30Y8gLSDQvdGD0LbQvdC+INC/0YDQvtCy0LXRgNGP0YLRjNGB0Y8g0YLQsNC60LbQtSDQsNC00YDQtdGBIC0g0Lgg0LLRi9Cx0LjRgNCw0YLRjCDQv9C+INCw0LTRgNC10YHRgwoKCiAgICAgICAgdmFyIGl0ZW1DdXJyZW5jeSA9IGl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgaWYgKGV0aFRva2VuLmlzRXRoVG9rZW4oewogICAgICAgICAgICBuYW1lOiB0aWNrZXIKICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgIGlmIChpdGVtLmN1cnJlbmN5LnRvTG93ZXJDYXNlKCkgPT09IHRpY2tlci50b0xvd2VyQ2FzZSgpICYmIGl0ZW0uYWRkcmVzcy50b0xvd2VyQ2FzZSgpID09PSB3YWxsZXRBZGRyZXNzLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCFldGhUb2tlbi5pc0V0aFRva2VuKHsKICAgICAgICAgICAgICBuYW1lOiB0aWNrZXIKICAgICAgICAgICAgfSkgJiYgaXRlbS5hZGRyZXNzLnRvTG93ZXJDYXNlKCkgPT09IHdhbGxldEFkZHJlc3MudG9Mb3dlckNhc2UoKSkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmIChpdGVtQ3VycmVuY3kubGVuZ3RoKSB7CiAgICAgICAgICBpdGVtQ3VycmVuY3kgPSBpdGVtQ3VycmVuY3lbMF07IC8vQAoKICAgICAgICAgIHZhciBfaXRlbUN1cnJlbmN5MyA9IGl0ZW1DdXJyZW5jeSwKICAgICAgICAgICAgICBfY3VycmVuY3kgPSBfaXRlbUN1cnJlbmN5My5jdXJyZW5jeSwKICAgICAgICAgICAgICBfYWRkcmVzczIgPSBfaXRlbUN1cnJlbmN5My5hZGRyZXNzLAogICAgICAgICAgICAgIGNvbnRyYWN0QWRkcmVzcyA9IF9pdGVtQ3VycmVuY3kzLmNvbnRyYWN0QWRkcmVzcywKICAgICAgICAgICAgICBkZWNpbWFscyA9IF9pdGVtQ3VycmVuY3kzLmRlY2ltYWxzLAogICAgICAgICAgICAgIGJhbGFuY2UgPSBfaXRlbUN1cnJlbmN5My5iYWxhbmNlLAogICAgICAgICAgICAgIGluZm9BYm91dEN1cnJlbmN5ID0gX2l0ZW1DdXJyZW5jeTMuaW5mb0Fib3V0Q3VycmVuY3k7CiAgICAgICAgICB2YXIgX2NvbnN0YW50cyRtb2RhbHMyID0gY29uc3RhbnRzLm1vZGFscywKICAgICAgICAgICAgICBXaXRoZHJhdyA9IF9jb25zdGFudHMkbW9kYWxzMi5XaXRoZHJhdywKICAgICAgICAgICAgICBXaXRoZHJhd011bHRpc2lnU01TID0gX2NvbnN0YW50cyRtb2RhbHMyLldpdGhkcmF3TXVsdGlzaWdTTVMsCiAgICAgICAgICAgICAgV2l0aGRyYXdNdWx0aXNpZ1VzZXIgPSBfY29uc3RhbnRzJG1vZGFsczIuV2l0aGRyYXdNdWx0aXNpZ1VzZXI7CiAgICAgICAgICB2YXIgbW9kYWxXaXRoZHJhdyA9IFdpdGhkcmF3OyAvLyBpZiAoaXRlbUN1cnJlbmN5LmlzU21zUHJvdGVjdGVkKSBtb2RhbFdpdGhkcmF3ID0gV2l0aGRyYXdNdWx0aXNpZ1NNUwogICAgICAgICAgLy8gaWYgKGl0ZW1DdXJyZW5jeS5pc1VzZXJQcm90ZWN0ZWQpIG1vZGFsV2l0aGRyYXcgPSBXaXRoZHJhd011bHRpc2lnVXNlcgoKICAgICAgICAgIHZhciBvbGRUeEl0ZW1zID0gdGhpcy5zdGF0ZS50eEl0ZW1zOwogICAgICAgICAgdmFyIGhhc0NhY2hlZERhdGEgPSBsc0RhdGFDYWNoZS5nZXQoIlR4SGlzdG9yeV8iLmNvbmNhdChnZXRDdXJyZW5jeUtleShfY3VycmVuY3ksIHRydWUpLnRvTG93ZXJDYXNlKCksICJfIikuY29uY2F0KF9hZGRyZXNzMikpOwogICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgIGl0ZW1DdXJyZW5jeTogaXRlbUN1cnJlbmN5LAogICAgICAgICAgICBhZGRyZXNzOiBfYWRkcmVzczIsCiAgICAgICAgICAgIGRlY2ltYWxzOiBkZWNpbWFscywKICAgICAgICAgICAgY3VycmVuY3k6IF9jdXJyZW5jeSwKICAgICAgICAgICAgYmFsYW5jZTogYmFsYW5jZSwKICAgICAgICAgICAgdHhJdGVtczogaGFzQ2FjaGVkRGF0YSB8fCBvbGRUeEl0ZW1zLAogICAgICAgICAgICBjb250cmFjdEFkZHJlc3M6IGNvbnRyYWN0QWRkcmVzcywKICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICAgICAgaW5mb0Fib3V0Q3VycmVuY3k6IGluZm9BYm91dEN1cnJlbmN5LAogICAgICAgICAgICBmaWx0ZXJWYWx1ZTogX2FkZHJlc3MyIHx8ICcnLAogICAgICAgICAgICB0b2tlbjogZXRoVG9rZW4uaXNFdGhUb2tlbih7CiAgICAgICAgICAgICAgbmFtZTogdGlja2VyCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChwcmV2UHJvcHMubG9jYXRpb24ucGF0aG5hbWUgIT09IF90aGlzMy5wcm9wcy5sb2NhdGlvbi5wYXRobmFtZSkgewogICAgICAgICAgICAgIGlmIChhY3RpdmVDdXJyZW5jeS50b1VwcGVyQ2FzZSgpICE9PSBhY3RpdmVGaWF0KSB7CiAgICAgICAgICAgICAgICBhY3Rpb25zLnVzZXIucHVsbEFjdGl2ZUN1cnJlbmN5KF9jdXJyZW5jeS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB0YXJnZXRDdXJyZW5jeSA9IGdldEN1cnJlbmN5S2V5KF9jdXJyZW5jeS50b0xvd2VyQ2FzZSgpLCB0cnVlKTsKICAgICAgICAgICAgdmFyIGlzVG9rZW4gPSBoZWxwZXJzLmV0aFRva2VuLmlzRXRoVG9rZW4oewogICAgICAgICAgICAgIG5hbWU6IF9jdXJyZW5jeQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHdpdGhkcmF3VXJsID0gKGlzVG9rZW4gPyAnL3Rva2VuJyA6ICcnKSArICIvIi5jb25jYXQodGFyZ2V0Q3VycmVuY3ksICIvIikuY29uY2F0KF9hZGRyZXNzMiwgIi9zZW5kIik7CiAgICAgICAgICAgIHZhciByZWNlaXZlVXJsID0gKGlzVG9rZW4gPyAnL3Rva2VuJyA6ICcnKSArICIvIi5jb25jYXQodGFyZ2V0Q3VycmVuY3ksICIvIikuY29uY2F0KF9hZGRyZXNzMiwgIi9yZWNlaXZlIik7CgogICAgICAgICAgICB2YXIgY3VycmVudFVybCA9IF90aGlzMy5wcm9wcy5sb2NhdGlvbi5wYXRobmFtZS50b0xvd2VyQ2FzZSgpOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRVcmwgPT09IHdpdGhkcmF3VXJsLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgICAgICAgICBhY3Rpb25zLm1vZGFscy5vcGVuKG1vZGFsV2l0aGRyYXcsIHsKICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBfY3VycmVuY3ksCiAgICAgICAgICAgICAgICBhZGRyZXNzOiBfYWRkcmVzczIsCiAgICAgICAgICAgICAgICBiYWxhbmNlOiBiYWxhbmNlLAogICAgICAgICAgICAgICAgaW5mb0Fib3V0Q3VycmVuY3k6IGluZm9BYm91dEN1cnJlbmN5LAogICAgICAgICAgICAgICAgaGlkZGVuQ29pbnNMaXN0OiBoaWRkZW5Db2luc0xpc3QsCiAgICAgICAgICAgICAgICBpdGVtQ3VycmVuY3k6IGl0ZW1DdXJyZW5jeSwKICAgICAgICAgICAgICAgIC8vQAogICAgICAgICAgICAgICAgY3VycmVuY3lSYXRlOiBpdGVtQ3VycmVuY3kuY3VycmVuY3lSYXRlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjdXJyZW50VXJsID09PSByZWNlaXZlVXJsLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgICAgICAgICBhY3Rpb25zLm1vZGFscy5vcGVuKGNvbnN0YW50cy5tb2RhbHMuUmVjZWl2ZU1vZGFsLCB7CiAgICAgICAgICAgICAgICBjdXJyZW5jeTogX2N1cnJlbmN5LAogICAgICAgICAgICAgICAgYWRkcmVzczogX2FkZHJlc3MyCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudFdpbGxVbm1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHsKICAgICAgdGhpcy5fbW91bnRlZCA9IGZhbHNlOwogICAgICBjb25zb2xlLmxvZygnQ3VycmVuY3lXYWxsZXQgdW5tb3VudGVkJyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczggPSB0aGlzLnByb3BzLAogICAgICAgICAgc3dhcEhpc3RvcnkgPSBfdGhpcyRwcm9wczguc3dhcEhpc3RvcnksCiAgICAgICAgICB0eEhpc3RvcnkgPSBfdGhpcyRwcm9wczgudHhIaXN0b3J5LAogICAgICAgICAgbG9jYXRpb24gPSBfdGhpcyRwcm9wczgubG9jYXRpb24sCiAgICAgICAgICBfdGhpcyRwcm9wczgkbWF0Y2gkcGEgPSBfdGhpcyRwcm9wczgubWF0Y2gucGFyYW1zLmFkZHJlc3MsCiAgICAgICAgICBhZGRyZXNzID0gX3RoaXMkcHJvcHM4JG1hdGNoJHBhID09PSB2b2lkIDAgPyBudWxsIDogX3RoaXMkcHJvcHM4JG1hdGNoJHBhLAogICAgICAgICAgaW50bCA9IF90aGlzJHByb3BzOC5pbnRsLAogICAgICAgICAgaGlkZGVuQ29pbnNMaXN0ID0gX3RoaXMkcHJvcHM4LmhpZGRlbkNvaW5zTGlzdCwKICAgICAgICAgIGlzU2lnbmVkID0gX3RoaXMkcHJvcHM4LmlzU2lnbmVkLAogICAgICAgICAgaXNCYWxhbmNlRmV0Y2hpbmcgPSBfdGhpcyRwcm9wczguaXNCYWxhbmNlRmV0Y2hpbmcsCiAgICAgICAgICBhY3RpdmVGaWF0ID0gX3RoaXMkcHJvcHM4LmFjdGl2ZUZpYXQsCiAgICAgICAgICBtdWx0aXNpZ1N0YXR1cyA9IF90aGlzJHByb3BzOC5tdWx0aXNpZ1N0YXR1cywKICAgICAgICAgIGFjdGl2ZUN1cnJlbmN5ID0gX3RoaXMkcHJvcHM4LmFjdGl2ZUN1cnJlbmN5LAogICAgICAgICAgbXVsdGlzaWdQZW5kaW5nQ291bnQgPSBfdGhpcyRwcm9wczgubXVsdGlzaWdQZW5kaW5nQ291bnQ7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTggPSB0aGlzLnN0YXRlLAogICAgICAgICAgY3VycmVuY3kgPSBfdGhpcyRzdGF0ZTguY3VycmVuY3ksCiAgICAgICAgICBpdGVtQ3VycmVuY3kgPSBfdGhpcyRzdGF0ZTguaXRlbUN1cnJlbmN5LAogICAgICAgICAgYmFsYW5jZSA9IF90aGlzJHN0YXRlOC5iYWxhbmNlLAogICAgICAgICAgZnVsbE5hbWUgPSBfdGhpcyRzdGF0ZTguZnVsbE5hbWUsCiAgICAgICAgICBpbmZvQWJvdXRDdXJyZW5jeSA9IF90aGlzJHN0YXRlOC5pbmZvQWJvdXRDdXJyZW5jeSwKICAgICAgICAgIGlzUmVkaXJlY3RpbmcgPSBfdGhpcyRzdGF0ZTguaXNSZWRpcmVjdGluZywKICAgICAgICAgIHR4SXRlbXMgPSBfdGhpcyRzdGF0ZTgudHhJdGVtcywKICAgICAgICAgIGZpbHRlclZhbHVlID0gX3RoaXMkc3RhdGU4LmZpbHRlclZhbHVlLAogICAgICAgICAgaXNMb2FkaW5nID0gX3RoaXMkc3RhdGU4LmlzTG9hZGluZzsKICAgICAgdmFyIGN1cnJlbmN5S2V5ID0gZ2V0Q3VycmVuY3lLZXkoY3VycmVuY3ksIHRydWUpOwogICAgICBpZiAoaXNSZWRpcmVjdGluZykgcmV0dXJuIG51bGw7CiAgICAgIHR4SGlzdG9yeSA9IHR4SXRlbXMgfHwgdHhIaXN0b3J5OwoKICAgICAgaWYgKHR4SGlzdG9yeSkgewogICAgICAgIHR4SGlzdG9yeSA9IHR4SGlzdG9yeS5maWx0ZXIoZnVuY3Rpb24gKHR4KSB7CiAgICAgICAgICBpZiAodHggJiYgdHgudHlwZSkgewogICAgICAgICAgICByZXR1cm4gdHgudHlwZS50b0xvd2VyQ2FzZSgpID09PSBjdXJyZW5jeUtleS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIHNob3dTd2FwSGlzdG9yeSA9IGFkZHJlc3MudG9Mb3dlckNhc2UoKSA9PT0gaXRlbUN1cnJlbmN5LmFkZHJlc3MudG9Mb3dlckNhc2UoKTsKICAgICAgaWYgKHNob3dTd2FwSGlzdG9yeSkgc3dhcEhpc3RvcnkgPSBPYmplY3Qua2V5cyhzd2FwSGlzdG9yeSkubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICByZXR1cm4gc3dhcEhpc3Rvcnlba2V5XTsKICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChzd2FwKSB7CiAgICAgICAgcmV0dXJuIHN3YXAuc2VsbEN1cnJlbmN5ID09PSBjdXJyZW5jeSB8fCBzd2FwLmJ1eUN1cnJlbmN5ID09PSBjdXJyZW5jeTsKICAgICAgfSkucmV2ZXJzZSgpOwogICAgICB2YXIgc2VvUGFnZSA9IGdldFNlb1BhZ2UobG9jYXRpb24ucGF0aG5hbWUpOwogICAgICB2YXIgdGl0bGVTd2FwT25saW5lID0gZGVmaW5lTWVzc2FnZXMoewogICAgICAgIG1ldGFUaXRsZTogewogICAgICAgICAgaWQ6ICdDdXJyZW5jeVdhbGxldFRpdGxlJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU3dhcC5PbmxpbmUgLSB7ZnVsbE5hbWV9ICh7Y3VycmVuY3l9KSBXZWIgV2FsbGV0IHdpdGggQXRvbWljIFN3YXAuJwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHZhciB0aXRsZVdpZGdldEJ1aWxkID0gZGVmaW5lTWVzc2FnZXMoewogICAgICAgIG1ldGFUaXRsZTogewogICAgICAgICAgaWQ6ICdDdXJyZW5jeVdhbGxldFdpZGdldEJ1aWxkVGl0bGUnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd7ZnVsbE5hbWV9ICh7Y3VycmVuY3l9KSBXZWIgV2FsbGV0IHdpdGggQXRvbWljIFN3YXAuJwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHZhciB0aXRsZSA9IGlzV2lkZ2V0QnVpbGQgPyB0aXRsZVdpZGdldEJ1aWxkIDogdGl0bGVTd2FwT25saW5lOwogICAgICB2YXIgZGVzY3JpcHRpb24gPSBkZWZpbmVNZXNzYWdlcyh7CiAgICAgICAgbWV0YURlc2NyaXB0aW9uOiB7CiAgICAgICAgICBpZDogJ0N1cnJlbmN5V2FsbGV0MTU0JywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQXRvbWljIFN3YXAgV2FsbGV0IGFsbG93cyB5b3UgdG8gbWFuYWdlIGFuZCBzZWN1cmVseSBleGNoYW5nZSAke2Z1bGxOYW1lfSAoJHtjdXJyZW5jeX0pIHdpdGggMCUgZmVlcy4gQmFzZWQgb24gTXVsdGktU2lnIGFuZCBBdG9taWMgU3dhcCB0ZWNobm9sb2dpZXMuJwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBpZiAoaGlkZGVuQ29pbnNMaXN0LmluY2x1ZGVzKGN1cnJlbmN5KSkgewogICAgICAgIGFjdGlvbnMuY29yZS5tYXJrQ29pbkFzVmlzaWJsZShjdXJyZW5jeSk7CiAgICAgIH0KCiAgICAgIHZhciBjdXJyZW5jeUZpYXRCYWxhbmNlOwogICAgICB2YXIgY2hhbmdlUGVyY2VudDsKCiAgICAgIGlmIChpbmZvQWJvdXRDdXJyZW5jeSAmJiBpbmZvQWJvdXRDdXJyZW5jeS5wcmljZV9maWF0KSB7CiAgICAgICAgY3VycmVuY3lGaWF0QmFsYW5jZSA9IG5ldyBCaWdOdW1iZXIoYmFsYW5jZSkuZHAoNiwgQmlnTnVtYmVyLlJPVU5EX0ZMT09SKS50b1N0cmluZygpICogaW5mb0Fib3V0Q3VycmVuY3kucHJpY2VfZmlhdDsKICAgICAgICBjaGFuZ2VQZXJjZW50ID0gaW5mb0Fib3V0Q3VycmVuY3kucGVyY2VudF9jaGFuZ2VfMWg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3VycmVuY3lGaWF0QmFsYW5jZSA9IDA7CiAgICAgIH0KCiAgICAgIHZhciBzZXR0aW5ncyA9IHsKICAgICAgICBpbmZpbml0ZTogdHJ1ZSwKICAgICAgICBzcGVlZDogNTAwLAogICAgICAgIGF1dG9wbGF5OiB0cnVlLAogICAgICAgIGF1dG9wbGF5U3BlZWQ6IDYwMDAsCiAgICAgICAgZmFkZTogdHJ1ZSwKICAgICAgICBzbGlkZXNUb1Nob3c6IDEsCiAgICAgICAgc2xpZGVzVG9TY3JvbGw6IDEKICAgICAgfTsKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgc3R5bGVOYW1lOiAicm9vdCAiLmNvbmNhdChpc0RhcmsgPyAnZGFyaycgOiAnJykKICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUGFnZVNlbywgewogICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICBkZWZhdWx0VGl0bGU6IGludGwuZm9ybWF0TWVzc2FnZSh0aXRsZS5tZXRhVGl0bGUsIHsKICAgICAgICAgIGZ1bGxOYW1lOiBmdWxsTmFtZSwKICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeQogICAgICAgIH0pLAogICAgICAgIGRlZmF1bHREZXNjcmlwdGlvbjogaW50bC5mb3JtYXRNZXNzYWdlKGRlc2NyaXB0aW9uLm1ldGFEZXNjcmlwdGlvbiwgewogICAgICAgICAgZnVsbE5hbWU6IGZ1bGxOYW1lLAogICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5CiAgICAgICAgfSkKICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KERhc2hib2FyZExheW91dCwgewogICAgICAgIHBhZ2U6ICJoaXN0b3J5IiwKICAgICAgICBCYWxhbmNlRm9ybTogdHhIaXN0b3J5ID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQmFsYW5jZUZvcm0sIHsKICAgICAgICAgIGFkZHJlc3M6IGFkZHJlc3MsCiAgICAgICAgICBhY3RpdmVGaWF0OiBhY3RpdmVGaWF0LAogICAgICAgICAgY3VycmVuY3lCYWxhbmNlOiBiYWxhbmNlLAogICAgICAgICAgZmlhdEJhbGFuY2U6IGN1cnJlbmN5RmlhdEJhbGFuY2UsCiAgICAgICAgICBjaGFuZ2VQZXJjZW50OiBjaGFuZ2VQZXJjZW50LAogICAgICAgICAgYWN0aXZlQ3VycmVuY3k6IGFjdGl2ZUN1cnJlbmN5LAogICAgICAgICAgaXNGZXRjaGluZzogaXNCYWxhbmNlRmV0Y2hpbmcsCiAgICAgICAgICBoYW5kbGVSZWNlaXZlOiB0aGlzLmhhbmRsZVJlY2VpdmUsCiAgICAgICAgICBoYW5kbGVXaXRoZHJhdzogdGhpcy5oYW5kbGVXaXRoZHJhdywKICAgICAgICAgIGhhbmRsZUV4Y2hhbmdlOiB0aGlzLmhhbmRsZUdvVHJhZGUsCiAgICAgICAgICBoYW5kbGVJbnZvaWNlOiB0aGlzLmhhbmRsZUludm9pY2UsCiAgICAgICAgICBzaG93QnV0dG9uczogYWN0aW9ucy51c2VyLmlzT3duZXIoYWRkcmVzcywgY3VycmVuY3kpLAogICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5LnRvTG93ZXJDYXNlKCksCiAgICAgICAgICBzaW5nbGVXYWxsZXQ6IHRydWUsCiAgICAgICAgICBtdWx0aXNpZ1BlbmRpbmdDb3VudDogbXVsdGlzaWdQZW5kaW5nQ291bnQKICAgICAgICB9KSA6IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChDb250ZW50TG9hZGVyLCB7CiAgICAgICAgICBsZWZ0U2lkZUNvbnRlbnQ6IHRydWUKICAgICAgICB9KSkKICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBzdHlsZU5hbWU6ICJjdXJyZW5jeVdhbGxldEFjdGl2aXR5ICIuY29uY2F0KGlzRGFyayA/ICdkYXJrQWN0aXZpdHknIDogJycpCiAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEZpbHRlckZvcm0sIHsKICAgICAgICBmaWx0ZXJWYWx1ZTogZmlsdGVyVmFsdWUsCiAgICAgICAgb25TdWJtaXQ6IHRoaXMuaGFuZGxlRmlsdGVyLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLmhhbmRsZUZpbHRlckNoYW5nZSwKICAgICAgICByZXNldEZpbHRlcjogdGhpcy5yZXNldEZpbHRlcgogICAgICB9KSwgdHhIaXN0b3J5ICYmICFpc0xvYWRpbmcgJiYgKHR4SGlzdG9yeS5sZW5ndGggPiAwID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVGFibGUsIHsKICAgICAgICByb3dzOiB0eEhpc3RvcnksCiAgICAgICAgc3R5bGVOYW1lOiAiY3VycmVuY3lIaXN0b3J5IiwKICAgICAgICByb3dSZW5kZXI6IHRoaXMucm93UmVuZGVyCiAgICAgIH0pIDogLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBzdHlsZU5hbWU6ICJoaXN0b3J5Q29udGVudCIKICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQ29udGVudExvYWRlciwgewogICAgICAgIHJpZGVTaWRlQ29udGVudDogdHJ1ZSwKICAgICAgICBlbXB0eTogdHJ1ZSwKICAgICAgICBub25IZWFkZXI6IHRydWUsCiAgICAgICAgaW5uZXI6IHRydWUKICAgICAgfSkpKSwgKCF0eEhpc3RvcnkgfHwgaXNMb2FkaW5nKSAmJiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgIHN0eWxlTmFtZTogImhpc3RvcnlDb250ZW50IgogICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChDb250ZW50TG9hZGVyLCB7CiAgICAgICAgcmlkZVNpZGVDb250ZW50OiB0cnVlLAogICAgICAgIG5vbkhlYWRlcjogdHJ1ZQogICAgICB9KSkpLCBzaG93U3dhcEhpc3RvcnkgJiYgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVhY3QuRnJhZ21lbnQsIG51bGwsICFhY3Rpb25zLmJ0Y211bHRpc2lnLmlzQlRDU01TQWRkcmVzcygiIi5jb25jYXQoYWRkcmVzcykpICYmICFhY3Rpb25zLmJ0Y211bHRpc2lnLmlzQlRDTVNVc2VyQWRkcmVzcygiIi5jb25jYXQoYWRkcmVzcykpICYmIChzd2FwSGlzdG9yeS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5zdGVwID49IDE7CiAgICAgIH0pLmxlbmd0aCA+IDAgPyAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChTd2Fwc0hpc3RvcnksIHsKICAgICAgICBvcmRlcnM6IHN3YXBIaXN0b3J5LmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgcmV0dXJuIGl0ZW0uc3RlcCA+PSA0OwogICAgICAgIH0pCiAgICAgIH0pIDogJycpKSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEZyYWdtZW50LCBudWxsLCBzZW9QYWdlICYmIHNlb1BhZ2UuZm9vdGVyICYmIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCBzZW9QYWdlLmZvb3RlcikpKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBDdXJyZW5jeVdhbGxldDsKfShDb21wb25lbnQpLCBfdGVtcCkpIHx8IF9jbGFzcykgfHwgX2NsYXNzKSB8fCBfY2xhc3MpIHx8IF9jbGFzcykgfHwgX2NsYXNzKTsKZXhwb3J0IHsgQ3VycmVuY3lXYWxsZXQgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/front/shared/pages/CurrencyWallet/CurrencyWallet.tsx"],"names":["React","Component","Fragment","connect","actions","withRouter","helpers","links","constants","ethToken","getTokenWallet","getBitcoinWallet","getEtherWallet","getGhostWallet","getNextWallet","CSSModules","styles","stylesHere","Row","SwapsHistory","Table","PageSeo","getSeoPage","injectIntl","defineMessages","localisedUrl","config","BalanceForm","BigNumber","ContentLoader","FilterForm","DashboardLayout","getCurrencyKey","lsDataCache","isWidgetBuild","isWidget","isDark","localStorage","getItem","CurrencyWallet","isSigned","signUp","core","user","history","transactions","swapHistory","ethData","btcData","ghostData","nextData","activeFiat","activeCurrency","btcMultisigSMSData","btcMultisigUserData","isFetching","isBalanceFetching","tokensData","multisigStatus","multisigPendingCount","items","Object","keys","map","k","tokens","historyTx","hiddenCoinsList","txHistory","allowMultiple","props","setState","rows","_mounted","data","concat","sort","a","b","date","txItems","state","currency","address","push","key","toLowerCase","time","isClosedNotifyBlockBanner","isClosedNotifyBlockSignUp","isPrivateKeysSaved","privateKeysSaved","walletTitle","modals","open","ReceiveModal","InvoiceModal","toUpperCase","toAddress","locale","intl","itemCurrency","contractAddress","decimals","balance","isBalanceEmpty","withdrawModal","Withdraw","isSmsProtected","WithdrawMultisigSMS","isUserProtected","WithdrawMultisigUser","targetCurrency","isToken","isEthToken","name","wallet","exchange","row","rowIndex","target","value","filterValue","loading","length","newRows","filter","includes","resetFilter","isLoading","setTimeout","setTransactions","pullTransactions","match","params","fullName","ticker","action","getWallets","isRedirecting","redirectUrl","walletAddress","item","infoAboutCurrency","hasCachedData","get","token","console","log","getBalances","location","reload","getBalance","fetchBalance","then","setLocalStorageItems","getSwapHistory","withdrawUrl","receiveUrl","pathname","modalType","currencyRate","pullActiveCurrency","prevProps","prevFiat","prevAddress","modalWithdraw","oldTxItems","currentUrl","currencyKey","tx","type","showSwapHistory","swap","sellCurrency","buyCurrency","reverse","seoPage","titleSwapOnline","metaTitle","id","defaultMessage","titleWidgetBuild","title","description","metaDescription","markCoinAsVisible","currencyFiatBalance","changePercent","price_fiat","dp","ROUND_FLOOR","toString","percent_change_1h","settings","infinite","speed","autoplay","autoplaySpeed","fade","slidesToShow","slidesToScroll","formatMessage","handleReceive","handleWithdraw","handleGoTrade","handleInvoice","isOwner","handleFilter","handleFilterChange","rowRender","btcmultisig","isBTCSMSAddress","isBTCMSUserAddress","step","footer"],"mappings":"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","sourcesContent":["// @ts-nocheck\r\nimport React, { Component, Fragment } from 'react'\r\n\r\nimport { connect } from 'redaction'\r\nimport actions from 'redux/actions'\r\nimport Slider from 'pages/Wallet/components/WallerSlider'\r\nimport { withRouter } from 'react-router-dom'\r\n\r\nimport helpers, { links, constants, ethToken } from 'helpers'\r\nimport { getTokenWallet, getBitcoinWallet, getEtherWallet, getGhostWallet, getNextWallet } from 'helpers/links'\r\n\r\nimport CSSModules from 'react-css-modules'\r\nimport styles from './CurrencyWallet.scss'\r\nimport stylesHere from '../History/History.scss'\r\n\r\nimport Row from 'pages/History/Row/Row'\r\nimport SwapsHistory from 'pages/History/SwapsHistory/SwapsHistory'\r\n\r\nimport Table from 'components/tables/Table/Table'\r\nimport PageSeo from 'components/Seo/PageSeo'\r\nimport { getSeoPage } from 'helpers/seo'\r\nimport { injectIntl, defineMessages } from 'react-intl'\r\nimport { localisedUrl } from 'helpers/locale'\r\nimport config from 'app-config'\r\nimport BalanceForm from 'components/BalanceForm/BalanceForm'\r\nimport { BigNumber } from 'bignumber.js'\r\nimport ContentLoader from 'components/loaders/ContentLoader/ContentLoader'\r\nimport FilterForm from 'components/FilterForm/FilterForm'\r\nimport DashboardLayout from 'components/layout/DashboardLayout/DashboardLayout'\r\n\r\nimport getCurrencyKey from 'helpers/getCurrencyKey'\r\nimport lsDataCache from 'helpers/lsDataCache'\r\n\r\n\r\nconst isWidgetBuild = config && config.isWidget\r\nconst isDark = localStorage.getItem(constants.localStorage.isDark)\r\n\r\n@connect(({ signUp: { isSigned } }) => ({\r\n  isSigned,\r\n}))\r\n@connect(\r\n  ({\r\n    core,\r\n    user,\r\n    history: { transactions, swapHistory },\r\n    history,\r\n    user: {\r\n      ethData,\r\n      btcData,\r\n      ghostData,\r\n      nextData,\r\n      activeFiat,\r\n      activeCurrency,\r\n      btcMultisigSMSData,\r\n      btcMultisigUserData,\r\n      isFetching,\r\n      isBalanceFetching,\r\n      tokensData,\r\n      multisigStatus,\r\n      multisigPendingCount,\r\n    },\r\n  }) => ({\r\n    items: [\r\n      ethData,\r\n      btcData,\r\n      ghostData,\r\n      nextData,\r\n      btcMultisigSMSData,\r\n      btcMultisigUserData,\r\n      ...Object.keys(tokensData).map((k) => tokensData[k]),\r\n    ],\r\n    tokens: [...Object.keys(tokensData).map((k) => tokensData[k])],\r\n    user,\r\n    activeFiat,\r\n    historyTx: history,\r\n    hiddenCoinsList: core.hiddenCoinsList,\r\n    txHistory: transactions,\r\n    swapHistory,\r\n    isFetching,\r\n    activeCurrency,\r\n    isBalanceFetching,\r\n    multisigStatus,\r\n    multisigPendingCount,\r\n  })\r\n)\r\n@injectIntl\r\n@withRouter\r\n@CSSModules({ ...styles, ...stylesHere }, { allowMultiple: true })\r\nexport default class CurrencyWallet extends Component<any, any> {\r\n  _mounted = false\r\n\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    const {\r\n      match: {\r\n        params: { fullName = null, ticker = null, address = null, action = null },\r\n      },\r\n      intl: { locale },\r\n      //items,\r\n      txHistory,\r\n      hiddenCoinsList,\r\n    } = props\r\n\r\n    const items = actions.core.getWallets({})\r\n\r\n    if (!address && !ticker) {\r\n      if (fullName) {\r\n        // Если это токен - перенаправляем на адрес /token/name/address\r\n        if (ethToken.isEthToken({ name: fullName })) {\r\n          this.state = {\r\n            ...this.state,\r\n            ...{\r\n              isRedirecting: true,\r\n              redirectUrl: getTokenWallet(fullName),\r\n            },\r\n          }\r\n          return\r\n        }\r\n\r\n        if (fullName.toLowerCase() === `bitcoin`) {\r\n          this.state = {\r\n            ...this.state,\r\n            ...{\r\n              isRedirecting: true,\r\n              redirectUrl: getBitcoinWallet(),\r\n            },\r\n          }\r\n          return\r\n        }\r\n        if (fullName.toLowerCase() === `ghost`) {\r\n          this.state = {\r\n            ...this.state,\r\n            ...{\r\n              isRedirecting: true,\r\n              redirectUrl: getGhostWallet(),\r\n            },\r\n          }\r\n          return\r\n        }\r\n        if (fullName.toLowerCase() === `next`) {\r\n          this.state = {\r\n            ...this.state,\r\n            ...{\r\n              isRedirecting: true,\r\n              redirectUrl: getNextWallet(),\r\n            },\r\n          }\r\n          return\r\n        }\r\n\r\n        if (fullName.toLowerCase() === `ethereum`) {\r\n          this.state = {\r\n            ...this.state,\r\n            ...{\r\n              isRedirecting: true,\r\n              redirectUrl: getEtherWallet(),\r\n            },\r\n          }\r\n          return\r\n        }\r\n      }\r\n      // @ToDO throw error\r\n    }\r\n\r\n    const walletAddress = address\r\n\r\n    // оставляю запасной вариант для старых ссылок\r\n    if (fullName) {\r\n      //@\r\n      ticker = fullName\r\n    }\r\n\r\n    // MultiWallet - after Sweep - названию валюты доверять нельзя - нужно проверяться также адрес - и выбирать по адресу\r\n    let itemCurrency = items.filter((item) => {\r\n      if (ethToken.isEthToken({ name: ticker })) {\r\n        if (\r\n          item.currency.toLowerCase() === ticker.toLowerCase() &&\r\n          item.address.toLowerCase() === walletAddress.toLowerCase()\r\n        ) {\r\n          return true\r\n        }\r\n      } else {\r\n        if (!ethToken.isEthToken({ name: ticker }) && item.address.toLowerCase() === walletAddress.toLowerCase()) {\r\n          return true\r\n        }\r\n      }\r\n    })\r\n    if (!itemCurrency.length) {\r\n      itemCurrency = items.filter((item) => {\r\n        if (item.balance > 0 && item.currency.toLowerCase() === ticker.toLowerCase()) return true\r\n      })\r\n    }\r\n    if (!itemCurrency.length) {\r\n      itemCurrency = items.filter((item) => {\r\n        if (item.balance >= 0 && item.currency.toLowerCase() === ticker.toLowerCase()) return true\r\n      })\r\n    }\r\n\r\n    if (itemCurrency.length) {\r\n      itemCurrency = itemCurrency[0]\r\n      //@\r\n      const { currency, address, contractAddress, decimals, balance, infoAboutCurrency } = itemCurrency\r\n\r\n      const hasCachedData = lsDataCache.get(`TxHistory_${getCurrencyKey(currency, true).toLowerCase()}_${address}`)\r\n\r\n      this.state = {\r\n        itemCurrency,\r\n        address,\r\n        walletAddress,\r\n        balance,\r\n        decimals,\r\n        currency,\r\n        txItems: hasCachedData,\r\n        contractAddress,\r\n        hiddenCoinsList,\r\n        isLoading: false,\r\n        infoAboutCurrency,\r\n        filterValue: walletAddress || address || '',\r\n        token: ethToken.isEthToken({ name: ticker }),\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this._mounted = true\r\n    console.log('CurrencyWallet mounted')\r\n    const {\r\n      currency,\r\n      itemCurrency,\r\n      token,\r\n      isRedirecting,\r\n      redirectUrl,\r\n      balance,\r\n      infoAboutCurrency,\r\n      hiddenCoinsList,\r\n    } = this.state\r\n\r\n    actions.user.getBalances()\r\n\r\n    if (isRedirecting) {\r\n      const {\r\n        history,\r\n        intl: { locale },\r\n      } = this.props\r\n      history.push(localisedUrl(locale, redirectUrl))\r\n      setTimeout(() => {\r\n        location.reload()\r\n      }, 100)\r\n      return\r\n    }\r\n\r\n    let {\r\n      match: {\r\n        params: { address = null },\r\n      },\r\n      activeCurrency,\r\n      activeFiat\r\n    } = this.props\r\n\r\n    if (currency) {\r\n      // actions.analytics.dataEvent(`open-page-${currency.toLowerCase()}-wallet`)\r\n    }\r\n    if (token) {\r\n      actions.token.getBalance(currency.toLowerCase())\r\n    }\r\n\r\n    // set balance for the address\r\n    address &&\r\n      actions[getCurrencyKey(currency.toLowerCase(), false)]\r\n        .fetchBalance(address)\r\n        .then((balance) => this.setState({ balance }))\r\n\r\n    this.setLocalStorageItems()\r\n\r\n    // if address is null, take transactions from current user\r\n    address\r\n      ? actions.history.setTransactions(address, currency.toLowerCase(), this.pullTransactions)\r\n      : actions.user.setTransactions()\r\n\r\n    if (!address) {\r\n      actions.core.getSwapHistory()\r\n    }\r\n\r\n    const { Withdraw, WithdrawMultisigSMS, WithdrawMultisigUser } = constants.modals\r\n\r\n    const targetCurrency = getCurrencyKey(currency.toLowerCase(), true)\r\n    const isToken = helpers.ethToken.isEthToken({ name: currency })\r\n\r\n    const withdrawUrl = (isToken ? '/token' : '') + `/${targetCurrency}/${address}/send`\r\n    const receiveUrl = (isToken ? '/token' : '') + `/${targetCurrency}/${address}/receive`\r\n\r\n    if (this.props.history.location.pathname.toLowerCase() === withdrawUrl.toLowerCase() && balance !== 0) {\r\n      let modalType = Withdraw\r\n      // if (itemCurrency.isSmsProtected) modalType = WithdrawMultisigSMS\r\n      // if (itemCurrency.isUserProtected) modalType = WithdrawMultisigUser\r\n\r\n      actions.modals.open(modalType, {\r\n        currency,\r\n        address,\r\n        balance,\r\n        infoAboutCurrency,\r\n        hiddenCoinsList,\r\n        currencyRate: itemCurrency.currencyRate,\r\n      })\r\n      if (activeCurrency.toUpperCase() !== activeFiat) {\r\n        actions.user.pullActiveCurrency(currency.toLowerCase())\r\n      }\r\n    }\r\n    if (this.props.history.location.pathname.toLowerCase() === receiveUrl.toLowerCase()) {\r\n      actions.modals.open(constants.modals.ReceiveModal, {\r\n        currency,\r\n        address,\r\n      })\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const { currency } = this.state\r\n\r\n    const { activeFiat } = this.props\r\n    const { activeFiat: prevFiat } = prevProps\r\n\r\n    let {\r\n      match: {\r\n        params: { address = null, fullName = null, ticker = null, action = null },\r\n      },\r\n      hiddenCoinsList,\r\n      activeCurrency\r\n    } = this.props\r\n\r\n    let {\r\n      match: {\r\n        params: { address: prevAddress = null },\r\n      },\r\n    } = prevProps\r\n    if (prevAddress !== address) {\r\n      address\r\n        ? actions.history.setTransactions(address, currency.toLowerCase(), this.pullTransactions)\r\n        : actions.user.setTransactions()\r\n    }\r\n\r\n    if (\r\n      prevProps.location.pathname !== this.props.location.pathname ||\r\n      prevProps.isBalanceFetching !== this.props.isBalanceFetching\r\n    ) {\r\n      const items = actions.core.getWallets({})\r\n\r\n      if (!address && !ticker) {\r\n        if (fullName) {\r\n          // Если это токен - перенаправляем на адрес /token/name/address\r\n          if (ethToken.isEthToken({ name: fullName })) {\r\n            this.state = {\r\n              ...this.state,\r\n              ...{\r\n                isRedirecting: true,\r\n                redirectUrl: getTokenWallet(fullName),\r\n              },\r\n            }\r\n            return\r\n          }\r\n\r\n          if (fullName.toLowerCase() === `bitcoin`) {\r\n            this.state = {\r\n              ...this.state,\r\n              ...{\r\n                isRedirecting: true,\r\n                redirectUrl: getBitcoinWallet(),\r\n              },\r\n            }\r\n            return\r\n          }\r\n\r\n          if (fullName.toLowerCase() === `ghost`) {\r\n            this.state = {\r\n              ...this.state,\r\n              ...{\r\n                isRedirecting: true,\r\n                redirectUrl: getGhostWallet(),\r\n              },\r\n            }\r\n            return\r\n          }\r\n\r\n          if (fullName.toLowerCase() === `next`) {\r\n            this.state = {\r\n              ...this.state,\r\n              ...{\r\n                isRedirecting: true,\r\n                redirectUrl: getNextWallet(),\r\n              },\r\n            }\r\n            return\r\n          }\r\n\r\n          if (fullName.toLowerCase() === `ethereum`) {\r\n            this.state = {\r\n              ...this.state,\r\n              ...{\r\n                isRedirecting: true,\r\n                redirectUrl: getEtherWallet(),\r\n              },\r\n            }\r\n            return\r\n          }\r\n        }\r\n        // @ToDO throw error\r\n      }\r\n\r\n      const walletAddress = address\r\n\r\n      // оставляю запасной вариант для старых ссылок\r\n      if (fullName) {\r\n        ticker = fullName\r\n      }\r\n      // MultiWallet - after Sweep - названию валюты доверять нельзя - нужно проверяться также адрес - и выбирать по адресу\r\n      let itemCurrency = items.filter((item) => {\r\n        if (ethToken.isEthToken({ name: ticker })) {\r\n          if (\r\n            item.currency.toLowerCase() === ticker.toLowerCase() &&\r\n            item.address.toLowerCase() === walletAddress.toLowerCase()\r\n          ) {\r\n            return true\r\n          }\r\n        } else {\r\n          if (!ethToken.isEthToken({ name: ticker }) && item.address.toLowerCase() === walletAddress.toLowerCase()) {\r\n            return true\r\n          }\r\n        }\r\n      })\r\n\r\n      if (itemCurrency.length) {\r\n        itemCurrency = itemCurrency[0]\r\n        //@\r\n        const { currency, address, contractAddress, decimals, balance, infoAboutCurrency } = itemCurrency\r\n\r\n        const { Withdraw, WithdrawMultisigSMS, WithdrawMultisigUser } = constants.modals\r\n\r\n        let modalWithdraw = Withdraw\r\n        // if (itemCurrency.isSmsProtected) modalWithdraw = WithdrawMultisigSMS\r\n        // if (itemCurrency.isUserProtected) modalWithdraw = WithdrawMultisigUser\r\n\r\n        const {\r\n          txItems: oldTxItems,\r\n        } = this.state\r\n\r\n        const hasCachedData = lsDataCache.get(`TxHistory_${getCurrencyKey(currency, true).toLowerCase()}_${address}`)\r\n\r\n        this.setState(\r\n          {\r\n            itemCurrency,\r\n            address,\r\n            decimals,\r\n            currency,\r\n            balance,\r\n            txItems: (hasCachedData || oldTxItems),\r\n            contractAddress,\r\n            isLoading: false,\r\n            infoAboutCurrency,\r\n            filterValue: address || '',\r\n            token: ethToken.isEthToken({ name: ticker }),\r\n          },\r\n          () => {\r\n            if (prevProps.location.pathname !== this.props.location.pathname) {\r\n              if (activeCurrency.toUpperCase() !== activeFiat) {\r\n                actions.user.pullActiveCurrency(currency.toLowerCase())\r\n              }\r\n            }\r\n            const targetCurrency = getCurrencyKey(currency.toLowerCase(), true)\r\n            const isToken = helpers.ethToken.isEthToken({ name: currency })\r\n\r\n            const withdrawUrl = (isToken ? '/token' : '') + `/${targetCurrency}/${address}/send`\r\n            const receiveUrl = (isToken ? '/token' : '') + `/${targetCurrency}/${address}/receive`\r\n            const currentUrl = this.props.location.pathname.toLowerCase()\r\n\r\n            if (currentUrl === withdrawUrl.toLowerCase()) {\r\n              actions.modals.open(modalWithdraw, {\r\n                currency,\r\n                address,\r\n                balance,\r\n                infoAboutCurrency,\r\n                hiddenCoinsList,\r\n                itemCurrency,\r\n                //@\r\n                currencyRate: itemCurrency.currencyRate,\r\n              })\r\n            }\r\n            if (currentUrl === receiveUrl.toLowerCase()) {\r\n              actions.modals.open(constants.modals.ReceiveModal, {\r\n                currency,\r\n                address,\r\n              })\r\n            }\r\n          }\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this._mounted = false\r\n    console.log('CurrencyWallet unmounted')\r\n  }\r\n\r\n  getRows = (txHistory) => {\r\n    this.setState(() => ({ rows: txHistory }))\r\n  }\r\n\r\n  pullTransactions = (transactions) => {\r\n    if (!this._mounted) return\r\n    let data = [].concat([], ...transactions).sort((a, b) => b.date - a.date)\r\n    this.setState({\r\n      txItems: data,\r\n    })\r\n\r\n    const {\r\n      currency,\r\n      address,\r\n    } = this.state\r\n\r\n    lsDataCache.push({\r\n      key: `TxHistory_${getCurrencyKey(currency, true).toLowerCase()}_${address}`,\r\n      data,\r\n      time: 3600,\r\n    })\r\n  }\r\n\r\n  setLocalStorageItems = () => {\r\n    //@\r\n    const isClosedNotifyBlockBanner = localStorage.getItem(constants.localStorage.isClosedNotifyBlockBanner)\r\n    //@\r\n    const isClosedNotifyBlockSignUp = localStorage.getItem(constants.localStorage.isClosedNotifyBlockSignUp)\r\n    const isPrivateKeysSaved = localStorage.getItem(constants.localStorage.privateKeysSaved)\r\n    const walletTitle = localStorage.getItem(constants.localStorage.walletTitle)\r\n\r\n    this.setState({\r\n      isClosedNotifyBlockBanner,\r\n      isClosedNotifyBlockSignUp,\r\n      walletTitle,\r\n      isPrivateKeysSaved,\r\n    })\r\n  }\r\n\r\n  handleReceive = () => {\r\n    const { currency, address } = this.state\r\n\r\n    actions.modals.open(constants.modals.ReceiveModal, {\r\n      currency,\r\n      address,\r\n    })\r\n  }\r\n\r\n  handleInvoice = () => {\r\n    const { currency, address } = this.state\r\n\r\n    actions.modals.open(constants.modals.InvoiceModal, {\r\n      currency: currency.toUpperCase(),\r\n      toAddress: address,\r\n    })\r\n  }\r\n\r\n  handleWithdraw = () => {\r\n    const {\r\n      history,\r\n      hiddenCoinsList,\r\n      intl: { locale },\r\n    } = this.props\r\n    const { itemCurrency, currency, address, contractAddress, decimals, balance, isBalanceEmpty } = this.state\r\n\r\n    // actions.analytics.dataEvent(`balances-withdraw-${currency.toLowerCase()}`)\r\n    let withdrawModal = constants.modals.Withdraw\r\n    if (itemCurrency.isSmsProtected) withdrawModal = withdrawModal = constants.modals.WithdrawMultisigSMS\r\n    if (itemCurrency.isUserProtected) withdrawModal = constants.modals.WithdrawMultisigUser\r\n\r\n    let targetCurrency = getCurrencyKey(currency.toLowerCase(), true).toLowerCase()\r\n\r\n    const isToken = helpers.ethToken.isEthToken({ name: currency })\r\n\r\n    history.push(localisedUrl(locale, (isToken ? '/token' : '') + `/${targetCurrency}/${address}/send`))\r\n  }\r\n\r\n  handleGoWalletHome = () => {\r\n    const {\r\n      history,\r\n      intl: { locale },\r\n    } = this.props\r\n\r\n    history.push(localisedUrl(locale, links.wallet))\r\n  }\r\n\r\n  handleGoTrade = () => {\r\n    const { currency } = this.state\r\n    const {\r\n      history,\r\n      intl: { locale },\r\n    } = this.props\r\n\r\n    history.push(localisedUrl(locale, `${links.exchange}/btc-to-${currency.toLowerCase()}`))\r\n  }\r\n\r\n  rowRender = (row, rowIndex) => {\r\n    const {\r\n      history,\r\n      activeFiat,\r\n    } = this.props\r\n\r\n    return <Row key={rowIndex} {...row} activeFiat={activeFiat} history={history} />\r\n  }\r\n\r\n  handleFilterChange = ({ target }) => {\r\n    const { value } = target\r\n\r\n    this.setState(() => ({ filterValue: value }))\r\n  }\r\n\r\n  handleFilter = () => {\r\n    const { filterValue, txItems } = this.state\r\n    this.loading()\r\n\r\n    if (filterValue.toLowerCase() && filterValue.length) {\r\n      const newRows = txItems.filter(\r\n        ({ address }) => address && address.toLowerCase().includes(filterValue.toLowerCase())\r\n      )\r\n\r\n      this.setState(() => ({ txItems: newRows }))\r\n    } else {\r\n      this.resetFilter()\r\n    }\r\n  }\r\n\r\n  loading = () => {\r\n    this.setState(() => ({ isLoading: true }))\r\n    setTimeout(() => this.setState(() => ({ isLoading: false })), 1000)\r\n  }\r\n\r\n  resetFilter = () => {\r\n    this.loading()\r\n    const { address, currency } = this.state\r\n    this.setState(() => ({ filterValue: address }))\r\n    actions.history.setTransactions(address, currency.toLowerCase(), this.pullTransactions)\r\n  }\r\n\r\n  render() {\r\n    let {\r\n      swapHistory,\r\n      txHistory,\r\n      location,\r\n      match: {\r\n        params: { address = null },\r\n      },\r\n      intl,\r\n      hiddenCoinsList,\r\n      isSigned,\r\n      isBalanceFetching,\r\n      activeFiat,\r\n      multisigStatus,\r\n      activeCurrency,\r\n      multisigPendingCount,\r\n    } = this.props\r\n\r\n    const {\r\n      currency,\r\n      itemCurrency,\r\n      balance,\r\n      fullName,\r\n      infoAboutCurrency,\r\n      isRedirecting,\r\n      txItems,\r\n      filterValue,\r\n      isLoading,\r\n    } = this.state\r\n\r\n    const currencyKey = getCurrencyKey(currency, true)\r\n\r\n    if (isRedirecting) return null\r\n\r\n    txHistory = txItems || txHistory\r\n\r\n    if (txHistory) {\r\n      txHistory = txHistory.filter((tx) => {\r\n        if (tx && tx.type) {\r\n          return tx.type.toLowerCase() === currencyKey.toLowerCase()\r\n        }\r\n        return false\r\n      })\r\n    }\r\n\r\n    const showSwapHistory = (address.toLowerCase() === itemCurrency.address.toLowerCase())\r\n\r\n    if (showSwapHistory)\r\n      swapHistory = Object.keys(swapHistory)\r\n      .map((key) => swapHistory[key])\r\n      .filter((swap) => swap.sellCurrency === currency || swap.buyCurrency === currency)\r\n      .reverse()\r\n\r\n    const seoPage = getSeoPage(location.pathname)\r\n\r\n    const titleSwapOnline = defineMessages({\r\n      metaTitle: {\r\n        id: 'CurrencyWalletTitle',\r\n        defaultMessage: 'Swap.Online - {fullName} ({currency}) Web Wallet with Atomic Swap.',\r\n      },\r\n    })\r\n    const titleWidgetBuild = defineMessages({\r\n      metaTitle: {\r\n        id: 'CurrencyWalletWidgetBuildTitle',\r\n        defaultMessage: '{fullName} ({currency}) Web Wallet with Atomic Swap.',\r\n      },\r\n    })\r\n    const title = isWidgetBuild ? titleWidgetBuild : titleSwapOnline\r\n\r\n    const description = defineMessages({\r\n      metaDescription: {\r\n        id: 'CurrencyWallet154',\r\n        defaultMessage:\r\n          'Atomic Swap Wallet allows you to manage and securely exchange ${fullName} (${currency}) with 0% fees. Based on Multi-Sig and Atomic Swap technologies.',\r\n      },\r\n    })\r\n\r\n    if (hiddenCoinsList.includes(currency)) {\r\n      actions.core.markCoinAsVisible(currency)\r\n    }\r\n\r\n    let currencyFiatBalance\r\n    let changePercent\r\n\r\n    if (infoAboutCurrency && infoAboutCurrency.price_fiat) {\r\n      currencyFiatBalance =\r\n        new BigNumber(balance).dp(6, BigNumber.ROUND_FLOOR).toString() as any * infoAboutCurrency.price_fiat as any\r\n      changePercent = infoAboutCurrency.percent_change_1h\r\n    } else {\r\n      currencyFiatBalance = 0\r\n    }\r\n\r\n    let settings = {\r\n      infinite: true,\r\n      speed: 500,\r\n      autoplay: true,\r\n      autoplaySpeed: 6000,\r\n      fade: true,\r\n      slidesToShow: 1,\r\n      slidesToScroll: 1,\r\n    }\r\n\r\n    return (\r\n      <div styleName={`root ${isDark ? 'dark' : ''}`}>\r\n        <PageSeo\r\n          location={location}\r\n          defaultTitle={intl.formatMessage(title.metaTitle, {\r\n            fullName,\r\n            currency,\r\n          })}\r\n          defaultDescription={intl.formatMessage(description.metaDescription, {\r\n            fullName,\r\n            currency,\r\n          })}\r\n        />\r\n\r\n        <DashboardLayout\r\n          page=\"history\"\r\n          BalanceForm={\r\n            txHistory\r\n              ?\r\n              <BalanceForm\r\n                address={address}\r\n                activeFiat={activeFiat}\r\n                currencyBalance={balance}\r\n                fiatBalance={currencyFiatBalance}\r\n                changePercent={changePercent}\r\n                activeCurrency={activeCurrency}\r\n                isFetching={isBalanceFetching}\r\n                handleReceive={this.handleReceive}\r\n                handleWithdraw={this.handleWithdraw}\r\n                handleExchange={this.handleGoTrade}\r\n                handleInvoice={this.handleInvoice}\r\n                showButtons={actions.user.isOwner(address, currency)}\r\n                currency={currency.toLowerCase()}\r\n                singleWallet={true}\r\n                multisigPendingCount={multisigPendingCount}\r\n              />\r\n              :\r\n              <Fragment>\r\n                {/*\r\n                //@ */}\r\n                <ContentLoader leftSideContent />\r\n              </Fragment>\r\n          }\r\n        >\r\n          <div styleName={`currencyWalletActivity ${isDark ? 'darkActivity' : ''}`}>\r\n            <FilterForm\r\n              filterValue={filterValue}\r\n              onSubmit={this.handleFilter}\r\n              onChange={this.handleFilterChange}\r\n              resetFilter={this.resetFilter}\r\n            />\r\n            {txHistory &&\r\n              !isLoading &&\r\n              (txHistory.length > 0 ? (\r\n                <Table rows={txHistory} styleName=\"currencyHistory\" rowRender={this.rowRender} />\r\n              ) : (\r\n                  <div styleName=\"historyContent\">\r\n                    {/*\r\n                    //@ */}\r\n                    <ContentLoader rideSideContent empty nonHeader inner />\r\n                  </div>\r\n                ))}\r\n            {(!txHistory || isLoading) && (\r\n              <div styleName=\"historyContent\">\r\n                {/*\r\n                //@ */}\r\n                <ContentLoader rideSideContent nonHeader />\r\n              </div>\r\n            )}\r\n          </div>\r\n          {showSwapHistory && (\r\n            <>\r\n              {!actions.btcmultisig.isBTCSMSAddress(`${address}`) &&\r\n                !actions.btcmultisig.isBTCMSUserAddress(`${address}`) &&\r\n                (swapHistory.filter((item) => item.step >= 1).length > 0 ? (\r\n                    <SwapsHistory orders={swapHistory.filter((item) => item.step >= 4)} />\r\n                  ) : (\r\n                    ''\r\n                  )\r\n                )\r\n              }\r\n            </>\r\n          )}\r\n        </DashboardLayout>\r\n        <Fragment>{seoPage && seoPage.footer && <div>{seoPage.footer}</div>}</Fragment>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"]}]}