{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\helpers\\migrations\\index.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\helpers\\migrations\\index.ts","mtime":1614842914117},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgY29uc3RhbnRzLCBsb2NhbFN0b3JhZ2UgfSBmcm9tICdoZWxwZXJzJzsKaW1wb3J0IGluaXRNaWdyYXRpb24gZnJvbSAnLi8wMDFfaW5pdE1pZ3JhdGlvbic7CnZhciBtaWdyYXRpb25zID0gW2luaXRNaWdyYXRpb24gLy8gZG9uJ3QgYnJlYWsgYW4gb3JkZXIgb2YgbWlncmF0aW9ucywgYWRkIG9ubHkgdG8gZW5kIG9mIGFycmF5Cl07CmV4cG9ydCB2YXIgbWlncmF0ZSA9IGZ1bmN0aW9uIG1pZ3JhdGUoKSB7CiAgdmFyIHJldmlzaW9uID0gcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oY29uc3RhbnRzLmxvY2FsU3RvcmFnZS5zdG9yYWdlUmV2aXNpb24pLCAxMCkgfHwgMDsKCiAgaWYgKG1pZ3JhdGlvbnMubGVuZ3RoID09PSByZXZpc2lvbikgewogICAgY29uc29sZS5sb2coJ1lvdXIgc3RvcmFnZSBpcyB1cC10by1kYXRlJyk7CiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgfQoKICBjb25zb2xlLmxvZygiWW91ciBjdXJyZW50IHN0b3JhZ2UgcmV2aXNpb24gaXMgIi5jb25jYXQocmV2aXNpb24sICIsIG5lZWQgdG8gcnVuICIpLmNvbmNhdChtaWdyYXRpb25zLmxlbmd0aCAtIHJldmlzaW9uLCAiIG1pZ3JhdGlvbnMiKSk7CiAgcmV0dXJuIG1pZ3JhdGlvbnMuc3BsaWNlKHJldmlzaW9uKS5yZWR1Y2UoZnVuY3Rpb24gKHF1ZXVlLCBtaWdyYXRpb24pIHsKICAgIHJldHVybiBxdWV1ZS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB0cnkgewogICAgICAgICAgbWlncmF0aW9uLnJ1bigpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiTWlncmF0aW9uIFwiIi5jb25jYXQobWlncmF0aW9uLm5hbWUsICJcIiAoIyIpLmNvbmNhdChyZXZpc2lvbiArIDEsICIpIHN1Y2Nlc3NmdWxseSBkb25lLiIpKTsKICAgICAgICAgICAgcmV2aXNpb24rKzsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICAgICAgcmVqZWN0KCJNaWdyYXRpb24gXCIiLmNvbmNhdChtaWdyYXRpb24ubmFtZSwgIlwiICgjIikuY29uY2F0KHJldmlzaW9uICsgMSwgIikgaXMgZmFpbGVkLiIpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICByZWplY3QoIk1pZ3JhdGlvbiBcIiIuY29uY2F0KG1pZ3JhdGlvbi5uYW1lLCAiXCIgKCMiKS5jb25jYXQocmV2aXNpb24gKyAxLCAiKSBpcyBmYWlsZWQuIikpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9LCBQcm9taXNlLnJlc29sdmUoKSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICBjb25zb2xlLmxvZygnQWxsIG1pZ3JhdGlvbnMgZG9uZS4nKTsKICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZSkgewogICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoZSk7CiAgfSlbImZpbmFsbHkiXShmdW5jdGlvbiAoKSB7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjb25zdGFudHMubG9jYWxTdG9yYWdlLnN0b3JhZ2VSZXZpc2lvbiwgcmV2aXNpb24pOwogIH0pOwp9Ow=="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/front/shared/helpers/migrations/index.ts"],"names":["constants","localStorage","initMigration","migrations","migrate","revision","parseInt","getItem","storageRevision","length","console","log","Promise","resolve","splice","reduce","queue","migration","then","reject","run","name","e","error","setItem"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,YAApB,QAAwC,SAAxC;AACA,OAAOC,aAAP,MAA0B,qBAA1B;AAGA,IAAMC,UAAU,GAAG,CACjBD,aADiB,CAEjB;AAFiB,CAAnB;AAKA,OAAO,IAAME,OAAO,GAAG,SAAVA,OAAU,GAAM;AAC3B,MAAIC,QAAQ,GAAGC,QAAQ,CAACL,YAAY,CAACM,OAAb,CAAqBP,SAAS,CAACC,YAAV,CAAuBO,eAA5C,CAAD,EAA+D,EAA/D,CAAR,IAA8E,CAA7F;;AACA,MAAIL,UAAU,CAACM,MAAX,KAAsBJ,QAA1B,EAAoC;AAClCK,IAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACA,WAAOC,OAAO,CAACC,OAAR,EAAP;AACD;;AACDH,EAAAA,OAAO,CAACC,GAAR,4CAAgDN,QAAhD,2BAAyEF,UAAU,CAACM,MAAX,GAAoBJ,QAA7F;AAEA,SAAOF,UAAU,CAACW,MAAX,CAAkBT,QAAlB,EAA4BU,MAA5B,CAAmC,UAACC,KAAD,EAAQC,SAAR;AAAA,WACxCD,KAAK,CAACE,IAAN,CAAW;AAAA,aAAM,IAAIN,OAAJ,CAAY,UAACC,OAAD,EAAUM,MAAV,EAAqB;AAChD,YAAI;AACFF,UAAAA,SAAS,CAACG,GAAV,GACGF,IADH,CACQ,YAAM;AACVR,YAAAA,OAAO,CAACC,GAAR,uBAA0BM,SAAS,CAACI,IAApC,kBAA+ChB,QAAQ,GAAG,CAA1D;AACAA,YAAAA,QAAQ;AACRQ,YAAAA,OAAO;AACR,WALH,WAKW,UAAAS,CAAC,EAAI;AACZZ,YAAAA,OAAO,CAACa,KAAR,CAAcD,CAAd;AACAH,YAAAA,MAAM,uBAAeF,SAAS,CAACI,IAAzB,kBAAoChB,QAAQ,GAAG,CAA/C,kBAAN;AACD,WARH;AASD,SAVD,CAUE,OAAOiB,CAAP,EAAU;AACVZ,UAAAA,OAAO,CAACa,KAAR,CAAcD,CAAd;AACAH,UAAAA,MAAM,uBAAeF,SAAS,CAACI,IAAzB,kBAAoChB,QAAQ,GAAG,CAA/C,kBAAN;AACD;AACF,OAfgB,CAAN;AAAA,KAAX,CADwC;AAAA,GAAnC,EAiBDO,OAAO,CAACC,OAAR,EAjBC,EAiBkBK,IAjBlB,CAiBuB,YAAM;AAClCR,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACD,GAnBM,WAmBE,UAAAW,CAAC;AAAA,WAAIZ,OAAO,CAACa,KAAR,CAAcD,CAAd,CAAJ;AAAA,GAnBH,aAoBI,YAAM;AACbrB,IAAAA,YAAY,CAACuB,OAAb,CAAqBxB,SAAS,CAACC,YAAV,CAAuBO,eAA5C,EAA6DH,QAA7D;AACD,GAtBI,CAAP;AAuBD,CA/BM","sourcesContent":["import { constants, localStorage } from 'helpers'\r\nimport initMigration from './001_initMigration'\r\n\r\n\r\nconst migrations = [\r\n  initMigration,\r\n  // don't break an order of migrations, add only to end of array\r\n]\r\n\r\nexport const migrate = () => {\r\n  let revision = parseInt(localStorage.getItem(constants.localStorage.storageRevision), 10) || 0\r\n  if (migrations.length === revision) {\r\n    console.log('Your storage is up-to-date')\r\n    return Promise.resolve()\r\n  }\r\n  console.log(`Your current storage revision is ${revision}, need to run ${migrations.length - revision} migrations`)\r\n\r\n  return migrations.splice(revision).reduce((queue, migration) =>\r\n    queue.then(() => new Promise((resolve, reject) => {\r\n      try {\r\n        migration.run()\r\n          .then(() => {\r\n            console.log(`Migration \"${migration.name}\" (#${revision + 1}) successfully done.`)\r\n            revision++\r\n            resolve()\r\n          }).catch(e => {\r\n            console.error(e)\r\n            reject(`Migration \"${migration.name}\" (#${revision + 1}) is failed.`)\r\n          })\r\n      } catch (e) {\r\n        console.error(e)\r\n        reject(`Migration \"${migration.name}\" (#${revision + 1}) is failed.`)\r\n      }\r\n    }\r\n    )), Promise.resolve()).then(() => {\r\n    console.log('All migrations done.')\r\n  }).catch(e => console.error(e))\r\n    .finally(() => {\r\n      localStorage.setItem(constants.localStorage.storageRevision, revision)\r\n    })\r\n}\r\n"]}]}