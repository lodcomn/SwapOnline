{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.flows\\turbo\\Maker.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.flows\\turbo\\Maker.ts","mtime":1614842913761},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI7CmltcG9ydCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXNzZXJ0VGhpc0luaXRpYWxpemVkIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI7CmltcG9ydCBfZ2V0IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZ2V0IjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiQGJhYmVsL3J1bnRpbWUvcmVnZW5lcmF0b3IiOwoKZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH0KCmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CgppbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnOwppbXBvcnQgeyBGbG93IH0gZnJvbSAnc3dhcC5zd2FwJzsKCnZhciBUdXJib01ha2VyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfRmxvdykgewogIF9pbmhlcml0cyhUdXJib01ha2VyLCBfRmxvdyk7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoVHVyYm9NYWtlcik7CgogIGZ1bmN0aW9uIFR1cmJvTWFrZXIoc3dhcCkgewogICAgdmFyIF90aGlzU3VwZXIsIF90aGlzU3VwZXIyLCBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVHVyYm9NYWtlcik7CgogICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBzd2FwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfZmxvd05hbWUiLCAnVHVyYm9NYWtlcicpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm15U3dhcCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicGFydGljaXBhbnRTd2FwIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGF0ZSIsIHZvaWQgMCk7CgogICAgY29uc29sZS5sb2coJ0NyZWF0ZSBNYWtlciBmbG93KHN3YXApLCBzd2FwID0nLCBzd2FwKTsKICAgIF90aGlzLnN0ZXBOdW1iZXJzID0gewogICAgICAnc2lnbic6IDEsCiAgICAgICdjaGVjay1iYWxhbmNlJzogMiwKICAgICAgJ3dhaXQtdGFrZXItdHgnOiAzLAogICAgICAnc2VuZC1tYWtlci10eCc6IDQsCiAgICAgICdmaW5pc2gnOiA1LAogICAgICAnZW5kJzogNgogICAgfTsKICAgIF90aGlzLm15U3dhcCA9IHN3YXAub3duZXJTd2FwOwogICAgX3RoaXMucGFydGljaXBhbnRTd2FwID0gc3dhcC5wYXJ0aWNpcGFudFN3YXA7CiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgc3RlcDogMCwKICAgICAgaXNQYXJ0aWNpcGFudFNpZ25lZDogZmFsc2UsCiAgICAgIGlzQmFsYW5jZUZldGNoaW5nOiBmYWxzZSwKICAgICAgaXNCYWxhbmNlRW5vdWdoOiB0cnVlLAogICAgICB0YWtlclR4SGFzaDogbnVsbCwKICAgICAgaXNUYWtlclR4UGVuZGVkOiBmYWxzZSwKICAgICAgbWFrZXJUeEhhc2g6IG51bGwsCiAgICAgIGlzTWFrZXJUeFBlbmRlZDogZmFsc2UsCiAgICAgIGlzU3RvcHBlZFN3YXA6IGZhbHNlLAogICAgICBpc0ZpbmlzaGVkOiBmYWxzZQogICAgfTsKCiAgICBfZ2V0KChfdGhpc1N1cGVyID0gX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksIF9nZXRQcm90b3R5cGVPZihUdXJib01ha2VyLnByb3RvdHlwZSkpLCAiX3BlcnNpc3RTdGF0ZSIsIF90aGlzU3VwZXIpLmNhbGwoX3RoaXNTdXBlcik7CgogICAgX2dldCgoX3RoaXNTdXBlcjIgPSBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgX2dldFByb3RvdHlwZU9mKFR1cmJvTWFrZXIucHJvdG90eXBlKSksICJfcGVyc2lzdFN0ZXBzIiwgX3RoaXNTdXBlcjIpLmNhbGwoX3RoaXNTdXBlcjIpOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhUdXJib01ha2VyLCBbewogICAga2V5OiAiX2dldFN0ZXBzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0U3RlcHMoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIGZsb3cgPSB0aGlzOwogICAgICB2YXIgc3dhcCA9IHRoaXMuc3dhcDsKICAgICAgdmFyIHJvb20gPSB0aGlzLnN3YXAucm9vbTsKICAgICAgdmFyIG15U3dhcCA9IHRoaXMubXlTd2FwOwogICAgICB2YXIgcGFydGljaXBhbnRTd2FwID0gdGhpcy5wYXJ0aWNpcGFudFN3YXA7CiAgICAgIHJldHVybiBbLyojX19QVVJFX18qL19hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJNYWtlciBTdGVwIDE6ICdzaWduJyIpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RoaXMuc3dhcCA9Jywgc3dhcCk7IC8vZmxvdy5zd2FwLnByb2Nlc3NNZXRhbWFzaygpCgogICAgICAgICAgICAgICAgcm9vbS5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIGV2ZW50OiAncmVxdWVzdCBzaWduJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByb29tLm9uY2UoJ3N3YXAgc2lnbicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgdmFyIHN0ZXAgPSBmbG93LnN0YXRlLnN0ZXA7CgogICAgICAgICAgICAgICAgICBpZiAoc3RlcCA+PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBmbG93LmZpbmlzaFN0ZXAoewogICAgICAgICAgICAgICAgICAgIGlzUGFydGljaXBhbnRTaWduZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIHN0ZXA6ICdzaWduJwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpLCAvKiNfX1BVUkVfXyovX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiTWFrZXIgU3RlcCAyOiAnY2hlY2stYmFsYW5jZSciKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0aGlzLnN3YXAgPScsIHN3YXApOwogICAgICAgICAgICAgICAgLypjb25zdCB7IHNlbGxBbW91bnQgfSA9IHRoaXMuc3dhcA0KICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7DQogICAgICAgICAgICAgICAgICBpc0JhbGFuY2VGZXRjaGluZzogdHJ1ZSwNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgY29uc3QgYnRjQWRkcmVzcyA9IHRoaXMuYXBwLnNlcnZpY2VzLmF1dGguYWNjb3VudHMuYnRjLmdldEFkZHJlc3MoKQ0KICAgICAgICAgICAgICAgICAgY29uc3QgdHhGZWUgPSBhd2FpdCB0aGlzLmJ0Y1N3YXAuZXN0aW1hdGVGZWVWYWx1ZSh7DQogICAgICAgICAgICAgICAgICBtZXRob2Q6ICdzd2FwJywNCiAgICAgICAgICAgICAgICAgIGZpeGVkOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgYWRkcmVzczogYnRjQWRkcmVzcw0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICBjb25zdCB1bnNwZW50cyA9IGF3YWl0IHRoaXMuYnRjU3dhcC5mZXRjaFVuc3BlbnRzKGJ0Y0FkZHJlc3MpDQogICAgICAgICAgICAgICAgY29uc3QgdG90YWxVbnNwZW50ID0gdW5zcGVudHMucmVkdWNlKChzdW1tLCB7IHNhdG9zaGlzIH0pID0+IHN1bW0gKyBzYXRvc2hpcywgMCkNCiAgICAgICAgICAgICAgICBjb25zdCBiYWxhbmNlID0gbmV3IEJpZ051bWJlcih0b3RhbFVuc3BlbnQpLmRpdmlkZWRCeSgxZTgpDQogICAgICAgICAgICAgICAgICBjb25zdCBuZWVkQW1vdW50ID0gc2VsbEFtb3VudC5wbHVzKHR4RmVlKQ0KICAgICAgICAgICAgICAgIGNvbnN0IGlzRW5vdWdoTW9uZXkgPSBuZWVkQW1vdW50LmlzTGVzc1RoYW5PckVxdWFsVG8oYmFsYW5jZSkNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlRGF0YSA9IHsNCiAgICAgICAgICAgICAgICAgIGlzQmFsYW5jZUZldGNoaW5nOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgIGlzQmFsYW5jZUVub3VnaDogaXNFbm91Z2hNb25leSwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAoaXNFbm91Z2hNb25leSkgew0KICAgICAgICAgICAgICAgICAgdGhpcy5maW5pc2hTdGVwKHN0YXRlRGF0YSwgeyBzdGVwOiAnY2hlY2stYmFsYW5jZScgfSkNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShzdGF0ZURhdGEsIHRydWUpDQogICAgICAgICAgICAgICAgfSovCiAgICAgICAgICAgICAgICAvL3JldHVybiB0cnVlCiAgICAgICAgICAgICAgICAvL3RlbXAKCiAgICAgICAgICAgICAgICBfdGhpczIuZmluaXNoU3RlcCh7CiAgICAgICAgICAgICAgICAgIGlzQmFsYW5jZUVub3VnaDogdHJ1ZQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBzdGVwOiAnY2hlY2stYmFsYW5jZScKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICB9KSksIGZ1bmN0aW9uICgpIHsKICAgICAgICBjb25zb2xlLmxvZygiTWFrZXIgU3RlcCAzOiAnd2FpdC10YWtlci10eCciKTsKICAgICAgICBjb25zb2xlLmxvZygndGhpcy5zd2FwID0nLCBzd2FwKTsKICAgICAgICByb29tLm9uY2UoJ3Rha2VyIHR4IHNlbmRlZCcsIGZ1bmN0aW9uIChfcmVmMykgewogICAgICAgICAgdmFyIHR4SGFzaCA9IF9yZWYzLnR4SGFzaDsKICAgICAgICAgIGNvbnNvbGUubG9nKCJSRUNFSVZFRCBmcm9tIHRha2VyOiB0eCBoYXNoID0iLCB0eEhhc2gpOwogICAgICAgICAgY29uc29sZS5sb2coJ0NoZWNrIHRha2VyIHR4Li4uJyk7IC8vIHRvZG86IHR4IGNoZWNrCiAgICAgICAgICAvLy4uLiB8fCB0aGlzLnN0b3BTd2FwUHJvY2VzcygpCgogICAgICAgICAgY29uc29sZS5sb2coJ1Rha2VyIHR4IGlzIE9LIScpOwogICAgICAgICAgZmxvdy5maW5pc2hTdGVwKHsKICAgICAgICAgICAgdGFrZXJUeEhhc2g6IHR4SGFzaCwKICAgICAgICAgICAgaXNUYWtlclR4UGVuZGVkOiB0cnVlIC8vIHRvZG8gbGF0ZXIKCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHN0ZXA6ICd3YWl0LXRha2VyLXR4JwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0sIC8qI19fUFVSRV9fKi9fYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICB2YXIgYW1vdW50LCB0bywgdXNlZFN3YXAsIHR4SGFzaDsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJNYWtlciBTdGVwIDQ6ICdzZW5kLW1ha2VyLXR4JyIpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RoaXMuc3dhcCA9Jywgc3dhcCk7IC8vIHNlbmQgdHgKCiAgICAgICAgICAgICAgICBhbW91bnQgPSBzd2FwLnNlbGxBbW91bnQ7CiAgICAgICAgICAgICAgICB0byA9IHN3YXAucGFydGljaXBhbnRbc3dhcC5zZWxsQ3VycmVuY3kudG9Mb3dlckNhc2UoKV0uYWRkcmVzczsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJTZW5kICIuY29uY2F0KGFtb3VudCwgIiAiKS5jb25jYXQoc3dhcC5zZWxsQ3VycmVuY3ksICIgdG8gdGFrZXIgYWRkcmVzcyBcIiIpLmNvbmNhdCh0bywgIlwiLi4uIikpOwoKICAgICAgICAgICAgICAgIGlmIChteVN3YXAuX3N3YXBOYW1lID09PSBzd2FwLnNlbGxDdXJyZW5jeS50b1VwcGVyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICAgIHVzZWRTd2FwID0gbXlTd2FwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChwYXJ0aWNpcGFudFN3YXAuX3N3YXBOYW1lID09PSBzd2FwLnNlbGxDdXJyZW5jeS50b1VwcGVyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICAgIHVzZWRTd2FwID0gcGFydGljaXBhbnRTd2FwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh1c2VkU3dhcCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHN3YXAgZm9yICIuY29uY2F0KHN3YXAuc2VsbEN1cnJlbmN5KSk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3dhcCBmb3VuZCEnLCB1c2VkU3dhcCk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgcmV0dXJuIHVzZWRTd2FwLnNlbmRUcmFuc2FjdGlvbih7CiAgICAgICAgICAgICAgICAgIHRvOiB0bywKICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgdHhIYXNoID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiU2VuZGVkISB0eEhhc2ggPSAiLmNvbmNhdCh0eEhhc2gpKTsKICAgICAgICAgICAgICAgIHJvb20uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBldmVudDogJ21ha2VyIHR4IHNlbmRlZCcsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICB0eEhhc2g6IHR4SGFzaAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGZsb3cuZmluaXNoU3RlcCh7CiAgICAgICAgICAgICAgICAgIG1ha2VyVHhIYXNoOiB0eEhhc2gsCiAgICAgICAgICAgICAgICAgIGlzTWFrZXJUeFBlbmRlZDogdHJ1ZSAvLyB0b2RvIGxhdGVyCgogICAgICAgICAgICAgICAgfSwgJ3NlbmQtbWFrZXItdHgnKTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgIH0pKSwgZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCJNYWtlciBTdGVwIDU6ICdmaW5pc2gnIik7CiAgICAgICAgLypyb29tLm9uY2UoJ3N3YXAgZmluaXNoZWQnLCAoe2J0Y1N3YXBXaXRoZHJhd1RyYW5zYWN0aW9uSGFzaH0pID0+IHsNCiAgICAgICAgICBmbG93LnNldFN0YXRlKHsNCiAgICAgICAgICAgIGJ0Y1N3YXBXaXRoZHJhd1RyYW5zYWN0aW9uSGFzaCwNCiAgICAgICAgICB9KQ0KICAgICAgICB9KQ0KICAgICAgICAgIHJvb20uc2VuZE1lc3NhZ2Uoew0KICAgICAgICAgIGV2ZW50OiAncmVxdWVzdCBzd2FwIGZpbmlzaGVkJywNCiAgICAgICAgfSkNCiAgICAgICAgKi8KCiAgICAgICAgZmxvdy5maW5pc2hTdGVwKHsKICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUKICAgICAgICB9LCAnZmluaXNoJyk7CiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICBjb25zb2xlLmxvZygiTWFrZXIgU3RlcCA2OiAnZW5kJyIpOyAvLyBGaW5pc2hlZCEKICAgICAgfV07CiAgICB9CiAgfSwgewogICAga2V5OiAic3RvcFN3YXBQcm9jZXNzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzdG9wU3dhcFByb2Nlc3MoKSB7CiAgICAgIHZhciBmbG93ID0gdGhpczsKICAgICAgZGVidWcoJ3N3YXAuY29yZTpmbG93JykoJ1N3YXAgd2FzIHN0b3BwZWQnKTsKICAgICAgZmxvdy5zZXRTdGF0ZSh7CiAgICAgICAgaXNTdG9wcGVkU3dhcDogdHJ1ZQogICAgICB9LCB0cnVlKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBUdXJib01ha2VyOwp9KEZsb3cpOwoKX2RlZmluZVByb3BlcnR5KFR1cmJvTWFrZXIsICJnZXROYW1lIiwgZnVuY3Rpb24gKCkgewogIHJldHVybiAnVHVyYm9NYWtlcic7Cn0pOwoKZXhwb3J0IHsgVHVyYm9NYWtlciBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/core/swap.flows/turbo/Maker.ts"],"names":["debug","Flow","TurboMaker","swap","console","log","stepNumbers","mySwap","ownerSwap","participantSwap","state","step","isParticipantSigned","isBalanceFetching","isBalanceEnough","takerTxHash","isTakerTxPended","makerTxHash","isMakerTxPended","isStoppedSwap","isFinished","flow","room","sendMessage","event","once","finishStep","txHash","amount","sellAmount","to","participant","sellCurrency","toLowerCase","address","_swapName","toUpperCase","usedSwap","Error","sendTransaction","data","setState"],"mappings":"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","sourcesContent":["import debug from 'debug'\r\nimport SwapApp, { constants, util } from 'swap.app'\r\nimport { Flow } from 'swap.swap'\r\nimport { BigNumber } from 'bignumber.js'\r\n\r\n\r\nexport default class TurboMaker extends Flow {\r\n\r\n  _flowName = 'TurboMaker'\r\n  static getName = () => 'TurboMaker'\r\n\r\n  mySwap: any\r\n  participantSwap: any\r\n\r\n  state: {\r\n    step: 0 | 1 | 2 | 3 | 4 | 5 | 6,\r\n\r\n    isParticipantSigned: boolean,\r\n\r\n    isBalanceFetching: boolean,\r\n    isBalanceEnough: boolean,\r\n\r\n    takerTxHash: null | string\r\n    isTakerTxPended: boolean\r\n\r\n    makerTxHash: null | string\r\n    isMakerTxPended: boolean\r\n\r\n    isStoppedSwap: boolean,\r\n    isFinished: boolean,\r\n  }\r\n\r\n  constructor(swap) {\r\n    super(swap)\r\n    console.log('Create Maker flow(swap), swap =', swap)\r\n\r\n    this.stepNumbers = {\r\n      'sign': 1,\r\n      'check-balance': 2,\r\n      'wait-taker-tx': 3,\r\n      'send-maker-tx': 4,\r\n      'finish': 5,\r\n      'end': 6,\r\n    }\r\n\r\n    this.mySwap = swap.ownerSwap\r\n    this.participantSwap = swap.participantSwap\r\n\r\n    this.state = {\r\n      step: 0,\r\n\r\n      isParticipantSigned: false,\r\n\r\n      isBalanceFetching: false,\r\n      isBalanceEnough: true,\r\n\r\n      takerTxHash: null,\r\n      isTakerTxPended: false,\r\n\r\n      makerTxHash: null,\r\n      isMakerTxPended: false,\r\n\r\n      isStoppedSwap: false,\r\n      isFinished: false,\r\n    }\r\n\r\n    super._persistState()\r\n    super._persistSteps()\r\n  }\r\n\r\n  _getSteps() {\r\n    const flow = this\r\n    const swap = this.swap\r\n    const room = this.swap.room\r\n\r\n    const mySwap = this.mySwap\r\n    const participantSwap = this.participantSwap\r\n\r\n    return [\r\n\r\n      async () => {\r\n        console.log(`Maker Step 1: 'sign'`)\r\n        console.log('this.swap =', swap)\r\n\r\n        //flow.swap.processMetamask()\r\n\r\n        room.sendMessage({\r\n          event: 'request sign',\r\n        })\r\n\r\n        room.once('swap sign', () => {\r\n          const { step } = flow.state\r\n\r\n          if (step >= 2) {\r\n            return\r\n          }\r\n\r\n          flow.finishStep({\r\n            isParticipantSigned: true,\r\n          }, { step: 'sign' })\r\n        })\r\n      },\r\n\r\n\r\n      async () => {\r\n        console.log(`Maker Step 2: 'check-balance'`)\r\n        console.log('this.swap =', swap)\r\n\r\n        /*const { sellAmount } = this.swap\r\n\r\n        this.setState({\r\n          isBalanceFetching: true,\r\n        })\r\n\r\n        const btcAddress = this.app.services.auth.accounts.btc.getAddress()\r\n\r\n        const txFee = await this.btcSwap.estimateFeeValue({\r\n          method: 'swap',\r\n          fixed: true,\r\n          address: btcAddress\r\n        })\r\n\r\n        const unspents = await this.btcSwap.fetchUnspents(btcAddress)\r\n        const totalUnspent = unspents.reduce((summ, { satoshis }) => summ + satoshis, 0)\r\n        const balance = new BigNumber(totalUnspent).dividedBy(1e8)\r\n\r\n        const needAmount = sellAmount.plus(txFee)\r\n        const isEnoughMoney = needAmount.isLessThanOrEqualTo(balance)\r\n\r\n        const stateData = {\r\n          isBalanceFetching: false,\r\n          isBalanceEnough: isEnoughMoney,\r\n        }\r\n\r\n        if (isEnoughMoney) {\r\n          this.finishStep(stateData, { step: 'check-balance' })\r\n        } else {\r\n          this.setState(stateData, true)\r\n        }*/\r\n\r\n        //return true\r\n\r\n        //temp\r\n        this.finishStep({\r\n          isBalanceEnough: true,\r\n        }, { step: 'check-balance' })\r\n      },\r\n\r\n\r\n      () => {\r\n        console.log(`Maker Step 3: 'wait-taker-tx'`)\r\n        console.log('this.swap =', swap)\r\n\r\n        room.once('taker tx sended', ({ txHash }) => {\r\n          console.log(`RECEIVED from taker: tx hash =`, txHash)\r\n          console.log('Check taker tx...')\r\n          // todo: tx check\r\n          //... || this.stopSwapProcess()\r\n          console.log('Taker tx is OK!')\r\n\r\n          flow.finishStep({\r\n            takerTxHash: txHash,\r\n            isTakerTxPended: true, // todo later\r\n          }, { step: 'wait-taker-tx' })\r\n        })\r\n      },\r\n\r\n\r\n      async () => {\r\n        console.log(`Maker Step 4: 'send-maker-tx'`)\r\n        console.log('this.swap =', swap)\r\n\r\n        // send tx\r\n        \r\n        const amount = swap.sellAmount\r\n        const to = swap.participant[swap.sellCurrency.toLowerCase()].address\r\n\r\n        console.log(`Send ${amount} ${swap.sellCurrency} to taker address \"${to}\"...`)\r\n\r\n        let usedSwap\r\n        if (mySwap._swapName === swap.sellCurrency.toUpperCase()) {\r\n          usedSwap = mySwap\r\n        }\r\n        if (participantSwap._swapName === swap.sellCurrency.toUpperCase()) {\r\n          usedSwap = participantSwap\r\n        }\r\n        if (!usedSwap) {\r\n          throw new Error(`No swap for ${swap.sellCurrency}`)\r\n        } else {\r\n          console.log('Swap found!', usedSwap)\r\n        }\r\n\r\n        const txHash = await usedSwap.sendTransaction({ to, amount })\r\n\r\n        console.log(`Sended! txHash = ${txHash}`)\r\n\r\n        room.sendMessage({\r\n          event: 'maker tx sended',\r\n          data: {\r\n            txHash,\r\n          }\r\n        })\r\n\r\n        flow.finishStep({\r\n          makerTxHash: txHash,\r\n          isMakerTxPended: true, // todo later\r\n        }, 'send-maker-tx')\r\n      },\r\n\r\n\r\n      () => {\r\n        console.log(`Maker Step 5: 'finish'`)\r\n        /*room.once('swap finished', ({btcSwapWithdrawTransactionHash}) => {\r\n          flow.setState({\r\n            btcSwapWithdrawTransactionHash,\r\n          })\r\n        })\r\n\r\n        room.sendMessage({\r\n          event: 'request swap finished',\r\n        })\r\n        */\r\n        flow.finishStep({\r\n          isFinished: true,\r\n        }, 'finish')\r\n      },\r\n\r\n\r\n      () => {\r\n        console.log(`Maker Step 6: 'end'`)\r\n        // Finished!\r\n      }\r\n    ]\r\n  }\r\n\r\n  stopSwapProcess() {\r\n    const flow = this\r\n\r\n    debug('swap.core:flow')('Swap was stopped')\r\n\r\n    flow.setState({\r\n      isStoppedSwap: true,\r\n    }, true)\r\n  }\r\n\r\n}\r\n"]}]}