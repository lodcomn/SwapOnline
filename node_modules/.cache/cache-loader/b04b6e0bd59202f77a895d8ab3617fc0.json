{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\helpers\\btc.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\helpers\\btc.ts","mtime":1614850541745},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIkBiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yIjsKLy8gQHRzLW5vY2hlY2sKaW1wb3J0ICogYXMgYml0Y29pbiBmcm9tICdiaXRjb2luanMtbGliJzsKaW1wb3J0IHsgZ2V0U3RhdGUgfSBmcm9tICdyZWR1eC9jb3JlJzsKaW1wb3J0IGFjdGlvbnMgZnJvbSAncmVkdXgvYWN0aW9ucyc7CmltcG9ydCBjb25maWcgZnJvbSAnLi9leHRlcm5hbENvbmZpZyc7CmltcG9ydCBjb25zdGFudHMgZnJvbSAnLi9jb25zdGFudHMnOwppbXBvcnQgYXBpIGZyb20gJy4vYXBpJzsKaW1wb3J0IEJpZ051bWJlciBmcm9tICdiaWdudW1iZXIuanMnOwp2YXIgaGFzQWRtaW5GZWUgPSBjb25maWcgJiYgY29uZmlnLm9wdHMgJiYgY29uZmlnLm9wdHMuZmVlICYmIGNvbmZpZy5vcHRzLmZlZS5idGMgJiYgY29uZmlnLm9wdHMuZmVlLmJ0Yy5mZWUgPyBjb25maWcub3B0cy5mZWUuYnRjIDogZmFsc2U7CnZhciBuZXR3b3JrID0gcHJvY2Vzcy5lbnYuTUFJTk5FVCA/IGJpdGNvaW4ubmV0d29ya3MuYml0Y29pbiA6IGJpdGNvaW4ubmV0d29ya3MudGVzdG5ldDsKLyogDQoqIEJpdGNvaW4gZHVzdCAtIHNtYWxsIGFtb3VudCBvZiBiaXRjb2luIHRoYXQgcmVtYWlucyBpbiBhIHBhcnRpY3VsYXIgd2FsbGV0IA0KKiBiZWNhdXNlIHRoZSBtb25ldGFyeSB2YWx1ZSBpcyBzbyB0aW55IHRoYXQgaXQgaXMgYmVsb3cgdGhlIGFtb3VudCBvZiB0aGUNCiogZmVlIHJlcXVpcmVkIHRvIHNwZW5kIHRoZSBiaXRjb2luLiBJdCBtYWtlcyB0aGUgdHJhbnNhY3Rpb24gaW1wb3NzaWJsZSANCiogdG8gcHJvY2Vzcw0KKg0KKiBEZWZhdWx0IHZhbHVlOg0KKiAtIGR1c3RSZWxheUZlZSAoMzAwMCBzYXRvY2hpIC8ga2IpDQoqIC0gb3V0cHV0IFAyUEtIDQoqLwoKdmFyIERVU1QgPSA1NDY7IC8vIHNhdG9zaGkKCnZhciBCWVRFX0lOUFVUX0FERFJFU1MgPSAxNDY7IC8vIH4gMTQ2IGJ5dGUKCnZhciBCWVRFX09VVFBVVF9BRERSRVNTID0gMzM7IC8vIH4gMzMgYnl0ZQoKdmFyIEJZVEVfVFJBTlNBQ1RJT04gPSAxNTsgLy8gfiAxNSBieXRlCi8vIGdldEJ5dGVDb3VudCh7J01VTFRJU0lHLVAyU0g6Mi00Jzo0NX0seydQMlBLSCc6MX0pIE1lYW5zICI0NSBpbnB1dHMgb2YgUDJTSCBNdWx0aXNpZyBhbmQgMSBvdXRwdXQgb2YgUDJQS0giCi8vIGdldEJ5dGVDb3VudCh7J1AyUEtIJzoxLCdNVUxUSVNJRy1QMlNIOjItMyc6Mn0seydQMlBLSCc6Mn0pIG1lYW5zICIxIFAyUEtIIGlucHV0IGFuZCAyIE11bHRpc2lnIFAyU0ggKDIgb2YgMykgaW5wdXRzIGFsb25nIHdpdGggMiBQMlBLSCBvdXRwdXRzIgoKdmFyIGdldEJ5dGVDb3VudCA9IGZ1bmN0aW9uIGdldEJ5dGVDb3VudChpbnB1dHMsIG91dHB1dHMpIHsKICB2YXIgdG90YWxXZWlnaHQgPSAwOwogIHZhciBoYXNXaXRuZXNzID0gZmFsc2U7CiAgdmFyIGlucHV0Q291bnQgPSAwOwogIHZhciBvdXRwdXRDb3VudCA9IDA7IC8vIGFzc3VtZXMgY29tcHJlc3NlZCBwdWJrZXlzIGluIGFsbCBjYXNlcy4KCiAgdmFyIHR5cGVzID0gewogICAgJ2lucHV0cyc6IHsKICAgICAgJ01VTFRJU0lHLVAyU0gnOiA0OSAqIDQsCiAgICAgICdNVUxUSVNJRy1QMldTSCc6IDYgKyA0MSAqIDQsCiAgICAgICdNVUxUSVNJRy1QMlNILVAyV1NIJzogNiArIDc2ICogNCwKICAgICAgJ1AyUEtIJzogMTQ4ICogNCwKICAgICAgJ1AyV1BLSCc6IDEwOCArIDQxICogNCwKICAgICAgJ1AyU0gtUDJXUEtIJzogMTA4ICsgNjQgKiA0CiAgICB9LAogICAgJ291dHB1dHMnOiB7CiAgICAgICdQMlNIJzogMzIgKiA0LAogICAgICAnUDJQS0gnOiAzNCAqIDQsCiAgICAgICdQMldQS0gnOiAzMSAqIDQsCiAgICAgICdQMldTSCc6IDQzICogNAogICAgfQogIH07CgogIHZhciBjaGVja1VJbnQ1MyA9IGZ1bmN0aW9uIGNoZWNrVUludDUzKG4pIHsKICAgIGlmIChuIDwgMCB8fCBuID4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgfHwgbiAlIDEgIT09IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCd2YWx1ZSBvdXQgb2YgcmFuZ2UnKTsKICB9OwoKICB2YXIgdmFySW50TGVuZ3RoID0gZnVuY3Rpb24gdmFySW50TGVuZ3RoKG51bWJlcikgewogICAgY2hlY2tVSW50NTMobnVtYmVyKTsKICAgIHJldHVybiBudW1iZXIgPCAweGZkID8gMSA6IG51bWJlciA8PSAweGZmZmYgPyAzIDogbnVtYmVyIDw9IDB4ZmZmZmZmZmYgPyA1IDogOTsKICB9OwoKICBPYmplY3Qua2V5cyhpbnB1dHMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgY2hlY2tVSW50NTMoaW5wdXRzW2tleV0pOwoKICAgIGlmIChrZXkuc2xpY2UoMCwgOCkgPT09ICdNVUxUSVNJRycpIHsKICAgICAgLy8gZXguICJNVUxUSVNJRy1QMlNIOjItMyIgd291bGQgbWVhbiAyIG9mIDMgUDJTSCBNVUxUSVNJRwogICAgICB2YXIga2V5UGFydHMgPSBrZXkuc3BsaXQoJzonKTsKICAgICAgaWYgKGtleVBhcnRzLmxlbmd0aCAhPT0gMikgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGlucHV0OiAiLmNvbmNhdChrZXkpKTsKICAgICAgdmFyIG5ld0tleSA9IGtleVBhcnRzWzBdOwogICAgICB2YXIgbUFuZE4gPSBrZXlQYXJ0c1sxXS5zcGxpdCgnLScpLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBwYXJzZUludChpdGVtKTsKICAgICAgfSk7CiAgICAgIHRvdGFsV2VpZ2h0ICs9IHR5cGVzLmlucHV0c1tuZXdLZXldICogaW5wdXRzW2tleV07CiAgICAgIHZhciBtdWx0aXBseWVyID0gbmV3S2V5ID09PSAnTVVMVElTSUctUDJTSCcgPyA0IDogMTsKICAgICAgdG90YWxXZWlnaHQgKz0gKDczICogbUFuZE5bMF0gKyAzNCAqIG1BbmROWzFdKSAqIG11bHRpcGx5ZXIgKiBpbnB1dHNba2V5XTsKICAgIH0gZWxzZSB7CiAgICAgIHRvdGFsV2VpZ2h0ICs9IHR5cGVzLmlucHV0c1trZXldICogaW5wdXRzW2tleV07CiAgICB9CgogICAgaW5wdXRDb3VudCArPSBpbnB1dHNba2V5XTsKICAgIGlmIChrZXkuaW5kZXhPZignVycpID49IDApIGhhc1dpdG5lc3MgPSB0cnVlOwogIH0pOwogIE9iamVjdC5rZXlzKG91dHB1dHMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgY2hlY2tVSW50NTMob3V0cHV0c1trZXldKTsKICAgIHRvdGFsV2VpZ2h0ICs9IHR5cGVzLm91dHB1dHNba2V5XSAqIG91dHB1dHNba2V5XTsKICAgIG91dHB1dENvdW50ICs9IG91dHB1dHNba2V5XTsKICB9KTsKICBpZiAoaGFzV2l0bmVzcykgdG90YWxXZWlnaHQgKz0gMjsKICB0b3RhbFdlaWdodCArPSA4ICogNDsKICB0b3RhbFdlaWdodCArPSB2YXJJbnRMZW5ndGgoaW5wdXRDb3VudCkgKiA0OwogIHRvdGFsV2VpZ2h0ICs9IHZhckludExlbmd0aChvdXRwdXRDb3VudCkgKiA0OwogIHJldHVybiBNYXRoLmNlaWwodG90YWxXZWlnaHQgLyA0KTsKfTsKCnZhciBjYWxjdWxhdGVUeFNpemUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShvcHRpb25zKSB7CiAgICB2YXIgYW1vdW50LCB1bnNwZW50cywgYWRkcmVzcywgdHhPdXQsIG1ldGhvZCwgZml4ZWQsIGRlZmF1bHRUeFNpemUsIHR4SW4sIHR4U2l6ZSwgbXN1U2l6ZSwgbXN1dHhTaXplLCBtc1NpemU7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBhbW91bnQgPSBvcHRpb25zLmFtb3VudCwgdW5zcGVudHMgPSBvcHRpb25zLnVuc3BlbnRzLCBhZGRyZXNzID0gb3B0aW9ucy5hZGRyZXNzLCB0eE91dCA9IG9wdGlvbnMudHhPdXQsIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kLCBmaXhlZCA9IG9wdGlvbnMuZml4ZWQ7CiAgICAgICAgICAgIHR4T3V0ID0gdHhPdXQgfHwgMjsKICAgICAgICAgICAgbWV0aG9kID0gbWV0aG9kIHx8ICdzZW5kJzsKICAgICAgICAgICAgZGVmYXVsdFR4U2l6ZSA9IGNvbnN0YW50cy5kZWZhdWx0RmVlUmF0ZXMuYnRjLnNpemVbbWV0aG9kXTsKCiAgICAgICAgICAgIGlmICghZml4ZWQpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgZGVmYXVsdFR4U2l6ZSk7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBfY29udGV4dC50MCA9IHVuc3BlbnRzOwoKICAgICAgICAgICAgaWYgKF9jb250ZXh0LnQwKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTA7CiAgICAgICAgICAgIHJldHVybiBhY3Rpb25zLmJ0Yy5mZXRjaFVuc3BlbnRzKGFkZHJlc3MpOwoKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHQuc2VudDsKCiAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICB1bnNwZW50cyA9IF9jb250ZXh0LnQwOwoKICAgICAgICAgICAgaWYgKCFhbW91bnQpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNTsKICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnMuYnRjLnByZXBhcmVVbnNwZW50cyh7CiAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnQsCiAgICAgICAgICAgICAgdW5zcGVudHM6IHVuc3BlbnRzCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgIHVuc3BlbnRzID0gX2NvbnRleHQuc2VudDsKCiAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAvKg0KICAgICAgICAgICAgKiBGb3JtdWxhIHdpdGggMiBpbnB1dCBhbmQgMiBvdXRwdXQgYWRkcmVzc2VzIA0KICAgICAgICAgICAgKiAoQllURV9JTlBVVF9BRERSRVNTIMOXIDIgKSArIChCWVRFX09VVFBVVF9BRERSRVNTIMOXIDIpICsgQllURV9UUkFOU0FDVElPTg0KICAgICAgICAgICAgKi8KICAgICAgICAgICAgdHhJbiA9IHVuc3BlbnRzLmxlbmd0aDsKICAgICAgICAgICAgdHhTaXplID0gdHhJbiA+IDAgPyB0eEluICogQllURV9JTlBVVF9BRERSRVNTICsgdHhPdXQgKiBCWVRFX09VVFBVVF9BRERSRVNTICsgKEJZVEVfVFJBTlNBQ1RJT04gKyB0eEluIC0gdHhPdXQpIDogZGVmYXVsdFR4U2l6ZTsKCiAgICAgICAgICAgIGlmICghKG1ldGhvZCA9PT0gJ3NlbmRfbXVsdGlzaWcnKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXN1U2l6ZSA9IGdldEJ5dGVDb3VudCh7CiAgICAgICAgICAgICAgJ01VTFRJU0lHLVAyU0gtUDJXU0g6Mi0yJzogMQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgJ1AyUEtIJzogaGFzQWRtaW5GZWUgPyAzIDogMgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbXN1dHhTaXplID0gdHhJbiAqIG1zdVNpemUgKyB0eE91dCAqIEJZVEVfT1VUUFVUX0FERFJFU1MgKyAoQllURV9UUkFOU0FDVElPTiArIHR4SW4gLSB0eE91dCk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG1zdXR4U2l6ZSk7CgogICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgaWYgKCEobWV0aG9kID09PSAnc2VuZF8yZmEnKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXNTaXplID0gZ2V0Qnl0ZUNvdW50KHsKICAgICAgICAgICAgICAnTVVMVElTSUctUDJTSC1QMldTSDoyLTMnOiB0eEluCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAnUDJQS0gnOiBoYXNBZG1pbkZlZSA/IDMgOiAyCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zb2xlLmxvZygnVHggc2l6ZScsIG1zU2l6ZSk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG1zU2l6ZSk7CgogICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgdHhTaXplKTsKCiAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGNhbGN1bGF0ZVR4U2l6ZShfeCkgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Cgp2YXIgZXN0aW1hdGVGZWVWYWx1ZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIob3B0aW9ucykgewogICAgdmFyIG1vcmVJbmZvLCBmZWVSYXRlLCBpblNhdG9zaGlzLCBzcGVlZCwgYWRkcmVzcywgdHhTaXplLCBmaXhlZCwgbWV0aG9kLCBhbW91bnQsIF9nZXRTdGF0ZSwgX2dldFN0YXRlJHVzZXIsIGJ0Y0RhdGEsIGJ0Y011bHRpc2lnU01TRGF0YSwgYnRjTXVsdGlzaWdVc2VyRGF0YSwgdHhPdXQsIHVuc3BlbnRzLCBjYWxjdWxhdGVkRmVlVmFsdWUsIENVU1RPTV9TQVRPU0hJLCBTQVRPU0hJX1RPX0JJVENPSU5fUkFUSU8sIGZpbmFsRmVlVmFsdWU7CgogICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIG1vcmVJbmZvID0gb3B0aW9ucy5tb3JlSW5mbzsKICAgICAgICAgICAgZmVlUmF0ZSA9IG9wdGlvbnMuZmVlUmF0ZSwgaW5TYXRvc2hpcyA9IG9wdGlvbnMuaW5TYXRvc2hpcywgc3BlZWQgPSBvcHRpb25zLnNwZWVkLCBhZGRyZXNzID0gb3B0aW9ucy5hZGRyZXNzLCB0eFNpemUgPSBvcHRpb25zLnR4U2l6ZSwgZml4ZWQgPSBvcHRpb25zLmZpeGVkLCBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCwgYW1vdW50ID0gb3B0aW9ucy5hbW91bnQ7CiAgICAgICAgICAgIF9nZXRTdGF0ZSA9IGdldFN0YXRlKCksIF9nZXRTdGF0ZSR1c2VyID0gX2dldFN0YXRlLnVzZXIsIGJ0Y0RhdGEgPSBfZ2V0U3RhdGUkdXNlci5idGNEYXRhLCBidGNNdWx0aXNpZ1NNU0RhdGEgPSBfZ2V0U3RhdGUkdXNlci5idGNNdWx0aXNpZ1NNU0RhdGEsIGJ0Y011bHRpc2lnVXNlckRhdGEgPSBfZ2V0U3RhdGUkdXNlci5idGNNdWx0aXNpZ1VzZXJEYXRhOwogICAgICAgICAgICB0eE91dCA9IDI7CiAgICAgICAgICAgIGlmIChoYXNBZG1pbkZlZSkgdHhPdXQgPSAzOwoKICAgICAgICAgICAgaWYgKCFhZGRyZXNzKSB7CiAgICAgICAgICAgICAgYWRkcmVzcyA9IGJ0Y0RhdGEuYWRkcmVzczsKICAgICAgICAgICAgICBpZiAobWV0aG9kID09PSAnc2VuZF8yZmEnKSBhZGRyZXNzID0gYnRjTXVsdGlzaWdTTVNEYXRhLmFkZHJlc3M7CiAgICAgICAgICAgICAgaWYgKG1ldGhvZCA9PT0gJ3NlbmRfbXVsdGlzaWcnKSBhZGRyZXNzID0gYnRjTXVsdGlzaWdVc2VyRGF0YS5hZGRyZXNzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDg7CiAgICAgICAgICAgIHJldHVybiBhY3Rpb25zLmJ0Yy5mZXRjaFVuc3BlbnRzKGFkZHJlc3MpOwoKICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgdW5zcGVudHMgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICAgIGlmICghYW1vdW50KSB7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMjsKICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnMuYnRjLnByZXBhcmVVbnNwZW50cyh7CiAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnQsCiAgICAgICAgICAgICAgdW5zcGVudHM6IHVuc3BlbnRzCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIHVuc3BlbnRzID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gdHhTaXplOwoKICAgICAgICAgICAgaWYgKF9jb250ZXh0Mi50MCkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTc7CiAgICAgICAgICAgIHJldHVybiBjYWxjdWxhdGVUeFNpemUoewogICAgICAgICAgICAgIGFkZHJlc3M6IGFkZHJlc3MsCiAgICAgICAgICAgICAgc3BlZWQ6IHNwZWVkLAogICAgICAgICAgICAgIGZpeGVkOiBmaXhlZCwKICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICAgICAgICB0eE91dDogdHhPdXQsCiAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnQKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgdHhTaXplID0gX2NvbnRleHQyLnQwOwogICAgICAgICAgICBfY29udGV4dDIudDEgPSBmZWVSYXRlOwoKICAgICAgICAgICAgaWYgKF9jb250ZXh0Mi50MSkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjM7CiAgICAgICAgICAgIHJldHVybiBlc3RpbWF0ZUZlZVJhdGUoewogICAgICAgICAgICAgIHNwZWVkOiBzcGVlZAogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICBfY29udGV4dDIudDEgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICBmZWVSYXRlID0gX2NvbnRleHQyLnQxOwogICAgICAgICAgICBjYWxjdWxhdGVkRmVlVmFsdWUgPSBCaWdOdW1iZXIubWF4aW11bShEVVNULCBuZXcgQmlnTnVtYmVyKGZlZVJhdGUpLm11bHRpcGxpZWRCeSh0eFNpemUpLmRpdigxMDI0KSAvLyBkaXZpZGUgYnkgb25lIGtpbG9ieXRlCiAgICAgICAgICAgIC5kcCgwLCBCaWdOdW1iZXIuUk9VTkRfSEFMRl9FVkVOKSk7CiAgICAgICAgICAgIENVU1RPTV9TQVRPU0hJID0gMjA7CiAgICAgICAgICAgIGNhbGN1bGF0ZWRGZWVWYWx1ZS5wbHVzKENVU1RPTV9TQVRPU0hJKTsgLy8ganVzdCB3YW50ZWQgdG8gYWRkCgogICAgICAgICAgICBTQVRPU0hJX1RPX0JJVENPSU5fUkFUSU8gPSAxZS04OyAvLyAxIEJUQyAtPiAxMDAgMDAwIDAwMCBzYXRvc2hpCgogICAgICAgICAgICBmaW5hbEZlZVZhbHVlID0gaW5TYXRvc2hpcyA/IGNhbGN1bGF0ZWRGZWVWYWx1ZS50b051bWJlcigpIDogY2FsY3VsYXRlZEZlZVZhbHVlLm11bHRpcGxpZWRCeShTQVRPU0hJX1RPX0JJVENPSU5fUkFUSU8pLnRvTnVtYmVyKCk7CgogICAgICAgICAgICBpZiAoIW1vcmVJbmZvKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzMjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICBmZWU6IGNhbGN1bGF0ZWRGZWVWYWx1ZS5tdWx0aXBsaWVkQnkoU0FUT1NISV9UT19CSVRDT0lOX1JBVElPKS50b051bWJlcigpLAogICAgICAgICAgICAgIHNhdG9zaGlzOiBjYWxjdWxhdGVkRmVlVmFsdWUudG9OdW1iZXIoKSwKICAgICAgICAgICAgICB0eFNpemU6IHR4U2l6ZSwKICAgICAgICAgICAgICBmZWVSYXRlOiBmZWVSYXRlLAogICAgICAgICAgICAgIHVuc3BlbnRzOiB1bnNwZW50cwogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgZmluYWxGZWVWYWx1ZSk7CgogICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTIpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGVzdGltYXRlRmVlVmFsdWUoX3gyKSB7CiAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Cgp2YXIgZXN0aW1hdGVGZWVSYXRlQml0Y29pbmZlZXMgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgdmFyIF9yZWY0LAogICAgICAgIF9yZWY0JHNwZWVkLAogICAgICAgIHNwZWVkLAogICAgICAgIGRlZmF1bHRSYXRlLAogICAgICAgIGFwaVJlc3VsdCwKICAgICAgICBhcGlTcGVlZHMsCiAgICAgICAgYXBpU3BlZWQsCiAgICAgICAgYXBpUmF0ZSwKICAgICAgICBfYXJnczMgPSBhcmd1bWVudHM7CgogICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9yZWY0ID0gX2FyZ3MzLmxlbmd0aCA+IDAgJiYgX2FyZ3MzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczNbMF0gOiB7fSwgX3JlZjQkc3BlZWQgPSBfcmVmNC5zcGVlZCwgc3BlZWQgPSBfcmVmNCRzcGVlZCA9PT0gdm9pZCAwID8gJ2Zhc3QnIDogX3JlZjQkc3BlZWQ7CiAgICAgICAgICAgIGRlZmF1bHRSYXRlID0gY29uc3RhbnRzLmRlZmF1bHRGZWVSYXRlcy5idGMucmF0ZTsKICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSAyOwogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDU7CiAgICAgICAgICAgIHJldHVybiBhcGkuYXN5bmNGZXRjaEFwaSgiaHR0cHM6Ly9iaXRjb2luZmVlcy5lYXJuLmNvbS9hcGkvdjEvZmVlcy9yZWNvbW1lbmRlZCIpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgYXBpUmVzdWx0ID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTI7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSA4OwogICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbImNhdGNoIl0oMik7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVzdGltYXRlRmVlUmF0ZTogIi5jb25jYXQoX2NvbnRleHQzLnQwLm1lc3NhZ2UpKTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIGRlZmF1bHRSYXRlW3NwZWVkXSk7CgogICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgYXBpU3BlZWRzID0gewogICAgICAgICAgICAgIHNsb3c6ICJob3VyRmVlIiwKICAgICAgICAgICAgICBub3JtYWw6ICJoYWxmSG91ckZlZSIsCiAgICAgICAgICAgICAgZmFzdDogImZhc3Rlc3RGZWUiCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGFwaVNwZWVkID0gYXBpU3BlZWRzW3NwZWVkXSB8fCBhcGlTcGVlZHMubm9ybWFsOwogICAgICAgICAgICBhcGlSYXRlID0gbmV3IEJpZ051bWJlcihhcGlSZXN1bHRbYXBpU3BlZWRdKS5tdWx0aXBsaWVkQnkoMTAyNCk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBhcGlSYXRlLmlzR3JlYXRlclRoYW5PckVxdWFsVG8oRFVTVCkgPyBhcGlSYXRlLnRvU3RyaW5nKCkgOiBkZWZhdWx0UmF0ZVtzcGVlZF0pOwoKICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUzLCBudWxsLCBbWzIsIDhdXSk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gZXN0aW1hdGVGZWVSYXRlQml0Y29pbmZlZXMoKSB7CiAgICByZXR1cm4gX3JlZjMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Cgp2YXIgZXN0aW1hdGVGZWVSYXRlQmxvY2tjeXBoZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmNSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgdmFyIF9yZWY2LAogICAgICAgIF9yZWY2JHNwZWVkLAogICAgICAgIHNwZWVkLAogICAgICAgIGxpbmssCiAgICAgICAgZGVmYXVsdFJhdGUsCiAgICAgICAgYXBpUmVzdWx0LAogICAgICAgIGFwaVNwZWVkcywKICAgICAgICBhcGlTcGVlZCwKICAgICAgICBhcGlSYXRlLAogICAgICAgIF9hcmdzNCA9IGFyZ3VtZW50czsKCiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX3JlZjYgPSBfYXJnczQubGVuZ3RoID4gMCAmJiBfYXJnczRbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNFswXSA6IHt9LCBfcmVmNiRzcGVlZCA9IF9yZWY2LnNwZWVkLCBzcGVlZCA9IF9yZWY2JHNwZWVkID09PSB2b2lkIDAgPyAnZmFzdCcgOiBfcmVmNiRzcGVlZDsKICAgICAgICAgICAgbGluayA9IGNvbmZpZy5mZWVSYXRlcy5idGM7CiAgICAgICAgICAgIGRlZmF1bHRSYXRlID0gY29uc3RhbnRzLmRlZmF1bHRGZWVSYXRlcy5idGMucmF0ZTsKCiAgICAgICAgICAgIGlmIChsaW5rKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA1OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgZGVmYXVsdFJhdGVbc3BlZWRdKTsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gNTsKICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA4OwogICAgICAgICAgICByZXR1cm4gYXBpLmFzeW5jRmV0Y2hBcGkobGluayk7CgogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBhcGlSZXN1bHQgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxNTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgX2NvbnRleHQ0LnByZXYgPSAxMTsKICAgICAgICAgICAgX2NvbnRleHQ0LnQwID0gX2NvbnRleHQ0WyJjYXRjaCJdKDUpOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFc3RpbWF0ZUZlZVJhdGU6ICIuY29uY2F0KF9jb250ZXh0NC50MC5tZXNzYWdlKSk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBkZWZhdWx0UmF0ZVtzcGVlZF0pOwoKICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgIGFwaVNwZWVkcyA9IHsKICAgICAgICAgICAgICBzbG93OiAnbG93X2ZlZV9wZXJfa2InLAogICAgICAgICAgICAgIG5vcm1hbDogJ21lZGl1bV9mZWVfcGVyX2tiJywKICAgICAgICAgICAgICBmYXN0OiAnaGlnaF9mZWVfcGVyX2tiJwogICAgICAgICAgICB9OwogICAgICAgICAgICBhcGlTcGVlZCA9IGFwaVNwZWVkc1tzcGVlZF0gfHwgYXBpU3BlZWRzLm5vcm1hbDsKICAgICAgICAgICAgYXBpUmF0ZSA9IG5ldyBCaWdOdW1iZXIoYXBpUmVzdWx0W2FwaVNwZWVkXSk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBhcGlSYXRlLmlzR3JlYXRlclRoYW5PckVxdWFsVG8oRFVTVCkgPyBhcGlSYXRlLnRvTnVtYmVyKCkgOiBkZWZhdWx0UmF0ZVtzcGVlZF0pOwoKICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWU0LCBudWxsLCBbWzUsIDExXV0pOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGVzdGltYXRlRmVlUmF0ZUJsb2NrY3lwaGVyKCkgewogICAgcmV0dXJuIF9yZWY1LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwoKdmFyIGVzdGltYXRlRmVlUmF0ZSA9IGVzdGltYXRlRmVlUmF0ZUJsb2NrY3lwaGVyOwpleHBvcnQgZGVmYXVsdCB7CiAgY2FsY3VsYXRlVHhTaXplOiBjYWxjdWxhdGVUeFNpemUsCiAgZXN0aW1hdGVGZWVWYWx1ZTogZXN0aW1hdGVGZWVWYWx1ZSwKICBlc3RpbWF0ZUZlZVJhdGU6IGVzdGltYXRlRmVlUmF0ZSwKICBuZXR3b3JrOiBuZXR3b3JrCn07"},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/front/shared/helpers/btc.ts"],"names":["bitcoin","getState","actions","config","constants","api","BigNumber","hasAdminFee","opts","fee","btc","network","process","env","MAINNET","networks","testnet","DUST","BYTE_INPUT_ADDRESS","BYTE_OUTPUT_ADDRESS","BYTE_TRANSACTION","getByteCount","inputs","outputs","totalWeight","hasWitness","inputCount","outputCount","types","checkUInt53","n","Number","MAX_SAFE_INTEGER","RangeError","varIntLength","number","Object","keys","forEach","key","slice","keyParts","split","length","Error","newKey","mAndN","map","item","parseInt","multiplyer","indexOf","Math","ceil","calculateTxSize","options","amount","unspents","address","txOut","method","fixed","defaultTxSize","defaultFeeRates","size","fetchUnspents","prepareUnspents","txIn","txSize","msuSize","msutxSize","msSize","console","log","estimateFeeValue","moreInfo","feeRate","inSatoshis","speed","user","btcData","btcMultisigSMSData","btcMultisigUserData","estimateFeeRate","calculatedFeeValue","maximum","multipliedBy","div","dp","ROUND_HALF_EVEN","CUSTOM_SATOSHI","plus","SATOSHI_TO_BITCOIN_RATIO","finalFeeValue","toNumber","satoshis","estimateFeeRateBitcoinfees","defaultRate","rate","asyncFetchApi","apiResult","error","message","apiSpeeds","slow","normal","fast","apiSpeed","apiRate","isGreaterThanOrEqualTo","toString","estimateFeeRateBlockcypher","link","feeRates"],"mappings":"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","sourcesContent":["// @ts-nocheck\r\nimport * as bitcoin from 'bitcoinjs-lib'\r\nimport { getState } from 'redux/core'\r\nimport actions from 'redux/actions'\r\nimport config from './externalConfig'\r\nimport constants from './constants'\r\nimport api from './api'\r\nimport BigNumber from 'bignumber.js'\r\nimport { IBtcUnspent } from 'common/utils/coin/btc'\r\n\r\n\r\nconst hasAdminFee = (\r\n  config\r\n    && config.opts\r\n    && config.opts.fee\r\n    && config.opts.fee.btc\r\n    && config.opts.fee.btc.fee\r\n) ? config.opts.fee.btc : false\r\n\r\nconst network = process.env.MAINNET\r\n  ? bitcoin.networks.bitcoin\r\n  : bitcoin.networks.testnet\r\n\r\n/* \r\n* Bitcoin dust - small amount of bitcoin that remains in a particular wallet \r\n* because the monetary value is so tiny that it is below the amount of the\r\n* fee required to spend the bitcoin. It makes the transaction impossible \r\n* to process\r\n*\r\n* Default value:\r\n* - dustRelayFee (3000 satochi / kb)\r\n* - output P2PKH\r\n*/\r\nconst DUST = 546 // satoshi\r\nconst BYTE_INPUT_ADDRESS = 146 // ~ 146 byte\r\nconst BYTE_OUTPUT_ADDRESS = 33 // ~ 33 byte\r\nconst BYTE_TRANSACTION = 15 // ~ 15 byte\r\n\r\n// getByteCount({'MULTISIG-P2SH:2-4':45},{'P2PKH':1}) Means \"45 inputs of P2SH Multisig and 1 output of P2PKH\"\r\n// getByteCount({'P2PKH':1,'MULTISIG-P2SH:2-3':2},{'P2PKH':2}) means \"1 P2PKH input and 2 Multisig P2SH (2 of 3) inputs along with 2 P2PKH outputs\"\r\nconst getByteCount = (inputs, outputs) => {\r\n  let totalWeight = 0\r\n  let hasWitness = false\r\n  let inputCount = 0\r\n  let outputCount = 0\r\n  // assumes compressed pubkeys in all cases.\r\n  const types = {\r\n    'inputs': {\r\n      'MULTISIG-P2SH': 49 * 4,\r\n      'MULTISIG-P2WSH': 6 + (41 * 4),\r\n      'MULTISIG-P2SH-P2WSH': 6 + (76 * 4),\r\n      'P2PKH': 148 * 4,\r\n      'P2WPKH': 108 + (41 * 4),\r\n      'P2SH-P2WPKH': 108 + (64 * 4),\r\n    },\r\n    'outputs': {\r\n      'P2SH': 32 * 4,\r\n      'P2PKH': 34 * 4,\r\n      'P2WPKH': 31 * 4,\r\n      'P2WSH': 43 * 4,\r\n    },\r\n  }\r\n\r\n  const checkUInt53 = (n) => {\r\n    if (n < 0 || n > Number.MAX_SAFE_INTEGER || n % 1 !== 0) throw new RangeError('value out of range')\r\n  }\r\n\r\n  const varIntLength = (number) => {\r\n    checkUInt53(number)\r\n\r\n    return (\r\n      number < 0xfd ? 1\r\n        : number <= 0xffff ? 3\r\n          : number <= 0xffffffff ? 5\r\n            : 9\r\n    )\r\n  }\r\n\r\n  Object.keys(inputs).forEach((key) => {\r\n    checkUInt53(inputs[key])\r\n    if (key.slice(0, 8) === 'MULTISIG') {\r\n      // ex. \"MULTISIG-P2SH:2-3\" would mean 2 of 3 P2SH MULTISIG\r\n      const keyParts = key.split(':')\r\n      if (keyParts.length !== 2) throw new Error(`invalid input: ${key}`)\r\n      const newKey = keyParts[0]\r\n      const mAndN = keyParts[1].split('-').map((item) => parseInt(item))\r\n\r\n      totalWeight += types.inputs[newKey] * inputs[key]\r\n      const multiplyer = (newKey === 'MULTISIG-P2SH') ? 4 : 1\r\n      totalWeight += ((73 * mAndN[0]) + (34 * mAndN[1])) * multiplyer * inputs[key]\r\n    } else {\r\n      totalWeight += types.inputs[key] * inputs[key]\r\n    }\r\n    inputCount += inputs[key]\r\n    if (key.indexOf('W') >= 0) hasWitness = true\r\n  })\r\n\r\n  Object.keys(outputs).forEach((key) => {\r\n    checkUInt53(outputs[key])\r\n    totalWeight += types.outputs[key] * outputs[key]\r\n    outputCount += outputs[key]\r\n  })\r\n\r\n  if (hasWitness) totalWeight += 2\r\n\r\n  totalWeight += 8 * 4\r\n  totalWeight += varIntLength(inputCount) * 4\r\n  totalWeight += varIntLength(outputCount) * 4\r\n\r\n  return Math.ceil(totalWeight / 4)\r\n}\r\n\r\ninterface IcalculateTxSizeOptions {\r\n  amount?: number\r\n  unspents?: any\r\n  address: string\r\n  txOut?: number\r\n  method?: string\r\n  fixed?: boolean\r\n}\r\nconst calculateTxSize = async (options: IcalculateTxSizeOptions) => {\r\n  let {\r\n    amount,\r\n    unspents,\r\n    address,\r\n    txOut,\r\n    method,\r\n    fixed,\r\n  } = options\r\n\r\n  txOut = txOut || 2\r\n  method = method || 'send'\r\n\r\n  const defaultTxSize = constants.defaultFeeRates.btc.size[method]\r\n\r\n  if (fixed) {\r\n    return defaultTxSize\r\n  }\r\n\r\n  unspents = unspents || await actions.btc.fetchUnspents(address)\r\n  if (amount) {\r\n    unspents = await actions.btc.prepareUnspents({ amount, unspents })\r\n  }\r\n  /*\r\n  * Formula with 2 input and 2 output addresses \r\n  * (BYTE_INPUT_ADDRESS × 2 ) + (BYTE_OUTPUT_ADDRESS × 2) + BYTE_TRANSACTION\r\n  */\r\n  const txIn = unspents.length\r\n  const txSize = txIn > 0\r\n    ? txIn * BYTE_INPUT_ADDRESS + txOut * BYTE_OUTPUT_ADDRESS + (BYTE_TRANSACTION + txIn - txOut)\r\n    : defaultTxSize\r\n\r\n  if (method === 'send_multisig') {\r\n    const msuSize = getByteCount(\r\n      { 'MULTISIG-P2SH-P2WSH:2-2': 1 },\r\n      { 'P2PKH': (hasAdminFee) ? 3 : 2 }\r\n    )\r\n    const msutxSize = txIn * msuSize + txOut * BYTE_OUTPUT_ADDRESS + (BYTE_TRANSACTION + txIn - txOut)\r\n\r\n    return msutxSize\r\n  }\r\n\r\n  if (method === 'send_2fa') {\r\n    const msSize = getByteCount(\r\n      { 'MULTISIG-P2SH-P2WSH:2-3': txIn },\r\n      { 'P2PKH': (hasAdminFee) ? 3 : 2 }\r\n    )\r\n    console.log('Tx size', msSize)\r\n    return msSize\r\n    /*\r\n    const mstxSize = txIn * msSize + txOut * BYTE_OUTPUT_ADDRESS + (BYTE_TRANSACTION + txIn - txOut)\r\n\r\n    return mstxSize\r\n    */\r\n  }\r\n\r\n  return txSize\r\n}\r\n\r\ntype EstimateFeeValueOptions = {\r\n  method?: string\r\n  speed: 'fast' | 'normal' | 'slow'\r\n  feeRate?: number\r\n  inSatoshis?: boolean\r\n  address?: string\r\n  txSize?: number\r\n  fixed?: string\r\n  amount?: number\r\n  moreInfo?: boolean\r\n}\r\n\r\nconst estimateFeeValue = async (options: EstimateFeeValueOptions): Promise<any> => {\r\n  const { moreInfo } = options\r\n  let { feeRate, inSatoshis, speed, address, txSize, fixed, method, amount } = options\r\n  const {\r\n    user: {\r\n      btcData,\r\n      btcMultisigSMSData,\r\n      btcMultisigUserData,\r\n    },\r\n  } = getState()\r\n\r\n  let txOut = 2\r\n\r\n  if (hasAdminFee) txOut = 3\r\n\r\n  if (!address) {\r\n    address = btcData.address\r\n    if (method === 'send_2fa') address = btcMultisigSMSData.address\r\n    if (method === 'send_multisig') address = btcMultisigUserData.address\r\n  }\r\n\r\n  let unspents = await actions.btc.fetchUnspents(address)\r\n  if (amount) {\r\n    unspents = await actions.btc.prepareUnspents({ amount, unspents })\r\n  }\r\n  //@\r\n  txSize = txSize || await calculateTxSize({ address, speed, fixed, method, txOut, amount })\r\n  feeRate = feeRate || await estimateFeeRate({ speed })\r\n\r\n  const calculatedFeeValue = BigNumber.maximum(\r\n    DUST,\r\n    new BigNumber(feeRate)\r\n      .multipliedBy(txSize)\r\n      .div(1024) // divide by one kilobyte\r\n      .dp(0, BigNumber.ROUND_HALF_EVEN),\r\n  )\r\n\r\n  const CUSTOM_SATOSHI = 20\r\n  calculatedFeeValue.plus(CUSTOM_SATOSHI) // just wanted to add\r\n\r\n  const SATOSHI_TO_BITCOIN_RATIO = 1e-8; // 1 BTC -> 100 000 000 satoshi\r\n  \r\n  const finalFeeValue = inSatoshis\r\n    ? calculatedFeeValue.toNumber()\r\n    : calculatedFeeValue.multipliedBy(SATOSHI_TO_BITCOIN_RATIO).toNumber()\r\n\r\n  if (moreInfo) {\r\n    return {\r\n      fee: calculatedFeeValue.multipliedBy(SATOSHI_TO_BITCOIN_RATIO).toNumber(),\r\n      satoshis: calculatedFeeValue.toNumber(),\r\n      txSize,\r\n      feeRate,\r\n      unspents,\r\n    }\r\n  }\r\n  return finalFeeValue\r\n}\r\n\r\nconst estimateFeeRateBitcoinfees = async ({ speed = 'fast' } = {}) => {\r\n  const defaultRate = constants.defaultFeeRates.btc.rate\r\n\r\n  let apiResult\r\n\r\n  try {\r\n    apiResult = await api.asyncFetchApi(`https://bitcoinfees.earn.com/api/v1/fees/recommended`)\r\n  } catch (err) {\r\n    console.error(`EstimateFeeRate: ${err.message}`)\r\n    return defaultRate[speed]\r\n  }\r\n\r\n  const apiSpeeds = {\r\n    slow: `hourFee`,\r\n    normal: `halfHourFee`,\r\n    fast: `fastestFee`,\r\n  }\r\n\r\n  const apiSpeed = apiSpeeds[speed] || apiSpeeds.normal\r\n  const apiRate = new BigNumber(apiResult[apiSpeed]).multipliedBy(1024)\r\n\r\n  return apiRate.isGreaterThanOrEqualTo(DUST)\r\n    ? apiRate.toString()\r\n    : defaultRate[speed]\r\n}\r\n\r\nconst estimateFeeRateBlockcypher = async ({ speed = 'fast' } = {}) => {\r\n  const link = config.feeRates.btc\r\n  const defaultRate = constants.defaultFeeRates.btc.rate\r\n\r\n  if (!link) {\r\n    return defaultRate[speed]\r\n  }\r\n\r\n  let apiResult\r\n\r\n  try {\r\n    // api returns sotoshi in 1 kb\r\n    apiResult = await api.asyncFetchApi(link)\r\n  } catch (err) {\r\n    console.error(`EstimateFeeRate: ${err.message}`)\r\n    return defaultRate[speed]\r\n  }\r\n\r\n  const apiSpeeds = {\r\n    slow: 'low_fee_per_kb',\r\n    normal: 'medium_fee_per_kb',\r\n    fast: 'high_fee_per_kb',\r\n  }\r\n\r\n  const apiSpeed = apiSpeeds[speed] || apiSpeeds.normal\r\n  const apiRate = new BigNumber(apiResult[apiSpeed])\r\n\r\n  return apiRate.isGreaterThanOrEqualTo(DUST) \r\n    ? apiRate.toNumber()\r\n    : defaultRate[speed]\r\n}\r\n\r\nconst estimateFeeRate = estimateFeeRateBlockcypher\r\n\r\nexport default {\r\n  calculateTxSize,\r\n  estimateFeeValue,\r\n  estimateFeeRate,\r\n  network,\r\n}\r\n"]}]}