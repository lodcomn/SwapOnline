{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.flows\\GHOST2ETHTOKEN.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.flows\\GHOST2ETHTOKEN.ts","mtime":1614842913759},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI7CmltcG9ydCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXNzZXJ0VGhpc0luaXRpYWxpemVkIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI7CmltcG9ydCBfZ2V0IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZ2V0IjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiQGJhYmVsL3J1bnRpbWUvcmVnZW5lcmF0b3IiOwoKZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH0KCmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CgppbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnOwppbXBvcnQgeyBjb25zdGFudHMsIHV0aWwgfSBmcm9tICdzd2FwLmFwcCc7CmltcG9ydCB7IEF0b21pY0FCMlVUWE8gfSBmcm9tICdzd2FwLnN3YXAnOwppbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdiaWdudW1iZXIuanMnOwpleHBvcnQgZGVmYXVsdCAoZnVuY3Rpb24gKHRva2VuTmFtZSkgewogIHZhciBHSE9TVDJFVEhUT0tFTiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0F0b21pY0FCMlVUWE8pIHsKICAgIF9pbmhlcml0cyhHSE9TVDJFVEhUT0tFTiwgX0F0b21pY0FCMlVUWE8pOwoKICAgIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoR0hPU1QyRVRIVE9LRU4pOwoKICAgIGZ1bmN0aW9uIEdIT1NUMkVUSFRPS0VOKHN3YXApIHsKICAgICAgdmFyIF90aGlzU3VwZXIsIF90aGlzOwoKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEdIT1NUMkVUSFRPS0VOKTsKCiAgICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc3dhcCk7CgogICAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfZmxvd05hbWUiLCB2b2lkIDApOwoKICAgICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZXRoVG9rZW5Td2FwIiwgdm9pZCAwKTsKCiAgICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdob3N0U3dhcCIsIHZvaWQgMCk7CgogICAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGF0ZSIsIHZvaWQgMCk7CgogICAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRSZWZ1bmRUeEhleCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpcy5naG9zdFN3YXAuZ2V0UmVmdW5kSGV4VHJhbnNhY3Rpb24oewogICAgICAgICAgc2NyaXB0VmFsdWVzOiBfdGhpcy5zdGF0ZS51dHhvU2NyaXB0VmFsdWVzLAogICAgICAgICAgc2VjcmV0OiBfdGhpcy5zdGF0ZS5zZWNyZXQKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICh0eEhleCkgewogICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICByZWZ1bmRUeEhleDogdHhIZXgKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIF90aGlzLnV0eG9Db2luID0gImdob3N0IjsKICAgICAgX3RoaXMuX2Zsb3dOYW1lID0gR0hPU1QyRVRIVE9LRU4uZ2V0TmFtZSgpOwogICAgICBfdGhpcy5zdGVwTnVtYmVycyA9IHsKICAgICAgICAnc2lnbic6IDEsCiAgICAgICAgJ3N1Ym1pdC1zZWNyZXQnOiAyLAogICAgICAgICdzeW5jLWJhbGFuY2UnOiAzLAogICAgICAgICdsb2NrLXV0eG8nOiA0LAogICAgICAgICd3YWl0LWxvY2stZXRoJzogNSwKICAgICAgICAnd2l0aGRyYXctZXRoJzogNiwKICAgICAgICAnZmluaXNoJzogNywKICAgICAgICAnZW5kJzogOAogICAgICB9OwogICAgICBfdGhpcy5ldGhUb2tlblN3YXAgPSBzd2FwLm93bmVyU3dhcDsKICAgICAgX3RoaXMuZ2hvc3RTd2FwID0gc3dhcC5wYXJ0aWNpcGFudFN3YXA7CiAgICAgIF90aGlzLmFiQmxvY2tjaGFpbiA9IF90aGlzLmV0aFRva2VuU3dhcDsKICAgICAgX3RoaXMudXR4b0Jsb2NrY2hhaW4gPSBfdGhpcy5naG9zdFN3YXA7CiAgICAgIF90aGlzLmlzVVRYT1NpZGUgPSB0cnVlOwoKICAgICAgaWYgKCFfdGhpcy5ldGhUb2tlblN3YXApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0dIT1NUMkVUSDogImV0aFRva2VuU3dhcCIgb2YgdHlwZSBvYmplY3QgcmVxdWlyZWQnKTsKICAgICAgfQoKICAgICAgaWYgKCFfdGhpcy5naG9zdFN3YXApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0dIT1NUMkVUSDogImdob3N0U3dhcCIgb2YgdHlwZSBvYmplY3QgcmVxdWlyZWQnKTsKICAgICAgfQoKICAgICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgICAgc3RlcDogMCwKICAgICAgICBpc1N0b3BwZWRTd2FwOiBmYWxzZSwKICAgICAgICBzaWduVHJhbnNhY3Rpb25IYXNoOiBudWxsLAogICAgICAgIGlzU2lnbkZldGNoaW5nOiBmYWxzZSwKICAgICAgICBpc1BhcnRpY2lwYW50U2lnbmVkOiBmYWxzZSwKICAgICAgICBldGhTd2FwQ3JlYXRpb25UcmFuc2FjdGlvbkhhc2g6IG51bGwsCiAgICAgICAgc2VjcmV0SGFzaDogbnVsbCwKICAgICAgICBpc0JhbGFuY2VGZXRjaGluZzogZmFsc2UsCiAgICAgICAgaXNCYWxhbmNlRW5vdWdoOiB0cnVlLAogICAgICAgIGJhbGFuY2U6IG51bGwsCiAgICAgICAgaXNFdGhDb250cmFjdEZ1bmRlZDogZmFsc2UsCiAgICAgICAgZ2hvc3RTd2FwV2l0aGRyYXdUcmFuc2FjdGlvbkhhc2g6IG51bGwsCiAgICAgICAgZXRoU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoOiBudWxsLAogICAgICAgIHNlY3JldDogbnVsbCwKICAgICAgICBjYW5DcmVhdGVFdGhUcmFuc2FjdGlvbjogdHJ1ZSwKICAgICAgICBpc0V0aFdpdGhkcmF3bjogZmFsc2UsCiAgICAgICAgcmVmdW5kVHJhbnNhY3Rpb25IYXNoOiBudWxsLAogICAgICAgIGlzUmVmdW5kZWQ6IGZhbHNlLAogICAgICAgIHdpdGhkcmF3RmVlOiBudWxsLAogICAgICAgIHJlZnVuZFR4SGV4OiBudWxsLAogICAgICAgIGlzRmluaXNoZWQ6IGZhbHNlLAogICAgICAgIGlzU3dhcEV4aXN0OiBmYWxzZQogICAgICB9OwoKICAgICAgX3RoaXMuX3BlcnNpc3RTdGF0ZSgpOwoKICAgICAgX2dldCgoX3RoaXNTdXBlciA9IF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCBfZ2V0UHJvdG90eXBlT2YoR0hPU1QyRVRIVE9LRU4ucHJvdG90eXBlKSksICJfcGVyc2lzdFN0ZXBzIiwgX3RoaXNTdXBlcikuY2FsbChfdGhpc1N1cGVyKTsKCiAgICAgIHJldHVybiBfdGhpczsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoR0hPU1QyRVRIVE9LRU4sIFt7CiAgICAgIGtleTogIl9wZXJzaXN0U3RhdGUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX3BlcnNpc3RTdGF0ZSgpIHsKICAgICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihHSE9TVDJFVEhUT0tFTi5wcm90b3R5cGUpLCAiX3BlcnNpc3RTdGF0ZSIsIHRoaXMpLmNhbGwodGhpcyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX2dldFN0ZXBzIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRTdGVwcygpIHsKICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgdmFyIGZsb3cgPSB0aGlzOwogICAgICAgIHJldHVybiBbCiAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgIC8vIDEuIFNpZ25zCiAgICAgICAgX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF90aGlzMi5zaWduVVRYT1NpZGUoKTsKCiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgfSkpLCAvLyAyLiBDcmVhdGUgc2VjcmV0LCBzZWNyZXQgaGFzaCBhbmQgR0hPU1Qgc2NyaXB0CiAgICAgICAgZnVuY3Rpb24gKCkgey8vIHRoaXMuc3VibWl0U2VjcmV0KCkKICAgICAgICB9LCAvLyAzLiBDaGVjayBzeXN0ZW0gd2FsbGV0IGJhbGFuY2UKICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIuc3luY0JhbGFuY2UoKTsKICAgICAgICB9LAogICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAvLyA0LiBDcmVhdGUgR0hPU3QgU2NyaXB0LCBmdW5kLCBub3RpZnkgcGFydGljaXBhbnQKICAgICAgICBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICAgIHZhciBvblRyYW5zYWN0aW9uSGFzaCwgc2VsbEFtb3VudCwgX2Zsb3ckc3RhdGUyLCBpc0JhbGFuY2VFbm91Z2gsIHV0eG9TY3JpcHRWYWx1ZXMsIGNoZWNrR0hPU1RTY3JpcHRCYWxhbmNlLCBpc1N0b3BwZWRTd2FwOwoKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBvblRyYW5zYWN0aW9uSGFzaCA9IGZ1bmN0aW9uIG9uVHJhbnNhY3Rpb25IYXNoKHR4SUQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgX2Zsb3ckc3RhdGUgPSBmbG93LnN0YXRlLAogICAgICAgICAgICAgICAgICAgICAgICB1dHhvU2NyaXB0Q3JlYXRpbmdUcmFuc2FjdGlvbkhhc2ggPSBfZmxvdyRzdGF0ZS51dHhvU2NyaXB0Q3JlYXRpbmdUcmFuc2FjdGlvbkhhc2gsCiAgICAgICAgICAgICAgICAgICAgICAgIHV0eG9TY3JpcHRWYWx1ZXMgPSBfZmxvdyRzdGF0ZS51dHhvU2NyaXB0VmFsdWVzOwoKICAgICAgICAgICAgICAgICAgICBpZiAodXR4b1NjcmlwdENyZWF0aW5nVHJhbnNhY3Rpb25IYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmbG93LnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgIHV0eG9TY3JpcHRDcmVhdGluZ1RyYW5zYWN0aW9uSGFzaDogdHhJRAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGZsb3cuc3dhcC5yb29tLm9uY2UoJ3JlcXVlc3QgdXR4byBzY3JpcHQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICBmbG93LnN3YXAucm9vbS5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiAnY3JlYXRlIHV0eG8gc2NyaXB0JywKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdFZhbHVlczogdXR4b1NjcmlwdFZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgICAgICB1dHhvU2NyaXB0Q3JlYXRpbmdUcmFuc2FjdGlvbkhhc2g6IHR4SUQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZmxvdy5zd2FwLnJvb20uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6ICdjcmVhdGUgdXR4byBzY3JpcHQnLAogICAgICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRWYWx1ZXM6IHV0eG9TY3JpcHRWYWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIHV0eG9TY3JpcHRDcmVhdGluZ1RyYW5zYWN0aW9uSGFzaDogdHhJRAogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgc2VsbEFtb3VudCA9IGZsb3cuc3dhcC5zZWxsQW1vdW50OwogICAgICAgICAgICAgICAgICBfZmxvdyRzdGF0ZTIgPSBmbG93LnN0YXRlLCBpc0JhbGFuY2VFbm91Z2ggPSBfZmxvdyRzdGF0ZTIuaXNCYWxhbmNlRW5vdWdoLCB1dHhvU2NyaXB0VmFsdWVzID0gX2Zsb3ckc3RhdGUyLnV0eG9TY3JpcHRWYWx1ZXM7CgogICAgICAgICAgICAgICAgICBpZiAoIWlzQmFsYW5jZUVub3VnaCkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICByZXR1cm4gZmxvdy5naG9zdFN3YXAuZnVuZFNjcmlwdCh7CiAgICAgICAgICAgICAgICAgICAgc2NyaXB0VmFsdWVzOiB1dHhvU2NyaXB0VmFsdWVzLAogICAgICAgICAgICAgICAgICAgIGFtb3VudDogc2VsbEFtb3VudAogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgIGNoZWNrR0hPU1RTY3JpcHRCYWxhbmNlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBfdGhpczIkZ2hvc3RTd2FwJGNyZWEsIHNjcmlwdEFkZHJlc3MsIHVuc3BlbnRzLCB0eElELCBiYWxhbmNlLCBpc0Vub3VnaE1vbmV5OwoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIkZ2hvc3RTd2FwJGNyZWEgPSBfdGhpczIuZ2hvc3RTd2FwLmNyZWF0ZVNjcmlwdCh1dHhvU2NyaXB0VmFsdWVzKSwgc2NyaXB0QWRkcmVzcyA9IF90aGlzMiRnaG9zdFN3YXAkY3JlYS5zY3JpcHRBZGRyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczIuZ2hvc3RTd2FwLmZldGNoVW5zcGVudHMoc2NyaXB0QWRkcmVzcyk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNwZW50cyA9IF9jb250ZXh0Mi5zZW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEodW5zcGVudHMubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4SUQgPSB1bnNwZW50c1swXS50eGlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczIuZ2hvc3RTd2FwLmdldEJhbGFuY2UodXR4b1NjcmlwdFZhbHVlcyk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWxhbmNlID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRW5vdWdoTW9uZXkgPSBuZXcgQmlnTnVtYmVyKGJhbGFuY2UpLmlzR3JlYXRlclRoYW5PckVxdWFsVG8oc2VsbEFtb3VudC50aW1lcygxZTgpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0Vub3VnaE1vbmV5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvdy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRCYWxhbmNlOiBuZXcgQmlnTnVtYmVyKGJhbGFuY2UpLmRpdigxZTgpLmRwKDgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25UcmFuc2FjdGlvbkhhc2godHhJRCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBpc0Vub3VnaE1vbmV5KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gY2hlY2tHSE9TVFNjcmlwdEJhbGFuY2UoKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZjMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9KCk7CgogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB1dGlsLmhlbHBlcnMucmVwZWF0QXN5bmNVbnRpbFJlc3VsdCggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhzdG9wUmVwZWF0KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNTdG9wcGVkU3dhcDsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1N0b3BwZWRTd2FwID0gZmxvdy5zdGF0ZS5pc1N0b3BwZWRTd2FwOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3RvcHBlZFN3YXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrR0hPU1RTY3JpcHRCYWxhbmNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQzLnNlbnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFJlcGVhdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWY0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgfSgpKTsKCiAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgIGlzU3RvcHBlZFN3YXAgPSBmbG93LnN0YXRlLmlzU3RvcHBlZFN3YXA7CgogICAgICAgICAgICAgICAgICBpZiAoIWlzU3RvcHBlZFN3YXApIHsKICAgICAgICAgICAgICAgICAgICBmbG93LmZpbmlzaFN0ZXAoewogICAgICAgICAgICAgICAgICAgICAgaXNHaG9zdFNjcmlwdEZ1bmRlZDogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgIHN0ZXA6ICdsb2NrLXV0eG8nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgICAgfSkpLAogICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAvLyA1LiBXYWl0IHBhcnRpY2lwYW50IGNyZWF0ZXMgRVRIIENvbnRyYWN0CiAgICAgICAgX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyLmV0aFRva2VuU3dhcC53YWl0QUIyVVRYT0NvbnRyYWN0KHsKICAgICAgICAgICAgICAgICAgICBmbG93OiBmbG93LAogICAgICAgICAgICAgICAgICAgIHV0eG9Db2luOiAiZ2hvc3QiCiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTUpOwogICAgICAgIH0pKSwKICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgLy8gNi4gV2l0aGRyYXcKICAgICAgICBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgIHJldHVybiBmbG93LmV0aFRva2VuU3dhcC53aXRoZHJhd0Zyb21BQjJVVFhPKHsKICAgICAgICAgICAgICAgICAgICBmbG93OiBmbG93CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTYpOwogICAgICAgIH0pKSwgLy8gNy4gRmluaXNoCiAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgZmxvdy5zd2FwLnJvb20ub25jZSgnc3dhcCBmaW5pc2hlZCcsIGZ1bmN0aW9uIChfcmVmNykgewogICAgICAgICAgICB2YXIgZ2hvc3RTd2FwV2l0aGRyYXdUcmFuc2FjdGlvbkhhc2ggPSBfcmVmNy5naG9zdFN3YXBXaXRoZHJhd1RyYW5zYWN0aW9uSGFzaDsKICAgICAgICAgICAgZmxvdy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgZ2hvc3RTd2FwV2l0aGRyYXdUcmFuc2FjdGlvbkhhc2g6IGdob3N0U3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICBmbG93LnN3YXAucm9vbS5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGV2ZW50OiAncmVxdWVzdCBzd2FwIGZpbmlzaGVkJwogICAgICAgICAgfSk7CiAgICAgICAgICBmbG93LmZpbmlzaFN0ZXAoewogICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlCiAgICAgICAgICB9LCAnZmluaXNoJyk7CiAgICAgICAgfSwgLy8gOC4gRmluaXNoZWQhCiAgICAgICAgZnVuY3Rpb24gKCkge31dOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInNraXBTeW5jQmFsYW5jZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9za2lwU3luY0JhbGFuY2UgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNygpIHsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICB0aGlzLmZpbmlzaFN0ZXAoe30sIHsKICAgICAgICAgICAgICAgICAgICBzdGVwOiAnc3luYy1iYWxhbmNlJwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWU3LCB0aGlzKTsKICAgICAgICB9KSk7CgogICAgICAgIGZ1bmN0aW9uIHNraXBTeW5jQmFsYW5jZSgpIHsKICAgICAgICAgIHJldHVybiBfc2tpcFN5bmNCYWxhbmNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2tpcFN5bmNCYWxhbmNlOwogICAgICB9KCkKICAgIH0sIHsKICAgICAga2V5OiAidHJ5UmVmdW5kIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRyeVJlZnVuZCgpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgdmFyIGZsb3cgPSB0aGlzOwogICAgICAgIHZhciBfZmxvdyRzdGF0ZTMgPSBmbG93LnN0YXRlLAogICAgICAgICAgICB1dHhvU2NyaXB0VmFsdWVzID0gX2Zsb3ckc3RhdGUzLnV0eG9TY3JpcHRWYWx1ZXMsCiAgICAgICAgICAgIHNlY3JldCA9IF9mbG93JHN0YXRlMy5zZWNyZXQ7CiAgICAgICAgcmV0dXJuIGZsb3cuZ2hvc3RTd2FwLnJlZnVuZCh7CiAgICAgICAgICBzY3JpcHRWYWx1ZXM6IHV0eG9TY3JpcHRWYWx1ZXMsCiAgICAgICAgICBzZWNyZXQ6IHNlY3JldAogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGhhc2gpIHsKICAgICAgICAgIGlmICghaGFzaCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMzLnN3YXAucm9vbS5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGV2ZW50OiAndXR4byByZWZ1bmQgY29tcGxldGVkJwogICAgICAgICAgfSk7CgogICAgICAgICAgZmxvdy5zZXRTdGF0ZSh7CiAgICAgICAgICAgIHJlZnVuZFRyYW5zYWN0aW9uSGFzaDogaGFzaCwKICAgICAgICAgICAgaXNSZWZ1bmRlZDogdHJ1ZSwKICAgICAgICAgICAgaXNTd2FwRXhpc3Q6IGZhbHNlCiAgICAgICAgICB9LCB0cnVlKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgaWYgKC9BZGRyZXNzIGlzIGVtcHR5Ly50ZXN0KGVycm9yKSkgewogICAgICAgICAgICAvLyBUT0RPIC0gZmV0Y2ggVFggbGlzdCB0byBzY3JpcHQgZm9yIHJlZnVuZCBUWAogICAgICAgICAgICBmbG93LnNldFN0YXRlKHsKICAgICAgICAgICAgICBpc1JlZnVuZGVkOiB0cnVlLAogICAgICAgICAgICAgIGlzU3dhcEV4aXN0OiBmYWxzZQogICAgICAgICAgICB9LCB0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLndhcm4oJ0dob3N0IHJlZnVuZDonLCBlcnJvcik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJpc1JlZnVuZFN1Y2Nlc3MiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfaXNSZWZ1bmRTdWNjZXNzID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoKSB7CiAgICAgICAgICB2YXIgX3RoaXMkc3RhdGUsIHJlZnVuZFRyYW5zYWN0aW9uSGFzaCwgaXNSZWZ1bmRlZDsKCiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU4JChfY29udGV4dDgpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgX3RoaXMkc3RhdGUgPSB0aGlzLnN0YXRlLCByZWZ1bmRUcmFuc2FjdGlvbkhhc2ggPSBfdGhpcyRzdGF0ZS5yZWZ1bmRUcmFuc2FjdGlvbkhhc2gsIGlzUmVmdW5kZWQgPSBfdGhpcyRzdGF0ZS5pc1JlZnVuZGVkOwoKICAgICAgICAgICAgICAgICAgaWYgKCEocmVmdW5kVHJhbnNhY3Rpb25IYXNoICYmIGlzUmVmdW5kZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5naG9zdFN3YXAuY2hlY2tUWChyZWZ1bmRUcmFuc2FjdGlvbkhhc2gpOwoKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDguc2VudCkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIHRydWUpOwoKICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdHSE9TVDJFVEhUT0tFTiAtIHVua25vd24gcmVmdW5kIHRyYW5zYWN0aW9uJyk7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgIHJlZnVuZFRyYW5zYWN0aW9uSGFzaDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBpc1JlZnVuZGVkOiBmYWxzZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwgZmFsc2UpOwoKICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWU4LCB0aGlzKTsKICAgICAgICB9KSk7CgogICAgICAgIGZ1bmN0aW9uIGlzUmVmdW5kU3VjY2VzcygpIHsKICAgICAgICAgIHJldHVybiBfaXNSZWZ1bmRTdWNjZXNzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaXNSZWZ1bmRTdWNjZXNzOwogICAgICB9KCkKICAgIH0sIHsKICAgICAga2V5OiAidHJ5V2l0aGRyYXciLAogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfdHJ5V2l0aGRyYXcgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOShfc2VjcmV0KSB7CiAgICAgICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgICAgICB2YXIgX3RoaXMkc3RhdGUyLCBzZWNyZXQsIHNlY3JldEhhc2gsIGlzRXRoV2l0aGRyYXduLCBfc2VjcmV0SGFzaCwgZGF0YTsKCiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgX3RoaXMkc3RhdGUyID0gdGhpcy5zdGF0ZSwgc2VjcmV0ID0gX3RoaXMkc3RhdGUyLnNlY3JldCwgc2VjcmV0SGFzaCA9IF90aGlzJHN0YXRlMi5zZWNyZXRIYXNoLCBpc0V0aFdpdGhkcmF3biA9IF90aGlzJHN0YXRlMi5pc0V0aFdpdGhkcmF3bjsKCiAgICAgICAgICAgICAgICAgIGlmIChfc2VjcmV0KSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldpdGhkcmF3YWwgaXMgYXV0b21hdGljLiBGb3IgbWFudWFsIHdpdGhkcmF3YWwsIHByb3ZpZGUgYSBzZWNyZXQiKTsKCiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgIGlmIChzZWNyZXQgJiYgc2VjcmV0ICE9IF9zZWNyZXQpIGNvbnNvbGUud2FybigiU2VjcmV0IGFscmVhZHkga25vd24gYW5kIGlzIGRpZmZlcmVudC4gQXJlIHlvdSBzdXJlPyIpOwogICAgICAgICAgICAgICAgICBpZiAoaXNFdGhXaXRoZHJhd24pIGNvbnNvbGUud2FybigiTG9va3MgbGlrZSBtb25leSB3ZXJlIGFscmVhZHkgd2l0aGRyYXduLCBhcmUgeW91IHN1cmU/Iik7CiAgICAgICAgICAgICAgICAgIGRlYnVnKCdzd2FwLmNvcmU6ZmxvdycpKCJXSVRIRFJBVyB1c2luZyBzZWNyZXQgPSAiLmNvbmNhdChfc2VjcmV0KSk7CiAgICAgICAgICAgICAgICAgIF9zZWNyZXRIYXNoID0gdGhpcy5hcHAuZW52LmJpdGNvaW4uY3J5cHRvLnJpcGVtZDE2MChCdWZmZXIuZnJvbShfc2VjcmV0LCAnaGV4JykpLnRvU3RyaW5nKCdoZXgnKTsKICAgICAgICAgICAgICAgICAgaWYgKHNlY3JldEhhc2ggIT0gX3NlY3JldEhhc2gpIGNvbnNvbGUud2FybigiSGFzaCBkb2VzIG5vdCBtYXRjaCEgc3RhdGU6ICIuY29uY2F0KHNlY3JldEhhc2gsICIsIGdpdmVuOiAiKS5jb25jYXQoX3NlY3JldEhhc2gpKTsKICAgICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBvd25lckFkZHJlc3M6IHRoaXMuYXBwLmdldFBhcnRpY2lwYW50RXRoQWRkcmVzcyh0aGlzLnN3YXApLAogICAgICAgICAgICAgICAgICAgIHNlY3JldDogX3NlY3JldAogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ldGhUb2tlblN3YXAud2l0aGRyYXcoZGF0YSwgZnVuY3Rpb24gKGhhc2gpIHsKICAgICAgICAgICAgICAgICAgICBkZWJ1Zygnc3dhcC5jb3JlOmZsb3cnKSgiVFggaGFzaD0iLmNvbmNhdChoYXNoKSk7CgogICAgICAgICAgICAgICAgICAgIF90aGlzNC5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICBldGhTd2FwV2l0aGRyYXdUcmFuc2FjdGlvbkhhc2g6IGhhc2gsCiAgICAgICAgICAgICAgICAgICAgICBjYW5DcmVhdGVFdGhUcmFuc2FjdGlvbjogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczQuZmluaXNoU3RlcCh7CiAgICAgICAgICAgICAgICAgICAgICBpc0V0aFdpdGhkcmF3bjogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sICd3aXRoZHJhdy1ldGgnKTsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTksIHRoaXMpOwogICAgICAgIH0pKTsKCiAgICAgICAgZnVuY3Rpb24gdHJ5V2l0aGRyYXcoX3gyKSB7CiAgICAgICAgICByZXR1cm4gX3RyeVdpdGhkcmF3LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ5V2l0aGRyYXc7CiAgICAgIH0oKQogICAgfV0sIFt7CiAgICAgIGtleTogImdldE5hbWUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TmFtZSgpIHsKICAgICAgICByZXR1cm4gIiIuY29uY2F0KHRoaXMuZ2V0RnJvbU5hbWUoKSwgIjIiKS5jb25jYXQodGhpcy5nZXRUb05hbWUoKSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0RnJvbU5hbWUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RnJvbU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIGNvbnN0YW50cy5DT0lOUy5naG9zdDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJnZXRUb05hbWUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VG9OYW1lKCkgewogICAgICAgIHJldHVybiB0b2tlbk5hbWUudG9VcHBlckNhc2UoKTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBHSE9TVDJFVEhUT0tFTjsKICB9KEF0b21pY0FCMlVUWE8pOwoKICByZXR1cm4gR0hPU1QyRVRIVE9LRU47Cn0pOw=="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/core/swap.flows/GHOST2ETHTOKEN.ts"],"names":["debug","constants","util","AtomicAB2UTXO","BigNumber","tokenName","GHOST2ETHTOKEN","swap","ghostSwap","getRefundHexTransaction","scriptValues","state","utxoScriptValues","secret","then","txHex","setState","refundTxHex","utxoCoin","_flowName","getName","stepNumbers","ethTokenSwap","ownerSwap","participantSwap","abBlockchain","utxoBlockchain","isUTXOSide","Error","step","isStoppedSwap","signTransactionHash","isSignFetching","isParticipantSigned","ethSwapCreationTransactionHash","secretHash","isBalanceFetching","isBalanceEnough","balance","isEthContractFunded","ghostSwapWithdrawTransactionHash","ethSwapWithdrawTransactionHash","canCreateEthTransaction","isEthWithdrawn","refundTransactionHash","isRefunded","withdrawFee","isFinished","isSwapExist","_persistState","flow","signUTXOSide","syncBalance","onTransactionHash","txID","utxoScriptCreatingTransactionHash","room","once","sendMessage","event","data","sellAmount","fundScript","amount","checkGHOSTScriptBalance","createScript","scriptAddress","fetchUnspents","unspents","length","txid","getBalance","isEnoughMoney","isGreaterThanOrEqualTo","times","scriptBalance","div","dp","helpers","repeatAsyncUntilResult","stopRepeat","finishStep","isGhostScriptFunded","waitAB2UTXOContract","withdrawFromAB2UTXO","refund","hash","error","test","console","warn","checkTX","_secret","_secretHash","app","env","bitcoin","crypto","ripemd160","Buffer","from","toString","ownerAddress","getParticipantEthAddress","withdraw","getFromName","getToName","COINS","ghost","toUpperCase"],"mappings":";;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAAkBC,SAAlB,EAA6BC,IAA7B,QAAyC,UAAzC;AACA,SAASC,aAAT,QAA8B,WAA9B;AACA,SAASC,SAAT,QAA0B,cAA1B;AAGA,gBAAe,UAACC,SAAD,EAAe;AAAA,MAEtBC,cAFsB;AAAA;;AAAA;;AAkB1B,4BAAYC,IAAZ,EAAkB;AAAA;;AAAA;;AAChB,gCAAMA,IAAN;;AADgB;;AAAA;;AAAA;;AAAA;;AAAA,uEAoOD,YAAM;AACrB,cAAKC,SAAL,CAAeC,uBAAf,CAAuC;AACrCC,UAAAA,YAAY,EAAE,MAAKC,KAAL,CAAWC,gBADY;AAErCC,UAAAA,MAAM,EAAE,MAAKF,KAAL,CAAWE;AAFkB,SAAvC,EAIGC,IAJH,CAIQ,UAACC,KAAD,EAAW;AACf,gBAAKC,QAAL,CAAc;AACZC,YAAAA,WAAW,EAAEF;AADD,WAAd;AAGD,SARH;AASD,OA9OiB;;AAEhB,YAAKG,QAAL;AAEA,YAAKC,SAAL,GAAiBb,cAAc,CAACc,OAAf,EAAjB;AAEA,YAAKC,WAAL,GAAmB;AACjB,gBAAQ,CADS;AAEjB,yBAAiB,CAFA;AAGjB,wBAAgB,CAHC;AAIjB,qBAAa,CAJI;AAKjB,yBAAiB,CALA;AAMjB,wBAAgB,CANC;AAOjB,kBAAU,CAPO;AAQjB,eAAO;AARU,OAAnB;AAWA,YAAKC,YAAL,GAAoBf,IAAI,CAACgB,SAAzB;AACA,YAAKf,SAAL,GAAsBD,IAAI,CAACiB,eAA3B;AAEA,YAAKC,YAAL,GAAoB,MAAKH,YAAzB;AACA,YAAKI,cAAL,GAAsB,MAAKlB,SAA3B;AACA,YAAKmB,UAAL,GAAkB,IAAlB;;AAEA,UAAI,CAAC,MAAKL,YAAV,EAAwB;AACtB,cAAM,IAAIM,KAAJ,CAAU,mDAAV,CAAN;AACD;;AACD,UAAI,CAAC,MAAKpB,SAAV,EAAqB;AACnB,cAAM,IAAIoB,KAAJ,CAAU,gDAAV,CAAN;AACD;;AAED,YAAKjB,KAAL,GAAa;AACXkB,QAAAA,IAAI,EAAE,CADK;AAGXC,QAAAA,aAAa,EAAE,KAHJ;AAKXC,QAAAA,mBAAmB,EAAE,IALV;AAMXC,QAAAA,cAAc,EAAE,KANL;AAOXC,QAAAA,mBAAmB,EAAE,KAPV;AASXC,QAAAA,8BAA8B,EAAE,IATrB;AAWXC,QAAAA,UAAU,EAAE,IAXD;AAaXC,QAAAA,iBAAiB,EAAE,KAbR;AAcXC,QAAAA,eAAe,EAAE,IAdN;AAeXC,QAAAA,OAAO,EAAE,IAfE;AAiBXC,QAAAA,mBAAmB,EAAE,KAjBV;AAmBXC,QAAAA,gCAAgC,EAAE,IAnBvB;AAoBXC,QAAAA,8BAA8B,EAAE,IApBrB;AAsBX5B,QAAAA,MAAM,EAAE,IAtBG;AAwBX6B,QAAAA,uBAAuB,EAAE,IAxBd;AAyBXC,QAAAA,cAAc,EAAE,KAzBL;AA2BXC,QAAAA,qBAAqB,EAAE,IA3BZ;AA4BXC,QAAAA,UAAU,EAAE,KA5BD;AA8BXC,QAAAA,WAAW,EAAE,IA9BF;AA+BX7B,QAAAA,WAAW,EAAE,IA/BF;AAgCX8B,QAAAA,UAAU,EAAE,KAhCD;AAiCXC,QAAAA,WAAW,EAAE;AAjCF,OAAb;;AAoCA,YAAKC,aAAL;;AACA;;AApEgB;AAqEjB;;AAvFyB;AAAA;AAAA,aAyF1B,yBAAgB;AACd;AACD;AA3FyB;AAAA;AAAA,aA6F1B,qBAAY;AAAA;;AACV,YAAMC,IAAI,GAAG,IAAb;AAEA,eAAO;AAAA;AAEL;AAFK,iEAIL;AAAA;AAAA;AAAA;AAAA;AACE,kBAAA,MAAI,CAACC,YAAL;;AADF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAJK,IAQL;AAEA,oBAAM,CACJ;AACD,SAZI,EAcL;AAEA,oBAAM;AACJ,UAAA,MAAI,CAACC,WAAL;AACD,SAlBI;AAAA;AAoBL;AApBK,iEAsBL;AAAA;;AAAA;AAAA;AAAA;AAAA;AACQC,kBAAAA,iBADR,GAC4B,SAApBA,iBAAoB,CAACC,IAAD,EAAU;AAAA,sCAC8BJ,IAAI,CAACvC,KADnC;AAAA,wBAC1B4C,iCAD0B,eAC1BA,iCAD0B;AAAA,wBACS3C,gBADT,eACSA,gBADT;;AAGlC,wBAAI2C,iCAAJ,EAAuC;AACrC;AACD;;AAEDL,oBAAAA,IAAI,CAAClC,QAAL,CAAc;AACZuC,sBAAAA,iCAAiC,EAAED;AADvB,qBAAd;AAIAJ,oBAAAA,IAAI,CAAC3C,IAAL,CAAUiD,IAAV,CAAeC,IAAf,CAAoB,qBAApB,EAA2C,YAAM;AAC/CP,sBAAAA,IAAI,CAAC3C,IAAL,CAAUiD,IAAV,CAAeE,WAAf,CAA2B;AACzBC,wBAAAA,KAAK,EAAG,oBADiB;AAEzBC,wBAAAA,IAAI,EAAE;AACJlD,0BAAAA,YAAY,EAAEE,gBADV;AAEJ2C,0BAAAA,iCAAiC,EAAED;AAF/B;AAFmB,uBAA3B;AAOD,qBARD;AAUAJ,oBAAAA,IAAI,CAAC3C,IAAL,CAAUiD,IAAV,CAAeE,WAAf,CAA2B;AACzBC,sBAAAA,KAAK,EAAE,oBADkB;AAEzBC,sBAAAA,IAAI,EAAE;AACJlD,wBAAAA,YAAY,EAAGE,gBADX;AAEJ2C,wBAAAA,iCAAiC,EAAGD;AAFhC;AAFmB,qBAA3B;AAOD,mBA7BH;;AA+BUO,kBAAAA,UA/BV,GA+ByBX,IAAI,CAAC3C,IA/B9B,CA+BUsD,UA/BV;AAAA,iCAgCgDX,IAAI,CAACvC,KAhCrD,EAgCU0B,eAhCV,gBAgCUA,eAhCV,EAgC2BzB,gBAhC3B,gBAgC2BA,gBAhC3B;;AAAA,uBAkCMyB,eAlCN;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAmCUa,IAAI,CAAC1C,SAAL,CAAesD,UAAf,CAA0B;AAC9BpD,oBAAAA,YAAY,EAAEE,gBADgB;AAE9BmD,oBAAAA,MAAM,EAAEF;AAFsB,mBAA1B,CAnCV;;AAAA;AAyCQG,kBAAAA,uBAzCR;AAAA,yFAyCkC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,sDACJ,MAAI,CAACxD,SAAL,CAAeyD,YAAf,CAA4BrD,gBAA5B,CADI,EACtBsD,aADsB,yBACtBA,aADsB;AAAA;AAAA,qCAEP,MAAI,CAAC1D,SAAL,CAAe2D,aAAf,CAA6BD,aAA7B,CAFO;;AAAA;AAExBE,8BAAAA,QAFwB;;AAAA,oCAI1BA,QAAQ,CAACC,MAAT,KAAoB,CAJM;AAAA;AAAA;AAAA;;AAAA,gEAKrB,KALqB;;AAAA;AAQxBf,8BAAAA,IARwB,GAQjBc,QAAQ,CAAC,CAAD,CAAR,CAAYE,IARK;AAAA;AAAA,qCAUR,MAAI,CAAC9D,SAAL,CAAe+D,UAAf,CAA0B3D,gBAA1B,CAVQ;;AAAA;AAUxB0B,8BAAAA,OAVwB;AAYxBkC,8BAAAA,aAZwB,GAYR,IAAIpE,SAAJ,CAAckC,OAAd,EAAuBmC,sBAAvB,CAA8CZ,UAAU,CAACa,KAAX,CAAiB,GAAjB,CAA9C,CAZQ;;AAc9B,kCAAIF,aAAJ,EAAmB;AACjBtB,gCAAAA,IAAI,CAAClC,QAAL,CAAc;AACZ2D,kCAAAA,aAAa,EAAE,IAAIvE,SAAJ,CAAckC,OAAd,EAAuBsC,GAAvB,CAA2B,GAA3B,EAAgCC,EAAhC,CAAmC,CAAnC;AADH,iCAAd;AAIAxB,gCAAAA,iBAAiB,CAACC,IAAD,CAAjB;AACD;;AApB6B,gEAsBvBkB,aAtBuB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAzClC;;AAAA,oCAyCQR,uBAzCR;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAkEQ9D,IAAI,CAAC4E,OAAL,CAAaC,sBAAb;AAAA,yFAAoC,kBAAOC,UAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAChClD,8BAAAA,aADgC,GACdoB,IAAI,CAACvC,KADS,CAChCmB,aADgC;;AAAA,kCAGnCA,aAHmC;AAAA;AAAA;AAAA;;AAAA;AAAA,qCAIzBkC,uBAAuB,EAJE;;AAAA;AAAA;;AAAA;AAMtCgB,8BAAAA,UAAU;;AAN4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAApC;;AAAA;AAAA;AAAA;AAAA,sBAlER;;AAAA;AA4EUlD,kBAAAA,aA5EV,GA4E4BoB,IAAI,CAACvC,KA5EjC,CA4EUmB,aA5EV;;AA8EE,sBAAI,CAACA,aAAL,EAAoB;AAClBoB,oBAAAA,IAAI,CAAC+B,UAAL,CAAgB;AACdC,sBAAAA,mBAAmB,EAAE;AADP,qBAAhB,EAEG;AAAErD,sBAAAA,IAAI,EAAE;AAAR,qBAFH;AAGD;;AAlFH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAtBK;AAAA;AA2GL;AA3GK,iEA6GL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACQ,MAAI,CAACP,YAAL,CAAkB6D,mBAAlB,CAAsC;AAC1CjC,oBAAAA,IAAI,EAAJA,IAD0C;AAE1ChC,oBAAAA,QAAQ;AAFkC,mBAAtC,CADR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SA7GK;AAAA;AAoHL;AApHK,iEAsHL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACQgC,IAAI,CAAC5B,YAAL,CAAkB8D,mBAAlB,CAAsC;AAAElC,oBAAAA,IAAI,EAAJA;AAAF,mBAAtC,CADR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAtHK,IA0HL;AAEA,oBAAM;AACJA,UAAAA,IAAI,CAAC3C,IAAL,CAAUiD,IAAV,CAAeC,IAAf,CAAoB,eAApB,EAAqC,iBAAwC;AAAA,gBAAtCjB,gCAAsC,SAAtCA,gCAAsC;AAC3EU,YAAAA,IAAI,CAAClC,QAAL,CAAc;AACZwB,cAAAA,gCAAgC,EAAhCA;AADY,aAAd;AAGD,WAJD;AAMAU,UAAAA,IAAI,CAAC3C,IAAL,CAAUiD,IAAV,CAAeE,WAAf,CAA2B;AACzBC,YAAAA,KAAK,EAAE;AADkB,WAA3B;AAIAT,UAAAA,IAAI,CAAC+B,UAAL,CAAgB;AACdlC,YAAAA,UAAU,EAAE;AADE,WAAhB,EAEG,QAFH;AAGD,SA1II,EA4IL;AAEA,oBAAM,CAAE,CA9IH,CAAP;AAgJD;AAhPyB;AAAA;AAAA;AAAA,wFAkP1B;AAAA;AAAA;AAAA;AAAA;AACE,uBAAKkC,UAAL,CAAgB,EAAhB,EAAoB;AAAEpD,oBAAAA,IAAI,EAAE;AAAR,mBAApB;;AADF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAlP0B;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,aAkQ1B,qBAAY;AAAA;;AACV,YAAMqB,IAAI,GAAG,IAAb;AADU,2BAE2BA,IAAI,CAACvC,KAFhC;AAAA,YAEFC,gBAFE,gBAEFA,gBAFE;AAAA,YAEgBC,MAFhB,gBAEgBA,MAFhB;AAIV,eAAOqC,IAAI,CAAC1C,SAAL,CAAe6E,MAAf,CAAsB;AAC3B3E,UAAAA,YAAY,EAAEE,gBADa;AAE3BC,UAAAA,MAAM,EAAEA;AAFmB,SAAtB,EAIJC,IAJI,CAIC,UAACwE,IAAD,EAAU;AACd,cAAI,CAACA,IAAL,EAAW;AACT,mBAAO,KAAP;AACD;;AAED,UAAA,MAAI,CAAC/E,IAAL,CAAUiD,IAAV,CAAeE,WAAf,CAA2B;AACzBC,YAAAA,KAAK,EAAE;AADkB,WAA3B;;AAIAT,UAAAA,IAAI,CAAClC,QAAL,CAAc;AACZ4B,YAAAA,qBAAqB,EAAE0C,IADX;AAEZzC,YAAAA,UAAU,EAAE,IAFA;AAGZG,YAAAA,WAAW,EAAE;AAHD,WAAd,EAIG,IAJH;AAMA,iBAAO,IAAP;AACD,SApBI,WAqBE,UAACuC,KAAD,EAAW;AAChB,cAAI,mBAAmBC,IAAnB,CAAwBD,KAAxB,CAAJ,EAAoC;AAClC;AACArC,YAAAA,IAAI,CAAClC,QAAL,CAAc;AACZ6B,cAAAA,UAAU,EAAE,IADA;AAEZG,cAAAA,WAAW,EAAE;AAFD,aAAd,EAGG,IAHH;AAIA,mBAAO,IAAP;AACD,WAPD,MAOO;AACLyC,YAAAA,OAAO,CAACC,IAAR,CAAa,eAAb,EAA8BH,KAA9B;AAEA,mBAAO,KAAP;AACD;AACF,SAlCI,CAAP;AAmCD;AAzSyB;AAAA;AAAA;AAAA,wFA2S1B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,gCACgD,KAAK5E,KADrD,EACUiC,qBADV,eACUA,qBADV,EACiCC,UADjC,eACiCA,UADjC;;AAAA,wBAEMD,qBAAqB,IAAIC,UAF/B;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAGc,KAAKrC,SAAL,CAAemF,OAAf,CAAuB/C,qBAAvB,CAHd;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,oDAIa,IAJb;;AAAA;AAMM6C,kBAAAA,OAAO,CAACC,IAAR,CAAa,6CAAb;AACA,uBAAK1E,QAAL,CAAe;AACb4B,oBAAAA,qBAAqB,EAAE,IADV;AAEbC,oBAAAA,UAAU,EAAE;AAFC,mBAAf;AAPN,oDAWa,KAXb;;AAAA;AAAA,oDAcS,KAdT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SA3S0B;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oFA4T1B,kBAAkB+C,OAAlB;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,iCACiD,KAAKjF,KADtD,EACUE,MADV,gBACUA,MADV,EACkBsB,UADlB,gBACkBA,UADlB,EAC8BQ,cAD9B,gBAC8BA,cAD9B;;AAAA,sBAGOiD,OAHP;AAAA;AAAA;AAAA;;AAAA,wBAIU,IAAIhE,KAAJ,oEAJV;;AAAA;AAME,sBAAIf,MAAM,IAAIA,MAAM,IAAI+E,OAAxB,EACEH,OAAO,CAACC,IAAR;AAEF,sBAAI/C,cAAJ,EACE8C,OAAO,CAACC,IAAR;AAEF1F,kBAAAA,KAAK,CAAC,gBAAD,CAAL,mCAAmD4F,OAAnD;AAEMC,kBAAAA,WAdR,GAcsB,KAAKC,GAAL,CAASC,GAAT,CAAaC,OAAb,CAAqBC,MAArB,CAA4BC,SAA5B,CAAsCC,MAAM,CAACC,IAAP,CAAYR,OAAZ,EAAqB,KAArB,CAAtC,EAAmES,QAAnE,CAA4E,KAA5E,CAdtB;AAgBE,sBAAIlE,UAAU,IAAI0D,WAAlB,EACEJ,OAAO,CAACC,IAAR,uCAA4CvD,UAA5C,sBAAkE0D,WAAlE;AAEIjC,kBAAAA,IAnBR,GAmBe;AACX0C,oBAAAA,YAAY,EAAE,KAAKR,GAAL,CAASS,wBAAT,CAAkC,KAAKhG,IAAvC,CADH;AAEXM,oBAAAA,MAAM,EAAE+E;AAFG,mBAnBf;AAAA;AAAA,yBAwBQ,KAAKtE,YAAL,CAAkBkF,QAAlB,CAA2B5C,IAA3B,EAAiC,UAAC0B,IAAD,EAAU;AAC/CtF,oBAAAA,KAAK,CAAC,gBAAD,CAAL,mBAAmCsF,IAAnC;;AACA,oBAAA,MAAI,CAACtE,QAAL,CAAc;AACZyB,sBAAAA,8BAA8B,EAAE6C,IADpB;AAEZ5C,sBAAAA,uBAAuB,EAAE;AAFb,qBAAd;AAID,mBANK,EAMH5B,IANG,CAME,YAAM;AAEZ,oBAAA,MAAI,CAACmE,UAAL,CAAgB;AACdtC,sBAAAA,cAAc,EAAE;AADF,qBAAhB,EAEG,cAFH;AAGD,mBAXK,CAxBR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SA5T0B;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,aAS1B,mBAAiB;AACf,yBAAU,KAAK8D,WAAL,EAAV,cAAgC,KAAKC,SAAL,EAAhC;AACD;AAXyB;AAAA;AAAA,aAY1B,uBAAqB;AACnB,eAAOzG,SAAS,CAAC0G,KAAV,CAAgBC,KAAvB;AACD;AAdyB;AAAA;AAAA,aAe1B,qBAAmB;AACjB,eAAOvG,SAAS,CAACwG,WAAV,EAAP;AACD;AAjByB;;AAAA;AAAA,IAEC1G,aAFD;;AAmW5B,SAAOG,cAAP;AACD,CApWD","sourcesContent":["import debug from 'debug'\r\nimport SwapApp, { constants, util } from 'swap.app'\r\nimport { AtomicAB2UTXO } from 'swap.swap'\r\nimport { BigNumber } from 'bignumber.js'\r\n\r\n\r\nexport default (tokenName) => {\r\n\r\n  class GHOST2ETHTOKEN extends AtomicAB2UTXO {\r\n\r\n    _flowName: string\r\n    ethTokenSwap: any\r\n    ghostSwap: any\r\n    state: any\r\n\r\n    static getName() {\r\n      return `${this.getFromName()}2${this.getToName()}`\r\n    }\r\n    static getFromName() {\r\n      return constants.COINS.ghost\r\n    }\r\n    static getToName() {\r\n      return tokenName.toUpperCase()\r\n    }\r\n    constructor(swap) {\r\n      super(swap)\r\n      this.utxoCoin = `ghost`\r\n\r\n      this._flowName = GHOST2ETHTOKEN.getName()\r\n\r\n      this.stepNumbers = {\r\n        'sign': 1,\r\n        'submit-secret': 2,\r\n        'sync-balance': 3,\r\n        'lock-utxo': 4,\r\n        'wait-lock-eth': 5,\r\n        'withdraw-eth': 6,\r\n        'finish': 7,\r\n        'end': 8\r\n      }\r\n\r\n      this.ethTokenSwap = swap.ownerSwap\r\n      this.ghostSwap      = swap.participantSwap\r\n\r\n      this.abBlockchain = this.ethTokenSwap\r\n      this.utxoBlockchain = this.ghostSwap\r\n      this.isUTXOSide = true\r\n\r\n      if (!this.ethTokenSwap) {\r\n        throw new Error('GHOST2ETH: \"ethTokenSwap\" of type object required')\r\n      }\r\n      if (!this.ghostSwap) {\r\n        throw new Error('GHOST2ETH: \"ghostSwap\" of type object required')\r\n      }\r\n\r\n      this.state = {\r\n        step: 0,\r\n\r\n        isStoppedSwap: false,\r\n\r\n        signTransactionHash: null,\r\n        isSignFetching: false,\r\n        isParticipantSigned: false,\r\n\r\n        ethSwapCreationTransactionHash: null,\r\n\r\n        secretHash: null,\r\n\r\n        isBalanceFetching: false,\r\n        isBalanceEnough: true,\r\n        balance: null,\r\n\r\n        isEthContractFunded: false,\r\n\r\n        ghostSwapWithdrawTransactionHash: null,\r\n        ethSwapWithdrawTransactionHash: null,\r\n\r\n        secret: null,\r\n\r\n        canCreateEthTransaction: true,\r\n        isEthWithdrawn: false,\r\n\r\n        refundTransactionHash: null,\r\n        isRefunded: false,\r\n\r\n        withdrawFee: null,\r\n        refundTxHex: null,\r\n        isFinished: false,\r\n        isSwapExist: false,\r\n      }\r\n\r\n      this._persistState()\r\n      super._persistSteps()\r\n    }\r\n\r\n    _persistState() {\r\n      super._persistState()\r\n    }\r\n\r\n    _getSteps() {\r\n      const flow = this\r\n\r\n      return [\r\n\r\n        // 1. Signs\r\n\r\n        async () => {\r\n          this.signUTXOSide()\r\n        },\r\n\r\n        // 2. Create secret, secret hash and GHOST script\r\n\r\n        () => {\r\n          // this.submitSecret()\r\n        },\r\n\r\n        // 3. Check system wallet balance\r\n\r\n        () => {\r\n          this.syncBalance()\r\n        },\r\n\r\n        // 4. Create GHOSt Script, fund, notify participant\r\n\r\n        async () => {\r\n          const onTransactionHash = (txID) => {\r\n            const { utxoScriptCreatingTransactionHash, utxoScriptValues } = flow.state\r\n\r\n            if (utxoScriptCreatingTransactionHash) {\r\n              return\r\n            }\r\n\r\n            flow.setState({\r\n              utxoScriptCreatingTransactionHash: txID,\r\n            })\r\n\r\n            flow.swap.room.once('request utxo script', () => {\r\n              flow.swap.room.sendMessage({\r\n                event:  'create utxo script',\r\n                data: {\r\n                  scriptValues: utxoScriptValues,\r\n                  utxoScriptCreatingTransactionHash: txID,\r\n                }\r\n              })\r\n            })\r\n\r\n            flow.swap.room.sendMessage({\r\n              event: 'create utxo script',\r\n              data: {\r\n                scriptValues : utxoScriptValues,\r\n                utxoScriptCreatingTransactionHash : txID,\r\n              }\r\n            })\r\n          }\r\n\r\n          const { sellAmount } = flow.swap\r\n          const { isBalanceEnough, utxoScriptValues } = flow.state\r\n\r\n          if (isBalanceEnough) {\r\n            await flow.ghostSwap.fundScript({\r\n              scriptValues: utxoScriptValues,\r\n              amount: sellAmount,\r\n            })\r\n          }\r\n\r\n          const checkGHOSTScriptBalance = async () => {\r\n            const { scriptAddress } = this.ghostSwap.createScript(utxoScriptValues)\r\n            const unspents = await this.ghostSwap.fetchUnspents(scriptAddress)\r\n\r\n            if (unspents.length === 0) {\r\n              return false\r\n            }\r\n\r\n            const txID = unspents[0].txid\r\n\r\n            const balance = await this.ghostSwap.getBalance(utxoScriptValues)\r\n\r\n            const isEnoughMoney = new BigNumber(balance).isGreaterThanOrEqualTo(sellAmount.times(1e8))\r\n\r\n            if (isEnoughMoney) {\r\n              flow.setState({\r\n                scriptBalance: new BigNumber(balance).div(1e8).dp(8),\r\n              })\r\n\r\n              onTransactionHash(txID)\r\n            }\r\n\r\n            return isEnoughMoney\r\n          }\r\n\r\n          await util.helpers.repeatAsyncUntilResult(async (stopRepeat) => {\r\n            const { isStoppedSwap } = flow.state\r\n\r\n            if (!isStoppedSwap) {\r\n              return await checkGHOSTScriptBalance()\r\n            } else {\r\n              stopRepeat()\r\n            }\r\n          })\r\n\r\n          const { isStoppedSwap } = flow.state\r\n\r\n          if (!isStoppedSwap) {\r\n            flow.finishStep({\r\n              isGhostScriptFunded: true,\r\n            }, { step: 'lock-utxo' })\r\n          }\r\n        },\r\n\r\n        // 5. Wait participant creates ETH Contract\r\n\r\n        async () => {\r\n          await this.ethTokenSwap.waitAB2UTXOContract({\r\n            flow,\r\n            utxoCoin: `ghost`,\r\n          })\r\n        },\r\n\r\n        // 6. Withdraw\r\n\r\n        async () => {\r\n          await flow.ethTokenSwap.withdrawFromAB2UTXO({ flow })\r\n        },\r\n\r\n        // 7. Finish\r\n\r\n        () => {\r\n          flow.swap.room.once('swap finished', ({ghostSwapWithdrawTransactionHash}) => {\r\n            flow.setState({\r\n              ghostSwapWithdrawTransactionHash,\r\n            })\r\n          })\r\n\r\n          flow.swap.room.sendMessage({\r\n            event: 'request swap finished',\r\n          })\r\n\r\n          flow.finishStep({\r\n            isFinished: true,\r\n          }, 'finish')\r\n        },\r\n\r\n        // 8. Finished!\r\n\r\n        () => {}\r\n      ]\r\n    }\r\n\r\n    async skipSyncBalance() {\r\n      this.finishStep({}, { step: 'sync-balance' })\r\n    }\r\n\r\n    getRefundTxHex = () => {\r\n      this.ghostSwap.getRefundHexTransaction({\r\n        scriptValues: this.state.utxoScriptValues,\r\n        secret: this.state.secret,\r\n      })\r\n        .then((txHex) => {\r\n          this.setState({\r\n            refundTxHex: txHex,\r\n          })\r\n        })\r\n    }\r\n\r\n    tryRefund() {\r\n      const flow = this\r\n      const { utxoScriptValues, secret } = flow.state\r\n\r\n      return flow.ghostSwap.refund({\r\n        scriptValues: utxoScriptValues,\r\n        secret: secret,\r\n      })\r\n        .then((hash) => {\r\n          if (!hash) {\r\n            return false\r\n          }\r\n\r\n          this.swap.room.sendMessage({\r\n            event: 'utxo refund completed',\r\n          })\r\n\r\n          flow.setState({\r\n            refundTransactionHash: hash,\r\n            isRefunded: true,\r\n            isSwapExist: false,\r\n          }, true)\r\n\r\n          return true\r\n        })\r\n        .catch((error) => {\r\n          if (/Address is empty/.test(error)) {\r\n            // TODO - fetch TX list to script for refund TX\r\n            flow.setState({\r\n              isRefunded: true,\r\n              isSwapExist: false,\r\n            }, true)\r\n            return true\r\n          } else {\r\n            console.warn('Ghost refund:', error)\r\n\r\n            return false\r\n          }\r\n        })\r\n    }\r\n\r\n    async isRefundSuccess() {\r\n      const { refundTransactionHash, isRefunded } = this.state\r\n      if (refundTransactionHash && isRefunded) {\r\n        if (await this.ghostSwap.checkTX(refundTransactionHash)) {\r\n          return true\r\n        } else {\r\n          console.warn('GHOST2ETHTOKEN - unknown refund transaction')\r\n          this.setState( {\r\n            refundTransactionHash: null,\r\n            isRefunded: false,\r\n          } )\r\n          return false\r\n        }\r\n      }\r\n      return false\r\n    }\r\n\r\n    async tryWithdraw(_secret) {\r\n      const { secret, secretHash, isEthWithdrawn } = this.state\r\n\r\n      if (!_secret)\r\n        throw new Error(`Withdrawal is automatic. For manual withdrawal, provide a secret`)\r\n\r\n      if (secret && secret != _secret)\r\n        console.warn(`Secret already known and is different. Are you sure?`)\r\n\r\n      if (isEthWithdrawn)\r\n        console.warn(`Looks like money were already withdrawn, are you sure?`)\r\n\r\n      debug('swap.core:flow')(`WITHDRAW using secret = ${_secret}`)\r\n\r\n      const _secretHash = this.app.env.bitcoin.crypto.ripemd160(Buffer.from(_secret, 'hex')).toString('hex')\r\n\r\n      if (secretHash != _secretHash)\r\n        console.warn(`Hash does not match! state: ${secretHash}, given: ${_secretHash}`)\r\n\r\n      const data = {\r\n        ownerAddress: this.app.getParticipantEthAddress(this.swap),\r\n        secret: _secret,\r\n      }\r\n\r\n      await this.ethTokenSwap.withdraw(data, (hash) => {\r\n        debug('swap.core:flow')(`TX hash=${hash}`)\r\n        this.setState({\r\n          ethSwapWithdrawTransactionHash: hash,\r\n          canCreateEthTransaction: true,\r\n        })\r\n      }).then(() => {\r\n\r\n        this.finishStep({\r\n          isEthWithdrawn: true,\r\n        }, 'withdraw-eth')\r\n      })\r\n    }\r\n  }\r\n\r\n  return GHOST2ETHTOKEN\r\n}\r\n"]}]}