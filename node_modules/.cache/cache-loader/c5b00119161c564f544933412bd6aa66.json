{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.flows\\GHOST2ETH.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.flows\\GHOST2ETH.ts","mtime":1614842913758},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI7CmltcG9ydCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXNzZXJ0VGhpc0luaXRpYWxpemVkIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI7CmltcG9ydCBfZ2V0IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZ2V0IjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiQGJhYmVsL3J1bnRpbWUvcmVnZW5lcmF0b3IiOwoKZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH0KCmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CgppbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnOwppbXBvcnQgeyBjb25zdGFudHMsIHV0aWwgfSBmcm9tICdzd2FwLmFwcCc7CmltcG9ydCB7IEF0b21pY0FCMlVUWE8gfSBmcm9tICdzd2FwLnN3YXAnOwppbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdiaWdudW1iZXIuanMnOwoKdmFyIEdIT1NUMkVUSCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0F0b21pY0FCMlVUWE8pIHsKICBfaW5oZXJpdHMoR0hPU1QyRVRILCBfQXRvbWljQUIyVVRYTyk7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoR0hPU1QyRVRIKTsKCiAgZnVuY3Rpb24gR0hPU1QyRVRIKHN3YXApIHsKICAgIHZhciBfdGhpc1N1cGVyLCBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR0hPU1QyRVRIKTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHN3YXApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9mbG93TmFtZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2hvc3RTd2FwIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJldGhTd2FwIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGF0ZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2V0UmVmdW5kVHhIZXgiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmdob3N0U3dhcC5nZXRSZWZ1bmRIZXhUcmFuc2FjdGlvbih7CiAgICAgICAgc2NyaXB0VmFsdWVzOiBfdGhpcy5zdGF0ZS51dHhvU2NyaXB0VmFsdWVzLAogICAgICAgIHNlY3JldDogX3RoaXMuc3RhdGUuc2VjcmV0CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHR4SGV4KSB7CiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgcmVmdW5kVHhIZXg6IHR4SGV4CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMudXR4b0NvaW4gPSAiZ2hvc3QiOwogICAgX3RoaXMuX2Zsb3dOYW1lID0gR0hPU1QyRVRILmdldE5hbWUoKTsKICAgIF90aGlzLnN0ZXBOdW1iZXJzID0gewogICAgICAnc2lnbic6IDEsCiAgICAgICdzdWJtaXQtc2VjcmV0JzogMiwKICAgICAgJ3N5bmMtYmFsYW5jZSc6IDMsCiAgICAgICdsb2NrLXV0eG8nOiA0LAogICAgICAnd2FpdC1sb2NrLWV0aCc6IDUsCiAgICAgICd3aXRoZHJhdy1ldGgnOiA2LAogICAgICAnZmluaXNoJzogNywKICAgICAgJ2VuZCc6IDgKICAgIH07CiAgICBfdGhpcy5ldGhTd2FwID0gc3dhcC5vd25lclN3YXA7CiAgICBfdGhpcy5naG9zdFN3YXAgPSBzd2FwLnBhcnRpY2lwYW50U3dhcDsKICAgIF90aGlzLmFiQmxvY2tjaGFpbiA9IF90aGlzLmV0aFN3YXA7CiAgICBfdGhpcy51dHhvQmxvY2tjaGFpbiA9IF90aGlzLmdob3N0U3dhcDsKICAgIF90aGlzLmlzVVRYT1NpZGUgPSB0cnVlOwoKICAgIGlmICghX3RoaXMuZXRoU3dhcCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0dIT1NUMkVUSDogImV0aFN3YXAiIG9mIHR5cGUgb2JqZWN0IHJlcXVpcmVkJyk7CiAgICB9CgogICAgaWYgKCFfdGhpcy5naG9zdFN3YXApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdHSE9TVDJFVEg6ICJnaG9zdFN3YXAiIG9mIHR5cGUgb2JqZWN0IHJlcXVpcmVkJyk7CiAgICB9CgogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIHN0ZXA6IDAsCiAgICAgIGlzU3RvcHBlZFN3YXA6IGZhbHNlLAogICAgICBzaWduVHJhbnNhY3Rpb25IYXNoOiBudWxsLAogICAgICBpc1NpZ25GZXRjaGluZzogZmFsc2UsCiAgICAgIGlzUGFydGljaXBhbnRTaWduZWQ6IGZhbHNlLAogICAgICBldGhTd2FwQ3JlYXRpb25UcmFuc2FjdGlvbkhhc2g6IG51bGwsCiAgICAgIHNlY3JldEhhc2g6IG51bGwsCiAgICAgIGlzQmFsYW5jZUZldGNoaW5nOiBmYWxzZSwKICAgICAgaXNCYWxhbmNlRW5vdWdoOiB0cnVlLAogICAgICBiYWxhbmNlOiBudWxsLAogICAgICBpc0V0aENvbnRyYWN0RnVuZGVkOiBmYWxzZSwKICAgICAgZ2hvc3RTd2FwV2l0aGRyYXdUcmFuc2FjdGlvbkhhc2g6IG51bGwsCiAgICAgIGV0aFN3YXBXaXRoZHJhd1RyYW5zYWN0aW9uSGFzaDogbnVsbCwKICAgICAgY2FuQ3JlYXRlRXRoVHJhbnNhY3Rpb246IHRydWUsCiAgICAgIGlzRXRoV2l0aGRyYXduOiBmYWxzZSwKICAgICAgcmVmdW5kVHJhbnNhY3Rpb25IYXNoOiBudWxsLAogICAgICBpc1JlZnVuZGVkOiBmYWxzZSwKICAgICAgd2l0aGRyYXdGZWU6IG51bGwsCiAgICAgIHJlZnVuZFR4SGV4OiBudWxsLAogICAgICBpc0ZpbmlzaGVkOiBmYWxzZSwKICAgICAgaXNTd2FwRXhpc3Q6IGZhbHNlLAogICAgICByZXF1aXJlV2l0aGRyYXdGZWU6IGZhbHNlCiAgICB9OwoKICAgIF90aGlzLl9wZXJzaXN0U3RhdGUoKTsKCiAgICBfZ2V0KChfdGhpc1N1cGVyID0gX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksIF9nZXRQcm90b3R5cGVPZihHSE9TVDJFVEgucHJvdG90eXBlKSksICJfcGVyc2lzdFN0ZXBzIiwgX3RoaXNTdXBlcikuY2FsbChfdGhpc1N1cGVyKTsKCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoR0hPU1QyRVRILCBbewogICAga2V5OiAiX3BlcnNpc3RTdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3BlcnNpc3RTdGF0ZSgpIHsKICAgICAgX2dldChfZ2V0UHJvdG90eXBlT2YoR0hPU1QyRVRILnByb3RvdHlwZSksICJfcGVyc2lzdFN0YXRlIiwgdGhpcykuY2FsbCh0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0U3RlcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRTdGVwcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgZmxvdyA9IHRoaXM7CiAgICAgIHJldHVybiBbCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgLy8gMS4gU2lnbnMKICAgICAgX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX3RoaXMyLnNpZ25VVFhPU2lkZSgpOwoKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpLCAvLyAyLiBDcmVhdGUgc2VjcmV0LCBzZWNyZXQgaGFzaCBhbmQgQlRDIHNjcmlwdAogICAgICBmdW5jdGlvbiAoKSB7Ly8gdGhpcy5zdWJtaXRTZWNyZXQoKQogICAgICB9LCAvLyAzLiBDaGVjayBiYWxhbmNlCiAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIuc3luY0JhbGFuY2UoKTsKICAgICAgfSwKICAgICAgLyojX19QVVJFX18qLwogICAgICAvLyA0LiBDcmVhdGUgQlRDIFNjcmlwdCwgZnVuZCwgbm90aWZ5IHBhcnRpY2lwYW50CiAgICAgIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHZhciBvblRyYW5zYWN0aW9uSGFzaCwgc2VsbEFtb3VudCwgX2Zsb3ckc3RhdGUyLCBpc0JhbGFuY2VFbm91Z2gsIHV0eG9TY3JpcHRWYWx1ZXMsIGNoZWNrR0hPU1RTY3JpcHRCYWxhbmNlLCBpc1N0b3BwZWRTd2FwOwoKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG9uVHJhbnNhY3Rpb25IYXNoID0gZnVuY3Rpb24gb25UcmFuc2FjdGlvbkhhc2godHhJRCkgewogICAgICAgICAgICAgICAgICB2YXIgX2Zsb3ckc3RhdGUgPSBmbG93LnN0YXRlLAogICAgICAgICAgICAgICAgICAgICAgdXR4b1NjcmlwdENyZWF0aW5nVHJhbnNhY3Rpb25IYXNoID0gX2Zsb3ckc3RhdGUudXR4b1NjcmlwdENyZWF0aW5nVHJhbnNhY3Rpb25IYXNoLAogICAgICAgICAgICAgICAgICAgICAgdXR4b1NjcmlwdFZhbHVlcyA9IF9mbG93JHN0YXRlLnV0eG9TY3JpcHRWYWx1ZXM7CgogICAgICAgICAgICAgICAgICBpZiAodXR4b1NjcmlwdENyZWF0aW5nVHJhbnNhY3Rpb25IYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBmbG93LnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICB1dHhvU2NyaXB0Q3JlYXRpbmdUcmFuc2FjdGlvbkhhc2g6IHR4SUQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGZsb3cuc3dhcC5yb29tLm9uY2UoJ3JlcXVlc3QgdXR4byBzY3JpcHQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgZmxvdy5zd2FwLnJvb20uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6ICdjcmVhdGUgdXR4byBzY3JpcHQnLAogICAgICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRWYWx1ZXM6IHV0eG9TY3JpcHRWYWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIHV0eG9TY3JpcHRDcmVhdGluZ1RyYW5zYWN0aW9uSGFzaDogdHhJRAogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgZmxvdy5zd2FwLnJvb20uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgIGV2ZW50OiAnY3JlYXRlIHV0eG8gc2NyaXB0JywKICAgICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRWYWx1ZXM6IHV0eG9TY3JpcHRWYWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgICB1dHhvU2NyaXB0Q3JlYXRpbmdUcmFuc2FjdGlvbkhhc2g6IHR4SUQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBzZWxsQW1vdW50ID0gZmxvdy5zd2FwLnNlbGxBbW91bnQ7CiAgICAgICAgICAgICAgICBfZmxvdyRzdGF0ZTIgPSBmbG93LnN0YXRlLCBpc0JhbGFuY2VFbm91Z2ggPSBfZmxvdyRzdGF0ZTIuaXNCYWxhbmNlRW5vdWdoLCB1dHhvU2NyaXB0VmFsdWVzID0gX2Zsb3ckc3RhdGUyLnV0eG9TY3JpcHRWYWx1ZXM7CgogICAgICAgICAgICAgICAgaWYgKCFpc0JhbGFuY2VFbm91Z2gpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICByZXR1cm4gZmxvdy5naG9zdFN3YXAuZnVuZFNjcmlwdCh7CiAgICAgICAgICAgICAgICAgIHNjcmlwdFZhbHVlczogdXR4b1NjcmlwdFZhbHVlcywKICAgICAgICAgICAgICAgICAgYW1vdW50OiBzZWxsQW1vdW50CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgY2hlY2tHSE9TVFNjcmlwdEJhbGFuY2UgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB2YXIgX3JlZjMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMyJGdob3N0U3dhcCRjcmVhLCBzY3JpcHRBZGRyZXNzLCB1bnNwZW50cywgdHhJRCwgYmFsYW5jZSwgaXNFbm91Z2hNb25leTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIkZ2hvc3RTd2FwJGNyZWEgPSBfdGhpczIuZ2hvc3RTd2FwLmNyZWF0ZVNjcmlwdCh1dHhvU2NyaXB0VmFsdWVzKSwgc2NyaXB0QWRkcmVzcyA9IF90aGlzMiRnaG9zdFN3YXAkY3JlYS5zY3JpcHRBZGRyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5naG9zdFN3YXAuZmV0Y2hVbnNwZW50cyhzY3JpcHRBZGRyZXNzKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zcGVudHMgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISh1bnNwZW50cy5sZW5ndGggPT09IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHhJRCA9IHVuc3BlbnRzWzBdLnR4aWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyLmdob3N0U3dhcC5nZXRCYWxhbmNlKHV0eG9TY3JpcHRWYWx1ZXMpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWxhbmNlID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0Vub3VnaE1vbmV5ID0gbmV3IEJpZ051bWJlcihiYWxhbmNlKS5pc0dyZWF0ZXJUaGFuT3JFcXVhbFRvKHNlbGxBbW91bnQudGltZXMoMWU4KSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRW5vdWdoTW9uZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvdy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0QmFsYW5jZTogbmV3IEJpZ051bWJlcihiYWxhbmNlKS5kaXYoMWU4KS5kcCg4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25UcmFuc2FjdGlvbkhhc2godHhJRCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGlzRW5vdWdoTW9uZXkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGNoZWNrR0hPU1RTY3JpcHRCYWxhbmNlKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpOwoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIHJldHVybiB1dGlsLmhlbHBlcnMucmVwZWF0QXN5bmNVbnRpbFJlc3VsdCggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZWY0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoc3RvcFJlcGVhdCkgewogICAgICAgICAgICAgICAgICAgIHZhciBpc1N0b3BwZWRTd2FwOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNTdG9wcGVkU3dhcCA9IGZsb3cuc3RhdGUuaXNTdG9wcGVkU3dhcDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNTdG9wcGVkU3dhcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjaGVja0dIT1NUU2NyaXB0QmFsYW5jZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQzLnNlbnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wUmVwZWF0KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZjQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0oKSk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIGlzU3RvcHBlZFN3YXAgPSBmbG93LnN0YXRlLmlzU3RvcHBlZFN3YXA7CgogICAgICAgICAgICAgICAgaWYgKCFpc1N0b3BwZWRTd2FwKSB7CiAgICAgICAgICAgICAgICAgIGZsb3cuZmluaXNoU3RlcCh7CiAgICAgICAgICAgICAgICAgICAgaXNHaG9zdFNjcmlwdEZ1bmRlZDogdHJ1ZQogICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgc3RlcDogJ2xvY2stdXR4bycKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQpOwogICAgICB9KSksCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgLy8gNS4gV2FpdCBwYXJ0aWNpcGFudCBjcmVhdGVzIEVUSCBDb250cmFjdAogICAgICBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiBmbG93LmV0aFN3YXAud2FpdEFCMlVUWE9Db250cmFjdCh7CiAgICAgICAgICAgICAgICAgIGZsb3c6IGZsb3csCiAgICAgICAgICAgICAgICAgIHV0eG9Db2luOiAiZ2hvc3QiCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1KTsKICAgICAgfSkpLAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIC8vIDYuIFdpdGhkcmF3CiAgICAgIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIGZsb3cuZXRoU3dhcC53aXRoZHJhd0Zyb21BQjJVVFhPKHsKICAgICAgICAgICAgICAgICAgZmxvdzogZmxvdwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNik7CiAgICAgIH0pKSwgLy8gNy4gRmluaXNoCiAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICBmbG93LnN3YXAucm9vbS5vbmNlKCdzd2FwIGZpbmlzaGVkJywgZnVuY3Rpb24gKF9yZWY3KSB7CiAgICAgICAgICB2YXIgYnRjU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoID0gX3JlZjcuYnRjU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoOwogICAgICAgICAgZmxvdy5zZXRTdGF0ZSh7CiAgICAgICAgICAgIGJ0Y1N3YXBXaXRoZHJhd1RyYW5zYWN0aW9uSGFzaDogYnRjU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBmbG93LnN3YXAucm9vbS5zZW5kTWVzc2FnZSh7CiAgICAgICAgICBldmVudDogJ3JlcXVlc3Qgc3dhcCBmaW5pc2hlZCcKICAgICAgICB9KTsKICAgICAgICBmbG93LmZpbmlzaFN0ZXAoewogICAgICAgICAgaXNGaW5pc2hlZDogdHJ1ZQogICAgICAgIH0sICdmaW5pc2gnKTsKICAgICAgfSwgLy8gOC4gRmluaXNoZWQhCiAgICAgIGZ1bmN0aW9uICgpIHt9XTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJza2lwU3luY0JhbGFuY2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9za2lwU3luY0JhbGFuY2UgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNygpIHsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoU3RlcCh7fSwgewogICAgICAgICAgICAgICAgICBzdGVwOiAnc3luYy1iYWxhbmNlJwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHNraXBTeW5jQmFsYW5jZSgpIHsKICAgICAgICByZXR1cm4gX3NraXBTeW5jQmFsYW5jZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gc2tpcFN5bmNCYWxhbmNlOwogICAgfSgpCiAgfSwgewogICAga2V5OiAidHJ5UmVmdW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0cnlSZWZ1bmQoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIGZsb3cgPSB0aGlzOwogICAgICB2YXIgX2Zsb3ckc3RhdGUzID0gZmxvdy5zdGF0ZSwKICAgICAgICAgIHV0eG9TY3JpcHRWYWx1ZXMgPSBfZmxvdyRzdGF0ZTMudXR4b1NjcmlwdFZhbHVlcywKICAgICAgICAgIHNlY3JldCA9IF9mbG93JHN0YXRlMy5zZWNyZXQ7CiAgICAgIHJldHVybiBmbG93Lmdob3N0U3dhcC5yZWZ1bmQoewogICAgICAgIHNjcmlwdFZhbHVlczogdXR4b1NjcmlwdFZhbHVlcywKICAgICAgICBzZWNyZXQ6IHNlY3JldAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChoYXNoKSB7CiAgICAgICAgaWYgKCFoYXNoKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBfdGhpczMuc3dhcC5yb29tLnNlbmRNZXNzYWdlKHsKICAgICAgICAgIGV2ZW50OiAndXR4byByZWZ1bmQgY29tcGxldGVkJwogICAgICAgIH0pOwoKICAgICAgICBmbG93LnNldFN0YXRlKHsKICAgICAgICAgIHJlZnVuZFRyYW5zYWN0aW9uSGFzaDogaGFzaCwKICAgICAgICAgIGlzUmVmdW5kZWQ6IHRydWUsCiAgICAgICAgICBpc1N3YXBFeGlzdDogZmFsc2UKICAgICAgICB9LCB0cnVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgaWYgKC9BZGRyZXNzIGlzIGVtcHR5Ly50ZXN0KGVycm9yKSkgewogICAgICAgICAgLy8gVE9ETyAtIGZldGNoIFRYIGxpc3QgdG8gc2NyaXB0IGZvciByZWZ1bmQgVFgKICAgICAgICAgIGZsb3cuc2V0U3RhdGUoewogICAgICAgICAgICBpc1JlZnVuZGVkOiB0cnVlLAogICAgICAgICAgICBpc1N3YXBFeGlzdDogZmFsc2UKICAgICAgICAgIH0sIHRydWUpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUud2FybignR2hvc3QgcmVmdW5kOicsIGVycm9yKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImlzUmVmdW5kU3VjY2VzcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2lzUmVmdW5kU3VjY2VzcyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KCkgewogICAgICAgIHZhciBfdGhpcyRzdGF0ZSwgcmVmdW5kVHJhbnNhY3Rpb25IYXNoLCBpc1JlZnVuZGVkOwoKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU4JChfY29udGV4dDgpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzJHN0YXRlID0gdGhpcy5zdGF0ZSwgcmVmdW5kVHJhbnNhY3Rpb25IYXNoID0gX3RoaXMkc3RhdGUucmVmdW5kVHJhbnNhY3Rpb25IYXNoLCBpc1JlZnVuZGVkID0gX3RoaXMkc3RhdGUuaXNSZWZ1bmRlZDsKCiAgICAgICAgICAgICAgICBpZiAoIShyZWZ1bmRUcmFuc2FjdGlvbkhhc2ggJiYgaXNSZWZ1bmRlZCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2hvc3RTd2FwLmNoZWNrVFgocmVmdW5kVHJhbnNhY3Rpb25IYXNoKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDguc2VudCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCB0cnVlKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdHSE9TVDJFVEggLSB1bmtub3duIHJlZnVuZCB0cmFuc2FjdGlvbicpOwogICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIHJlZnVuZFRyYW5zYWN0aW9uSGFzaDogbnVsbCwKICAgICAgICAgICAgICAgICAgaXNSZWZ1bmRlZDogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCBmYWxzZSk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTgsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBpc1JlZnVuZFN1Y2Nlc3MoKSB7CiAgICAgICAgcmV0dXJuIF9pc1JlZnVuZFN1Y2Nlc3MuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGlzUmVmdW5kU3VjY2VzczsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInRyeVdpdGhkcmF3IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdHJ5V2l0aGRyYXcgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOShfc2VjcmV0KSB7CiAgICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICAgIHZhciBfdGhpcyRzdGF0ZTIsIHNlY3JldCwgc2VjcmV0SGFzaCwgaXNFdGhXaXRoZHJhd24sIF9zZWNyZXRIYXNoLCBkYXRhOwoKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzJHN0YXRlMiA9IHRoaXMuc3RhdGUsIHNlY3JldCA9IF90aGlzJHN0YXRlMi5zZWNyZXQsIHNlY3JldEhhc2ggPSBfdGhpcyRzdGF0ZTIuc2VjcmV0SGFzaCwgaXNFdGhXaXRoZHJhd24gPSBfdGhpcyRzdGF0ZTIuaXNFdGhXaXRoZHJhd247CgogICAgICAgICAgICAgICAgaWYgKF9zZWNyZXQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldpdGhkcmF3YWwgaXMgYXV0b21hdGljLiBGb3IgbWFudWFsIHdpdGhkcmF3YWwsIHByb3ZpZGUgYSBzZWNyZXQiKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaWYgKHNlY3JldCAmJiBzZWNyZXQgIT0gX3NlY3JldCkgY29uc29sZS53YXJuKCJTZWNyZXQgYWxyZWFkeSBrbm93biBhbmQgaXMgZGlmZmVyZW50LiBBcmUgeW91IHN1cmU/Iik7CiAgICAgICAgICAgICAgICBpZiAoaXNFdGhXaXRoZHJhd24pIGNvbnNvbGUud2FybigiTG9va3MgbGlrZSBtb25leSB3ZXJlIGFscmVhZHkgd2l0aGRyYXduLCBhcmUgeW91IHN1cmU/Iik7CiAgICAgICAgICAgICAgICBkZWJ1Zygnc3dhcC5jb3JlOmZsb3cnKSgiV0lUSERSQVcgdXNpbmcgc2VjcmV0ID0gIi5jb25jYXQoX3NlY3JldCkpOwogICAgICAgICAgICAgICAgX3NlY3JldEhhc2ggPSB0aGlzLmFwcC5lbnYuYml0Y29pbi5jcnlwdG8ucmlwZW1kMTYwKEJ1ZmZlci5mcm9tKF9zZWNyZXQsICdoZXgnKSkudG9TdHJpbmcoJ2hleCcpOwogICAgICAgICAgICAgICAgaWYgKHNlY3JldEhhc2ggIT0gX3NlY3JldEhhc2gpIGNvbnNvbGUud2FybigiSGFzaCBkb2VzIG5vdCBtYXRjaCEgc3RhdGU6ICIuY29uY2F0KHNlY3JldEhhc2gsICIsIGdpdmVuOiAiKS5jb25jYXQoX3NlY3JldEhhc2gpKTsKICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgIG93bmVyQWRkcmVzczogdGhpcy5hcHAuZ2V0UGFydGljaXBhbnRFdGhBZGRyZXNzKHRoaXMuc3dhcCksCiAgICAgICAgICAgICAgICAgIHNlY3JldDogX3NlY3JldAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ldGhTd2FwLndpdGhkcmF3KGRhdGEsIGZ1bmN0aW9uIChoYXNoKSB7CiAgICAgICAgICAgICAgICAgIGRlYnVnKCdzd2FwLmNvcmU6ZmxvdycpKCJUWCBoYXNoPSIuY29uY2F0KGhhc2gpKTsKCiAgICAgICAgICAgICAgICAgIF90aGlzNC5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgZXRoU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoOiBoYXNoLAogICAgICAgICAgICAgICAgICAgIGNhbkNyZWF0ZUV0aFRyYW5zYWN0aW9uOiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNC5maW5pc2hTdGVwKHsKICAgICAgICAgICAgICAgICAgICBpc0V0aFdpdGhkcmF3bjogdHJ1ZQogICAgICAgICAgICAgICAgICB9LCAnd2l0aGRyYXctZXRoJyk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHRyeVdpdGhkcmF3KF94MikgewogICAgICAgIHJldHVybiBfdHJ5V2l0aGRyYXcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRyeVdpdGhkcmF3OwogICAgfSgpCiAgfV0sIFt7CiAgICBrZXk6ICJnZXROYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXROYW1lKCkgewogICAgICByZXR1cm4gIiIuY29uY2F0KHRoaXMuZ2V0RnJvbU5hbWUoKSwgIjIiKS5jb25jYXQodGhpcy5nZXRUb05hbWUoKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RnJvbU5hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZyb21OYW1lKCkgewogICAgICByZXR1cm4gY29uc3RhbnRzLkNPSU5TLmdob3N0OwogICAgfQogIH0sIHsKICAgIGtleTogImdldFRvTmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VG9OYW1lKCkgewogICAgICByZXR1cm4gY29uc3RhbnRzLkNPSU5TLmV0aDsKICAgIH0KICB9XSk7CgogIHJldHVybiBHSE9TVDJFVEg7Cn0oQXRvbWljQUIyVVRYTyk7CgpleHBvcnQgZGVmYXVsdCBHSE9TVDJFVEg7"},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/core/swap.flows/GHOST2ETH.ts"],"names":["debug","constants","util","AtomicAB2UTXO","BigNumber","GHOST2ETH","swap","ghostSwap","getRefundHexTransaction","scriptValues","state","utxoScriptValues","secret","then","txHex","setState","refundTxHex","utxoCoin","_flowName","getName","stepNumbers","ethSwap","ownerSwap","participantSwap","abBlockchain","utxoBlockchain","isUTXOSide","Error","step","isStoppedSwap","signTransactionHash","isSignFetching","isParticipantSigned","ethSwapCreationTransactionHash","secretHash","isBalanceFetching","isBalanceEnough","balance","isEthContractFunded","ghostSwapWithdrawTransactionHash","ethSwapWithdrawTransactionHash","canCreateEthTransaction","isEthWithdrawn","refundTransactionHash","isRefunded","withdrawFee","isFinished","isSwapExist","requireWithdrawFee","_persistState","flow","signUTXOSide","syncBalance","onTransactionHash","txID","utxoScriptCreatingTransactionHash","room","once","sendMessage","event","data","sellAmount","fundScript","amount","checkGHOSTScriptBalance","createScript","scriptAddress","fetchUnspents","unspents","length","txid","getBalance","isEnoughMoney","isGreaterThanOrEqualTo","times","scriptBalance","div","dp","helpers","repeatAsyncUntilResult","stopRepeat","finishStep","isGhostScriptFunded","waitAB2UTXOContract","withdrawFromAB2UTXO","btcSwapWithdrawTransactionHash","refund","hash","error","test","console","warn","checkTX","_secret","_secretHash","app","env","bitcoin","crypto","ripemd160","Buffer","from","toString","ownerAddress","getParticipantEthAddress","withdraw","getFromName","getToName","COINS","ghost","eth"],"mappings":"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","sourcesContent":["import debug from 'debug'\r\nimport SwapApp, { constants, util } from 'swap.app'\r\nimport { AtomicAB2UTXO } from 'swap.swap'\r\nimport { BigNumber } from 'bignumber.js'\r\n\r\n\r\nclass GHOST2ETH extends AtomicAB2UTXO {\r\n\r\n  _flowName: string\r\n  ghostSwap: any\r\n  ethSwap: any\r\n  state: any\r\n\r\n  static getName() {\r\n    return `${this.getFromName()}2${this.getToName()}`\r\n  }\r\n  static getFromName() {\r\n    return constants.COINS.ghost\r\n  }\r\n  static getToName() {\r\n    return constants.COINS.eth\r\n  }\r\n\r\n  constructor(swap) {\r\n    super(swap)\r\n    this.utxoCoin = `ghost`\r\n\r\n    this._flowName = GHOST2ETH.getName()\r\n\r\n    this.stepNumbers = {\r\n      'sign': 1,\r\n      'submit-secret': 2,\r\n      'sync-balance': 3,\r\n      'lock-utxo': 4,\r\n      'wait-lock-eth': 5,\r\n      'withdraw-eth': 6,\r\n      'finish': 7,\r\n      'end': 8\r\n    }\r\n\r\n    this.ethSwap = swap.ownerSwap\r\n    this.ghostSwap = swap.participantSwap\r\n\r\n    this.abBlockchain = this.ethSwap\r\n    this.utxoBlockchain = this.ghostSwap\r\n    this.isUTXOSide = true\r\n\r\n    if (!this.ethSwap) {\r\n      throw new Error('GHOST2ETH: \"ethSwap\" of type object required')\r\n    }\r\n    if (!this.ghostSwap) {\r\n      throw new Error('GHOST2ETH: \"ghostSwap\" of type object required')\r\n    }\r\n\r\n    this.state = {\r\n      step: 0,\r\n\r\n      isStoppedSwap: false,\r\n\r\n      signTransactionHash: null,\r\n      isSignFetching: false,\r\n      isParticipantSigned: false,\r\n\r\n      ethSwapCreationTransactionHash: null,\r\n\r\n      secretHash: null,\r\n\r\n      isBalanceFetching: false,\r\n      isBalanceEnough: true,\r\n      balance: null,\r\n\r\n      isEthContractFunded: false,\r\n\r\n      ghostSwapWithdrawTransactionHash: null,\r\n      ethSwapWithdrawTransactionHash: null,\r\n\r\n      canCreateEthTransaction: true,\r\n      isEthWithdrawn: false,\r\n\r\n      refundTransactionHash: null,\r\n      isRefunded: false,\r\n\r\n      withdrawFee: null,\r\n      refundTxHex: null,\r\n      isFinished: false,\r\n      isSwapExist: false,\r\n\r\n      requireWithdrawFee: false,\r\n    }\r\n\r\n    this._persistState()\r\n    super._persistSteps()\r\n  }\r\n\r\n  _persistState() {\r\n    super._persistState()\r\n  }\r\n\r\n  _getSteps() {\r\n    const flow = this\r\n\r\n    return [\r\n\r\n      // 1. Signs\r\n\r\n      async () => {\r\n        this.signUTXOSide()\r\n      },\r\n\r\n      // 2. Create secret, secret hash and BTC script\r\n\r\n      () => {\r\n        // this.submitSecret()\r\n      },\r\n\r\n      // 3. Check balance\r\n\r\n      () => {\r\n        this.syncBalance()\r\n      },\r\n\r\n      // 4. Create BTC Script, fund, notify participant\r\n\r\n      async () => {\r\n        const onTransactionHash = (txID) => {\r\n          const { utxoScriptCreatingTransactionHash, utxoScriptValues } = flow.state\r\n\r\n          if (utxoScriptCreatingTransactionHash) {\r\n            return\r\n          }\r\n\r\n          flow.setState({\r\n            utxoScriptCreatingTransactionHash: txID,\r\n          })\r\n\r\n          flow.swap.room.once('request utxo script', () => {\r\n            flow.swap.room.sendMessage({\r\n              event:  'create utxo script',\r\n              data: {\r\n                scriptValues: utxoScriptValues,\r\n                utxoScriptCreatingTransactionHash: txID,\r\n              }\r\n            })\r\n          })\r\n\r\n          flow.swap.room.sendMessage({\r\n            event: 'create utxo script',\r\n            data: {\r\n              scriptValues : utxoScriptValues,\r\n              utxoScriptCreatingTransactionHash : txID,\r\n            }\r\n          })\r\n        }\r\n\r\n        const { sellAmount } = flow.swap\r\n        const { isBalanceEnough, utxoScriptValues } = flow.state\r\n\r\n        if (isBalanceEnough) {\r\n          await flow.ghostSwap.fundScript({\r\n            scriptValues: utxoScriptValues,\r\n            amount: sellAmount,\r\n          })\r\n        }\r\n\r\n        const checkGHOSTScriptBalance = async () => {\r\n          const { scriptAddress } = this.ghostSwap.createScript(utxoScriptValues)\r\n          const unspents = await this.ghostSwap.fetchUnspents(scriptAddress)\r\n\r\n          if (unspents.length === 0) {\r\n            return false\r\n          }\r\n\r\n          const txID = unspents[0].txid\r\n\r\n          const balance = await this.ghostSwap.getBalance(utxoScriptValues)\r\n\r\n          const isEnoughMoney = new BigNumber(balance).isGreaterThanOrEqualTo(sellAmount.times(1e8))\r\n\r\n          if (isEnoughMoney) {\r\n            flow.setState({\r\n              scriptBalance: new BigNumber(balance).div(1e8).dp(8),\r\n            })\r\n\r\n            onTransactionHash(txID)\r\n          }\r\n\r\n          return isEnoughMoney\r\n        }\r\n\r\n        await util.helpers.repeatAsyncUntilResult(async (stopRepeat) => {\r\n          const { isStoppedSwap } = flow.state\r\n\r\n          if (!isStoppedSwap) {\r\n            return await checkGHOSTScriptBalance()\r\n          } else {\r\n            stopRepeat()\r\n          }\r\n        })\r\n\r\n        const { isStoppedSwap } = flow.state\r\n\r\n        if (!isStoppedSwap) {\r\n          flow.finishStep({\r\n            isGhostScriptFunded: true,\r\n          }, { step: 'lock-utxo' })\r\n        }\r\n      },\r\n\r\n      // 5. Wait participant creates ETH Contract\r\n\r\n      async () => {\r\n        await flow.ethSwap.waitAB2UTXOContract({\r\n          flow,\r\n          utxoCoin: `ghost`,\r\n        })\r\n      },\r\n\r\n      // 6. Withdraw\r\n\r\n      async () => {\r\n        await flow.ethSwap.withdrawFromAB2UTXO({ flow })\r\n      },\r\n\r\n      // 7. Finish\r\n\r\n      () => {\r\n        flow.swap.room.once('swap finished', ({btcSwapWithdrawTransactionHash}) => {\r\n          flow.setState({\r\n            btcSwapWithdrawTransactionHash,\r\n          })\r\n        })\r\n\r\n        flow.swap.room.sendMessage({\r\n          event: 'request swap finished',\r\n        })\r\n\r\n        flow.finishStep({\r\n          isFinished: true,\r\n        }, 'finish')\r\n      },\r\n\r\n      // 8. Finished!\r\n\r\n      () => {}\r\n    ]\r\n  }\r\n\r\n  async skipSyncBalance() {\r\n    this.finishStep({}, { step: 'sync-balance' })\r\n  }\r\n\r\n  getRefundTxHex = () => {\r\n    this.ghostSwap.getRefundHexTransaction({\r\n      scriptValues: this.state.utxoScriptValues,\r\n      secret: this.state.secret,\r\n    })\r\n      .then((txHex) => {\r\n        this.setState({\r\n          refundTxHex: txHex,\r\n        })\r\n      })\r\n  }\r\n\r\n  tryRefund() {\r\n    const flow = this\r\n    const { utxoScriptValues, secret } = flow.state\r\n\r\n    return flow.ghostSwap.refund({\r\n      scriptValues: utxoScriptValues,\r\n      secret: secret,\r\n    })\r\n      .then((hash) => {\r\n        if (!hash) {\r\n          return false\r\n        }\r\n\r\n        this.swap.room.sendMessage({\r\n          event: 'utxo refund completed',\r\n        })\r\n\r\n        flow.setState({\r\n          refundTransactionHash: hash,\r\n          isRefunded: true,\r\n          isSwapExist: false,\r\n        }, true)\r\n\r\n        return true\r\n      })\r\n      .catch((error) => {\r\n        if (/Address is empty/.test(error)) {\r\n          // TODO - fetch TX list to script for refund TX\r\n          flow.setState({\r\n            isRefunded: true,\r\n            isSwapExist: false,\r\n          }, true)\r\n          return true\r\n        } else {\r\n          console.warn('Ghost refund:', error)\r\n\r\n          return false\r\n        }\r\n      })\r\n  }\r\n\r\n  async isRefundSuccess() {\r\n    const { refundTransactionHash, isRefunded } = this.state\r\n    if (refundTransactionHash && isRefunded) {\r\n      if (await this.ghostSwap.checkTX(refundTransactionHash)) {\r\n        return true\r\n      } else {\r\n        console.warn('GHOST2ETH - unknown refund transaction')\r\n        this.setState( {\r\n          refundTransactionHash: null,\r\n          isRefunded: false,\r\n        } )\r\n        return false\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  async tryWithdraw(_secret) {\r\n    const { secret, secretHash, isEthWithdrawn } = this.state\r\n\r\n    if (!_secret)\r\n      throw new Error(`Withdrawal is automatic. For manual withdrawal, provide a secret`)\r\n\r\n    if (secret && secret != _secret)\r\n      console.warn(`Secret already known and is different. Are you sure?`)\r\n\r\n    if (isEthWithdrawn)\r\n      console.warn(`Looks like money were already withdrawn, are you sure?`)\r\n\r\n    debug('swap.core:flow')(`WITHDRAW using secret = ${_secret}`)\r\n\r\n    const _secretHash = this.app.env.bitcoin.crypto.ripemd160(Buffer.from(_secret, 'hex')).toString('hex')\r\n\r\n    if (secretHash != _secretHash)\r\n      console.warn(`Hash does not match! state: ${secretHash}, given: ${_secretHash}`)\r\n\r\n    const data = {\r\n      ownerAddress: this.app.getParticipantEthAddress(this.swap),\r\n      secret: _secret,\r\n    }\r\n\r\n    await this.ethSwap.withdraw(data, (hash) => {\r\n      debug('swap.core:flow')(`TX hash=${hash}`)\r\n      this.setState({\r\n        ethSwapWithdrawTransactionHash: hash,\r\n        canCreateEthTransaction: true,\r\n      })\r\n    }).then(() => {\r\n\r\n      this.finishStep({\r\n        isEthWithdrawn: true,\r\n      }, 'withdraw-eth')\r\n    })\r\n  }\r\n}\r\n\r\nexport default GHOST2ETH\r\n"]}]}