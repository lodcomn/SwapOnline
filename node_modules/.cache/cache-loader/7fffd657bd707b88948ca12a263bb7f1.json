{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.orders\\SwapOrders.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.orders\\SwapOrders.ts","mtime":1614850242100},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOwppbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5IjsKCmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CgpmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOyBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkgcmV0dXJuIGZhbHNlOyBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTsgdHJ5IHsgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKLy8gQHRzLW5vY2hlY2sKaW1wb3J0IGRlYnVnIGZyb20gJ2RlYnVnJzsKaW1wb3J0IEJpZ051bWJlciBmcm9tICdiaWdudW1iZXIuanMnOwppbXBvcnQgeyBDb2xsZWN0aW9uLCBTZXJ2aWNlSW50ZXJmYWNlLCB1dGlsLCBjb25zdGFudHMgfSBmcm9tICdzd2FwLmFwcCc7CmltcG9ydCBTd2FwUm9vbSBmcm9tICdzd2FwLnJvb20nOwppbXBvcnQgYWdncmVnYXRpb24gZnJvbSAnLi9hZ2dyZWdhdGlvbic7CmltcG9ydCBldmVudHMgZnJvbSAnLi9ldmVudHMnOwppbXBvcnQgT3JkZXIgZnJvbSAnLi9PcmRlcic7CmltcG9ydCB2aXNpYmxlTWFrZXJzIGZyb20gJ2NvbW1vbi93aGl0ZWxpc3RzL3Zpc2libGVNYWtlcnMnOwoKdmFyIGNoZWNrSW5jb21lT3JkZXJGb3JtYXQgPSBmdW5jdGlvbiBjaGVja0luY29tZU9yZGVyRm9ybWF0KG9yZGVyKSB7CiAgLy8gU2tpcCB1bmtub3duIGN1cnJlbmNpZXMKICBpZiAob3JkZXIgJiYgb3JkZXIuYnV5Q3VycmVuY3kgJiYgIXV0aWwudHlwZWZvcmNlLmlzQ29pbk5hbWUob3JkZXIuYnV5Q3VycmVuY3kpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBpZiAob3JkZXIgJiYgb3JkZXIuc2VsbEN1cnJlbmN5ICYmICF1dGlsLnR5cGVmb3JjZS5pc0NvaW5OYW1lKG9yZGVyLnNlbGxDdXJyZW5jeSkpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHZhciBmb3JtYXQgPSB7CiAgICBpZDogJz9TdHJpbmcnLAogICAgb3duZXI6IF9vYmplY3RTcHJlYWQoewogICAgICBwZWVyOiAnU3RyaW5nJywKICAgICAgcmVwdXRhdGlvbjogdXRpbC50eXBlZm9yY2UudC5tYXliZSh1dGlsLnR5cGVmb3JjZS5pc051bWVyaWMpCiAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciByZXN1bHQgPSB7fTsKICAgICAgT2JqZWN0LmtleXMoY29uc3RhbnRzLkNPSU5TKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICByZXN1bHRba2V5XSA9IHV0aWwudHlwZWZvcmNlLnQubWF5YmUoewogICAgICAgICAgYWRkcmVzczogdXRpbC50eXBlZm9yY2UuaXNDb2luQWRkcmVzc1tjb25zdGFudHMuQ09JTlNba2V5XV0sCiAgICAgICAgICBwdWJsaWNLZXk6IHV0aWwudHlwZWZvcmNlLmlzUHVibGljS2V5W2NvbnN0YW50cy5DT0lOU1trZXldXQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0oKSksCiAgICBzZWxsQ3VycmVuY3k6IHV0aWwudHlwZWZvcmNlLmlzQ29pbk5hbWUsCiAgICBzZWxsQW1vdW50OiB1dGlsLnR5cGVmb3JjZS5pc051bWVyaWMsCiAgICBidXlDdXJyZW5jeTogdXRpbC50eXBlZm9yY2UuaXNDb2luTmFtZSwKICAgIGJ1eUFtb3VudDogdXRpbC50eXBlZm9yY2UuaXNOdW1lcmljLAogICAgZXhjaGFuZ2VSYXRlOiB1dGlsLnR5cGVmb3JjZS50Lm1heWJlKHV0aWwudHlwZWZvcmNlLmlzTnVtZXJpYyksCiAgICBpc1Byb2Nlc3Npbmc6ICc/Qm9vbGVhbicsCiAgICBpc1JlcXVlc3RlZDogJz9Cb29sZWFuJywKICAgIGlzUGFydGlhbDogJz9Cb29sZWFuJywKICAgIGlzVHVyYm86ICc/Qm9vbGVhbicsCiAgICBpc0hpZGRlbjogJz9Cb29sZWFuJywKICAgIGRlc3RpbmF0aW9uOiB1dGlsLnR5cGVmb3JjZS50Lm1heWJlKHsKICAgICAgb3duZXJBZGRyZXNzOiAnP1N0cmluZycsCiAgICAgIHBhcnRpY2lwYW50QWRkcmVzczogJz9TdHJpbmcnCiAgICB9KQogIH07CiAgdmFyIGlzVmFsaWQgPSB1dGlsLnR5cGVmb3JjZS5jaGVjayhmb3JtYXQsIG9yZGVyLCB0cnVlKTsKCiAgaWYgKCFpc1ZhbGlkKSB7CiAgICBkZWJ1Zygnc3dhcC5jb3JlOm9yZGVycycpKCdXcm9uZyBpbmNvbWUgb3JkZXIgZm9ybWF0LiBFeGNlcHRlZDonLCBmb3JtYXQsICdnb3Q6Jywgb3JkZXIpOwogIH0KCiAgcmV0dXJuIGlzVmFsaWQ7Cn07Cgp2YXIgY2hlY2tJbmNvbWVPcmRlck93bmVyID0gZnVuY3Rpb24gY2hlY2tJbmNvbWVPcmRlck93bmVyKF9yZWYsIGZyb21QZWVyKSB7CiAgdmFyIHBlZXIgPSBfcmVmLm93bmVyLnBlZXI7CiAgcmV0dXJuIHBlZXIgPT09IGZyb21QZWVyOwp9OwoKdmFyIGNoZWNrSW5jb21lT3JkZXJXaGl0ZWxpc3RlZCA9IGZ1bmN0aW9uIGNoZWNrSW5jb21lT3JkZXJXaGl0ZWxpc3RlZChfcmVmMikgewogIHZhciBwZWVyID0gX3JlZjIub3duZXIucGVlcjsKICByZXR1cm4gIXZpc2libGVNYWtlcnMubGVuZ3RoIHx8IHZpc2libGVNYWtlcnMuaW5jbHVkZXMocGVlcik7Cn07Cgp2YXIgY2hlY2tJbmNvbWVPcmRlciA9IGZ1bmN0aW9uIGNoZWNrSW5jb21lT3JkZXIob3JkZXIsIGZyb21QZWVyKSB7CiAgdmFyIGlzRm9ybWF0VmFsaWQgPSBjaGVja0luY29tZU9yZGVyRm9ybWF0KG9yZGVyKTsKICB2YXIgaXNPd25lclZhbGlkID0gY2hlY2tJbmNvbWVPcmRlck93bmVyKG9yZGVyLCBmcm9tUGVlcik7CiAgdmFyIGlzT3duZXJXaGl0ZWxpc3RlZCA9IGNoZWNrSW5jb21lT3JkZXJXaGl0ZWxpc3RlZChvcmRlcik7CiAgcmV0dXJuIGlzRm9ybWF0VmFsaWQgJiYgaXNPd25lclZhbGlkICYmIGlzT3duZXJXaGl0ZWxpc3RlZDsKfTsKCnZhciBTd2FwT3JkZXJzID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfYWdncmVnYXRpb24pIHsKICBfaW5oZXJpdHMoU3dhcE9yZGVycywgX2FnZ3JlZ2F0aW9uKTsKCiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihTd2FwT3JkZXJzKTsKCiAgZnVuY3Rpb24gU3dhcE9yZGVycygpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3dhcE9yZGVycyk7CgogICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfc2VydmljZU5hbWUiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldFVuaXF1ZUlkIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfZGVwZW5kc09uIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfaGFuZGxlUmVhZHkiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLl9wZXJzaXN0TXlPcmRlcnMoKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9oYW5kbGVIaWRlT3JkZXJzIiwgZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgIHZhciBmcm9tUGVlciA9IF9yZWYzLmZyb21QZWVyOwoKICAgICAgX3RoaXMuaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAob3JkZXIpIHsKICAgICAgICBpZiAob3JkZXIgJiYgb3JkZXIub3duZXIgJiYgb3JkZXIub3duZXIucGVlciA9PT0gZnJvbVBlZXIpIHsKICAgICAgICAgIG9yZGVyLmlzSGlkZGVuID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2hhbmRsZVNob3dPcmRlcnMiLCBmdW5jdGlvbiAoX3JlZjQpIHsKICAgICAgdmFyIGZyb21QZWVyID0gX3JlZjQuZnJvbVBlZXI7CgogICAgICBfdGhpcy5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChvcmRlcikgewogICAgICAgIGlmIChvcmRlciAmJiBvcmRlci5vd25lciAmJiBvcmRlci5vd25lci5wZWVyID09PSBmcm9tUGVlcikgewogICAgICAgICAgb3JkZXIuaXNIaWRkZW4gPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2hhbmRsZUdpdmVPcmRlcnMiLCBmdW5jdGlvbiAoX3JlZjUpIHsKICAgICAgdmFyIGZyb21QZWVyID0gX3JlZjUuZnJvbVBlZXI7CgogICAgICBfdGhpcy5fc2VuZE9yZGVyc1RvUGVlcihmcm9tUGVlcik7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfc2VuZE9yZGVyc1RvUGVlciIsIGZ1bmN0aW9uIChwZWVyKSB7CiAgICAgIHZhciBteU9yZGVycyA9IF90aGlzLmdldE15T3JkZXJzKCk7CgogICAgICBpZiAobXlPcmRlcnMubGVuZ3RoKSB7CiAgICAgICAgLy8gY2xlYW4gb3JkZXJzIGZyb20gb3RoZXIgYWRkaXRpb25hbCBwcm9wcwogICAgICAgIG15T3JkZXJzID0gbXlPcmRlcnMubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gdXRpbC5wdWxsUHJvcHMoaXRlbSwgJ2lkJywgJ293bmVyJywgJ2J1eUN1cnJlbmN5JywgJ3NlbGxDdXJyZW5jeScsICdidXlBbW91bnQnLCAnZXhjaGFuZ2VSYXRlJywgJ3NlbGxBbW91bnQnLCAnaXNSZXF1ZXN0ZWQnLCAnaXNQcm9jZXNzaW5nJywgJ2lzUGFydGlhbCcsICdpc1R1cmJvJywgJ2lzSGlkZGVuJywgJ2Rlc3RpbmF0aW9uJyk7CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzLmFwcC5zZXJ2aWNlcy5yb29tLnNlbmRNZXNzYWdlUGVlcihwZWVyLCB7CiAgICAgICAgICBldmVudDogJ25ldyBvcmRlcnMnLAogICAgICAgICAgZGF0YTogewogICAgICAgICAgICBvcmRlcnM6IG15T3JkZXJzCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9oYW5kbGVVc2VyT25saW5lIiwgZnVuY3Rpb24gKHBlZXIpIHsKICAgICAgX3RoaXMuX3NlbmRPcmRlcnNUb1BlZXIocGVlcik7CgogICAgICBfdGhpcy5hcHAuc2VydmljZXMucm9vbS5zZW5kTWVzc2FnZVBlZXIocGVlciwgewogICAgICAgIGV2ZW50OiAnZ2l2ZSBvcmRlcnMnLAogICAgICAgIGRhdGE6IHt9CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2hhbmRsZVVzZXJPZmZsaW5lIiwgZnVuY3Rpb24gKHBlZXIpIHsKICAgICAgdmFyIHBlZXJPcmRlcnMgPSBfdGhpcy5nZXRQZWVyT3JkZXJzKHBlZXIpOwoKICAgICAgaWYgKHBlZXJPcmRlcnMubGVuZ3RoKSB7CiAgICAgICAgcGVlck9yZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChfcmVmNikgewogICAgICAgICAgdmFyIGlkID0gX3JlZjYuaWQ7CgogICAgICAgICAgX3RoaXMuX2hhbmRsZVJlbW92ZShpZCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9oYW5kbGVOZXdPcmRlcnMiLCBmdW5jdGlvbiAoX3JlZjcpIHsKICAgICAgdmFyIGZyb21QZWVyID0gX3JlZjcuZnJvbVBlZXIsCiAgICAgICAgICBvcmRlcnMgPSBfcmVmNy5vcmRlcnM7CiAgICAgIC8vIGR1Y3RhcGUgdG8gY2hlY2sgaWYgc3VjaCBvcmRlcnMgYWxyZWFkeSBleGlzdAogICAgICB2YXIgZmlsdGVyZWRPcmRlcnMgPSBvcmRlcnMuZmlsdGVyKGZ1bmN0aW9uIChfcmVmOCkgewogICAgICAgIHZhciBpZCA9IF9yZWY4LmlkLAogICAgICAgICAgICBwZWVyID0gX3JlZjgub3duZXIucGVlcjsKICAgICAgICByZXR1cm4gIV90aGlzLmdldEJ5S2V5KGlkKSAmJiBwZWVyID09PSBmcm9tUGVlcjsKICAgICAgfSk7CgogICAgICBfdGhpcy5faGFuZGxlTXVsdGlwbGVDcmVhdGUoewogICAgICAgIG9yZGVyczogZmlsdGVyZWRPcmRlcnMsCiAgICAgICAgZnJvbVBlZXI6IGZyb21QZWVyCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2hhbmRsZU5ld09yZGVyIiwgZnVuY3Rpb24gKF9yZWY5KSB7CiAgICAgIHZhciBmcm9tUGVlciA9IF9yZWY5LmZyb21QZWVyLAogICAgICAgICAgb3JkZXIgPSBfcmVmOS5vcmRlcjsKCiAgICAgIGlmIChvcmRlciAmJiBvcmRlci5vd25lciAmJiBvcmRlci5vd25lci5wZWVyID09PSBmcm9tUGVlcikgewogICAgICAgIGlmIChjaGVja0luY29tZU9yZGVyKG9yZGVyLCBmcm9tUGVlcikpIHsKICAgICAgICAgIF90aGlzLl9oYW5kbGVDcmVhdGUob3JkZXIpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2hhbmRsZVJlbW92ZU9yZGVyIiwgZnVuY3Rpb24gKF9yZWYxMCkgewogICAgICB2YXIgZnJvbVBlZXIgPSBfcmVmMTAuZnJvbVBlZXIsCiAgICAgICAgICBvcmRlcklkID0gX3JlZjEwLm9yZGVySWQ7CgogICAgICB2YXIgb3JkZXIgPSBfdGhpcy5nZXRCeUtleShvcmRlcklkKTsKCiAgICAgIGlmIChvcmRlciAmJiBvcmRlci5vd25lciAmJiBvcmRlci5vd25lci5wZWVyID09PSBmcm9tUGVlcikgewogICAgICAgIF90aGlzLl9oYW5kbGVSZW1vdmUob3JkZXJJZCk7CiAgICAgIH0KICAgIH0pOwoKICAgIF90aGlzLl9zZXJ2aWNlTmFtZSA9ICdvcmRlcnMnOwogICAgX3RoaXMuX2RlcGVuZHNPbiA9IFtTd2FwUm9vbV07CgogICAgX3RoaXMuZ2V0VW5pcXVlSWQgPSBmdW5jdGlvbiAoKSB7fTsKCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoU3dhcE9yZGVycywgW3sKICAgIGtleTogImluaXRTZXJ2aWNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0U2VydmljZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLmFwcC5zZXJ2aWNlcy5yb29tLm9uKCdyZWFkeScsIHRoaXMuX2hhbmRsZVJlYWR5KTsKICAgICAgdGhpcy5hcHAuc2VydmljZXMucm9vbS5vbigndXNlciBvbmxpbmUnLCB0aGlzLl9oYW5kbGVVc2VyT25saW5lKTsKICAgICAgdGhpcy5hcHAuc2VydmljZXMucm9vbS5vbigndXNlciBvZmZsaW5lJywgdGhpcy5faGFuZGxlVXNlck9mZmxpbmUpOwogICAgICB0aGlzLmFwcC5zZXJ2aWNlcy5yb29tLm9uKCduZXcgb3JkZXJzJywgdGhpcy5faGFuZGxlTmV3T3JkZXJzKTsKICAgICAgdGhpcy5hcHAuc2VydmljZXMucm9vbS5vbignZ2l2ZSBvcmRlcnMnLCB0aGlzLl9oYW5kbGVHaXZlT3JkZXJzKTsKICAgICAgdGhpcy5hcHAuc2VydmljZXMucm9vbS5vbignbmV3IG9yZGVyJywgdGhpcy5faGFuZGxlTmV3T3JkZXIpOwogICAgICB0aGlzLmFwcC5zZXJ2aWNlcy5yb29tLm9uKCdyZW1vdmUgb3JkZXInLCB0aGlzLl9oYW5kbGVSZW1vdmVPcmRlcik7CiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20ub24oJ2hpZGUgb3JkZXJzJywgdGhpcy5faGFuZGxlSGlkZU9yZGVycyk7CiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20ub24oJ3Nob3cgb3JkZXJzJywgdGhpcy5faGFuZGxlU2hvd09yZGVycyk7CgogICAgICB0aGlzLmdldFVuaXF1ZUlkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBpZCA9IERhdGUubm93KCk7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAiIi5jb25jYXQoX3RoaXMyLmFwcC5zZXJ2aWNlcy5yb29tLnBlZXIsICItIikuY29uY2F0KCsraWQpOwogICAgICAgIH07CiAgICAgIH0oKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcGVyc2lzdE15T3JkZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcGVyc2lzdE15T3JkZXJzKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuZ2V0TXlPcmRlcnMoKS5mb3JFYWNoKGZ1bmN0aW9uIChvcmRlckRhdGEpIHsKICAgICAgICBfdGhpczMuX2hhbmRsZUNyZWF0ZShvcmRlckRhdGEpOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqDQogICAgICogQHBhcmFtIHtvYmplY3R9IGRhdGENCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZGF0YS5pZA0KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhLm93bmVyDQogICAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGEub3duZXIucGVlcg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBkYXRhLm93bmVyLnJlcHV0YXRpb24NCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YS5vd25lci48Y3VycmVuY3k+DQogICAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGEub3duZXIuPGN1cnJlbmN5Pi5hZGRyZXNzDQogICAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGEub3duZXIuPGN1cnJlbmN5Pi5wdWJsaWNLZXkNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZGF0YS5idXlDdXJyZW5jeQ0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBkYXRhLnNlbGxDdXJyZW5jeQ0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBkYXRhLmJ1eUFtb3VudA0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBkYXRhLnNlbGxBbW91bnQNCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGRhdGEuaXNQcm9jZXNzaW5nDQogICAgICogQHBhcmFtIHtib29sZWFufSBkYXRhLmlzUmVxdWVzdGVkDQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9jcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGUoZGF0YSkgewogICAgICBjb25zb2xlLmxvZygnPj4+IF9jcmVhdGUoKSBkYXRhID0nLCBkYXRhKTsKCiAgICAgIHZhciBpZCA9IGRhdGEuaWQsCiAgICAgICAgICBidXlBbW91bnQgPSBkYXRhLmJ1eUFtb3VudCwKICAgICAgICAgIHNlbGxBbW91bnQgPSBkYXRhLnNlbGxBbW91bnQsCiAgICAgICAgICBidXlDdXJyZW5jeSA9IGRhdGEuYnV5Q3VycmVuY3ksCiAgICAgICAgICBzZWxsQ3VycmVuY3kgPSBkYXRhLnNlbGxDdXJyZW5jeSwKICAgICAgICAgIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoZGF0YSwgWyJpZCIsICJidXlBbW91bnQiLCAic2VsbEFtb3VudCIsICJidXlDdXJyZW5jeSIsICJzZWxsQ3VycmVuY3kiXSk7CgogICAgICB2YXIgYnV5ID0gYnV5Q3VycmVuY3kudG9VcHBlckNhc2UoKTsKICAgICAgdmFyIHNlbGwgPSBzZWxsQ3VycmVuY3kudG9VcHBlckNhc2UoKTsgLy8gRXJyb3IgaW4gdGhlIGJvdHRvbSBsaW5lOiBDYW5ub3QgcmVhZCBwcm9wZXJ0eSAncHJlY2lzaW9uJyBvZiB1bmRlZmluZWQKCiAgICAgIHZhciByb3VuZGVkQnV5QW1vdW50ID0gbmV3IEJpZ051bWJlcihidXlBbW91bnQpLmRwKGNvbnN0YW50cy5DT0lOX0RBVEFbYnV5XS5wcmVjaXNpb24pOwogICAgICB2YXIgcm91bmRlZFNlbGxBbW91bnQgPSBuZXcgQmlnTnVtYmVyKHNlbGxBbW91bnQpLmRwKGNvbnN0YW50cy5DT0lOX0RBVEFbc2VsbF0ucHJlY2lzaW9uKTsKICAgICAgdmFyIG9yZGVyID0gbmV3IE9yZGVyKHRoaXMuYXBwLCB0aGlzLCBfb2JqZWN0U3ByZWFkKHsKICAgICAgICBpZDogaWQgfHwgdGhpcy5nZXRVbmlxdWVJZCgpLAogICAgICAgIGJ1eUFtb3VudDogcm91bmRlZEJ1eUFtb3VudCwKICAgICAgICBzZWxsQW1vdW50OiByb3VuZGVkU2VsbEFtb3VudCwKICAgICAgICBidXlDdXJyZW5jeTogYnV5LAogICAgICAgIHNlbGxDdXJyZW5jeTogc2VsbAogICAgICB9LCByZXN0KSk7CiAgICAgIHRoaXMuYXBwZW5kKG9yZGVyLCBvcmRlci5pZCk7CiAgICAgIHJldHVybiBvcmRlcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaGFuZGxlQ3JlYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlQ3JlYXRlKGRhdGEpIHsKICAgICAgdmFyIG9yZGVyID0gdGhpcy5fY3JlYXRlKGRhdGEpOwoKICAgICAgaWYgKG9yZGVyKSB7CiAgICAgICAgZXZlbnRzLmRpc3BhdGNoKCduZXcgb3JkZXInLCBvcmRlcik7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaGFuZGxlTXVsdGlwbGVDcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVNdWx0aXBsZUNyZWF0ZShfcmVmMTEpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB2YXIgb3JkZXJzID0gX3JlZjExLm9yZGVycywKICAgICAgICAgIGZyb21QZWVyID0gX3JlZjExLmZyb21QZWVyOwogICAgICB2YXIgbmV3T3JkZXJzID0gW107CiAgICAgIG9yZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgaWYgKGNoZWNrSW5jb21lT3JkZXIoZGF0YSwgZnJvbVBlZXIpKSB7CiAgICAgICAgICB2YXIgb3JkZXIgPSBfdGhpczQuX2NyZWF0ZShkYXRhKTsKCiAgICAgICAgICBuZXdPcmRlcnMucHVzaChvcmRlcik7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGlmIChuZXdPcmRlcnMubGVuZ3RoKSB7CiAgICAgICAgZXZlbnRzLmRpc3BhdGNoKCduZXcgb3JkZXJzJywgbmV3T3JkZXJzKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gb3JkZXJJZA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfaGFuZGxlUmVtb3ZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlUmVtb3ZlKG9yZGVySWQpIHsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLmdldEJ5S2V5KG9yZGVySWQpOwoKICAgICAgICBpZiAob3JkZXIpIHsKICAgICAgICAgIHRoaXMucmVtb3ZlQnlLZXkob3JkZXJJZCk7CiAgICAgICAgICBldmVudHMuZGlzcGF0Y2goJ3JlbW92ZSBvcmRlcicsIG9yZGVyKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIl9zYXZlTXlPcmRlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zYXZlTXlPcmRlcnMoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdmFyIG15T3JkZXJzID0gdGhpcy5pdGVtcy5maWx0ZXIoZnVuY3Rpb24gKF9yZWYxMikgewogICAgICAgIHZhciBwZWVyID0gX3JlZjEyLm93bmVyLnBlZXI7CiAgICAgICAgcmV0dXJuIHBlZXIgPT09IF90aGlzNS5hcHAuc2VydmljZXMucm9vbS5wZWVyOwogICAgICB9KTsgLy8gY2xlYW4gb3JkZXJzIGZyb20gb3RoZXIgYWRkaXRpb25hbCBwcm9wcwogICAgICAvLyBUT0RPIG5lZWQgdG8gYWRkIGZ1bmN0aW9uYWxpdHkgdG8gc3luYyBgcmVxdWVzdHNgIGZvciB1c2VycyB3aG8gZ29pbmcgb2ZmbGluZSAvIG9ubGluZQogICAgICAvLyBwcm9ibGVtOiB3aGVuIEkgZ29pbmcgb25saW5lIGFuZCBwZXJzaXN0aW5nIG15IG9yZGVycyBuZWVkIHRvIHNob3cgb25seSBvbmxpbmUgdXNlcnMgcmVxdWVzdHMsCiAgICAgIC8vIGJ1dCB0aGVuIHVzZXIgY29tZXMgb25saW5lIG5lZWQgdG8gY2hhbmdlIHN0YXR1cy4gT2ZjIHdlIGNhbiBsZWF2ZSB0aGlzIGJjcyBkZXZlbG9wZXJzIGNhbiBkbyB0aGlzIHRoZW1zZWx2ZXMKICAgICAgLy8gd2l0aCBmaWx0ZXJzIC0gc2tpcCByZXF1ZXN0cyB3aGVyZSB1c2VyIGlzIG9mZmxpbmUsIGJ1dCBpdCBsb29rcyBsaWtlIG5vdCB2ZXJ5IGdvb2QKCiAgICAgIG15T3JkZXJzID0gbXlPcmRlcnMubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIHV0aWwucHVsbFByb3BzKGl0ZW0sICdpZCcsICdvd25lcicsICdidXlDdXJyZW5jeScsICdzZWxsQ3VycmVuY3knLCAnYnV5QW1vdW50JywgJ3NlbGxBbW91bnQnLCAnZXhjaGFuZ2VSYXRlJywgJ3BhcnRpY2lwYW50JywgJ3JlcXVlc3RzJywgJ2lzUmVxdWVzdGVkJywgJ2lzUHJvY2Vzc2luZycsICdpc1BhcnRpYWwnLCAnaXNUdXJibycsICdpc0hpZGRlbicsICdkZXN0aW5hdGlvbicpOwogICAgICB9KTsKICAgICAgdGhpcy5hcHAuZW52LnN0b3JhZ2Uuc2V0SXRlbSgnbXlPcmRlcnMnLCBteU9yZGVycyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TXlPcmRlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE15T3JkZXJzKCkgewogICAgICByZXR1cm4gdGhpcy5hcHAuZW52LnN0b3JhZ2UuZ2V0SXRlbSgnbXlPcmRlcnMnKSB8fCBbXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRQZWVyT3JkZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQZWVyT3JkZXJzKHBlZXIpIHsKICAgICAgcmV0dXJuIHRoaXMuaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChfcmVmMTMpIHsKICAgICAgICB2YXIgb3duZXIgPSBfcmVmMTMub3duZXI7CiAgICAgICAgcmV0dXJuIHBlZXIgPT09IG93bmVyLnBlZXI7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICoNCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YQ0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBkYXRhLmJ1eUN1cnJlbmN5DQogICAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGEuc2VsbEN1cnJlbmN5DQogICAgICogQHBhcmFtIHtudW1iZXJ9IGRhdGEuYnV5QW1vdW50DQogICAgICogQHBhcmFtIHtudW1iZXJ9IGRhdGEuc2VsbEFtb3VudA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZShkYXRhKSB7CiAgICAgIGNvbnNvbGUubG9nKCc+Pj4gY3JlYXRlKCkgZGF0YSA9JywgZGF0YSk7CgogICAgICB2YXIgb3JkZXIgPSB0aGlzLl9jcmVhdGUoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBkYXRhKSwge30sIHsKICAgICAgICBvd25lcjogdGhpcy5hcHAuc2VydmljZXMuYXV0aC5nZXRQdWJsaWNEYXRhKCkKICAgICAgfSkpOwoKICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZWQgb3JkZXI6Jywgb3JkZXIpOwoKICAgICAgdGhpcy5fc2F2ZU15T3JkZXJzKCk7CgogICAgICB0aGlzLmFwcC5zZXJ2aWNlcy5yb29tLnNlbmRNZXNzYWdlUm9vbSh7CiAgICAgICAgZXZlbnQ6ICduZXcgb3JkZXInLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIG9yZGVyOiB1dGlsLnB1bGxQcm9wcyhvcmRlciwgJ2lkJywgJ293bmVyJywgJ2J1eUN1cnJlbmN5JywgJ2V4Y2hhbmdlUmF0ZScsICdzZWxsQ3VycmVuY3knLCAnYnV5QW1vdW50JywgJ3NlbGxBbW91bnQnLCAnaXNSZXF1ZXN0ZWQnLCAnaXNQcm9jZXNzaW5nJywgJ2lzUGFydGlhbCcsICdpc1R1cmJvJywgJ2lzSGlkZGVuJywgJ2Rlc3RpbmF0aW9uJykKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gb3JkZXI7CiAgICB9CiAgfSwgewogICAga2V5OiAiaGlkZU15T3JkZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoaWRlTXlPcmRlcnMoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChvcmRlcikgewogICAgICAgIGlmIChvcmRlciAmJiBvcmRlci5vd25lciAmJiBvcmRlci5vd25lci5wZWVyID09PSBfdGhpczYuYXBwLnNlcnZpY2VzLnJvb20ucGVlcikgewogICAgICAgICAgb3JkZXIuaXNIaWRkZW4gPSB0cnVlOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICB0aGlzLl9zYXZlTXlPcmRlcnMoKTsKCiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20uc2VuZE1lc3NhZ2VSb29tKHsKICAgICAgICBldmVudDogJ2hpZGUgb3JkZXJzJywKICAgICAgICBkYXRhOiB7fQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzaG93TXlPcmRlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3dNeU9yZGVycygpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB0aGlzLml0ZW1zLmZvckVhY2goZnVuY3Rpb24gKG9yZGVyKSB7CiAgICAgICAgaWYgKG9yZGVyICYmIG9yZGVyLm93bmVyICYmIG9yZGVyLm93bmVyLnBlZXIgPT09IF90aGlzNy5hcHAuc2VydmljZXMucm9vbS5wZWVyKSB7CiAgICAgICAgICBvcmRlci5pc0hpZGRlbiA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICB0aGlzLl9zYXZlTXlPcmRlcnMoKTsKCiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20uc2VuZE1lc3NhZ2VSb29tKHsKICAgICAgICBldmVudDogJ3Nob3cgb3JkZXJzJywKICAgICAgICBkYXRhOiB7fQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJoYXNIaWRkZW5PcmRlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhc0hpZGRlbk9yZGVycygpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICB2YXIgbXlIaWRkZW5PcmRlcnMgPSB0aGlzLml0ZW1zLmZpbHRlcihmdW5jdGlvbiAoX3JlZjE0KSB7CiAgICAgICAgdmFyIGlzSGlkZGVuID0gX3JlZjE0LmlzSGlkZGVuLAogICAgICAgICAgICBwZWVyID0gX3JlZjE0Lm93bmVyLnBlZXI7CiAgICAgICAgcmV0dXJuIHBlZXIgPT09IF90aGlzOC5hcHAuc2VydmljZXMucm9vbS5wZWVyICYmIGlzSGlkZGVuOwogICAgICB9KTsKICAgICAgcmV0dXJuICEhbXlIaWRkZW5PcmRlcnMubGVuZ3RoOwogICAgfQogICAgLyoqDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gb3JkZXJJZA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZShvcmRlcklkKSB7CiAgICAgIHRoaXMucmVtb3ZlQnlLZXkob3JkZXJJZCk7CiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20uc2VuZE1lc3NhZ2VSb29tKHsKICAgICAgICBldmVudDogJ3JlbW92ZSBvcmRlcicsCiAgICAgICAgZGF0YTogewogICAgICAgICAgb3JkZXJJZDogb3JkZXJJZAogICAgICAgIH0KICAgICAgfSk7CgogICAgICB0aGlzLl9zYXZlTXlPcmRlcnMoKTsKICAgIH0KICAgIC8qKg0KICAgICAqDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50DQogICAgICogQHBhcmFtIHtTdHJpbmd9IHBlZXINCiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YQ0KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlcXVlc3RUb1BlZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlcXVlc3RUb1BlZXIoZXZlbnQsIHBlZXIsIGRhdGEsIGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20uc2VuZE1lc3NhZ2VQZWVyKHBlZXIsIHsKICAgICAgICBldmVudDogZXZlbnQsCiAgICAgICAgZGF0YTogZGF0YQogICAgICB9KTsKCiAgICAgIGlmICghY2FsbGJhY2spIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuYXBwLnNlcnZpY2VzLnJvb20ub24oJ2FjY2VwdCByZXF1ZXN0JywgZnVuY3Rpb24gKF9yZWYxNSkgewogICAgICAgIHZhciBmcm9tUGVlciA9IF9yZWYxNS5mcm9tUGVlciwKICAgICAgICAgICAgb3JkZXJJZCA9IF9yZWYxNS5vcmRlcklkOwogICAgICAgIGRlYnVnKCdzd2FwLmNvcmU6b3JkZXJzJykoJ3JlcXVlc3RUb1BlZXIgYWNjZXB0IHJlcXVlc3QnLCBmcm9tUGVlcik7CgogICAgICAgIGlmIChwZWVyID09PSBmcm9tUGVlcikgewogICAgICAgICAgdGhpcy51bnN1YnNjcmliZSgpOwogICAgICAgICAgZGVidWcoJ3N3YXAuY29yZTpvcmRlcnMnKSgncmVxdWVzdFRvUGVlciBJRicpOwogICAgICAgICAgY2FsbGJhY2sob3JkZXJJZCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5hcHAuc2VydmljZXMucm9vbS5vbignZGVjbGluZSByZXF1ZXN0JywgZnVuY3Rpb24gKF9yZWYxNikgewogICAgICAgIHZhciBmcm9tUGVlciA9IF9yZWYxNi5mcm9tUGVlcjsKCiAgICAgICAgaWYgKHBlZXIgPT09IGZyb21QZWVyKSB7CiAgICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7CiAgICAgICAgICBjYWxsYmFjayhmYWxzZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb24oZXZlbnROYW1lLCBoYW5kbGVyKSB7CiAgICAgIGV2ZW50cy5zdWJzY3JpYmUoZXZlbnROYW1lLCBoYW5kbGVyKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAib2ZmIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvZmYoZXZlbnROYW1lLCBoYW5kbGVyKSB7CiAgICAgIGV2ZW50cy51bnN1YnNjcmliZShldmVudE5hbWUsIGhhbmRsZXIpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9XSwgW3sKICAgIGtleTogIm5hbWUiLAogICAgZ2V0OiAvL0AKICAgIGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuICdvcmRlcnMnOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFN3YXBPcmRlcnM7Cn0oYWdncmVnYXRpb24oU2VydmljZUludGVyZmFjZSwgQ29sbGVjdGlvbikpOwoKZXhwb3J0IGRlZmF1bHQgU3dhcE9yZGVyczs="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/core/swap.orders/SwapOrders.ts"],"names":["debug","BigNumber","Collection","ServiceInterface","util","constants","SwapRoom","aggregation","events","Order","visibleMakers","checkIncomeOrderFormat","order","buyCurrency","typeforce","isCoinName","sellCurrency","format","id","owner","peer","reputation","t","maybe","isNumeric","result","Object","keys","COINS","forEach","key","address","isCoinAddress","publicKey","isPublicKey","sellAmount","buyAmount","exchangeRate","isProcessing","isRequested","isPartial","isTurbo","isHidden","destination","ownerAddress","participantAddress","isValid","check","checkIncomeOrderOwner","fromPeer","checkIncomeOrderWhitelisted","length","includes","checkIncomeOrder","isFormatValid","isOwnerValid","isOwnerWhitelisted","SwapOrders","_persistMyOrders","items","_sendOrdersToPeer","myOrders","getMyOrders","map","item","pullProps","app","services","room","sendMessagePeer","event","data","orders","peerOrders","getPeerOrders","_handleRemove","filteredOrders","filter","getByKey","_handleMultipleCreate","_handleCreate","orderId","_serviceName","_dependsOn","getUniqueId","on","_handleReady","_handleUserOnline","_handleUserOffline","_handleNewOrders","_handleGiveOrders","_handleNewOrder","_handleRemoveOrder","_handleHideOrders","_handleShowOrders","Date","now","orderData","console","log","rest","buy","toUpperCase","sell","roundedBuyAmount","dp","COIN_DATA","precision","roundedSellAmount","append","_create","dispatch","newOrders","push","removeByKey","err","error","env","storage","setItem","getItem","auth","getPublicData","_saveMyOrders","sendMessageRoom","myHiddenOrders","callback","unsubscribe","eventName","handler","subscribe"],"mappings":"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","sourcesContent":["// @ts-nocheck\r\nimport debug from 'debug'\r\nimport BigNumber from 'bignumber.js'\r\nimport SwapApp, { Collection, ServiceInterface, util, constants } from 'swap.app'\r\nimport SwapRoom from 'swap.room'\r\nimport aggregation from './aggregation'\r\nimport events from './events'\r\nimport Order from './Order'\r\nimport visibleMakers from 'common/whitelists/visibleMakers'\r\n\r\n\r\nconst checkIncomeOrderFormat = (order) => {\r\n  // Skip unknown currencies\r\n  if (order && order.buyCurrency && !util.typeforce.isCoinName(order.buyCurrency)) {\r\n    return false\r\n  }\r\n  if (order && order.sellCurrency && !util.typeforce.isCoinName(order.sellCurrency)) {\r\n    return false\r\n  }\r\n\r\n  const format = {\r\n    id: '?String',\r\n    owner: {\r\n      peer: 'String',\r\n      reputation: util.typeforce.t.maybe(util.typeforce.isNumeric),\r\n      ...(() => {\r\n        const result = {}\r\n        Object.keys(constants.COINS).forEach((key) => {\r\n          result[key] = util.typeforce.t.maybe({\r\n            address: util.typeforce.isCoinAddress[constants.COINS[key]],\r\n            publicKey: util.typeforce.isPublicKey[constants.COINS[key]],\r\n          })\r\n        })\r\n        return result\r\n      })(),\r\n    },\r\n    sellCurrency: util.typeforce.isCoinName,\r\n    sellAmount: util.typeforce.isNumeric,\r\n    buyCurrency: util.typeforce.isCoinName,\r\n    buyAmount: util.typeforce.isNumeric,\r\n    exchangeRate: util.typeforce.t.maybe(util.typeforce.isNumeric),\r\n    isProcessing: '?Boolean',\r\n    isRequested: '?Boolean',\r\n    isPartial: '?Boolean',\r\n    isTurbo: '?Boolean',\r\n    isHidden: '?Boolean',\r\n    destination: util.typeforce.t.maybe({\r\n      ownerAddress: '?String',\r\n      participantAddress: '?String',\r\n    }),\r\n  }\r\n\r\n  const isValid = util.typeforce.check(format, order, true)\r\n\r\n  if (!isValid) {\r\n    debug('swap.core:orders')('Wrong income order format. Excepted:', format, 'got:', order)\r\n  }\r\n\r\n  return isValid\r\n}\r\n\r\nconst checkIncomeOrderOwner = ({ owner: { peer } }, fromPeer) =>\r\n  peer === fromPeer\r\n\r\n\r\nconst checkIncomeOrderWhitelisted = ({ owner: { peer } }) => {\r\n  return !visibleMakers.length || visibleMakers.includes(peer)\r\n}\r\n\r\nconst checkIncomeOrder = (order, fromPeer) => {\r\n  const isFormatValid = checkIncomeOrderFormat(order)\r\n  const isOwnerValid = checkIncomeOrderOwner(order, fromPeer)\r\n  const isOwnerWhitelisted = checkIncomeOrderWhitelisted(order)\r\n\r\n  return isFormatValid && isOwnerValid && isOwnerWhitelisted\r\n}\r\n\r\n\r\nclass SwapOrders extends aggregation(ServiceInterface, Collection) {\r\n\r\n  _serviceName: string\r\n  getUniqueId: any\r\n  _dependsOn: any\r\n\r\n  //@\r\n  static get name() {\r\n    return 'orders'\r\n  }\r\n\r\n  constructor() {\r\n    super()\r\n\r\n    this._serviceName = 'orders'\r\n    this._dependsOn   = [ SwapRoom ]\r\n\r\n    this.getUniqueId = () => {}\r\n  }\r\n\r\n  initService() {\r\n    this.app.services.room.on('ready', this._handleReady)\r\n    this.app.services.room.on('user online', this._handleUserOnline)\r\n    this.app.services.room.on('user offline', this._handleUserOffline)\r\n    this.app.services.room.on('new orders', this._handleNewOrders)\r\n    this.app.services.room.on('give orders', this._handleGiveOrders)\r\n    this.app.services.room.on('new order', this._handleNewOrder)\r\n    this.app.services.room.on('remove order', this._handleRemoveOrder)\r\n    this.app.services.room.on('hide orders', this._handleHideOrders)\r\n    this.app.services.room.on('show orders', this._handleShowOrders)\r\n\r\n    this.getUniqueId = (() => {\r\n      let id = Date.now()\r\n      return () => `${this.app.services.room.peer}-${++id}`\r\n    })()\r\n  }\r\n\r\n  _handleReady = () => {\r\n    this._persistMyOrders()\r\n  }\r\n\r\n  _handleHideOrders = ({ fromPeer }) => {\r\n    this.items.forEach((order) => {\r\n      if (order && order.owner && order.owner.peer === fromPeer) {\r\n        order.isHidden = true\r\n      }\r\n    })\r\n  }\r\n\r\n  _handleShowOrders = ({ fromPeer }) => {\r\n    this.items.forEach((order) => {\r\n      if (order && order.owner && order.owner.peer === fromPeer) {\r\n        order.isHidden = false\r\n      }\r\n    })\r\n  }\r\n\r\n  _handleGiveOrders = ({ fromPeer }) => {\r\n    this._sendOrdersToPeer(fromPeer)\r\n  }\r\n\r\n  _sendOrdersToPeer = (peer) => {\r\n    let myOrders = this.getMyOrders()\r\n    if (myOrders.length) {\r\n      // clean orders from other additional props\r\n      myOrders = myOrders.map((item) => util.pullProps(\r\n        item,\r\n        'id',\r\n        'owner',\r\n        'buyCurrency',\r\n        'sellCurrency',\r\n        'buyAmount',\r\n        'exchangeRate',\r\n        'sellAmount',\r\n        'isRequested',\r\n        'isProcessing',\r\n        'isPartial',\r\n        'isTurbo',\r\n        'isHidden',\r\n        'destination',\r\n      ))\r\n\r\n      this.app.services.room.sendMessagePeer(peer, {\r\n        event: 'new orders',\r\n        data: {\r\n          orders: myOrders,\r\n        },\r\n      })\r\n    }\r\n  }\r\n  _handleUserOnline = (peer) => {\r\n    this._sendOrdersToPeer(peer)\r\n    this.app.services.room.sendMessagePeer(peer, {\r\n      event: 'give orders',\r\n      data: {},\r\n    })\r\n  }\r\n\r\n  _handleUserOffline = (peer) => {\r\n    const peerOrders = this.getPeerOrders(peer)\r\n\r\n    if (peerOrders.length) {\r\n      peerOrders.forEach(({ id }) => {\r\n        this._handleRemove(id)\r\n      })\r\n    }\r\n  }\r\n\r\n  _handleNewOrders = ({ fromPeer, orders }) => {\r\n    // ductape to check if such orders already exist\r\n    const filteredOrders = orders.filter(({ id, owner: { peer } }) => (\r\n      !this.getByKey(id) && peer === fromPeer\r\n    ))\r\n\r\n    this._handleMultipleCreate({ orders: filteredOrders, fromPeer })\r\n  }\r\n\r\n  _handleNewOrder = ({ fromPeer, order }) => {\r\n    if (order && order.owner && order.owner.peer === fromPeer) {\r\n      if (checkIncomeOrder(order, fromPeer)) {\r\n        this._handleCreate(order)\r\n      }\r\n    }\r\n  }\r\n\r\n  _handleRemoveOrder = ({ fromPeer, orderId }) => {\r\n    const order = this.getByKey(orderId)\r\n\r\n    if (order && order.owner && order.owner.peer === fromPeer) {\r\n      this._handleRemove(orderId)\r\n    }\r\n  }\r\n\r\n  _persistMyOrders() {\r\n    this.getMyOrders().forEach((orderData) => {\r\n      this._handleCreate(orderData)\r\n    })\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {object} data\r\n   * @param {string} data.id\r\n   * @param {object} data.owner\r\n   * @param {string} data.owner.peer\r\n   * @param {number} data.owner.reputation\r\n   * @param {object} data.owner.<currency>\r\n   * @param {string} data.owner.<currency>.address\r\n   * @param {string} data.owner.<currency>.publicKey\r\n   * @param {string} data.buyCurrency\r\n   * @param {string} data.sellCurrency\r\n   * @param {number} data.buyAmount\r\n   * @param {number} data.sellAmount\r\n   * @param {boolean} data.isProcessing\r\n   * @param {boolean} data.isRequested\r\n   */\r\n  _create(data) {\r\n    console.log('>>> _create() data =', data)\r\n    const { id, buyAmount, sellAmount, buyCurrency, sellCurrency, ...rest } = data\r\n\r\n    const buy = buyCurrency.toUpperCase()\r\n    const sell = sellCurrency.toUpperCase()\r\n    // Error in the bottom line: Cannot read property 'precision' of undefined\r\n    const roundedBuyAmount = new BigNumber(buyAmount).dp(constants.COIN_DATA[buy].precision)\r\n    const roundedSellAmount = new BigNumber(sellAmount).dp(constants.COIN_DATA[sell].precision)\r\n\r\n    const order = new Order(this.app, this, {\r\n      id:           id || this.getUniqueId(),\r\n      buyAmount:    roundedBuyAmount,\r\n      sellAmount:   roundedSellAmount,\r\n      buyCurrency:  buy,\r\n      sellCurrency: sell,\r\n      ...rest,\r\n    })\r\n\r\n    this.append(order, order.id)\r\n\r\n    return order\r\n  }\r\n\r\n  _handleCreate(data) {\r\n    const order = this._create(data)\r\n\r\n    if (order) {\r\n      events.dispatch('new order', order)\r\n    }\r\n  }\r\n\r\n  _handleMultipleCreate({ orders, fromPeer }) {\r\n    const newOrders = []\r\n\r\n    orders.forEach((data) => {\r\n      if (checkIncomeOrder(data, fromPeer)) {\r\n        const order = this._create(data)\r\n\r\n        newOrders.push(order)\r\n      }\r\n    })\r\n\r\n    if (newOrders.length) {\r\n      events.dispatch('new orders', newOrders)\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {string} orderId\r\n   */\r\n  _handleRemove(orderId) {\r\n    try {\r\n      const order = this.getByKey(orderId)\r\n\r\n      if (order) {\r\n        this.removeByKey(orderId)\r\n        events.dispatch('remove order', order)\r\n      }\r\n    }\r\n    catch (err) {\r\n      console.error(err)\r\n    }\r\n  }\r\n\r\n  _saveMyOrders() {\r\n    let myOrders = this.items.filter(({ owner: { peer } }) => peer === this.app.services.room.peer)\r\n\r\n    // clean orders from other additional props\r\n    // TODO need to add functionality to sync `requests` for users who going offline / online\r\n    // problem: when I going online and persisting my orders need to show only online users requests,\r\n    // but then user comes online need to change status. Ofc we can leave this bcs developers can do this themselves\r\n    // with filters - skip requests where user is offline, but it looks like not very good\r\n    myOrders = myOrders.map((item) => util.pullProps(\r\n      item,\r\n      'id',\r\n      'owner',\r\n      'buyCurrency',\r\n      'sellCurrency',\r\n      'buyAmount',\r\n      'sellAmount',\r\n      'exchangeRate',\r\n      'participant',\r\n      'requests',\r\n      'isRequested',\r\n      'isProcessing',\r\n      'isPartial',\r\n      'isTurbo',\r\n      'isHidden',\r\n      'destination',\r\n    ))\r\n\r\n    this.app.env.storage.setItem('myOrders', myOrders)\r\n  }\r\n\r\n  getMyOrders() {\r\n    return this.app.env.storage.getItem('myOrders') || []\r\n  }\r\n\r\n  getPeerOrders(peer) {\r\n    return this.items.filter(({ owner }) => peer === owner.peer)\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {object} data\r\n   * @param {string} data.buyCurrency\r\n   * @param {string} data.sellCurrency\r\n   * @param {number} data.buyAmount\r\n   * @param {number} data.sellAmount\r\n   */\r\n  create(data) {\r\n    console.log('>>> create() data =', data)\r\n    const order = this._create({\r\n      ...data,\r\n      owner: this.app.services.auth.getPublicData(),\r\n    })\r\n    console.log('created order:', order)\r\n    this._saveMyOrders()\r\n\r\n    this.app.services.room.sendMessageRoom({\r\n      event: 'new order',\r\n      data: {\r\n        order: util.pullProps(\r\n          order,\r\n          'id',\r\n          'owner',\r\n          'buyCurrency',\r\n          'exchangeRate',\r\n          'sellCurrency',\r\n          'buyAmount',\r\n          'sellAmount',\r\n          'isRequested',\r\n          'isProcessing',\r\n          'isPartial',\r\n          'isTurbo',\r\n          'isHidden',\r\n          'destination',\r\n        ),\r\n      },\r\n    })\r\n\r\n    return order\r\n  }\r\n\r\n  hideMyOrders() {\r\n    this.items.forEach((order) => {\r\n      if (order && order.owner && order.owner.peer === this.app.services.room.peer) {\r\n        order.isHidden = true\r\n      }\r\n    })\r\n    this._saveMyOrders()\r\n    this.app.services.room.sendMessageRoom({\r\n      event: 'hide orders',\r\n      data: {},\r\n    })\r\n  }\r\n\r\n  showMyOrders() {\r\n    this.items.forEach((order) => {\r\n      if (order && order.owner && order.owner.peer === this.app.services.room.peer) {\r\n        order.isHidden = false\r\n      }\r\n    })\r\n    this._saveMyOrders()\r\n    this.app.services.room.sendMessageRoom({\r\n      event: 'show orders',\r\n      data: {},\r\n    })\r\n  }\r\n\r\n  hasHiddenOrders() {\r\n    let myHiddenOrders = this.items.filter(({ isHidden, owner: { peer } }) => (peer === this.app.services.room.peer && isHidden))\r\n    return !!myHiddenOrders.length\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {string} orderId\r\n   */\r\n  remove(orderId) {\r\n    this.removeByKey(orderId)\r\n    this.app.services.room.sendMessageRoom({\r\n      event: 'remove order',\r\n      data: {\r\n        orderId,\r\n      },\r\n    })\r\n    this._saveMyOrders()\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {String} event\r\n   * @param {String} peer\r\n   * @param {Object} data\r\n   * @param {function} callback\r\n   */\r\n  requestToPeer(event, peer, data, callback) {\r\n    this.app.services.room.sendMessagePeer(peer, {\r\n      event,\r\n      data,\r\n    })\r\n\r\n    if (!callback) {\r\n      return\r\n    }\r\n\r\n    this.app.services.room.on('accept request', function ({ fromPeer, orderId }) {\r\n      debug('swap.core:orders')('requestToPeer accept request', fromPeer)\r\n      if (peer === fromPeer) {\r\n        this.unsubscribe()\r\n\r\n        debug('swap.core:orders')('requestToPeer IF')\r\n\r\n        callback(orderId)\r\n      }\r\n    })\r\n\r\n    this.app.services.room.on('decline request', function ({ fromPeer }) {\r\n      if (peer === fromPeer) {\r\n        this.unsubscribe()\r\n\r\n        callback(false)\r\n      }\r\n    })\r\n  }\r\n\r\n  on(eventName, handler) {\r\n    events.subscribe(eventName, handler)\r\n    return this\r\n  }\r\n\r\n  off(eventName, handler) {\r\n    events.unsubscribe(eventName, handler)\r\n    return this\r\n  }\r\n}\r\n\r\n\r\nexport default SwapOrders\r\n"]}]}