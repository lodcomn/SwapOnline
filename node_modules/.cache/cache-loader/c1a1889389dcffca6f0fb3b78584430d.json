{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\redux\\actions\\invoices.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\redux\\actions\\invoices.ts","mtime":1614842914290},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgZ2V0U3RhdGUgfSBmcm9tICdyZWR1eC9jb3JlJzsKaW1wb3J0IHsgYXBpTG9vcGVyIH0gZnJvbSAnaGVscGVycyc7CmltcG9ydCBhY3Rpb25zIGZyb20gJ3JlZHV4L2FjdGlvbnMnOwppbXBvcnQgY29uZmlnIGZyb20gJ2hlbHBlcnMvZXh0ZXJuYWxDb25maWcnOwppbXBvcnQgZ2V0Q3VycmVuY3lLZXkgZnJvbSAnaGVscGVycy9nZXRDdXJyZW5jeUtleSc7Cgp2YXIgdmFsaWRhdGVEYXRhID0gZnVuY3Rpb24gdmFsaWRhdGVEYXRhKGRhdGEpIHsKICBpZiAoIWRhdGEpIHJldHVybiBmYWxzZTsKICBpZiAoIWRhdGEuY3VycmVuY3kpIHJldHVybiBmYWxzZTsgLy8gaWYgKCFkYXRhLnRvQWRkcmVzcykgcmV0dXJuIGZhbHNlCgogIGlmICghZGF0YS5mcm9tQWRkcmVzcykgcmV0dXJuIGZhbHNlOwogIGlmICghZGF0YS5hbW91bnQpIHJldHVybiBmYWxzZTsKICByZXR1cm4gdHJ1ZTsKfTsKCnZhciBhZGRJbnZvaWNlID0gZnVuY3Rpb24gYWRkSW52b2ljZShkYXRhKSB7CiAgdmFyIF9nZXRTdGF0ZSA9IGdldFN0YXRlKCksCiAgICAgIGJ0Y0RhdGEgPSBfZ2V0U3RhdGUudXNlci5idGNEYXRhOwoKICBpZiAoIXZhbGlkYXRlRGF0YShkYXRhKSkgcmV0dXJuIGZhbHNlOwogIHZhciBjdXJyZW5jeSA9IGdldEN1cnJlbmN5S2V5KGRhdGEuY3VycmVuY3ksIHRydWUpOwogIHZhciByZXF1ZXN0RGF0YSA9IHsKICAgIGN1cnJlbmN5OiBjdXJyZW5jeS50b1VwcGVyQ2FzZSgpLAogICAgdG9BZGRyZXNzOiBkYXRhLnRvQWRkcmVzcywKICAgIGZyb21BZGRyZXNzOiBkYXRhLmZyb21BZGRyZXNzLAogICAgYW1vdW50OiBkYXRhLmFtb3VudCwKICAgIGNvbnRhY3Q6IGRhdGEuY29udGFjdCwKICAgIGxhYmVsOiBkYXRhLmxhYmVsID8gZGF0YS5sYWJlbCA6ICcnLAogICAgYWRkcmVzczogYnRjRGF0YS5hZGRyZXNzLAogICAgcHVia2V5OiBidGNEYXRhLnB1YmxpY0tleS50b1N0cmluZygnaGV4JyksCiAgICBtYWlubmV0OiBwcm9jZXNzLmVudi5NQUlOTkVUID8gJzEnIDogJzAnLAogICAgZGVzdGluYXRpb246IGRhdGEuZGVzdGluYXRpb24gPyBkYXRhLmRlc3RpbmF0aW9uIDogJycKICB9OwogIHJldHVybiBhcGlMb29wZXIucG9zdCgnaW52b2ljZUFwaScsICIvaW52b2ljZS9wdXNoLyIsIHsKICAgIGJvZHk6IHJlcXVlc3REYXRhCiAgfSk7Cn07Cgp2YXIgY2FuY2VsSW52b2ljZSA9IGZ1bmN0aW9uIGNhbmNlbEludm9pY2UoaW52b2ljZUlkKSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICByZXR1cm4gYXBpTG9vcGVyLnBvc3QoJ2ludm9pY2VBcGknLCAiL2ludm9pY2UvY2FuY2VsLyIsIHsKICAgICAgYm9keTogewogICAgICAgIGludm9pY2VJZDogaW52b2ljZUlkCiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICByZXNvbHZlKHJlcyAmJiByZXMuYW5zd2VyICYmIHJlcy5hbnN3ZXIgPT09ICdvaycpOwogICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICByZXNvbHZlKGZhbHNlKTsKICAgIH0pOwogIH0pOwp9OwoKdmFyIG1hcmtJbnZvaWNlID0gZnVuY3Rpb24gbWFya0ludm9pY2UoaW52b2ljZUlkLCBtYXJrLCB0eGlkLCBhZGRyZXNzKSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICByZXR1cm4gYXBpTG9vcGVyLnBvc3QoJ2ludm9pY2VBcGknLCAiL2ludm9pY2UvbWFyay8iLCB7CiAgICAgIGJvZHk6IHsKICAgICAgICBpbnZvaWNlSWQ6IGludm9pY2VJZCwKICAgICAgICBtYXJrOiBtYXJrLAogICAgICAgIHR4aWQ6IHR4aWQsCiAgICAgICAgYWRkcmVzczogYWRkcmVzcwogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgcmVzb2x2ZShyZXMgJiYgcmVzLmFuc3dlciAmJiByZXMuYW5zd2VyID09PSAnb2snKTsKICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgcmVzb2x2ZShmYWxzZSk7CiAgICB9KTsKICB9KTsKfTsKCnZhciBnZXRJbnZvaWNlID0gZnVuY3Rpb24gZ2V0SW52b2ljZShoYXNoKSB7CiAgaWYgKCFjb25maWcub3B0cy5pbnZvaWNlRW5hYmxlZCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgfSk7CiAgfQoKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgIGFwaUxvb3Blci5wb3N0KCdpbnZvaWNlQXBpJywgIi9pbnZvaWNlL2dldCIsIHsKICAgICAgYm9keTogewogICAgICAgIGhhc2g6IGhhc2gKICAgICAgfQogICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgIGNvbnNvbGUubG9nKCdmZXRjZWQgYW5zd2VyIGZyb20gaW52b2ljZSBhcGknLCByZXMpOwoKICAgICAgaWYgKHJlcyAmJiByZXMuYW5zd2VyICYmIHJlcy5hbnN3ZXIgPT09ICdvaycgJiYgcmVzLml0ZW0pIHsKICAgICAgICB2YXIgaXRlbSA9IHJlcy5pdGVtLAogICAgICAgICAgICBfcmVzJGl0ZW0gPSByZXMuaXRlbSwKICAgICAgICAgICAgYW1vdW50ID0gX3JlcyRpdGVtLmFtb3VudCwKICAgICAgICAgICAgdXR4ID0gX3JlcyRpdGVtLnV0eDsKICAgICAgICB2YXIgZGlyZWN0aW9uID0gYWN0aW9ucy51c2VyLmlzT3duZXIoaXRlbS50b0FkZHJlc3MsIGl0ZW0udHlwZSkgPyAnaW4nIDogJ291dCc7CiAgICAgICAgdmFyIGlzT3duZXIgPSBhY3Rpb25zLnVzZXIuaXNPd25lcihpdGVtLmZyb21BZGRyZXNzLCBpdGVtLnR5cGUpOwogICAgICAgIHJlc29sdmUoewogICAgICAgICAgaW52b2ljZURhdGE6IGl0ZW0sCiAgICAgICAgICBpc093bmVyOiBpc093bmVyLAogICAgICAgICAgaGFzUGF5ZXI6ICEhaXRlbS50b0FkZHJlc3MsCiAgICAgICAgICBoYXNoOiAnbm8gaGFzaCcsCiAgICAgICAgICBjb25maXJtYXRpb25zOiAxLAogICAgICAgICAgdmFsdWU6IGFtb3VudCwKICAgICAgICAgIGRhdGU6IHV0eCAqIDEwMDAsCiAgICAgICAgICBkaXJlY3Rpb246IGRpcmVjdGlvbgogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICB9CiAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoKSB7CiAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgfSk7CiAgfSk7Cn07Cgp2YXIgZ2V0TWFueUludm9pY2VzID0gZnVuY3Rpb24gZ2V0TWFueUludm9pY2VzKGRhdGEpIHsKICBpZiAoIWNvbmZpZy5vcHRzLmludm9pY2VFbmFibGVkKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgcmVzb2x2ZShbXSk7CiAgICB9KTsKICB9CgogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgdmFyIHdhbGxldHNIYXNoTWFwID0ge307CiAgICB2YXIgd2FsbGV0cyA9IGRhdGEubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIGlmIChpdGVtICYmIGl0ZW0udHlwZSAmJiBpdGVtLmFkZHJlc3MpIHsKICAgICAgICB2YXIgcmF3VHlwZSA9IGl0ZW0udHlwZSwKICAgICAgICAgICAgYWRkcmVzcyA9IGl0ZW0uYWRkcmVzczsKICAgICAgICB2YXIgdHlwZSA9IGdldEN1cnJlbmN5S2V5KHJhd1R5cGUsIHRydWUpLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgd2FsbGV0c0hhc2hNYXBbIiIuY29uY2F0KHR5cGUsICI6IikuY29uY2F0KGFkZHJlc3MudG9Mb3dlckNhc2UoKSldID0gewogICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgIGFkZHJlc3M6IGFkZHJlc3MKICAgICAgICB9OwogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgYWRkcmVzczogYWRkcmVzcwogICAgICAgIH07CiAgICAgIH0KICAgIH0pOwogICAgYXBpTG9vcGVyLnBvc3QoJ2ludm9pY2VBcGknLCAiL2ludm9pY2UvZmV0Y2htYW55LyIsIHsKICAgICAgYm9keTogewogICAgICAgIHdhbGxldHM6IHdhbGxldHMsCiAgICAgICAgbWFpbm5ldDogcHJvY2Vzcy5lbnYuTUFJTk5FVCA/ICcxJyA6ICcwJwogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgaWYgKHJlcyAmJiByZXMuYW5zd2VyICYmIHJlcy5hbnN3ZXIgPT09ICdvaycpIHsKICAgICAgICB2YXIgaW52b2ljZXMgPSByZXMuaXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICB2YXIgd2FsbGV0SGFzaCA9ICIiLmNvbmNhdChpdGVtLnR5cGUsICI6IikuY29uY2F0KGl0ZW0udG9BZGRyZXNzLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgdmFyIGRpcmVjdGlvbiA9IHdhbGxldHNIYXNoTWFwW3dhbGxldEhhc2hdICE9PSB1bmRlZmluZWQgPyAnaW4nIDogJ291dCc7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0eXBlOiBpdGVtLnR5cGUsCiAgICAgICAgICAgIHR4VHlwZTogJ0lOVk9JQ0UnLAogICAgICAgICAgICBpbnZvaWNlRGF0YTogaXRlbSwKICAgICAgICAgICAgaGFzaDogJ25vIGhhc2gnLAogICAgICAgICAgICBjb25maXJtYXRpb25zOiAxLAogICAgICAgICAgICB2YWx1ZTogaXRlbS5hbW91bnQsCiAgICAgICAgICAgIGRhdGU6IGl0ZW0udXR4ICogMTAwMCwKICAgICAgICAgICAgZGlyZWN0aW9uOiBkaXJlY3Rpb24KICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgICAgcmVzb2x2ZShpbnZvaWNlcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgIH0KICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgcmVzb2x2ZShbXSk7CiAgICB9KTsKICB9KTsKfTsKCnZhciBnZXRJbnZvaWNlcyA9IGZ1bmN0aW9uIGdldEludm9pY2VzKGRhdGEpIHsKICBpZiAoIWNvbmZpZy5vcHRzLmludm9pY2VFbmFibGVkKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgcmVzb2x2ZShbXSk7CiAgICB9KTsKICB9CgogIGlmIChkYXRhLmFkZHJlc3MgPT09ICdOb3Qgam9pbnRlZCcpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICByZXNvbHZlKFtdKTsKICAgIH0pOwogIH0KCiAgdmFyIF9nZXRTdGF0ZTIgPSBnZXRTdGF0ZSgpLAogICAgICBidGNEYXRhID0gX2dldFN0YXRlMi51c2VyLmJ0Y0RhdGE7CgogIGlmICghZGF0YSB8fCAhZGF0YS5jdXJyZW5jeSB8fCAhZGF0YS5hZGRyZXNzKSByZXR1cm4gZmFsc2U7CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICBhcGlMb29wZXIucG9zdCgnaW52b2ljZUFwaScsICIvaW52b2ljZS9mZXRjaC8iLCB7CiAgICAgIGJvZHk6IHsKICAgICAgICBjdXJyZW5jeTogZ2V0Q3VycmVuY3lLZXkoZGF0YS5jdXJyZW5jeSwgdHJ1ZSkudG9VcHBlckNhc2UoKSwKICAgICAgICBhZGRyZXNzOiBkYXRhLmFkZHJlc3MsCiAgICAgICAgbWFpbm5ldDogcHJvY2Vzcy5lbnYuTUFJTk5FVCA/ICcxJyA6ICcwJwogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgaWYgKHJlcyAmJiByZXMuYW5zd2VyICYmIHJlcy5hbnN3ZXIgPT09ICdvaycpIHsKICAgICAgICB2YXIgdHJhbnNhY3Rpb25zID0gcmVzLml0ZW1zLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgdmFyIGRpcmVjdGlvbiA9IGl0ZW0udG9BZGRyZXNzID09PSBkYXRhLmFkZHJlc3MgPyAnaW4nIDogJ291dCc7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0eXBlOiBnZXRDdXJyZW5jeUtleShkYXRhLmN1cnJlbmN5LCB0cnVlKSwKICAgICAgICAgICAgdHhUeXBlOiAnSU5WT0lDRScsCiAgICAgICAgICAgIGludm9pY2VEYXRhOiBpdGVtLAogICAgICAgICAgICBoYXNoOiAnbm8gaGFzaCcsCiAgICAgICAgICAgIGNvbmZpcm1hdGlvbnM6IDEsCiAgICAgICAgICAgIHZhbHVlOiBpdGVtLmFtb3VudCwKICAgICAgICAgICAgZGF0ZTogaXRlbS51dHggKiAxMDAwLAogICAgICAgICAgICBkaXJlY3Rpb246IGRpcmVjdGlvbgogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICByZXNvbHZlKHRyYW5zYWN0aW9ucyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgIH0KICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uICgpIHsKICAgICAgcmVzb2x2ZShbXSk7CiAgICB9KTsKICB9KTsKfTsKCmV4cG9ydCBkZWZhdWx0IHsKICBhZGRJbnZvaWNlOiBhZGRJbnZvaWNlLAogIGdldEludm9pY2VzOiBnZXRJbnZvaWNlcywKICBnZXRJbnZvaWNlOiBnZXRJbnZvaWNlLAogIGdldE1hbnlJbnZvaWNlczogZ2V0TWFueUludm9pY2VzLAogIGNhbmNlbEludm9pY2U6IGNhbmNlbEludm9pY2UsCiAgbWFya0ludm9pY2U6IG1hcmtJbnZvaWNlCn07"},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/front/shared/redux/actions/invoices.ts"],"names":["getState","apiLooper","actions","config","getCurrencyKey","validateData","data","currency","fromAddress","amount","addInvoice","btcData","user","requestData","toUpperCase","toAddress","contact","label","address","pubkey","publicKey","toString","mainnet","process","env","MAINNET","destination","post","body","cancelInvoice","invoiceId","Promise","resolve","then","res","answer","markInvoice","mark","txid","getInvoice","hash","opts","invoiceEnabled","console","log","item","utx","direction","isOwner","type","invoiceData","hasPayer","confirmations","value","date","getManyInvoices","walletsHashMap","wallets","map","rawType","toLowerCase","invoices","items","walletHash","undefined","txType","getInvoices","transactions"],"mappings":"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","sourcesContent":["import BigInteger from 'bigi'\r\n\r\nimport { BigNumber } from 'bignumber.js'\r\nimport * as bitcoin from 'bitcoinjs-lib'\r\nimport bitcoinMessage from 'bitcoinjs-message'\r\nimport { getState } from 'redux/core'\r\nimport reducers from 'redux/core/reducers'\r\nimport { btc, apiLooper, constants, api } from 'helpers'\r\nimport actions from 'redux/actions'\r\nimport config from 'helpers/externalConfig'\r\nimport getCurrencyKey from 'helpers/getCurrencyKey'\r\n\r\n\r\nconst validateData = (data) => {\r\n  if (!data) return false\r\n  if (!data.currency) return false\r\n  // if (!data.toAddress) return false\r\n  if (!data.fromAddress) return false\r\n  if (!data.amount) return false\r\n\r\n\r\n  return true\r\n}\r\n\r\nconst addInvoice = (data) => {\r\n  const { user: { btcData } } = getState()\r\n\r\n  if (!validateData(data)) return false\r\n\r\n  const currency = getCurrencyKey(data.currency, true)\r\n\r\n  const requestData = {\r\n    currency: currency.toUpperCase(),\r\n    toAddress: data.toAddress,\r\n    fromAddress: data.fromAddress,\r\n    amount: data.amount,\r\n    contact: data.contact,\r\n    label: (data.label) ? data.label : '',\r\n    address: btcData.address,\r\n    pubkey: btcData.publicKey.toString('hex'),\r\n    mainnet: (process.env.MAINNET) ? '1' : '0',\r\n    destination: (data.destination) ? data.destination : '',\r\n  }\r\n\r\n  return apiLooper.post('invoiceApi', `/invoice/push/`, {\r\n    body: requestData,\r\n  })\r\n}\r\n\r\nconst cancelInvoice = (invoiceId) => new Promise((resolve) => apiLooper.post('invoiceApi', `/invoice/cancel/`,\r\n  {\r\n    body: {\r\n      invoiceId,\r\n    },\r\n  })\r\n  .then((res: any) => {\r\n    resolve(res && res.answer && res.answer === 'ok')\r\n  })\r\n  .catch(() => { resolve(false) }))\r\n\r\nconst markInvoice = (invoiceId, mark, txid, address) => new Promise((resolve) => apiLooper.post('invoiceApi', `/invoice/mark/`,\r\n  {\r\n    body: {\r\n      invoiceId,\r\n      mark,\r\n      txid,\r\n      address,\r\n    },\r\n  })\r\n  .then((res: any) => {\r\n    resolve(res && res.answer && res.answer === 'ok')\r\n  })\r\n  .catch(() => { resolve(false) }))\r\n\r\nconst getInvoice = (hash) => {\r\n  if (!config.opts.invoiceEnabled) {\r\n    return new Promise((resolve) => { resolve(false) })\r\n  }\r\n\r\n  return new Promise((resolve) => {\r\n\r\n    apiLooper.post('invoiceApi', `/invoice/get`, {\r\n      body: {\r\n        hash,\r\n      },\r\n    }).then((res: any) => {\r\n      console.log('fetced answer from invoice api', res)\r\n      if (res && res.answer && res.answer === 'ok' && res.item) {\r\n        const {\r\n          item,\r\n          item: {\r\n            amount,\r\n            utx,\r\n          },\r\n        } = res\r\n\r\n        const direction = (actions.user.isOwner(item.toAddress, item.type)) ? 'in' : 'out'\r\n        const isOwner = (actions.user.isOwner(item.fromAddress, item.type))\r\n\r\n        resolve({\r\n          invoiceData: item,\r\n          isOwner,\r\n          hasPayer: !(!item.toAddress),\r\n          hash: 'no hash',\r\n          confirmations: 1,\r\n          value: amount,\r\n          date: utx * 1000,\r\n          direction,\r\n        })\r\n      } else {\r\n        resolve(false)\r\n      }\r\n    }).catch(() => {\r\n      resolve(false)\r\n    })\r\n  })\r\n}\r\n\r\nconst getManyInvoices = (data) => {\r\n  if (!config.opts.invoiceEnabled) {\r\n    return new Promise((resolve) => { resolve([]) })\r\n  }\r\n\r\n  return new Promise((resolve) => {\r\n\r\n    const walletsHashMap = {}\r\n    const wallets = data.map((item) => {\r\n      if (item && item.type && item.address) {\r\n        const {\r\n          type: rawType,\r\n          address,\r\n        } = item\r\n\r\n        const type = getCurrencyKey(rawType, true).toUpperCase()\r\n        walletsHashMap[`${type}:${address.toLowerCase()}`] = {\r\n          type,\r\n          address,\r\n        }\r\n\r\n        return {\r\n          type,\r\n          address,\r\n        }\r\n      }\r\n    })\r\n\r\n    apiLooper.post('invoiceApi', `/invoice/fetchmany/`, {\r\n      body: {\r\n        wallets,\r\n        mainnet: (process.env.MAINNET) ? '1' : '0',\r\n      },\r\n    }).then((res: any) => {\r\n      if (res && res.answer && res.answer === 'ok') {\r\n        const invoices = res.items.map((item) => {\r\n          const walletHash = `${item.type}:${item.toAddress.toLowerCase()}`\r\n\r\n          const direction = (walletsHashMap[walletHash] !== undefined) ? 'in' : 'out'\r\n\r\n          return ({\r\n            type: item.type,\r\n            txType: 'INVOICE',\r\n            invoiceData: item,\r\n            hash: 'no hash',\r\n            confirmations: 1,\r\n            value: item.amount,\r\n            date: item.utx * 1000,\r\n            direction,\r\n          })\r\n        })\r\n\r\n        resolve(invoices)\r\n      } else {\r\n        resolve([])\r\n      }\r\n    })\r\n      .catch(() => {\r\n        resolve([])\r\n      })\r\n  })\r\n}\r\n\r\nconst getInvoices = (data) => {\r\n  if (!config.opts.invoiceEnabled) {\r\n    return new Promise((resolve) => { resolve([]) })\r\n  }\r\n\r\n  if (data.address === 'Not jointed') {\r\n    return new Promise((resolve) => {\r\n      resolve([])\r\n    })\r\n  }\r\n\r\n  const { user: { btcData } } = getState()\r\n  if (!data || !data.currency || !data.address) return false\r\n\r\n  return new Promise((resolve) => {\r\n\r\n    apiLooper.post('invoiceApi', `/invoice/fetch/`, {\r\n      body: {\r\n        currency: getCurrencyKey(data.currency, true).toUpperCase(),\r\n        address: data.address,\r\n        mainnet: (process.env.MAINNET) ? '1' : '0',\r\n      },\r\n    }).then((res: any) => {\r\n      if (res && res.answer && res.answer === 'ok') {\r\n        const transactions = res.items.map((item) => {\r\n          const direction = item.toAddress === data.address ? 'in' : 'out'\r\n\r\n          return ({\r\n            type: getCurrencyKey(data.currency, true),\r\n            txType: 'INVOICE',\r\n            invoiceData: item,\r\n            hash: 'no hash',\r\n            confirmations: 1,\r\n            value: item.amount,\r\n            date: item.utx * 1000,\r\n            direction,\r\n          })\r\n        })\r\n\r\n        resolve(transactions)\r\n      } else {\r\n        resolve([])\r\n      }\r\n    })\r\n      .catch(() => {\r\n        resolve([])\r\n      })\r\n  })\r\n}\r\n\r\nexport default {\r\n  addInvoice,\r\n  getInvoices,\r\n  getInvoice,\r\n  getManyInvoices,\r\n  cancelInvoice,\r\n  markInvoice,\r\n}\r\n"]}]}