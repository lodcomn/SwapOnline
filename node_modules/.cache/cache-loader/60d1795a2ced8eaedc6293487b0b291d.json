{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\pages\\Wallet\\Wallet.tsx","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\pages\\Wallet\\Wallet.tsx","mtime":1614852154018},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9leHRlbmRzIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXh0ZW5kcyI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2Fzc2VydFRoaXNJbml0aWFsaXplZCBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2Fzc2VydFRoaXNJbml0aWFsaXplZCI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbmhlcml0cyI7CmltcG9ydCBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2RlZmluZVByb3BlcnR5IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvb2JqZWN0V2l0aG91dFByb3BlcnRpZXMiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvdG9Db25zdW1hYmxlQXJyYXkiOwoKdmFyIF9kZWMsIF9kZWMyLCBfZGVjMywgX2NsYXNzLCBfdGVtcDsKCmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIkBiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yIjsKCmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CgpmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOyBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkgcmV0dXJuIGZhbHNlOyBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTsgdHJ5IHsgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKLy8gQHRzLW5vY2hlY2sKaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJ3JlZGFjdGlvbic7CmltcG9ydCBhY3Rpb25zIGZyb20gJ3JlZHV4L2FjdGlvbnMnOwppbXBvcnQgY3NzTW9kdWxlcyBmcm9tICdyZWFjdC1jc3MtbW9kdWxlcyc7CmltcG9ydCBzdHlsZXMgZnJvbSAnLi9XYWxsZXQuc2Nzcyc7CmltcG9ydCB7IGlzTW9iaWxlIH0gZnJvbSAncmVhY3QtZGV2aWNlLWRldGVjdCc7CmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JzsgLy8gaW1wb3J0IGZpcmVzdG9yZSBmcm9tICdoZWxwZXJzL2ZpcmViYXNlL2ZpcmVzdG9yZScKCmltcG9ydCBIaXN0b3J5IGZyb20gJ3BhZ2VzL0hpc3RvcnkvSGlzdG9yeSc7CmltcG9ydCBoZWxwZXJzLCB7IC8vIGZpcmViYXNlLApsaW5rcywgY29uc3RhbnRzLCBzdGF0cyB9IGZyb20gJ2hlbHBlcnMnOwppbXBvcnQgeyBsb2NhbGlzZWRVcmwgfSBmcm9tICdoZWxwZXJzL2xvY2FsZSc7CmltcG9ydCB7IGdldEFjdGl2YXRlZEN1cnJlbmNpZXMgfSBmcm9tICdoZWxwZXJzL3VzZXInOwppbXBvcnQgZ2V0VG9wTG9jYXRpb24gZnJvbSAnaGVscGVycy9nZXRUb3BMb2NhdGlvbic7CmltcG9ydCB7IGluamVjdEludGwgfSBmcm9tICdyZWFjdC1pbnRsJzsKaW1wb3J0IGFwcENvbmZpZyBmcm9tICdhcHAtY29uZmlnJzsKaW1wb3J0IGNvbmZpZyBmcm9tICdoZWxwZXJzL2V4dGVybmFsQ29uZmlnJzsKaW1wb3J0IHsgd2l0aFJvdXRlciB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nOwppbXBvcnQgQ3VycmVuY2llc0xpc3QgZnJvbSAnLi9DdXJyZW5jaWVzTGlzdCc7CmltcG9ydCBJbnZvaWNlc0xpc3QgZnJvbSAncGFnZXMvSW52b2ljZXMvSW52b2ljZXNMaXN0JzsKaW1wb3J0IERhc2hib2FyZExheW91dCBmcm9tICdjb21wb25lbnRzL2xheW91dC9EYXNoYm9hcmRMYXlvdXQvRGFzaGJvYXJkTGF5b3V0JzsKaW1wb3J0IEJhbGFuY2VGb3JtIGZyb20gJ2NvbXBvbmVudHMvQmFsYW5jZUZvcm0vQmFsYW5jZUZvcm0nOwppbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdiaWdudW1iZXIuanMnOwppbXBvcnQgbWV0YW1hc2sgZnJvbSAnaGVscGVycy9tZXRhbWFzayc7CmltcG9ydCB3cExvZ291dE1vZGFsIGZyb20gJ2hlbHBlcnMvd3BMb2dvdXRNb2RhbCc7CmltcG9ydCBmZWVkYmFjayBmcm9tICdzaGFyZWQvaGVscGVycy9mZWVkYmFjayc7CnZhciBpc1dpZGdldEJ1aWxkID0gY29uZmlnICYmIGNvbmZpZy5pc1dpZGdldDsKdmFyIGlzRGFyayA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGNvbnN0YW50cy5sb2NhbFN0b3JhZ2UuaXNEYXJrKTsKdmFyIFdhbGxldCA9IChfZGVjID0gY29ubmVjdChmdW5jdGlvbiAoX3JlZikgewogIHZhciBoaWRkZW5Db2luc0xpc3QgPSBfcmVmLmNvcmUuaGlkZGVuQ29pbnNMaXN0LAogICAgICB1c2VyID0gX3JlZi51c2VyLAogICAgICBfcmVmJHVzZXIgPSBfcmVmLnVzZXIsCiAgICAgIGFjdGl2ZUZpYXQgPSBfcmVmJHVzZXIuYWN0aXZlRmlhdCwKICAgICAgZXRoRGF0YSA9IF9yZWYkdXNlci5ldGhEYXRhLAogICAgICBidGNEYXRhID0gX3JlZiR1c2VyLmJ0Y0RhdGEsCiAgICAgIGdob3N0RGF0YSA9IF9yZWYkdXNlci5naG9zdERhdGEsCiAgICAgIG5leHREYXRhID0gX3JlZiR1c2VyLm5leHREYXRhLAogICAgICBidGNNdWx0aXNpZ1NNU0RhdGEgPSBfcmVmJHVzZXIuYnRjTXVsdGlzaWdTTVNEYXRhLAogICAgICBidGNNdWx0aXNpZ1VzZXJEYXRhID0gX3JlZiR1c2VyLmJ0Y011bHRpc2lnVXNlckRhdGEsCiAgICAgIGJ0Y011bHRpc2lnVXNlckRhdGFMaXN0ID0gX3JlZiR1c2VyLmJ0Y011bHRpc2lnVXNlckRhdGFMaXN0LAogICAgICB0b2tlbnNEYXRhID0gX3JlZiR1c2VyLnRva2Vuc0RhdGEsCiAgICAgIGlzRmV0Y2hpbmcgPSBfcmVmJHVzZXIuaXNGZXRjaGluZywKICAgICAgaXNCYWxhbmNlRmV0Y2hpbmcgPSBfcmVmJHVzZXIuaXNCYWxhbmNlRmV0Y2hpbmcsCiAgICAgIG11bHRpc2lnUGVuZGluZ0NvdW50ID0gX3JlZiR1c2VyLm11bHRpc2lnUGVuZGluZ0NvdW50LAogICAgICBhY3RpdmVDdXJyZW5jeSA9IF9yZWYkdXNlci5hY3RpdmVDdXJyZW5jeSwKICAgICAgbWVzc2FnaW5nVG9rZW4gPSBfcmVmJHVzZXIubWVzc2FnaW5nVG9rZW4sCiAgICAgIG1ldGFtYXNrRGF0YSA9IF9yZWYkdXNlci5tZXRhbWFza0RhdGEsCiAgICAgIGN1cnJlbmNpZXMgPSBfcmVmLmN1cnJlbmNpZXMuaXRlbXMsCiAgICAgIGFzc2V0cyA9IF9yZWYuY3JlYXRlV2FsbGV0LmN1cnJlbmNpZXMsCiAgICAgIG1vZGFscyA9IF9yZWYubW9kYWxzLAogICAgICBkYXNoYm9hcmRNb2RhbHNBbGxvd2VkID0gX3JlZi51aS5kYXNoYm9hcmRNb2RhbHNBbGxvd2VkOwogIHZhciB3aWRnZXRNdWx0aVRva2VucyA9IFtdOwoKICBpZiAod2luZG93LndpZGdldEVSQzIwVG9rZW5zICYmIE9iamVjdC5rZXlzKHdpbmRvdy53aWRnZXRFUkMyMFRva2VucykubGVuZ3RoKSB7CiAgICBPYmplY3Qua2V5cyh3aW5kb3cud2lkZ2V0RVJDMjBUb2tlbnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICB3aWRnZXRNdWx0aVRva2Vucy5wdXNoKGtleS50b1VwcGVyQ2FzZSgpKTsKICAgIH0pOwogIH0KCiAgdmFyIHRva2VucyA9IGNvbmZpZyAmJiBjb25maWcuaXNXaWRnZXQgPyB3aW5kb3cud2lkZ2V0RVJDMjBUb2tlbnMgJiYgT2JqZWN0LmtleXMod2luZG93LndpZGdldEVSQzIwVG9rZW5zKS5sZW5ndGggPyB3aWRnZXRNdWx0aVRva2VucyA6IFtjb25maWcuZXJjMjB0b2tlbi50b1VwcGVyQ2FzZSgpXSA6IE9iamVjdC5rZXlzKHRva2Vuc0RhdGEpLm1hcChmdW5jdGlvbiAoaykgewogICAgcmV0dXJuIHRva2Vuc0RhdGFba10uY3VycmVuY3k7CiAgfSk7CiAgdmFyIHRva2Vuc0l0ZW1zID0gT2JqZWN0LmtleXModG9rZW5zRGF0YSkubWFwKGZ1bmN0aW9uIChrKSB7CiAgICByZXR1cm4gdG9rZW5zRGF0YVtrXTsKICB9KTsKICB2YXIgYWxsRGF0YSA9IFtidGNEYXRhLCBidGNNdWx0aXNpZ1NNU0RhdGEsIGJ0Y011bHRpc2lnVXNlckRhdGEsIGV0aERhdGEsIGdob3N0RGF0YSwgbmV4dERhdGFdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoT2JqZWN0LmtleXModG9rZW5zRGF0YSkubWFwKGZ1bmN0aW9uIChrKSB7CiAgICByZXR1cm4gdG9rZW5zRGF0YVtrXTsKICB9KSkpLm1hcChmdW5jdGlvbiAoX3JlZjIpIHsKICAgIHZhciBhY2NvdW50ID0gX3JlZjIuYWNjb3VudCwKICAgICAgICBrZXlQYWlyID0gX3JlZjIua2V5UGFpciwKICAgICAgICBkYXRhID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF9yZWYyLCBbImFjY291bnQiLCAia2V5UGFpciJdKTsKCiAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgZGF0YSk7CiAgfSk7CiAgdmFyIGl0ZW1zID0gKGNvbmZpZyAmJiBjb25maWcuaXNXaWRnZXQgPyBbYnRjRGF0YSwgZXRoRGF0YSwgZ2hvc3REYXRhLCBuZXh0RGF0YV0gOiBbYnRjRGF0YSwgYnRjTXVsdGlzaWdTTVNEYXRhLCBidGNNdWx0aXNpZ1VzZXJEYXRhLCBldGhEYXRhLCBnaG9zdERhdGEsIG5leHREYXRhXSkubWFwKGZ1bmN0aW9uIChkYXRhKSB7CiAgICByZXR1cm4gZGF0YS5jdXJyZW5jeTsKICB9KTsKICByZXR1cm4gewogICAgdG9rZW5zOiB0b2tlbnMsCiAgICBpdGVtczogaXRlbXMsCiAgICBhbGxEYXRhOiBhbGxEYXRhLAogICAgdG9rZW5zSXRlbXM6IHRva2Vuc0l0ZW1zLAogICAgbWVzc2FnaW5nVG9rZW46IG1lc3NhZ2luZ1Rva2VuLAogICAgY3VycmVuY2llczogY3VycmVuY2llcywKICAgIGFzc2V0czogYXNzZXRzLAogICAgaXNGZXRjaGluZzogaXNGZXRjaGluZywKICAgIGlzQmFsYW5jZUZldGNoaW5nOiBpc0JhbGFuY2VGZXRjaGluZywKICAgIG11bHRpc2lnUGVuZGluZ0NvdW50OiBtdWx0aXNpZ1BlbmRpbmdDb3VudCwKICAgIGhpZGRlbkNvaW5zTGlzdDogaGlkZGVuQ29pbnNMaXN0LAogICAgdXNlckV0aEFkZHJlc3M6IGV0aERhdGEuYWRkcmVzcywKICAgIHVzZXI6IHVzZXIsCiAgICBhY3RpdmVDdXJyZW5jeTogYWN0aXZlQ3VycmVuY3ksCiAgICBhY3RpdmVGaWF0OiBhY3RpdmVGaWF0LAogICAgdG9rZW5zRGF0YTogewogICAgICBldGhEYXRhOiBldGhEYXRhLAogICAgICBtZXRhbWFza0RhdGE6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgbWV0YW1hc2tEYXRhKSwge30sIHsKICAgICAgICBjdXJyZW5jeTogJ0VUSCBNZXRhbWFzaycKICAgICAgfSksCiAgICAgIGJ0Y0RhdGE6IGJ0Y0RhdGEsCiAgICAgIGdob3N0RGF0YTogZ2hvc3REYXRhLAogICAgICBuZXh0RGF0YTogbmV4dERhdGEsCiAgICAgIGJ0Y011bHRpc2lnU01TRGF0YTogYnRjTXVsdGlzaWdTTVNEYXRhLAogICAgICBidGNNdWx0aXNpZ1VzZXJEYXRhOiBidGNNdWx0aXNpZ1VzZXJEYXRhLAogICAgICBidGNNdWx0aXNpZ1VzZXJEYXRhTGlzdDogYnRjTXVsdGlzaWdVc2VyRGF0YUxpc3QKICAgIH0sCiAgICBkYXNoYm9hcmRWaWV3OiBkYXNoYm9hcmRNb2RhbHNBbGxvd2VkLAogICAgbW9kYWxzOiBtb2RhbHMKICB9Owp9KSwgX2RlYzIgPSBjb25uZWN0KGZ1bmN0aW9uIChfcmVmMykgewogIHZhciBpc1NpZ25lZCA9IF9yZWYzLnNpZ25VcC5pc1NpZ25lZDsKICByZXR1cm4gewogICAgaXNTaWduZWQ6IGlzU2lnbmVkCiAgfTsKfSksIF9kZWMzID0gY3NzTW9kdWxlcyhzdHlsZXMsIHsKICBhbGxvd011bHRpcGxlOiB0cnVlCn0pLCBfZGVjKF9jbGFzcyA9IGluamVjdEludGwoX2NsYXNzID0gd2l0aFJvdXRlcihfY2xhc3MgPSBfZGVjMihfY2xhc3MgPSBfZGVjMyhfY2xhc3MgPSAoX3RlbXAgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoV2FsbGV0LCBfQ29tcG9uZW50KTsKCiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihXYWxsZXQpOwoKICBmdW5jdGlvbiBXYWxsZXQocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgV2FsbGV0KTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRJbmZvQWJvdXRDdXJyZW5jeSIsIC8qI19fUFVSRV9fKi9fYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICB2YXIgY3VycmVuY2llcywgY3VycmVuY3lOYW1lczsKICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBjdXJyZW5jaWVzID0gX3RoaXMucHJvcHMuY3VycmVuY2llczsKICAgICAgICAgICAgICBjdXJyZW5jeU5hbWVzID0gY3VycmVuY2llcy5tYXAoZnVuY3Rpb24gKF9yZWY1KSB7CiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IF9yZWY1Lm5hbWU7CiAgICAgICAgICAgICAgICByZXR1cm4gbmFtZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gYWN0aW9ucy51c2VyLmdldEluZm9BYm91dEN1cnJlbmN5KGN1cnJlbmN5TmFtZXMpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlKTsKICAgIH0pKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlV2l0aGRyYXciLCBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgIHZhciBhbGxEYXRhID0gX3RoaXMucHJvcHMuYWxsRGF0YTsKICAgICAgdmFyIGFkZHJlc3MgPSBwYXJhbXMuYWRkcmVzcywKICAgICAgICAgIGFtb3VudCA9IHBhcmFtcy5hbW91bnQ7CiAgICAgIHZhciBpdGVtID0gYWxsRGF0YS5maW5kKGZ1bmN0aW9uIChfcmVmNikgewogICAgICAgIHZhciBjdXJyZW5jeSA9IF9yZWY2LmN1cnJlbmN5OwogICAgICAgIHJldHVybiBjdXJyZW5jeS50b0xvd2VyQ2FzZSgpID09PSBwYXJhbXMuY3VycmVuY3kudG9Mb3dlckNhc2UoKTsKICAgICAgfSk7CiAgICAgIGFjdGlvbnMubW9kYWxzLm9wZW4oY29uc3RhbnRzLm1vZGFscy5XaXRoZHJhdywgX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpdGVtKSwge30sIHsKICAgICAgICB0b0FkZHJlc3M6IGFkZHJlc3MsCiAgICAgICAgYW1vdW50OiBhbW91bnQKICAgICAgfSkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ29Ub1x1MDQyMXJlYXRlV2FsbGV0IiwgZnVuY3Rpb24gKCkgewogICAgICBmZWVkYmFjay53YWxsZXQucHJlc3NlZEFkZEN1cnJlbmN5KCk7CiAgICAgIHZhciBfdGhpcyRwcm9wcyA9IF90aGlzLnByb3BzLAogICAgICAgICAgaGlzdG9yeSA9IF90aGlzJHByb3BzLmhpc3RvcnksCiAgICAgICAgICBsb2NhbGUgPSBfdGhpcyRwcm9wcy5pbnRsLmxvY2FsZTsKICAgICAgaGlzdG9yeS5wdXNoKGxvY2FsaXNlZFVybChsb2NhbGUsIGxpbmtzLmNyZWF0ZVdhbGxldCkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlR29FeGNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHByb3BzMiA9IF90aGlzLnByb3BzLAogICAgICAgICAgaGlzdG9yeSA9IF90aGlzJHByb3BzMi5oaXN0b3J5LAogICAgICAgICAgbG9jYWxlID0gX3RoaXMkcHJvcHMyLmludGwubG9jYWxlOwogICAgICBoaXN0b3J5LnB1c2gobG9jYWxpc2VkVXJsKGxvY2FsZSwgbGlua3MuZXhjaGFuZ2UpKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhhbmRsZU1vZGFsT3BlbiIsIGZ1bmN0aW9uIChjb250ZXh0KSB7CiAgICAgIHZhciBlbmFibGVkQ3VycmVuY2llcyA9IF90aGlzLnN0YXRlLmVuYWJsZWRDdXJyZW5jaWVzOwogICAgICB2YXIgaGlkZGVuQ29pbnNMaXN0ID0gX3RoaXMucHJvcHMuaGlkZGVuQ29pbnNMaXN0OwogICAgICAvKiBAVG9EbyDQktGL0L3QtdGB0YLQuCDQvtGC0LTQtdC70YzQvdC+ICovCiAgICAgIC8vINCd0LDQsdC+0YAg0LLQsNC70Y7RgiDQtNC70Y8g0LLQuNC00LbQtdGC0LAKCiAgICAgIHZhciB3aWRnZXRDdXJyZW5jaWVzID0gWydCVEMnXTsKICAgICAgaWYgKCFoaWRkZW5Db2luc0xpc3QuaW5jbHVkZXMoJ0JUQyAoU01TLVByb3RlY3RlZCknKSkgd2lkZ2V0Q3VycmVuY2llcy5wdXNoKCdCVEMgKFNNUy1Qcm90ZWN0ZWQpJyk7CiAgICAgIGlmICghaGlkZGVuQ29pbnNMaXN0LmluY2x1ZGVzKCdCVEMgKFBJTi1Qcm90ZWN0ZWQpJykpIHdpZGdldEN1cnJlbmNpZXMucHVzaCgnQlRDIChQSU4tUHJvdGVjdGVkKScpOwogICAgICBpZiAoIWhpZGRlbkNvaW5zTGlzdC5pbmNsdWRlcygnQlRDIChNdWx0aXNpZyknKSkgd2lkZ2V0Q3VycmVuY2llcy5wdXNoKCdCVEMgKE11bHRpc2lnKScpOwogICAgICB3aWRnZXRDdXJyZW5jaWVzLnB1c2goJ0VUSCcpOwogICAgICB3aWRnZXRDdXJyZW5jaWVzLnB1c2goJ0dIT1NUJyk7CiAgICAgIHdpZGdldEN1cnJlbmNpZXMucHVzaCgnTkVYVCcpOwoKICAgICAgaWYgKGlzV2lkZ2V0QnVpbGQpIHsKICAgICAgICBpZiAod2luZG93LndpZGdldEVSQzIwVG9rZW5zICYmIE9iamVjdC5rZXlzKHdpbmRvdy53aWRnZXRFUkMyMFRva2VucykubGVuZ3RoKSB7CiAgICAgICAgICAvLyBNdWx0aSB0b2tlbiB3aWRnZXQgYnVpbGQKICAgICAgICAgIE9iamVjdC5rZXlzKHdpbmRvdy53aWRnZXRFUkMyMFRva2VucykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHdpZGdldEN1cnJlbmNpZXMucHVzaChrZXkudG9VcHBlckNhc2UoKSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2lkZ2V0Q3VycmVuY2llcy5wdXNoKGNvbmZpZy5lcmMyMHRva2VuLnRvVXBwZXJDYXNlKCkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGN1cnJlbmNpZXMgPSBhY3Rpb25zLmNvcmUuZ2V0V2FsbGV0cyh7fSkuZmlsdGVyKGZ1bmN0aW9uIChfcmVmNykgewogICAgICAgIHZhciBpc01ldGFtYXNrID0gX3JlZjcuaXNNZXRhbWFzaywKICAgICAgICAgICAgaXNDb25uZWN0ZWQgPSBfcmVmNy5pc0Nvbm5lY3RlZCwKICAgICAgICAgICAgY3VycmVuY3kgPSBfcmVmNy5jdXJyZW5jeSwKICAgICAgICAgICAgYWRkcmVzcyA9IF9yZWY3LmFkZHJlc3MsCiAgICAgICAgICAgIGJhbGFuY2UgPSBfcmVmNy5iYWxhbmNlOwogICAgICAgIHJldHVybiAoY29udGV4dCA9PT0gJ1NlbmQnID8gYmFsYW5jZSA6IHRydWUpICYmICFoaWRkZW5Db2luc0xpc3QuaW5jbHVkZXMoY3VycmVuY3kpICYmICFoaWRkZW5Db2luc0xpc3QuaW5jbHVkZXMoIiIuY29uY2F0KGN1cnJlbmN5LCAiOiIpLmNvbmNhdChhZGRyZXNzKSkgJiYgZW5hYmxlZEN1cnJlbmNpZXMuaW5jbHVkZXMoY3VycmVuY3kpICYmICghaXNNZXRhbWFzayB8fCBpc01ldGFtYXNrICYmIGlzQ29ubmVjdGVkKSAmJiAoaXNXaWRnZXRCdWlsZCA/IHdpZGdldEN1cnJlbmNpZXMuaW5jbHVkZXMoY3VycmVuY3kpIDogdHJ1ZSk7CiAgICAgIH0pOwogICAgICBhY3Rpb25zLm1vZGFscy5vcGVuKGNvbnN0YW50cy5tb2RhbHMuQ3VycmVuY3lBY3Rpb24sIHsKICAgICAgICBjdXJyZW5jaWVzOiBjdXJyZW5jaWVzLAogICAgICAgIGNvbnRleHQ6IGNvbnRleHQKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJoYW5kbGVXaXRoZHJhd0ZpcnN0QXNzZXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBoaWRkZW5Db2luc0xpc3QgPSBfdGhpcy5wcm9wcy5oaWRkZW5Db2luc0xpc3Q7CiAgICAgIHZhciBfdGhpcyRwcm9wczMgPSBfdGhpcy5wcm9wcywKICAgICAgICAgIGhpc3RvcnkgPSBfdGhpcyRwcm9wczMuaGlzdG9yeSwKICAgICAgICAgIGxvY2FsZSA9IF90aGlzJHByb3BzMy5pbnRsLmxvY2FsZTsKICAgICAgdmFyIGFsbERhdGEgPSBhY3Rpb25zLmNvcmUuZ2V0V2FsbGV0cyh7fSk7CiAgICAgIHZhciB0YWJsZVJvd3MgPSBhbGxEYXRhLmZpbHRlcihmdW5jdGlvbiAoX3JlZjgpIHsKICAgICAgICB2YXIgY3VycmVuY3kgPSBfcmVmOC5jdXJyZW5jeSwKICAgICAgICAgICAgYWRkcmVzcyA9IF9yZWY4LmFkZHJlc3MsCiAgICAgICAgICAgIGJhbGFuY2UgPSBfcmVmOC5iYWxhbmNlOwogICAgICAgIC8vIEBUb0RvIC0g0JIg0LHRg9C00YPRidC10Lwg0L3Rg9C20L3QviDRg9Cx0YDQsNGC0Ywg0L/RgNC+0LLQtdGA0LrRgyDRgtC+0LvRjNC60L4g0L/QviDRgtC40L/RgyDQvNC+0L3QtdGC0YsuCiAgICAgICAgLy8g0KHRgtCw0YDRg9GOINC/0YDQvtCy0LXRgNC60YMg0L7RgdGC0LDQstC40LssINGH0YLQvtCx0Ysg0YMg0YHRgtCw0YDRi9GFINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvQtdC5INC90LUg0LLRi9Cy0LDQu9C40LvQuNGB0Ywg0YHQutGA0YvRgtGL0LUg0LrQvtGI0LXQu9GM0LrQuAogICAgICAgIHJldHVybiAhaGlkZGVuQ29pbnNMaXN0LmluY2x1ZGVzKGN1cnJlbmN5KSAmJiAhaGlkZGVuQ29pbnNMaXN0LmluY2x1ZGVzKCIiLmNvbmNhdChjdXJyZW5jeSwgIjoiKS5jb25jYXQoYWRkcmVzcykpICYmIGJhbGFuY2UgPiAwOwogICAgICB9KTsKCiAgICAgIGlmICh0YWJsZVJvd3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgLy8gQFRvRG8gQWxlcnRNb2RhbCAtIGJhbGFuY2UgaXMgZW1wdHkKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBfdGFibGVSb3dzJCA9IHRhYmxlUm93c1swXSwKICAgICAgICAgIGN1cnJlbmN5ID0gX3RhYmxlUm93cyQuY3VycmVuY3ksCiAgICAgICAgICBhZGRyZXNzID0gX3RhYmxlUm93cyQuYWRkcmVzczsKICAgICAgdmFyIHRhcmdldEN1cnJlbmN5ID0gY3VycmVuY3k7CgogICAgICBzd2l0Y2ggKGN1cnJlbmN5LnRvTG93ZXJDYXNlKCkpIHsKICAgICAgICBjYXNlICdidGMgKG11bHRpc2lnKSc6CiAgICAgICAgY2FzZSAnYnRjIChzbXMtcHJvdGVjdGVkKSc6CiAgICAgICAgY2FzZSAnYnRjIChwaW4tcHJvdGVjdGVkKSc6CiAgICAgICAgICB0YXJnZXRDdXJyZW5jeSA9ICdidGMnOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHZhciBpc1Rva2VuID0gaGVscGVycy5ldGhUb2tlbi5pc0V0aFRva2VuKHsKICAgICAgICBuYW1lOiBjdXJyZW5jeQogICAgICB9KTsKICAgICAgaGlzdG9yeS5wdXNoKGxvY2FsaXNlZFVybChsb2NhbGUsIChpc1Rva2VuID8gJy90b2tlbicgOiAnJykgKyAiLyIuY29uY2F0KHRhcmdldEN1cnJlbmN5LCAiLyIpLmNvbmNhdChhZGRyZXNzLCAiL3NlbmQiKSkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic3luY0RhdGEiLCBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIHRoYXQgaXMgZm9yIG5veG9uLCBkb250IGRlbGV0ZSBpdCA6KQogICAgICB2YXIgbm93ID0gbW9tZW50KCkuZm9ybWF0KCdISDptbTpzcyBERC9NTS9ZWVlZJyk7CiAgICAgIHZhciBsYXN0Q2hlY2sgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMubG9jYWxTdG9yYWdlLmxhc3RDaGVja0JhbGFuY2UpIHx8IG5vdzsKICAgICAgdmFyIGxhc3RDaGVja01vbWVudCA9IG1vbWVudChsYXN0Q2hlY2ssICdISDptbTpzcyBERC9NTS9ZWVlZJyk7CiAgICAgIHZhciBpc0ZpcnN0Q2hlY2sgPSBtb21lbnQobm93LCAnSEg6bW06c3MgREQvTU0vWVlZWScpLmlzU2FtZShsYXN0Q2hlY2tNb21lbnQpOwogICAgICB2YXIgaXNPbmVIb3VyQWZ0ZXIgPSBtb21lbnQobm93LCAnSEg6bW06c3MgREQvTU0vWVlZWScpLmlzQWZ0ZXIobGFzdENoZWNrTW9tZW50LmFkZCgxLCAnaG91cnMnKSk7CiAgICAgIHZhciBfdGhpcyRwcm9wcyR0b2tlbnNEYXQgPSBfdGhpcy5wcm9wcy50b2tlbnNEYXRhLAogICAgICAgICAgZXRoRGF0YSA9IF90aGlzJHByb3BzJHRva2Vuc0RhdC5ldGhEYXRhLAogICAgICAgICAgYnRjRGF0YSA9IF90aGlzJHByb3BzJHRva2Vuc0RhdC5idGNEYXRhLAogICAgICAgICAgZ2hvc3REYXRhID0gX3RoaXMkcHJvcHMkdG9rZW5zRGF0Lmdob3N0RGF0YSwKICAgICAgICAgIG5leHREYXRhID0gX3RoaXMkcHJvcHMkdG9rZW5zRGF0Lm5leHREYXRhOwogICAgICB2YXIgYmFsYW5jZXNEYXRhID0gewogICAgICAgIGV0aEJhbGFuY2U6IGV0aERhdGEuYmFsYW5jZSwKICAgICAgICBidGNCYWxhbmNlOiBidGNEYXRhLmJhbGFuY2UsCiAgICAgICAgZ2hvc3RCYWxhbmNlOiBnaG9zdERhdGEuYmFsYW5jZSwKICAgICAgICBuZXh0QmFsYW5jZTogbmV4dERhdGEuYmFsYW5jZSwKICAgICAgICBldGhBZGRyZXNzOiBldGhEYXRhLmFkZHJlc3MsCiAgICAgICAgYnRjQWRkcmVzczogYnRjRGF0YS5hZGRyZXNzLAogICAgICAgIGdob3N0QWRkcmVzczogZ2hvc3REYXRhLmFkZHJlc3MsCiAgICAgICAgbmV4dEFkZHJlc3M6IG5leHREYXRhLmFkZHJlc3MKICAgICAgfTsgLy9ACgogICAgICBfdGhpcy5zeW5jVGltZXIgPSBzZXRUaW1lb3V0KCAvKiNfX1BVUkVfXyovX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyIGlwSW5mbywgcmVnaXN0cmF0aW9uRGF0YSwgd2lkZ2V0VXJsLCB0b2tlbnNBcnJheSwgd2FsbGV0czsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICghKGlzT25lSG91ckFmdGVyIHx8IGlzRmlyc3RDaGVjaykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oY29uc3RhbnRzLmxvY2FsU3RvcmFnZS5sYXN0Q2hlY2tCYWxhbmNlLCBub3cpOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAyOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRzLmdldElQSW5mbygpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBpcEluZm8gPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIHJlZ2lzdHJhdGlvbkRhdGEgPSB7CiAgICAgICAgICAgICAgICAgIGxvY2FsZTogaXBJbmZvLmxvY2FsZSB8fCAobmF2aWdhdG9yLnVzZXJMYW5ndWFnZSB8fCBuYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgJ2VuLWdiJykuc3BsaXQoJy0nKVswXSwKICAgICAgICAgICAgICAgICAgaXA6IGlwSW5mby5pcAogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMucHJvcHMubWVzc2FnaW5nVG9rZW4pIHsKICAgICAgICAgICAgICAgICAgLy9ACiAgICAgICAgICAgICAgICAgIHJlZ2lzdHJhdGlvbkRhdGEubWVzc2FnaW5nX3Rva2VuID0gX3RoaXMucHJvcHMubWVzc2FnaW5nVG9rZW47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGFwcENvbmZpZy5pc1dpZGdldCkgewogICAgICAgICAgICAgICAgICB3aWRnZXRVcmwgPSBnZXRUb3BMb2NhdGlvbigpLm9yaWdpbjsgLy9ACgogICAgICAgICAgICAgICAgICByZWdpc3RyYXRpb25EYXRhLndpZGdldF91cmwgPSB3aWRnZXRVcmw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdG9rZW5zQXJyYXkgPSBPYmplY3QudmFsdWVzKF90aGlzLnByb3BzLnRva2Vuc0RhdGEpOwogICAgICAgICAgICAgICAgd2FsbGV0cyA9IHRva2Vuc0FycmF5Lm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHN5bWJvbDogaXRlbSAmJiBpdGVtLmN1cnJlbmN5ID8gaXRlbS5jdXJyZW5jeS5zcGxpdCgnICcpWzBdIDogJycsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogaXRlbSAmJiBpdGVtLmN1cnJlbmN5ID8gaXRlbS5jdXJyZW5jeS5zcGxpdCgnICcpWzFdIHx8ICdjb21tb24nIDogJycsCiAgICAgICAgICAgICAgICAgICAgYWRkcmVzczogaXRlbSAmJiBpdGVtLmFkZHJlc3MgPyBpdGVtLmFkZHJlc3MgOiAnJywKICAgICAgICAgICAgICAgICAgICBiYWxhbmNlOiBpdGVtICYmIGl0ZW0uYmFsYW5jZSA/IG5ldyBCaWdOdW1iZXIoaXRlbS5iYWxhbmNlKS50b051bWJlcigpIDogMCwKICAgICAgICAgICAgICAgICAgICBwdWJsaWNfa2V5OiBpdGVtICYmIGl0ZW0ucHVibGljS2V5ID8gaXRlbS5wdWJsaWNLZXkudG9TdHJpbmcoJ0hleCcpIDogJycgLy8gVE9ETzogbGV0IHRoaXMgd29yawogICAgICAgICAgICAgICAgICAgIC8vIG5vdW5jZTogMSwKICAgICAgICAgICAgICAgICAgICAvLyBzaWduYXR1cmVzX3JlcXVpcmVkOiAxLAogICAgICAgICAgICAgICAgICAgIC8vIHNpZ25hdG9yaWVzOiBbXSwKCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KTsgLy9ACgogICAgICAgICAgICAgICAgcmVnaXN0cmF0aW9uRGF0YS53YWxsZXRzID0gd2FsbGV0czsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdHMudXBkYXRlVXNlcihldGhEYXRhLmFkZHJlc3MsIGdldFRvcExvY2F0aW9uKCkuaG9zdCwgcmVnaXN0cmF0aW9uRGF0YSk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDE2OwogICAgICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gX2NvbnRleHQyWyJjYXRjaCJdKDIpOwogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiU3luYyBlcnJvciBpbiB3YWxsZXQ6ICIuY29uY2F0KF9jb250ZXh0Mi50MCkpOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCBudWxsLCBbWzIsIDE2XV0pOwogICAgICB9KSksIDIwMDApOwogICAgfSk7CgogICAgdmFyIF9wcm9wcyRtYXRjaCRwYXJhbXMkcCA9IHByb3BzLm1hdGNoLnBhcmFtcy5wYWdlLAogICAgICAgIHBhZ2UgPSBfcHJvcHMkbWF0Y2gkcGFyYW1zJHAgPT09IHZvaWQgMCA/IG51bGwgOiBfcHJvcHMkbWF0Y2gkcGFyYW1zJHAsCiAgICAgICAgbXVsdGlzaWdQZW5kaW5nQ291bnQgPSBwcm9wcy5tdWx0aXNpZ1BlbmRpbmdDb3VudDsKICAgIHZhciBhY3RpdmVWaWV3ID0gMDsKCiAgICBpZiAocGFnZSA9PT0gJ2hpc3RvcnknICYmICFpc01vYmlsZSkgewogICAgICBhY3RpdmVWaWV3ID0gMTsKICAgIH0KCiAgICBpZiAocGFnZSA9PT0gJ2ludm9pY2VzJykgYWN0aXZlVmlldyA9IDI7CiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgYWN0aXZlVmlldzogYWN0aXZlVmlldywKICAgICAgYnRjQmFsYW5jZTogMCwKICAgICAgZW5hYmxlZEN1cnJlbmNpZXM6IGdldEFjdGl2YXRlZEN1cnJlbmNpZXMoKSwKICAgICAgbXVsdGlzaWdQZW5kaW5nQ291bnQ6IG11bHRpc2lnUGVuZGluZ0NvdW50CiAgICB9OyAvL0AKCiAgICBfdGhpcy5zeW5jVGltZXIgPSBudWxsOwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFdhbGxldCwgW3sKICAgIGtleTogImhhbmRsZUNvbm5lY3RXYWxsZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZUNvbm5lY3RXYWxsZXQoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczQgPSB0aGlzLnByb3BzLAogICAgICAgICAgaGlzdG9yeSA9IF90aGlzJHByb3BzNC5oaXN0b3J5LAogICAgICAgICAgbG9jYWxlID0gX3RoaXMkcHJvcHM0LmludGwubG9jYWxlOwoKICAgICAgaWYgKG1ldGFtYXNrLmlzQ29ubmVjdGVkKCkpIHsKICAgICAgICBoaXN0b3J5LnB1c2gobG9jYWxpc2VkVXJsKGxvY2FsZSwgbGlua3MuaG9tZSkpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgbWV0YW1hc2suY29ubmVjdCh7fSk7CiAgICAgIH0sIDEwMCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50RGlkVXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczUgPSB0aGlzLnByb3BzLAogICAgICAgICAgX3RoaXMkcHJvcHM1JG1hdGNoJHBhID0gX3RoaXMkcHJvcHM1Lm1hdGNoLnBhcmFtcy5wYWdlLAogICAgICAgICAgcGFnZSA9IF90aGlzJHByb3BzNSRtYXRjaCRwYSA9PT0gdm9pZCAwID8gbnVsbCA6IF90aGlzJHByb3BzNSRtYXRjaCRwYSwKICAgICAgICAgIG11bHRpc2lnUGVuZGluZ0NvdW50ID0gX3RoaXMkcHJvcHM1Lm11bHRpc2lnUGVuZGluZ0NvdW50LAogICAgICAgICAgaW50bCA9IF90aGlzJHByb3BzNS5pbnRsLAogICAgICAgICAgbG9jYWxlID0gX3RoaXMkcHJvcHM1LmludGwubG9jYWxlLAogICAgICAgICAgcGF0aG5hbWUgPSBfdGhpcyRwcm9wczUubG9jYXRpb24ucGF0aG5hbWUsCiAgICAgICAgICBoaXN0b3J5ID0gX3RoaXMkcHJvcHM1Lmhpc3Rvcnk7CiAgICAgIHZhciBwcmV2UGF0aG5hbWUgPSBwcmV2UHJvcHMubG9jYXRpb24ucGF0aG5hbWU7CgogICAgICBpZiAocGF0aG5hbWUudG9Mb3dlckNhc2UoKSAhPSBwcmV2UGF0aG5hbWUudG9Mb3dlckNhc2UoKSAmJiBwYXRobmFtZS50b0xvd2VyQ2FzZSgpID09IGxpbmtzLmNvbm5lY3RXYWxsZXQudG9Mb3dlckNhc2UoKSkgewogICAgICAgIHRoaXMuaGFuZGxlQ29ubmVjdFdhbGxldCgpOwogICAgICB9CgogICAgICB2YXIgX3ByZXZQcm9wcyRtYXRjaCRwYXJhID0gcHJldlByb3BzLm1hdGNoLnBhcmFtcy5wYWdlLAogICAgICAgICAgcHJldlBhZ2UgPSBfcHJldlByb3BzJG1hdGNoJHBhcmEgPT09IHZvaWQgMCA/IG51bGwgOiBfcHJldlByb3BzJG1hdGNoJHBhcmEsCiAgICAgICAgICBwcmV2TXVsdGlzaWdQZW5kaW5nQ291bnQgPSBwcmV2UHJvcHMubXVsdGlzaWdQZW5kaW5nQ291bnQ7CgogICAgICBpZiAocGFnZSAhPT0gcHJldlBhZ2UgfHwgbXVsdGlzaWdQZW5kaW5nQ291bnQgIT09IHByZXZNdWx0aXNpZ1BlbmRpbmdDb3VudCkgewogICAgICAgIHZhciBhY3RpdmVWaWV3ID0gMDsKICAgICAgICBpZiAocGFnZSA9PT0gJ2hpc3RvcnknICYmICFpc01vYmlsZSkgYWN0aXZlVmlldyA9IDE7CiAgICAgICAgaWYgKHBhZ2UgPT09ICdpbnZvaWNlcycpIGFjdGl2ZVZpZXcgPSAyOwoKICAgICAgICBpZiAocGFnZSA9PT0gJ2V4aXQnKSB7CiAgICAgICAgICB3cExvZ291dE1vZGFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaGlzdG9yeS5wdXNoKGxvY2FsaXNlZFVybChsb2NhbGUsIGxpbmtzLmhvbWUpKTsKICAgICAgICAgIH0sIGludGwpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBhY3RpdmVWaWV3OiBhY3RpdmVWaWV3LAogICAgICAgICAgbXVsdGlzaWdQZW5kaW5nQ291bnQ6IG11bHRpc2lnUGVuZGluZ0NvdW50CiAgICAgICAgfSk7CiAgICAgIH0gLy9ACgoKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc3luY1RpbWVyKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczYgPSB0aGlzLnByb3BzLAogICAgICAgICAgX3RoaXMkcHJvcHM2JG1hdGNoID0gX3RoaXMkcHJvcHM2Lm1hdGNoLAogICAgICAgICAgcGFyYW1zID0gX3RoaXMkcHJvcHM2JG1hdGNoLnBhcmFtcywKICAgICAgICAgIHBhZ2UgPSBfdGhpcyRwcm9wczYkbWF0Y2gucGFyYW1zLnBhZ2UsCiAgICAgICAgICB1cmwgPSBfdGhpcyRwcm9wczYkbWF0Y2gudXJsLAogICAgICAgICAgbXVsdGlzaWdQZW5kaW5nQ291bnQgPSBfdGhpcyRwcm9wczYubXVsdGlzaWdQZW5kaW5nQ291bnQsCiAgICAgICAgICBoaXN0b3J5ID0gX3RoaXMkcHJvcHM2Lmhpc3RvcnksCiAgICAgICAgICBwYXRobmFtZSA9IF90aGlzJHByb3BzNi5sb2NhdGlvbi5wYXRobmFtZSwKICAgICAgICAgIGludGwgPSBfdGhpcyRwcm9wczYuaW50bCwKICAgICAgICAgIGxvY2FsZSA9IF90aGlzJHByb3BzNi5pbnRsLmxvY2FsZTsKCiAgICAgIGlmIChwYXRobmFtZS50b0xvd2VyQ2FzZSgpID09IGxpbmtzLmNvbm5lY3RXYWxsZXQudG9Mb3dlckNhc2UoKSkgewogICAgICAgIHRoaXMuaGFuZGxlQ29ubmVjdFdhbGxldCgpOwogICAgICB9CgogICAgICBhY3Rpb25zLnVzZXIuZ2V0QmFsYW5jZXMoKTsKICAgICAgYWN0aW9ucy51c2VyLmZldGNoTXVsdGlzaWdTdGF0dXMoKTsKCiAgICAgIGlmICh1cmwuaW5jbHVkZXMoJ3NlbmQnKSkgewogICAgICAgIHRoaXMuaGFuZGxlV2l0aGRyYXcocGFyYW1zKTsKICAgICAgfQoKICAgICAgaWYgKHBhZ2UgPT09ICdleGl0JykgewogICAgICAgIHdwTG9nb3V0TW9kYWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgaGlzdG9yeS5wdXNoKGxvY2FsaXNlZFVybChsb2NhbGUsIGxpbmtzLmhvbWUpKTsKICAgICAgICB9LCBpbnRsKTsKICAgICAgfQoKICAgICAgdGhpcy5nZXRJbmZvQWJvdXRDdXJyZW5jeSgpOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBtdWx0aXNpZ1BlbmRpbmdDb3VudDogbXVsdGlzaWdQZW5kaW5nQ291bnQKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50V2lsbFVubW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkgewogICAgICBjb25zb2xlLmxvZygnV2FsbGV0IHVubW91bnRlZCcpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUgPSB0aGlzLnN0YXRlLAogICAgICAgICAgYWN0aXZlVmlldyA9IF90aGlzJHN0YXRlLmFjdGl2ZVZpZXcsCiAgICAgICAgICBpbmZvQWJvdXRDdXJyZW5jeSA9IF90aGlzJHN0YXRlLmluZm9BYm91dEN1cnJlbmN5LAogICAgICAgICAgZW5hYmxlZEN1cnJlbmNpZXMgPSBfdGhpcyRzdGF0ZS5lbmFibGVkQ3VycmVuY2llcywKICAgICAgICAgIG11bHRpc2lnUGVuZGluZ0NvdW50ID0gX3RoaXMkc3RhdGUubXVsdGlzaWdQZW5kaW5nQ291bnQ7CiAgICAgIHZhciBfdGhpcyRwcm9wczcgPSB0aGlzLnByb3BzLAogICAgICAgICAgaGlkZGVuQ29pbnNMaXN0ID0gX3RoaXMkcHJvcHM3LmhpZGRlbkNvaW5zTGlzdCwKICAgICAgICAgIGlzQmFsYW5jZUZldGNoaW5nID0gX3RoaXMkcHJvcHM3LmlzQmFsYW5jZUZldGNoaW5nLAogICAgICAgICAgYWN0aXZlRmlhdCA9IF90aGlzJHByb3BzNy5hY3RpdmVGaWF0LAogICAgICAgICAgYWN0aXZlQ3VycmVuY3kgPSBfdGhpcyRwcm9wczcuYWN0aXZlQ3VycmVuY3ksCiAgICAgICAgICBfdGhpcyRwcm9wczckbWF0Y2gkcGEgPSBfdGhpcyRwcm9wczcubWF0Y2gucGFyYW1zLnBhZ2UsCiAgICAgICAgICBwYWdlID0gX3RoaXMkcHJvcHM3JG1hdGNoJHBhID09PSB2b2lkIDAgPyBudWxsIDogX3RoaXMkcHJvcHM3JG1hdGNoJHBhOwogICAgICB2YXIgYWxsRGF0YSA9IGFjdGlvbnMuY29yZS5nZXRXYWxsZXRzKHt9KTsKICAgICAgdGhpcy5zeW5jRGF0YSgpOwogICAgICB2YXIgYnRjQmFsYW5jZSA9IDA7CiAgICAgIHZhciBjaGFuZ2VQZXJjZW50ID0gMDsgLy8g0J3QsNCx0L7RgCDQstCw0LvRjtGCINC00LvRjyDQstC40LTQttC10YLQsAoKICAgICAgdmFyIHdpZGdldEN1cnJlbmNpZXMgPSBbJ0JUQyddOwogICAgICBpZiAoIWhpZGRlbkNvaW5zTGlzdC5pbmNsdWRlcygnQlRDIChTTVMtUHJvdGVjdGVkKScpKSB3aWRnZXRDdXJyZW5jaWVzLnB1c2goJ0JUQyAoU01TLVByb3RlY3RlZCknKTsKICAgICAgaWYgKCFoaWRkZW5Db2luc0xpc3QuaW5jbHVkZXMoJ0JUQyAoUElOLVByb3RlY3RlZCknKSkgd2lkZ2V0Q3VycmVuY2llcy5wdXNoKCdCVEMgKFBJTi1Qcm90ZWN0ZWQpJyk7CiAgICAgIGlmICghaGlkZGVuQ29pbnNMaXN0LmluY2x1ZGVzKCdCVEMgKE11bHRpc2lnKScpKSB3aWRnZXRDdXJyZW5jaWVzLnB1c2goJ0JUQyAoTXVsdGlzaWcpJyk7CiAgICAgIHdpZGdldEN1cnJlbmNpZXMucHVzaCgnRVRIJyk7CiAgICAgIHdpZGdldEN1cnJlbmNpZXMucHVzaCgnR0hPU1QnKTsKICAgICAgd2lkZ2V0Q3VycmVuY2llcy5wdXNoKCdORVhUJyk7CgogICAgICBpZiAoaXNXaWRnZXRCdWlsZCkgewogICAgICAgIGlmICh3aW5kb3cud2lkZ2V0RVJDMjBUb2tlbnMgJiYgT2JqZWN0LmtleXMod2luZG93LndpZGdldEVSQzIwVG9rZW5zKS5sZW5ndGgpIHsKICAgICAgICAgIC8vIE11bHRpIHRva2VuIHdpZGdldCBidWlsZAogICAgICAgICAgT2JqZWN0LmtleXMod2luZG93LndpZGdldEVSQzIwVG9rZW5zKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgd2lkZ2V0Q3VycmVuY2llcy5wdXNoKGtleS50b1VwcGVyQ2FzZSgpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aWRnZXRDdXJyZW5jaWVzLnB1c2goY29uZmlnLmVyYzIwdG9rZW4udG9VcHBlckNhc2UoKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgdGFibGVSb3dzID0gYWxsRGF0YS5maWx0ZXIoZnVuY3Rpb24gKF9yZWYxMCkgewogICAgICAgIHZhciBjdXJyZW5jeSA9IF9yZWYxMC5jdXJyZW5jeSwKICAgICAgICAgICAgYWRkcmVzcyA9IF9yZWYxMC5hZGRyZXNzLAogICAgICAgICAgICBiYWxhbmNlID0gX3JlZjEwLmJhbGFuY2U7CiAgICAgICAgLy8gQFRvRG8gLSDQkiDQsdGD0LTRg9GJ0LXQvCDQvdGD0LbQvdC+INGD0LHRgNCw0YLRjCDQv9GA0L7QstC10YDQutGDINGC0L7Qu9GM0LrQviDQv9C+INGC0LjQv9GDINC80L7QvdC10YLRiy4KICAgICAgICAvLyDQodGC0LDRgNGD0Y4g0L/RgNC+0LLQtdGA0LrRgyDQvtGB0YLQsNCy0LjQuywg0YfRgtC+0LHRiyDRgyDRgdGC0LDRgNGL0YUg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C10Lkg0L3QtSDQstGL0LLQsNC70LjQu9C40YHRjCDRgdC60YDRi9GC0YvQtSDQutC+0YjQtdC70YzQutC4CiAgICAgICAgcmV0dXJuICFoaWRkZW5Db2luc0xpc3QuaW5jbHVkZXMoY3VycmVuY3kpICYmICFoaWRkZW5Db2luc0xpc3QuaW5jbHVkZXMoIiIuY29uY2F0KGN1cnJlbmN5LCAiOiIpLmNvbmNhdChhZGRyZXNzKSkgfHwgYmFsYW5jZSA+IDA7CiAgICAgIH0pOwoKICAgICAgaWYgKGlzV2lkZ2V0QnVpbGQpIHsKICAgICAgICAvL3RhYmxlUm93cyA9IGFsbERhdGEuZmlsdGVyKCh7IGN1cnJlbmN5IH0pID0+IHdpZGdldEN1cnJlbmNpZXMuaW5jbHVkZXMoY3VycmVuY3kpKQogICAgICAgIHRhYmxlUm93cyA9IGFsbERhdGEuZmlsdGVyKGZ1bmN0aW9uIChfcmVmMTEpIHsKICAgICAgICAgIHZhciBjdXJyZW5jeSA9IF9yZWYxMS5jdXJyZW5jeSwKICAgICAgICAgICAgICBhZGRyZXNzID0gX3JlZjExLmFkZHJlc3MsCiAgICAgICAgICAgICAgYmFsYW5jZSA9IF9yZWYxMS5iYWxhbmNlOwogICAgICAgICAgcmV0dXJuICFoaWRkZW5Db2luc0xpc3QuaW5jbHVkZXMoY3VycmVuY3kpICYmICFoaWRkZW5Db2luc0xpc3QuaW5jbHVkZXMoIiIuY29uY2F0KGN1cnJlbmN5LCAiOiIpLmNvbmNhdChhZGRyZXNzKSkgfHwgYmFsYW5jZSA+IDA7CiAgICAgICAgfSk7IC8vINCe0YLRhNC40LvRjNGC0YDRg9C10Lwg0LLQsNC70Y7RgtGLLCDQuNGB0LrQu9GO0YfQuNCyINGC0LUsINC60L7RgtC+0YDRi9C1INC90LUg0LjRgdC/0L7Qu9GM0LfRg9GO0YLRgdGPINCyINGN0YLQvtC8INCx0LjQu9C00LUKCiAgICAgICAgdGFibGVSb3dzID0gdGFibGVSb3dzLmZpbHRlcihmdW5jdGlvbiAoX3JlZjEyKSB7CiAgICAgICAgICB2YXIgY3VycmVuY3kgPSBfcmVmMTIuY3VycmVuY3k7CiAgICAgICAgICByZXR1cm4gd2lkZ2V0Q3VycmVuY2llcy5pbmNsdWRlcyhjdXJyZW5jeSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRhYmxlUm93cyA9IHRhYmxlUm93cy5maWx0ZXIoZnVuY3Rpb24gKF9yZWYxMykgewogICAgICAgIHZhciBjdXJyZW5jeSA9IF9yZWYxMy5jdXJyZW5jeTsKICAgICAgICByZXR1cm4gZW5hYmxlZEN1cnJlbmNpZXMuaW5jbHVkZXMoY3VycmVuY3kpOwogICAgICB9KTsKICAgICAgdGFibGVSb3dzID0gdGFibGVSb3dzLm1hcChmdW5jdGlvbiAoZWwpIHsKICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBlbCksIHt9LCB7CiAgICAgICAgICBiYWxhbmNlOiBlbC5iYWxhbmNlLAogICAgICAgICAgZmlhdEJhbGFuY2U6IGVsLmJhbGFuY2UgPiAwICYmIGVsLmluZm9BYm91dEN1cnJlbmN5ICYmIGVsLmluZm9BYm91dEN1cnJlbmN5LnByaWNlX2ZpYXQgPyBuZXcgQmlnTnVtYmVyKGVsLmJhbGFuY2UpLm11bHRpcGxpZWRCeShlbC5pbmZvQWJvdXRDdXJyZW5jeS5wcmljZV9maWF0KS5kcCgyLCBCaWdOdW1iZXIuUk9VTkRfRkxPT1IpIDogMAogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgdGFibGVSb3dzLmZvckVhY2goZnVuY3Rpb24gKF9yZWYxNCkgewogICAgICAgIHZhciBuYW1lID0gX3JlZjE0Lm5hbWUsCiAgICAgICAgICAgIGluZm9BYm91dEN1cnJlbmN5ID0gX3JlZjE0LmluZm9BYm91dEN1cnJlbmN5LAogICAgICAgICAgICBiYWxhbmNlID0gX3JlZjE0LmJhbGFuY2UsCiAgICAgICAgICAgIGN1cnJlbmN5ID0gX3JlZjE0LmN1cnJlbmN5OwogICAgICAgIHZhciBjdXJyTmFtZSA9IGN1cnJlbmN5IHx8IG5hbWU7CgogICAgICAgIGlmICgoIWlzV2lkZ2V0QnVpbGQgfHwgd2lkZ2V0Q3VycmVuY2llcy5pbmNsdWRlcyhjdXJyTmFtZSkpICYmIGluZm9BYm91dEN1cnJlbmN5ICYmIGJhbGFuY2UgIT09IDApIHsKICAgICAgICAgIGlmIChjdXJyTmFtZSA9PT0gJ0JUQycpIHsKICAgICAgICAgICAgY2hhbmdlUGVyY2VudCA9IGluZm9BYm91dEN1cnJlbmN5LnBlcmNlbnRfY2hhbmdlXzFoOwogICAgICAgICAgfQoKICAgICAgICAgIGJ0Y0JhbGFuY2UgKz0gYmFsYW5jZSAqIGluZm9BYm91dEN1cnJlbmN5LnByaWNlX2J0YzsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB2YXIgYWxsRmlhdEJhbGFuY2UgPSB0YWJsZVJvd3MucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGN1cikgewogICAgICAgIHJldHVybiBuZXcgQmlnTnVtYmVyKGN1ci5maWF0QmFsYW5jZSkucGx1cyhhY2MpOwogICAgICB9LCAwKTsKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KERhc2hib2FyZExheW91dCwgewogICAgICAgIHBhZ2U6IHBhZ2UsCiAgICAgICAgaXNEYXJrOiBpc0RhcmssCiAgICAgICAgQmFsYW5jZUZvcm06IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEJhbGFuY2VGb3JtLCB7CiAgICAgICAgICBpc0Rhcms6IGlzRGFyaywKICAgICAgICAgIGFjdGl2ZUZpYXQ6IGFjdGl2ZUZpYXQsCiAgICAgICAgICBmaWF0QmFsYW5jZTogYWxsRmlhdEJhbGFuY2UsCiAgICAgICAgICBjdXJyZW5jeUJhbGFuY2U6IGJ0Y0JhbGFuY2UsCiAgICAgICAgICBjaGFuZ2VQZXJjZW50OiBjaGFuZ2VQZXJjZW50LAogICAgICAgICAgYWN0aXZlQ3VycmVuY3k6IGFjdGl2ZUN1cnJlbmN5LAogICAgICAgICAgaGFuZGxlUmVjZWl2ZTogdGhpcy5oYW5kbGVNb2RhbE9wZW4sCiAgICAgICAgICBoYW5kbGVXaXRoZHJhdzogdGhpcy5oYW5kbGVXaXRoZHJhd0ZpcnN0QXNzZXQsCiAgICAgICAgICBoYW5kbGVFeGNoYW5nZTogdGhpcy5oYW5kbGVHb0V4Y2hhbmdlLAogICAgICAgICAgaXNGZXRjaGluZzogaXNCYWxhbmNlRmV0Y2hpbmcsCiAgICAgICAgICB0eXBlOiAid2FsbGV0IiwKICAgICAgICAgIGN1cnJlbmN5OiAiYnRjIiwKICAgICAgICAgIGluZm9BYm91dEN1cnJlbmN5OiBpbmZvQWJvdXRDdXJyZW5jeSwKICAgICAgICAgIG11bHRpc2lnUGVuZGluZ0NvdW50OiBtdWx0aXNpZ1BlbmRpbmdDb3VudAogICAgICAgIH0pCiAgICAgIH0sIGFjdGl2ZVZpZXcgPT09IDAgJiYgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQ3VycmVuY2llc0xpc3QsIHsKICAgICAgICBpc0Rhcms6ICEhaXNEYXJrLAogICAgICAgIHRhYmxlUm93czogdGFibGVSb3dzLAogICAgICAgIGhpZGRlbkNvaW5zTGlzdDogaGlkZGVuQ29pbnNMaXN0LAogICAgICAgIGdvVG/QoXJlYXRlV2FsbGV0OiB0aGlzLmdvVG/QoXJlYXRlV2FsbGV0LAogICAgICAgIG11bHRpc2lnUGVuZGluZ0NvdW50OiBtdWx0aXNpZ1BlbmRpbmdDb3VudAogICAgICB9KSwgYWN0aXZlVmlldyA9PT0gMSAmJiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChIaXN0b3J5LCBfZXh0ZW5kcyh7fSwgdGhpcy5wcm9wcywgewogICAgICAgIGlzRGFyazogaXNEYXJrCiAgICAgIH0pKSwgYWN0aXZlVmlldyA9PT0gMiAmJiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChJbnZvaWNlc0xpc3QsIF9leHRlbmRzKHt9LCB0aGlzLnByb3BzLCB7CiAgICAgICAgb25seVRhYmxlOiB0cnVlLAogICAgICAgIGlzRGFyazogaXNEYXJrCiAgICAgIH0pKSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gV2FsbGV0Owp9KENvbXBvbmVudCksIF90ZW1wKSkgfHwgX2NsYXNzKSB8fCBfY2xhc3MpIHx8IF9jbGFzcykgfHwgX2NsYXNzKSB8fCBfY2xhc3MpOwpleHBvcnQgeyBXYWxsZXQgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/front/shared/pages/Wallet/Wallet.tsx"],"names":["React","Component","connect","actions","cssModules","styles","isMobile","moment","History","helpers","links","constants","stats","localisedUrl","getActivatedCurrencies","getTopLocation","injectIntl","appConfig","config","withRouter","CurrenciesList","InvoicesList","DashboardLayout","BalanceForm","BigNumber","metamask","wpLogoutModal","feedback","isWidgetBuild","isWidget","isDark","localStorage","getItem","Wallet","hiddenCoinsList","core","user","activeFiat","ethData","btcData","ghostData","nextData","btcMultisigSMSData","btcMultisigUserData","btcMultisigUserDataList","tokensData","isFetching","isBalanceFetching","multisigPendingCount","activeCurrency","messagingToken","metamaskData","currencies","items","assets","createWallet","modals","dashboardModalsAllowed","ui","widgetMultiTokens","window","widgetERC20Tokens","Object","keys","length","forEach","key","push","toUpperCase","tokens","erc20token","map","k","currency","tokensItems","allData","account","keyPair","data","userEthAddress","address","dashboardView","isSigned","signUp","allowMultiple","props","currencyNames","name","getInfoAboutCurrency","params","amount","item","find","toLowerCase","open","Withdraw","toAddress","wallet","pressedAddCurrency","history","locale","intl","exchange","context","enabledCurrencies","state","widgetCurrencies","includes","getWallets","filter","isMetamask","isConnected","balance","CurrencyAction","tableRows","targetCurrency","isToken","ethToken","isEthToken","now","format","lastCheck","lastCheckBalance","lastCheckMoment","isFirstCheck","isSame","isOneHourAfter","isAfter","add","balancesData","ethBalance","btcBalance","ghostBalance","nextBalance","ethAddress","btcAddress","ghostAddress","nextAddress","syncTimer","setTimeout","setItem","getIPInfo","ipInfo","registrationData","navigator","userLanguage","language","split","ip","messaging_token","widgetUrl","origin","widget_url","tokensArray","values","wallets","symbol","type","toNumber","public_key","publicKey","toString","updateUser","host","console","error","match","page","activeView","home","prevProps","pathname","location","prevPathname","connectWallet","handleConnectWallet","prevPage","prevMultisigPendingCount","setState","clearTimeout","url","getBalances","fetchMultisigStatus","handleWithdraw","log","infoAboutCurrency","syncData","changePercent","el","fiatBalance","price_fiat","multipliedBy","dp","ROUND_FLOOR","currName","percent_change_1h","price_btc","allFiatBalance","reduce","acc","cur","plus","handleModalOpen","handleWithdrawFirstAsset","handleGoExchange","goToСreateWallet"],"mappings":"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","sourcesContent":["// @ts-nocheck\r\nimport React, { Component } from 'react'\r\n\r\nimport { connect } from 'redaction'\r\nimport actions from 'redux/actions'\r\n\r\nimport cssModules from 'react-css-modules'\r\nimport styles from './Wallet.scss'\r\nimport { isMobile } from 'react-device-detect'\r\nimport moment from 'moment'\r\n// import firestore from 'helpers/firebase/firestore'\r\n\r\nimport History from 'pages/History/History'\r\n\r\nimport helpers, {\r\n  // firebase,\r\n  links,\r\n  constants,\r\n  stats\r\n} from 'helpers'\r\nimport { localisedUrl } from 'helpers/locale'\r\nimport { getActivatedCurrencies } from 'helpers/user'\r\nimport getTopLocation from 'helpers/getTopLocation'\r\nimport { injectIntl } from 'react-intl'\r\n\r\nimport appConfig from 'app-config'\r\nimport config from 'helpers/externalConfig'\r\nimport { withRouter } from 'react-router-dom'\r\nimport CurrenciesList from './CurrenciesList'\r\nimport InvoicesList from 'pages/Invoices/InvoicesList'\r\n\r\nimport DashboardLayout from 'components/layout/DashboardLayout/DashboardLayout'\r\nimport BalanceForm from 'components/BalanceForm/BalanceForm'\r\n\r\nimport { BigNumber } from 'bignumber.js'\r\nimport metamask from 'helpers/metamask'\r\n\r\nimport wpLogoutModal from 'helpers/wpLogoutModal'\r\nimport feedback from 'shared/helpers/feedback'\r\n\r\nconst isWidgetBuild = config && config.isWidget\r\nconst isDark = localStorage.getItem(constants.localStorage.isDark)\r\n\r\n@connect(\r\n  ({\r\n    core: { hiddenCoinsList },\r\n    user,\r\n    user: {\r\n      activeFiat,\r\n      ethData,\r\n      btcData,\r\n      ghostData,\r\n      nextData,\r\n      btcMultisigSMSData,\r\n      btcMultisigUserData,\r\n      btcMultisigUserDataList,\r\n      tokensData,\r\n      isFetching,\r\n      isBalanceFetching,\r\n      multisigPendingCount,\r\n      activeCurrency,\r\n      messagingToken,\r\n      metamaskData,\r\n    },\r\n    currencies: { items: currencies },\r\n    createWallet: { currencies: assets },\r\n    modals,\r\n    ui: { dashboardModalsAllowed },\r\n  }) => {\r\n    let widgetMultiTokens = []\r\n    if (window.widgetERC20Tokens && Object.keys(window.widgetERC20Tokens).length) {\r\n      Object.keys(window.widgetERC20Tokens).forEach((key) => {\r\n        widgetMultiTokens.push(key.toUpperCase())\r\n      })\r\n    }\r\n    const tokens =\r\n      config && config.isWidget\r\n        ? window.widgetERC20Tokens && Object.keys(window.widgetERC20Tokens).length\r\n          ? widgetMultiTokens\r\n          : [config.erc20token.toUpperCase()]\r\n        : Object.keys(tokensData).map((k) => tokensData[k].currency)\r\n\r\n    const tokensItems = Object.keys(tokensData).map((k) => tokensData[k])\r\n\r\n    const allData = [\r\n      btcData,\r\n      btcMultisigSMSData,\r\n      btcMultisigUserData,\r\n      ethData,\r\n      ghostData,\r\n      nextData,\r\n      ...Object.keys(tokensData).map((k) => tokensData[k]),\r\n    ].map(({ account, keyPair, ...data }) => ({\r\n      ...data,\r\n    }))\r\n\r\n    const items = (config && config.isWidget\r\n      ? [btcData, ethData, ghostData, nextData]\r\n      : [btcData, btcMultisigSMSData, btcMultisigUserData, ethData, ghostData, nextData]\r\n    ).map((data) => data.currency)\r\n\r\n    return {\r\n      tokens,\r\n      items,\r\n      allData,\r\n      tokensItems,\r\n      messagingToken,\r\n      currencies,\r\n      assets,\r\n      isFetching,\r\n      isBalanceFetching,\r\n      multisigPendingCount,\r\n      hiddenCoinsList: hiddenCoinsList,\r\n      userEthAddress: ethData.address,\r\n      user,\r\n      activeCurrency,\r\n      activeFiat,\r\n      tokensData: {\r\n        ethData,\r\n        metamaskData: {\r\n          ...metamaskData,\r\n          currency: 'ETH Metamask',\r\n        },\r\n        btcData,\r\n        ghostData,\r\n        nextData,\r\n        btcMultisigSMSData,\r\n        btcMultisigUserData,\r\n        btcMultisigUserDataList,\r\n      },\r\n      dashboardView: dashboardModalsAllowed,\r\n      modals,\r\n    }\r\n  }\r\n)\r\n@injectIntl\r\n@withRouter\r\n@connect(({ signUp: { isSigned } }) => ({\r\n  isSigned,\r\n}))\r\n@cssModules(styles, { allowMultiple: true })\r\nexport default class Wallet extends Component<any, any> {\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    const {\r\n      match: {\r\n        params: { page = null },\r\n      },\r\n      multisigPendingCount,\r\n    } = props\r\n\r\n    let activeView = 0\r\n\r\n    if (page === 'history' && !isMobile) {\r\n      activeView = 1\r\n    }\r\n    if (page === 'invoices') activeView = 2\r\n\r\n    this.state = {\r\n      activeView,\r\n      btcBalance: 0,\r\n      enabledCurrencies: getActivatedCurrencies(),\r\n      multisigPendingCount,\r\n    }\r\n    //@\r\n    this.syncTimer = null\r\n  }\r\n\r\n  handleConnectWallet() {\r\n    const {\r\n      history,\r\n      intl: { locale },\r\n    } = this.props\r\n\r\n    if (metamask.isConnected()) {\r\n      history.push(localisedUrl(locale, links.home))\r\n      return\r\n    }\r\n\r\n    setTimeout(() => {\r\n      metamask.connect({})\r\n    }, 100)\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const {\r\n      match: {\r\n        params: { page = null },\r\n      },\r\n      multisigPendingCount,\r\n      intl,\r\n      intl: { locale },\r\n      location: { pathname },\r\n      history,\r\n    } = this.props\r\n\r\n    const {\r\n      location: { pathname: prevPathname },\r\n    } = prevProps\r\n\r\n    if (\r\n      pathname.toLowerCase() != prevPathname.toLowerCase() &&\r\n      pathname.toLowerCase() == links.connectWallet.toLowerCase()\r\n    ) {\r\n      this.handleConnectWallet()\r\n    }\r\n\r\n    const {\r\n      match: {\r\n        params: { page: prevPage = null },\r\n      },\r\n      multisigPendingCount: prevMultisigPendingCount,\r\n    } = prevProps\r\n\r\n    if (page !== prevPage || multisigPendingCount !== prevMultisigPendingCount) {\r\n      let activeView = 0\r\n\r\n      if (page === 'history' && !isMobile) activeView = 1\r\n      if (page === 'invoices') activeView = 2\r\n\r\n      if (page === 'exit') {\r\n        wpLogoutModal(() => {\r\n          history.push(localisedUrl(locale, links.home))\r\n        }, intl)\r\n      }\r\n\r\n      this.setState({\r\n        activeView,\r\n        multisigPendingCount,\r\n      })\r\n    }\r\n    //@\r\n    clearTimeout(this.syncTimer)\r\n  }\r\n\r\n  componentDidMount() {\r\n    const {\r\n      match: {\r\n        params,\r\n        params: { page },\r\n        url,\r\n      },\r\n      multisigPendingCount,\r\n      history,\r\n      location: { pathname },\r\n      intl,\r\n      intl: { locale },\r\n    } = this.props\r\n\r\n    if (pathname.toLowerCase() == links.connectWallet.toLowerCase()) {\r\n      this.handleConnectWallet()\r\n    }\r\n\r\n    actions.user.getBalances()\r\n\r\n    actions.user.fetchMultisigStatus()\r\n\r\n    if (url.includes('send')) {\r\n      this.handleWithdraw(params)\r\n    }\r\n\r\n    if (page === 'exit') {\r\n      wpLogoutModal(() => {\r\n        history.push(localisedUrl(locale, links.home))\r\n      }, intl)\r\n    }\r\n    this.getInfoAboutCurrency()\r\n    this.setState({\r\n      multisigPendingCount,\r\n    })\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    console.log('Wallet unmounted')\r\n  }\r\n\r\n  getInfoAboutCurrency = async () => {\r\n    const { currencies } = this.props\r\n    const currencyNames = currencies.map(({ name }) => name)\r\n\r\n    await actions.user.getInfoAboutCurrency(currencyNames)\r\n  }\r\n\r\n  handleWithdraw = (params) => {\r\n    const { allData } = this.props\r\n    const { address, amount } = params\r\n    const item = allData.find(\r\n      ({ currency }) => currency.toLowerCase() === params.currency.toLowerCase()\r\n    )\r\n\r\n    actions.modals.open(constants.modals.Withdraw, {\r\n      ...item,\r\n      toAddress: address,\r\n      amount,\r\n    })\r\n  }\r\n\r\n  goToСreateWallet = () => {\r\n    feedback.wallet.pressedAddCurrency()\r\n    const {\r\n      history,\r\n      intl: { locale },\r\n    } = this.props\r\n\r\n    history.push(localisedUrl(locale, links.createWallet))\r\n  }\r\n\r\n  handleGoExchange = () => {\r\n    const {\r\n      history,\r\n      intl: { locale },\r\n    } = this.props\r\n\r\n    history.push(localisedUrl(locale, links.exchange))\r\n  }\r\n\r\n  handleModalOpen = (context) => {\r\n    const { enabledCurrencies } = this.state\r\n    const { hiddenCoinsList } = this.props\r\n\r\n    /* @ToDo Вынести отдельно */\r\n    // Набор валют для виджета\r\n    const widgetCurrencies = ['BTC']\r\n    if (!hiddenCoinsList.includes('BTC (SMS-Protected)'))\r\n      widgetCurrencies.push('BTC (SMS-Protected)')\r\n    if (!hiddenCoinsList.includes('BTC (PIN-Protected)'))\r\n      widgetCurrencies.push('BTC (PIN-Protected)')\r\n    if (!hiddenCoinsList.includes('BTC (Multisig)')) widgetCurrencies.push('BTC (Multisig)')\r\n    widgetCurrencies.push('ETH')\r\n    widgetCurrencies.push('GHOST')\r\n    widgetCurrencies.push('NEXT')\r\n    if (isWidgetBuild) {\r\n      if (window.widgetERC20Tokens && Object.keys(window.widgetERC20Tokens).length) {\r\n        // Multi token widget build\r\n        Object.keys(window.widgetERC20Tokens).forEach((key) => {\r\n          widgetCurrencies.push(key.toUpperCase())\r\n        })\r\n      } else {\r\n        widgetCurrencies.push(config.erc20token.toUpperCase())\r\n      }\r\n    }\r\n\r\n    const currencies = actions.core\r\n      .getWallets({})\r\n      .filter(({ isMetamask, isConnected, currency, address, balance }) => {\r\n        return (\r\n          (context === 'Send' ? balance : true) &&\r\n          !hiddenCoinsList.includes(currency) &&\r\n          !hiddenCoinsList.includes(`${currency}:${address}`) &&\r\n          enabledCurrencies.includes(currency) &&\r\n          (!isMetamask || (isMetamask && isConnected)) &&\r\n          (isWidgetBuild ? widgetCurrencies.includes(currency) : true)\r\n        )\r\n      })\r\n\r\n    actions.modals.open(constants.modals.CurrencyAction, {\r\n      currencies,\r\n      context,\r\n    })\r\n  }\r\n\r\n  handleWithdrawFirstAsset = () => {\r\n    const { hiddenCoinsList } = this.props\r\n    const {\r\n      history,\r\n      intl: { locale },\r\n    } = this.props\r\n\r\n    const allData = actions.core.getWallets({})\r\n\r\n    let tableRows = allData.filter(({ currency, address, balance }) => {\r\n      // @ToDo - В будущем нужно убрать проверку только по типу монеты.\r\n      // Старую проверку оставил, чтобы у старых пользователей не вывалились скрытые кошельки\r\n\r\n      return (\r\n        !hiddenCoinsList.includes(currency) &&\r\n        !hiddenCoinsList.includes(`${currency}:${address}`) &&\r\n        balance > 0\r\n      )\r\n    })\r\n\r\n    if (tableRows.length === 0) {\r\n      // @ToDo AlertModal - balance is empty\r\n      return\r\n    }\r\n\r\n    const { currency, address } = tableRows[0]\r\n\r\n    let targetCurrency = currency\r\n    switch (currency.toLowerCase()) {\r\n      case 'btc (multisig)':\r\n      case 'btc (sms-protected)':\r\n      case 'btc (pin-protected)':\r\n        targetCurrency = 'btc'\r\n        break\r\n    }\r\n\r\n    const isToken = helpers.ethToken.isEthToken({ name: currency })\r\n\r\n    history.push(\r\n      localisedUrl(locale, (isToken ? '/token' : '') + `/${targetCurrency}/${address}/send`)\r\n    )\r\n  }\r\n\r\n  syncData = () => {\r\n    // that is for noxon, dont delete it :)\r\n    const now = moment().format('HH:mm:ss DD/MM/YYYY')\r\n    const lastCheck = localStorage.getItem(constants.localStorage.lastCheckBalance) || now\r\n    const lastCheckMoment = moment(lastCheck, 'HH:mm:ss DD/MM/YYYY')\r\n\r\n    const isFirstCheck = moment(now, 'HH:mm:ss DD/MM/YYYY').isSame(lastCheckMoment)\r\n    const isOneHourAfter = moment(now, 'HH:mm:ss DD/MM/YYYY').isAfter(\r\n      lastCheckMoment.add(1, 'hours')\r\n    )\r\n\r\n    const { ethData, btcData, ghostData, nextData } = this.props.tokensData\r\n\r\n    const balancesData = {\r\n      ethBalance: ethData.balance,\r\n      btcBalance: btcData.balance,\r\n      ghostBalance: ghostData.balance,\r\n      nextBalance: nextData.balance,\r\n      ethAddress: ethData.address,\r\n      btcAddress: btcData.address,\r\n      ghostAddress: ghostData.address,\r\n      nextAddress: nextData.address,\r\n    }\r\n\r\n    //@\r\n    this.syncTimer = setTimeout(async () => {\r\n      if (isOneHourAfter || isFirstCheck) {\r\n        localStorage.setItem(constants.localStorage.lastCheckBalance, now)\r\n        try {\r\n          const ipInfo = await stats.getIPInfo()\r\n\r\n          const registrationData = {\r\n            locale:\r\n              ipInfo.locale ||\r\n              (navigator.userLanguage || navigator.language || 'en-gb').split('-')[0],\r\n            ip: ipInfo.ip,\r\n          }\r\n\r\n          if (this.props.messagingToken) {\r\n            //@\r\n            registrationData.messaging_token = this.props.messagingToken\r\n          }\r\n          let widgetUrl\r\n          if (appConfig.isWidget) {\r\n            widgetUrl = getTopLocation().origin\r\n            //@\r\n            registrationData.widget_url = widgetUrl\r\n          }\r\n\r\n          const tokensArray: any[] = Object.values(this.props.tokensData)\r\n\r\n          const wallets = tokensArray.map((item) => ({\r\n            symbol: item && item.currency ? item.currency.split(' ')[0] : '',\r\n            type: item && item.currency ? item.currency.split(' ')[1] || 'common' : '',\r\n            address: item && item.address ? item.address : '',\r\n            balance: item && item.balance ? new BigNumber(item.balance).toNumber() : 0,\r\n            public_key: item && item.publicKey ? item.publicKey.toString('Hex') : '',\r\n            // TODO: let this work\r\n            // nounce: 1,\r\n            // signatures_required: 1,\r\n            // signatories: [],\r\n          }))\r\n          //@\r\n          registrationData.wallets = wallets\r\n\r\n          await stats.updateUser(ethData.address, getTopLocation().host, registrationData)\r\n\r\n          // firestore.updateUserData(balancesData)\r\n        } catch (error) {\r\n          console.error(`Sync error in wallet: ${error}`)\r\n        }\r\n      }\r\n    }, 2000)\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      activeView,\r\n      infoAboutCurrency,\r\n      enabledCurrencies,\r\n      multisigPendingCount,\r\n    } = this.state\r\n\r\n    const {\r\n      hiddenCoinsList,\r\n      isBalanceFetching,\r\n      activeFiat,\r\n      activeCurrency,\r\n      match: {\r\n        params: { page = null },\r\n      },\r\n    } = this.props\r\n\r\n    const allData = actions.core.getWallets({})\r\n\r\n    this.syncData()\r\n\r\n    let btcBalance = 0\r\n    let changePercent = 0\r\n\r\n    // Набор валют для виджета\r\n    const widgetCurrencies = ['BTC']\r\n    if (!hiddenCoinsList.includes('BTC (SMS-Protected)'))\r\n      widgetCurrencies.push('BTC (SMS-Protected)')\r\n    if (!hiddenCoinsList.includes('BTC (PIN-Protected)'))\r\n      widgetCurrencies.push('BTC (PIN-Protected)')\r\n    if (!hiddenCoinsList.includes('BTC (Multisig)')) widgetCurrencies.push('BTC (Multisig)')\r\n    widgetCurrencies.push('ETH')\r\n    widgetCurrencies.push('GHOST')\r\n    widgetCurrencies.push('NEXT')\r\n    if (isWidgetBuild) {\r\n      if (window.widgetERC20Tokens && Object.keys(window.widgetERC20Tokens).length) {\r\n        // Multi token widget build\r\n        Object.keys(window.widgetERC20Tokens).forEach((key) => {\r\n          widgetCurrencies.push(key.toUpperCase())\r\n        })\r\n      } else {\r\n        widgetCurrencies.push(config.erc20token.toUpperCase())\r\n      }\r\n    }\r\n\r\n    let tableRows = allData.filter(({ currency, address, balance }) => {\r\n      // @ToDo - В будущем нужно убрать проверку только по типу монеты.\r\n      // Старую проверку оставил, чтобы у старых пользователей не вывалились скрытые кошельки\r\n\r\n      return (\r\n        (!hiddenCoinsList.includes(currency) &&\r\n          !hiddenCoinsList.includes(`${currency}:${address}`)) ||\r\n        balance > 0\r\n      )\r\n    })\r\n\r\n    if (isWidgetBuild) {\r\n      //tableRows = allData.filter(({ currency }) => widgetCurrencies.includes(currency))\r\n      tableRows = allData.filter(\r\n        ({ currency, address, balance }) =>\r\n          (!hiddenCoinsList.includes(currency) &&\r\n            !hiddenCoinsList.includes(`${currency}:${address}`)) ||\r\n          balance > 0\r\n      )\r\n      // Отфильтруем валюты, исключив те, которые не используются в этом билде\r\n      tableRows = tableRows.filter(({ currency }) => widgetCurrencies.includes(currency))\r\n    }\r\n\r\n    tableRows = tableRows.filter(({ currency }) => enabledCurrencies.includes(currency))\r\n\r\n    tableRows = tableRows.map((el) => {\r\n      return {\r\n        ...el,\r\n        balance: el.balance,\r\n        fiatBalance:\r\n          el.balance > 0 && el.infoAboutCurrency && el.infoAboutCurrency.price_fiat\r\n            ? new BigNumber(el.balance)\r\n                .multipliedBy(el.infoAboutCurrency.price_fiat)\r\n                .dp(2, BigNumber.ROUND_FLOOR)\r\n            : 0,\r\n      }\r\n    })\r\n\r\n    tableRows.forEach(({ name, infoAboutCurrency, balance, currency }) => {\r\n      const currName = currency || name\r\n\r\n      if (\r\n        (!isWidgetBuild || widgetCurrencies.includes(currName)) &&\r\n        infoAboutCurrency &&\r\n        balance !== 0\r\n      ) {\r\n        if (currName === 'BTC') {\r\n          changePercent = infoAboutCurrency.percent_change_1h\r\n        }\r\n        btcBalance += balance * infoAboutCurrency.price_btc\r\n      }\r\n    })\r\n\r\n    const allFiatBalance = tableRows.reduce((acc, cur) => new BigNumber(cur.fiatBalance).plus(acc), 0)\r\n\r\n    return (\r\n      <DashboardLayout\r\n        page={page}\r\n        isDark={isDark}\r\n        BalanceForm={\r\n          <BalanceForm\r\n            isDark={isDark}\r\n            activeFiat={activeFiat}\r\n            fiatBalance={allFiatBalance}\r\n            currencyBalance={btcBalance}\r\n            changePercent={changePercent}\r\n            activeCurrency={activeCurrency}\r\n            handleReceive={this.handleModalOpen}\r\n            handleWithdraw={this.handleWithdrawFirstAsset}\r\n            handleExchange={this.handleGoExchange}\r\n            isFetching={isBalanceFetching}\r\n            type=\"wallet\"\r\n            currency=\"btc\"\r\n            infoAboutCurrency={infoAboutCurrency}\r\n            multisigPendingCount={multisigPendingCount}\r\n          />\r\n        }\r\n      >\r\n        {activeView === 0 && (\r\n          <CurrenciesList\r\n            isDark={!!isDark}\r\n            tableRows={tableRows}\r\n            hiddenCoinsList={hiddenCoinsList}\r\n            goToСreateWallet={this.goToСreateWallet}\r\n            multisigPendingCount={multisigPendingCount}\r\n          />\r\n        )}\r\n        {activeView === 1 && <History {...this.props} isDark={isDark} />}\r\n        {activeView === 2 && <InvoicesList {...this.props} onlyTable={true} isDark={isDark} />}\r\n      </DashboardLayout>\r\n    )\r\n  }\r\n}\r\n"]}]}