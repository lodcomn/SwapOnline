{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.flows\\BTC2ETH.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.flows\\BTC2ETH.ts","mtime":1614842913754},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI7CmltcG9ydCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXNzZXJ0VGhpc0luaXRpYWxpemVkIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI7CmltcG9ydCBfZ2V0IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZ2V0IjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiQGJhYmVsL3J1bnRpbWUvcmVnZW5lcmF0b3IiOwoKZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH0KCmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CgppbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnOwppbXBvcnQgeyBjb25zdGFudHMgfSBmcm9tICdzd2FwLmFwcCc7CmltcG9ydCB7IEF0b21pY0FCMlVUWE8gfSBmcm9tICdzd2FwLnN3YXAnOwoKdmFyIEJUQzJFVEggPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9BdG9taWNBQjJVVFhPKSB7CiAgX2luaGVyaXRzKEJUQzJFVEgsIF9BdG9taWNBQjJVVFhPKTsKCiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihCVEMyRVRIKTsKCiAgZnVuY3Rpb24gQlRDMkVUSChzd2FwKSB7CiAgICB2YXIgX3RoaXNTdXBlciwgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEJUQzJFVEgpOwoKICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc3dhcCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2Zsb3dOYW1lIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJldGhTd2FwIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJidGNTd2FwIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGF0ZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2V0UmVmdW5kVHhIZXgiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmJ0Y1N3YXAuZ2V0UmVmdW5kSGV4VHJhbnNhY3Rpb24oewogICAgICAgIHNjcmlwdFZhbHVlczogX3RoaXMuc3RhdGUuYnRjU2NyaXB0VmFsdWVzLAogICAgICAgIHNlY3JldDogX3RoaXMuc3RhdGUuc2VjcmV0CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHR4SGV4KSB7CiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgcmVmdW5kVHhIZXg6IHR4SGV4CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMudXR4b0NvaW4gPSAiYnRjIjsKICAgIF90aGlzLl9mbG93TmFtZSA9IEJUQzJFVEguZ2V0TmFtZSgpOwogICAgX3RoaXMuc3RlcE51bWJlcnMgPSB7CiAgICAgICdzaWduJzogMSwKICAgICAgJ3N1Ym1pdC1zZWNyZXQnOiAyLAogICAgICAnc3luYy1iYWxhbmNlJzogMywKICAgICAgJ2xvY2stdXR4byc6IDQsCiAgICAgICd3YWl0LWxvY2stZXRoJzogNSwKICAgICAgJ3dpdGhkcmF3LWV0aCc6IDYsCiAgICAgICdmaW5pc2gnOiA3LAogICAgICAnZW5kJzogOAogICAgfTsKICAgIF90aGlzLmV0aFN3YXAgPSBzd2FwLm93bmVyU3dhcDsKICAgIF90aGlzLmJ0Y1N3YXAgPSBzd2FwLnBhcnRpY2lwYW50U3dhcDsKICAgIF90aGlzLmFiQmxvY2tjaGFpbiA9IF90aGlzLmV0aFN3YXA7CiAgICBfdGhpcy51dHhvQmxvY2tjaGFpbiA9IF90aGlzLmJ0Y1N3YXA7CiAgICBfdGhpcy5pc1VUWE9TaWRlID0gdHJ1ZTsKCiAgICBpZiAoIV90aGlzLmV0aFN3YXApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdCVEMyRVRIOiAiZXRoU3dhcCIgb2YgdHlwZSBvYmplY3QgcmVxdWlyZWQnKTsKICAgIH0KCiAgICBpZiAoIV90aGlzLmJ0Y1N3YXApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdCVEMyRVRIOiAiYnRjU3dhcCIgb2YgdHlwZSBvYmplY3QgcmVxdWlyZWQnKTsKICAgIH0KCiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgc3RlcDogMCwKICAgICAgaXNTdG9wcGVkU3dhcDogZmFsc2UsCiAgICAgIHNpZ25UcmFuc2FjdGlvbkhhc2g6IG51bGwsCiAgICAgIGlzU2lnbkZldGNoaW5nOiBmYWxzZSwKICAgICAgaXNQYXJ0aWNpcGFudFNpZ25lZDogZmFsc2UsCiAgICAgIGV0aFN3YXBDcmVhdGlvblRyYW5zYWN0aW9uSGFzaDogbnVsbCwKICAgICAgc2VjcmV0SGFzaDogbnVsbCwKICAgICAgaXNCYWxhbmNlRmV0Y2hpbmc6IGZhbHNlLAogICAgICBpc0JhbGFuY2VFbm91Z2g6IHRydWUsCiAgICAgIGJhbGFuY2U6IG51bGwsCiAgICAgIGlzRXRoQ29udHJhY3RGdW5kZWQ6IGZhbHNlLAogICAgICBidGNTd2FwV2l0aGRyYXdUcmFuc2FjdGlvbkhhc2g6IG51bGwsCiAgICAgIGV0aFN3YXBXaXRoZHJhd1RyYW5zYWN0aW9uSGFzaDogbnVsbCwKICAgICAgY2FuQ3JlYXRlRXRoVHJhbnNhY3Rpb246IHRydWUsCiAgICAgIGlzRXRoV2l0aGRyYXduOiBmYWxzZSwKICAgICAgcmVmdW5kVHJhbnNhY3Rpb25IYXNoOiBudWxsLAogICAgICBpc1JlZnVuZGVkOiBmYWxzZSwKICAgICAgd2l0aGRyYXdGZWU6IG51bGwsCiAgICAgIHJlZnVuZFR4SGV4OiBudWxsLAogICAgICBpc0ZpbmlzaGVkOiBmYWxzZSwKICAgICAgaXNTd2FwRXhpc3Q6IGZhbHNlLAogICAgICByZXF1aXJlV2l0aGRyYXdGZWU6IGZhbHNlLAogICAgICB1dHhvRnVuZEVycm9yOiBudWxsCiAgICB9OwoKICAgIF90aGlzLl9wZXJzaXN0U3RhdGUoKTsKCiAgICBfZ2V0KChfdGhpc1N1cGVyID0gX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksIF9nZXRQcm90b3R5cGVPZihCVEMyRVRILnByb3RvdHlwZSkpLCAiX3BlcnNpc3RTdGVwcyIsIF90aGlzU3VwZXIpLmNhbGwoX3RoaXNTdXBlcik7CgogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEJUQzJFVEgsIFt7CiAgICBrZXk6ICJfcGVyc2lzdFN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcGVyc2lzdFN0YXRlKCkgewogICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihCVEMyRVRILnByb3RvdHlwZSksICJfcGVyc2lzdFN0YXRlIiwgdGhpcykuY2FsbCh0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0U3RlcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRTdGVwcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgZmxvdyA9IHRoaXM7CiAgICAgIHJldHVybiBbCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgLy8gMS4gU2lnbnMKICAgICAgX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX3RoaXMyLnNpZ25VVFhPU2lkZSgpOwoKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpLCAvLyAyLiBDcmVhdGUgc2VjcmV0LCBzZWNyZXQgaGFzaCBhbmQgQlRDIHNjcmlwdAogICAgICBmdW5jdGlvbiAoKSB7Ly8gdGhpcy5zdWJtaXRTZWNyZXQoKQogICAgICB9LCAvLyAzLiBDaGVjayBiYWxhbmNlCiAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIuc3luY0JhbGFuY2UoKTsKICAgICAgfSwKICAgICAgLyojX19QVVJFX18qLwogICAgICAvLyA0LiBDcmVhdGUgQlRDIFNjcmlwdCwgZnVuZCwgbm90aWZ5IHBhcnRpY2lwYW50CiAgICAgIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX3RoaXMyLmJ0Y1N3YXAuZnVuZFN3YXBTY3JpcHQoewogICAgICAgICAgICAgICAgICBmbG93OiBmbG93CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgfSkpLAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIC8vIDUuIFdhaXQgcGFydGljaXBhbnQgY3JlYXRlcyBFVEggQ29udHJhY3QKICAgICAgX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gZmxvdy5ldGhTd2FwLndhaXRBQkNvbnRyYWN0KHsKICAgICAgICAgICAgICAgICAgZmxvdzogZmxvdywKICAgICAgICAgICAgICAgICAgdXR4b0NvaW46ICJidGMiCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzKTsKICAgICAgfSkpLAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIC8vIDYuIFdpdGhkcmF3CiAgICAgIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIGZsb3cuZXRoU3dhcC53aXRoZHJhd0Zyb21BQkNvbnRyYWN0KHsKICAgICAgICAgICAgICAgICAgZmxvdzogZmxvdwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgIH0pKSwgLy8gNy4gRmluaXNoCiAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICBmbG93LnN3YXAucm9vbS5vbmNlKCdzd2FwIGZpbmlzaGVkJywgZnVuY3Rpb24gKF9yZWY1KSB7CiAgICAgICAgICB2YXIgYnRjU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoID0gX3JlZjUuYnRjU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoOwogICAgICAgICAgZmxvdy5zZXRTdGF0ZSh7CiAgICAgICAgICAgIGJ0Y1N3YXBXaXRoZHJhd1RyYW5zYWN0aW9uSGFzaDogYnRjU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBmbG93LnN3YXAucm9vbS5zZW5kTWVzc2FnZSh7CiAgICAgICAgICBldmVudDogJ3JlcXVlc3Qgc3dhcCBmaW5pc2hlZCcKICAgICAgICB9KTsKICAgICAgICBmbG93LmZpbmlzaFN0ZXAoewogICAgICAgICAgaXNGaW5pc2hlZDogdHJ1ZQogICAgICAgIH0sICdmaW5pc2gnKTsKICAgICAgfSwgLy8gOC4gRmluaXNoZWQhCiAgICAgIGZ1bmN0aW9uICgpIHt9XTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRCVENTY3JpcHRBZGRyZXNzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCVENTY3JpcHRBZGRyZXNzKCkgewogICAgICB2YXIgc2NyaXB0QWRkcmVzcyA9IHRoaXMuc3RhdGUuc2NyaXB0QWRkcmVzczsKICAgICAgcmV0dXJuIHNjcmlwdEFkZHJlc3M7CiAgICB9CiAgfSwgewogICAga2V5OiAic2tpcFN5bmNCYWxhbmNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfc2tpcFN5bmNCYWxhbmNlID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB0aGlzLmZpbmlzaFN0ZXAoe30sIHsKICAgICAgICAgICAgICAgICAgc3RlcDogJ3N5bmMtYmFsYW5jZScKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBza2lwU3luY0JhbGFuY2UoKSB7CiAgICAgICAgcmV0dXJuIF9za2lwU3luY0JhbGFuY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNraXBTeW5jQmFsYW5jZTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInRyeVJlZnVuZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdHJ5UmVmdW5kKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBmbG93ID0gdGhpczsKICAgICAgdmFyIF9mbG93JHN0YXRlID0gZmxvdy5zdGF0ZSwKICAgICAgICAgIHV0eG9TY3JpcHRWYWx1ZXMgPSBfZmxvdyRzdGF0ZS51dHhvU2NyaXB0VmFsdWVzLAogICAgICAgICAgc2VjcmV0ID0gX2Zsb3ckc3RhdGUuc2VjcmV0OwogICAgICByZXR1cm4gZmxvdy5idGNTd2FwLnJlZnVuZCh7CiAgICAgICAgc2NyaXB0VmFsdWVzOiB1dHhvU2NyaXB0VmFsdWVzLAogICAgICAgIHNlY3JldDogc2VjcmV0CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGhhc2gpIHsKICAgICAgICBpZiAoIWhhc2gpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIF90aGlzMy5zd2FwLnJvb20uc2VuZE1lc3NhZ2UoewogICAgICAgICAgZXZlbnQ6ICd1dHhvIHJlZnVuZCBjb21wbGV0ZWQnCiAgICAgICAgfSk7CgogICAgICAgIGZsb3cuc2V0U3RhdGUoewogICAgICAgICAgcmVmdW5kVHJhbnNhY3Rpb25IYXNoOiBoYXNoLAogICAgICAgICAgaXNSZWZ1bmRlZDogdHJ1ZSwKICAgICAgICAgIGlzU3dhcEV4aXN0OiBmYWxzZQogICAgICAgIH0sIHRydWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICBpZiAoL0FkZHJlc3MgaXMgZW1wdHkvLnRlc3QoZXJyb3IpKSB7CiAgICAgICAgICAvLyBUT0RPIC0gZmV0Y2ggVFggbGlzdCB0byBzY3JpcHQgZm9yIHJlZnVuZCBUWAogICAgICAgICAgZmxvdy5zZXRTdGF0ZSh7CiAgICAgICAgICAgIGlzUmVmdW5kZWQ6IHRydWUsCiAgICAgICAgICAgIGlzU3dhcEV4aXN0OiBmYWxzZQogICAgICAgICAgfSwgdHJ1ZSk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdCdGMgcmVmdW5kOicsIGVycm9yKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImlzUmVmdW5kU3VjY2VzcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2lzUmVmdW5kU3VjY2VzcyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICAgIHZhciBfdGhpcyRzdGF0ZSwgcmVmdW5kVHJhbnNhY3Rpb25IYXNoLCBpc1JlZnVuZGVkOwoKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzJHN0YXRlID0gdGhpcy5zdGF0ZSwgcmVmdW5kVHJhbnNhY3Rpb25IYXNoID0gX3RoaXMkc3RhdGUucmVmdW5kVHJhbnNhY3Rpb25IYXNoLCBpc1JlZnVuZGVkID0gX3RoaXMkc3RhdGUuaXNSZWZ1bmRlZDsKCiAgICAgICAgICAgICAgICBpZiAoIShyZWZ1bmRUcmFuc2FjdGlvbkhhc2ggJiYgaXNSZWZ1bmRlZCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnRjU3dhcC5jaGVja1RYKHJlZnVuZFRyYW5zYWN0aW9uSGFzaCk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIGlmICghX2NvbnRleHQ2LnNlbnQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgdHJ1ZSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignQlRDMkVUSCAtIHVua25vd24gcmVmdW5kIHRyYW5zYWN0aW9uJyk7CiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgcmVmdW5kVHJhbnNhY3Rpb25IYXNoOiBudWxsLAogICAgICAgICAgICAgICAgICBpc1JlZnVuZGVkOiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgZmFsc2UpOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGlzUmVmdW5kU3VjY2VzcygpIHsKICAgICAgICByZXR1cm4gX2lzUmVmdW5kU3VjY2Vzcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gaXNSZWZ1bmRTdWNjZXNzOwogICAgfSgpCiAgfSwgewogICAga2V5OiAidHJ5V2l0aGRyYXciLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90cnlXaXRoZHJhdyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KF9zZWNyZXQpIHsKICAgICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgICAgdmFyIF90aGlzJHN0YXRlMiwgc2VjcmV0LCBzZWNyZXRIYXNoLCBpc0V0aFdpdGhkcmF3biwgX3NlY3JldEhhc2gsIGRhdGE7CgogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX3RoaXMkc3RhdGUyID0gdGhpcy5zdGF0ZSwgc2VjcmV0ID0gX3RoaXMkc3RhdGUyLnNlY3JldCwgc2VjcmV0SGFzaCA9IF90aGlzJHN0YXRlMi5zZWNyZXRIYXNoLCBpc0V0aFdpdGhkcmF3biA9IF90aGlzJHN0YXRlMi5pc0V0aFdpdGhkcmF3bjsKCiAgICAgICAgICAgICAgICBpZiAoX3NlY3JldCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiV2l0aGRyYXdhbCBpcyBhdXRvbWF0aWMuIEZvciBtYW51YWwgd2l0aGRyYXdhbCwgcHJvdmlkZSBhIHNlY3JldCIpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpZiAoc2VjcmV0ICYmIHNlY3JldCAhPSBfc2VjcmV0KSBjb25zb2xlLndhcm4oIlNlY3JldCBhbHJlYWR5IGtub3duIGFuZCBpcyBkaWZmZXJlbnQuIEFyZSB5b3Ugc3VyZT8iKTsKICAgICAgICAgICAgICAgIGlmIChpc0V0aFdpdGhkcmF3bikgY29uc29sZS53YXJuKCJMb29rcyBsaWtlIG1vbmV5IHdlcmUgYWxyZWFkeSB3aXRoZHJhd24sIGFyZSB5b3Ugc3VyZT8iKTsKICAgICAgICAgICAgICAgIGRlYnVnKCdzd2FwLmNvcmU6ZmxvdycpKCJXSVRIRFJBVyB1c2luZyBzZWNyZXQgPSAiLmNvbmNhdChfc2VjcmV0KSk7CiAgICAgICAgICAgICAgICBfc2VjcmV0SGFzaCA9IHRoaXMuYXBwLmVudi5iaXRjb2luLmNyeXB0by5yaXBlbWQxNjAoQnVmZmVyLmZyb20oX3NlY3JldCwgJ2hleCcpKS50b1N0cmluZygnaGV4Jyk7CiAgICAgICAgICAgICAgICBpZiAoc2VjcmV0SGFzaCAhPSBfc2VjcmV0SGFzaCkgY29uc29sZS53YXJuKCJIYXNoIGRvZXMgbm90IG1hdGNoISBzdGF0ZTogIi5jb25jYXQoc2VjcmV0SGFzaCwgIiwgZ2l2ZW46ICIpLmNvbmNhdChfc2VjcmV0SGFzaCkpOwogICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgb3duZXJBZGRyZXNzOiB0aGlzLmFwcC5nZXRQYXJ0aWNpcGFudEV0aEFkZHJlc3ModGhpcy5zd2FwKSwKICAgICAgICAgICAgICAgICAgc2VjcmV0OiBfc2VjcmV0CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmV0aFN3YXAud2l0aGRyYXcoZGF0YSwgZnVuY3Rpb24gKGhhc2gpIHsKICAgICAgICAgICAgICAgICAgZGVidWcoJ3N3YXAuY29yZTpmbG93JykoIlRYIGhhc2g9Ii5jb25jYXQoaGFzaCkpOwoKICAgICAgICAgICAgICAgICAgX3RoaXM0LnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICBldGhTd2FwV2l0aGRyYXdUcmFuc2FjdGlvbkhhc2g6IGhhc2gsCiAgICAgICAgICAgICAgICAgICAgY2FuQ3JlYXRlRXRoVHJhbnNhY3Rpb246IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM0LmZpbmlzaFN0ZXAoewogICAgICAgICAgICAgICAgICAgIGlzRXRoV2l0aGRyYXduOiB0cnVlCiAgICAgICAgICAgICAgICAgIH0sICd3aXRoZHJhdy1ldGgnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdHJ5V2l0aGRyYXcoX3gpIHsKICAgICAgICByZXR1cm4gX3RyeVdpdGhkcmF3LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnlXaXRoZHJhdzsKICAgIH0oKQogIH1dLCBbewogICAga2V5OiAiZ2V0TmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TmFtZSgpIHsKICAgICAgcmV0dXJuICIiLmNvbmNhdCh0aGlzLmdldEZyb21OYW1lKCksICIyIikuY29uY2F0KHRoaXMuZ2V0VG9OYW1lKCkpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEZyb21OYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGcm9tTmFtZSgpIHsKICAgICAgcmV0dXJuIGNvbnN0YW50cy5DT0lOUy5idGM7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0VG9OYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRUb05hbWUoKSB7CiAgICAgIHJldHVybiBjb25zdGFudHMuQ09JTlMuZXRoOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEJUQzJFVEg7Cn0oQXRvbWljQUIyVVRYTyk7CgpleHBvcnQgZGVmYXVsdCBCVEMyRVRIOw=="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/core/swap.flows/BTC2ETH.ts"],"names":["debug","constants","AtomicAB2UTXO","BTC2ETH","swap","btcSwap","getRefundHexTransaction","scriptValues","state","btcScriptValues","secret","then","txHex","setState","refundTxHex","utxoCoin","_flowName","getName","stepNumbers","ethSwap","ownerSwap","participantSwap","abBlockchain","utxoBlockchain","isUTXOSide","Error","step","isStoppedSwap","signTransactionHash","isSignFetching","isParticipantSigned","ethSwapCreationTransactionHash","secretHash","isBalanceFetching","isBalanceEnough","balance","isEthContractFunded","btcSwapWithdrawTransactionHash","ethSwapWithdrawTransactionHash","canCreateEthTransaction","isEthWithdrawn","refundTransactionHash","isRefunded","withdrawFee","isFinished","isSwapExist","requireWithdrawFee","utxoFundError","_persistState","flow","signUTXOSide","syncBalance","fundSwapScript","waitABContract","withdrawFromABContract","room","once","sendMessage","event","finishStep","scriptAddress","utxoScriptValues","refund","hash","error","test","console","warn","checkTX","_secret","_secretHash","app","env","bitcoin","crypto","ripemd160","Buffer","from","toString","data","ownerAddress","getParticipantEthAddress","withdraw","getFromName","getToName","COINS","btc","eth"],"mappings":"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","sourcesContent":["import debug from 'debug'\r\nimport SwapApp, { constants, util } from 'swap.app'\r\nimport { AtomicAB2UTXO } from 'swap.swap'\r\nimport { BigNumber } from 'bignumber.js'\r\nimport { EthSwap, BtcSwap } from 'swap.swaps'\r\n\r\n\r\nclass BTC2ETH extends AtomicAB2UTXO {\r\n\r\n  _flowName: string\r\n  ethSwap: EthSwap\r\n  btcSwap: BtcSwap\r\n  state: any\r\n\r\n  static getName() {\r\n    return `${this.getFromName()}2${this.getToName()}`\r\n  }\r\n\r\n  static getFromName() {\r\n    return constants.COINS.btc\r\n  }\r\n\r\n  static getToName() {\r\n    return constants.COINS.eth\r\n  }\r\n\r\n  constructor(swap) {\r\n    super(swap)\r\n    this.utxoCoin = `btc`\r\n    this._flowName = BTC2ETH.getName()\r\n\r\n    this.stepNumbers = {\r\n      'sign': 1,\r\n      'submit-secret': 2,\r\n      'sync-balance': 3,\r\n      'lock-utxo': 4,\r\n      'wait-lock-eth': 5,\r\n      'withdraw-eth': 6,\r\n      'finish': 7,\r\n      'end': 8,\r\n    }\r\n\r\n    this.ethSwap = swap.ownerSwap\r\n    this.btcSwap = swap.participantSwap\r\n\r\n    this.abBlockchain = this.ethSwap\r\n    this.utxoBlockchain = this.btcSwap\r\n    this.isUTXOSide = true\r\n\r\n    if (!this.ethSwap) {\r\n      throw new Error('BTC2ETH: \"ethSwap\" of type object required')\r\n    }\r\n    if (!this.btcSwap) {\r\n      throw new Error('BTC2ETH: \"btcSwap\" of type object required')\r\n    }\r\n\r\n    this.state = {\r\n      step: 0,\r\n\r\n      isStoppedSwap: false,\r\n\r\n      signTransactionHash: null,\r\n      isSignFetching: false,\r\n      isParticipantSigned: false,\r\n\r\n      ethSwapCreationTransactionHash: null,\r\n\r\n      secretHash: null,\r\n\r\n      isBalanceFetching: false,\r\n      isBalanceEnough: true,\r\n      balance: null,\r\n\r\n      isEthContractFunded: false,\r\n\r\n      btcSwapWithdrawTransactionHash: null,\r\n      ethSwapWithdrawTransactionHash: null,\r\n\r\n      canCreateEthTransaction: true,\r\n      isEthWithdrawn: false,\r\n\r\n      refundTransactionHash: null,\r\n      isRefunded: false,\r\n\r\n      withdrawFee: null,\r\n      refundTxHex: null,\r\n      isFinished: false,\r\n      isSwapExist: false,\r\n\r\n      requireWithdrawFee: false,\r\n\r\n      utxoFundError: null,\r\n    }\r\n\r\n    this._persistState()\r\n    super._persistSteps()\r\n  }\r\n\r\n  _persistState() {\r\n    super._persistState()\r\n  }\r\n\r\n  _getSteps() {\r\n    const flow = this\r\n\r\n    return [\r\n\r\n      // 1. Signs\r\n\r\n      async () => {\r\n        this.signUTXOSide()\r\n      },\r\n\r\n      // 2. Create secret, secret hash and BTC script\r\n\r\n      () => {\r\n        // this.submitSecret()\r\n      },\r\n\r\n      // 3. Check balance\r\n\r\n      () => {\r\n        this.syncBalance()\r\n      },\r\n\r\n      // 4. Create BTC Script, fund, notify participant\r\n\r\n      async () => {\r\n        this.btcSwap.fundSwapScript({\r\n          flow,\r\n        })\r\n      },\r\n\r\n      // 5. Wait participant creates ETH Contract\r\n\r\n      async () => {\r\n        await flow.ethSwap.waitABContract({\r\n          flow,\r\n          utxoCoin: `btc`,\r\n        })\r\n      },\r\n\r\n      // 6. Withdraw\r\n\r\n      async () => {\r\n        await flow.ethSwap.withdrawFromABContract({ flow })\r\n      },\r\n\r\n      // 7. Finish\r\n\r\n      () => {\r\n        flow.swap.room.once('swap finished', ({btcSwapWithdrawTransactionHash}) => {\r\n          flow.setState({\r\n            btcSwapWithdrawTransactionHash,\r\n          })\r\n        })\r\n\r\n        flow.swap.room.sendMessage({\r\n          event: 'request swap finished',\r\n        })\r\n\r\n        flow.finishStep({\r\n          isFinished: true,\r\n        }, 'finish')\r\n      },\r\n\r\n      // 8. Finished!\r\n\r\n      () => {}\r\n    ]\r\n  }\r\n\r\n  getBTCScriptAddress() {\r\n    const { scriptAddress } = this.state\r\n    return scriptAddress;\r\n  }\r\n\r\n  async skipSyncBalance() {\r\n    this.finishStep({}, { step: 'sync-balance' })\r\n  }\r\n\r\n  getRefundTxHex = () => {\r\n    this.btcSwap.getRefundHexTransaction({\r\n      scriptValues: this.state.btcScriptValues,\r\n      secret: this.state.secret,\r\n    })\r\n      .then((txHex) => {\r\n        this.setState({\r\n          refundTxHex: txHex,\r\n        })\r\n      })\r\n  }\r\n\r\n  tryRefund() {\r\n    const flow = this\r\n    const { utxoScriptValues, secret } = flow.state\r\n\r\n    return flow.btcSwap.refund({\r\n      scriptValues: utxoScriptValues,\r\n      secret: secret,\r\n    })\r\n      .then((hash) => {\r\n        if (!hash) {\r\n          return false\r\n        }\r\n\r\n        this.swap.room.sendMessage({\r\n          event: 'utxo refund completed',\r\n        })\r\n\r\n        flow.setState({\r\n          refundTransactionHash: hash,\r\n          isRefunded: true,\r\n          isSwapExist: false,\r\n        }, true)\r\n\r\n        return true\r\n      })\r\n      .catch((error) => {\r\n        if (/Address is empty/.test(error)) {\r\n          // TODO - fetch TX list to script for refund TX\r\n          flow.setState({\r\n            isRefunded: true,\r\n            isSwapExist: false,\r\n          }, true)\r\n          return true\r\n        } else {\r\n          console.warn('Btc refund:', error)\r\n\r\n          return false\r\n        }\r\n      })\r\n  }\r\n\r\n  async isRefundSuccess() {\r\n    const { refundTransactionHash, isRefunded } = this.state\r\n    if (refundTransactionHash && isRefunded) {\r\n      if (await this.btcSwap.checkTX(refundTransactionHash)) {\r\n        return true\r\n      } else {\r\n        console.warn('BTC2ETH - unknown refund transaction')\r\n        this.setState( {\r\n          refundTransactionHash: null,\r\n          isRefunded: false,\r\n        } )\r\n        return false\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  async tryWithdraw(_secret) {\r\n    const { secret, secretHash, isEthWithdrawn } = this.state\r\n\r\n    if (!_secret)\r\n      throw new Error(`Withdrawal is automatic. For manual withdrawal, provide a secret`)\r\n\r\n    if (secret && secret != _secret)\r\n      console.warn(`Secret already known and is different. Are you sure?`)\r\n\r\n    if (isEthWithdrawn)\r\n      console.warn(`Looks like money were already withdrawn, are you sure?`)\r\n\r\n    debug('swap.core:flow')(`WITHDRAW using secret = ${_secret}`)\r\n\r\n    const _secretHash = this.app.env.bitcoin.crypto.ripemd160(Buffer.from(_secret, 'hex')).toString('hex')\r\n\r\n    if (secretHash != _secretHash)\r\n      console.warn(`Hash does not match! state: ${secretHash}, given: ${_secretHash}`)\r\n\r\n    const data = {\r\n      ownerAddress: this.app.getParticipantEthAddress(this.swap),\r\n      secret: _secret,\r\n    }\r\n\r\n    await this.ethSwap.withdraw(data, (hash) => {\r\n      debug('swap.core:flow')(`TX hash=${hash}`)\r\n      this.setState({\r\n        ethSwapWithdrawTransactionHash: hash,\r\n        canCreateEthTransaction: true,\r\n      })\r\n    }).then(() => {\r\n\r\n      this.finishStep({\r\n        isEthWithdrawn: true,\r\n      }, 'withdraw-eth')\r\n    })\r\n  }\r\n}\r\n\r\nexport default BTC2ETH\r\n"]}]}