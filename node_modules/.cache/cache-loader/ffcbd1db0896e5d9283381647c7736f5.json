{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.app\\util\\helpers.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.app\\util\\helpers.ts","mtime":1614847693992},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIkBiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yIjsKCi8qKg0KICogQHBhcmFtIHtmdW5jdGlvbn0gYWN0aW9uDQogKiBAcGFyYW0ge251bWJlcn0gZGVsYXkNCiAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59DQogKi8KdmFyIHJlcGVhdEFzeW5jVW50aWxSZXN1bHQgPSBmdW5jdGlvbiByZXBlYXRBc3luY1VudGlsUmVzdWx0KGFjdGlvbikgewogIHZhciBkZWxheSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMTAgKiAxMDAwOwogIHJldHVybiBuZXcgUHJvbWlzZSggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIocmVzb2x2ZSkgewogICAgICB2YXIgaXNTdG9wZWQsIHN0b3AsIGl0ZXJhdGlvbjsKICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaXNTdG9wZWQgPSBmYWxzZTsKCiAgICAgICAgICAgICAgc3RvcCA9IGZ1bmN0aW9uIHN0b3AoKSB7CiAgICAgICAgICAgICAgICBpc1N0b3BlZCA9IHRydWU7CiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaXRlcmF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbihzdG9wKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzU3RvcGVkICYmICghcmVzdWx0IHx8IHJlc3VsdCA9PT0gMCB8fCB0eXBlb2YgcmVzdWx0ID09PSAndW5kZWZpbmVkJyB8fCByZXN1bHQgPT09IG51bGwgfHwgcmVzdWx0ID09PSAnMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoaXRlcmF0aW9uLCBkZWxheSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUpOwogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBpdGVyYXRpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KCk7CgogICAgICAgICAgICAgIGl0ZXJhdGlvbigpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTIpOwogICAgfSkpOwoKICAgIHJldHVybiBmdW5jdGlvbiAoX3gpIHsKICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpKTsKfTsKLyoqDQogKiBAcGFyYW0ge251bWJlcn0gaW5TZWNvbmRzDQogKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fQ0KICovCgoKdmFyIHdhaXREZWxheSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYzID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoaW5TZWNvbmRzKSB7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIG5ldyBQcm9taXNlKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciBfcmVmNCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGluU2Vjb25kcyAqIDEwMDApOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDMsIF94NCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9yZWY0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSgpKSk7CgogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlNCk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gd2FpdERlbGF5KF94MikgewogICAgcmV0dXJuIF9yZWYzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwoKdmFyIGV4dHJhY3RTZWNyZXRGcm9tQ29udHJhY3QgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmNiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KF9yZWY1KSB7CiAgICB2YXIgZmxvdywgc3dhcEZsb3csIHBhcnRpY2lwYW50QWRkcmVzcywgb3duZXJBZGRyZXNzLCBhcHAsIHNlY3JldEZyb21Db250cmFjdCwgc2VjcmV0SGFzaCwgaGFzaEZyb21Db250cmFjdFNlY3JldCwgb3VyU3dhcCwgaGFzaEZyb21Db250cmFjdFN3YXA7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgZmxvdyA9IF9yZWY1LmZsb3csIHN3YXBGbG93ID0gX3JlZjUuc3dhcEZsb3csIHBhcnRpY2lwYW50QWRkcmVzcyA9IF9yZWY1LnBhcnRpY2lwYW50QWRkcmVzcywgb3duZXJBZGRyZXNzID0gX3JlZjUub3duZXJBZGRyZXNzLCBhcHAgPSBfcmVmNS5hcHA7CiAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMTsKICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA0OwogICAgICAgICAgICByZXR1cm4gc3dhcEZsb3cuZ2V0U2VjcmV0KHsKICAgICAgICAgICAgICBwYXJ0aWNpcGFudEFkZHJlc3M6IHBhcnRpY2lwYW50QWRkcmVzcwogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHNlY3JldEZyb21Db250cmFjdCA9IF9jb250ZXh0NS5zZW50OwoKICAgICAgICAgICAgaWYgKCFzZWNyZXRGcm9tQ29udHJhY3QpIHsKICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDI3OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzZWNyZXRIYXNoID0gZmxvdy5zdGF0ZS5zZWNyZXRIYXNoOwogICAgICAgICAgICBoYXNoRnJvbUNvbnRyYWN0U2VjcmV0ID0gYXBwLmVudi5iaXRjb2luLmNyeXB0by5yaXBlbWQxNjAoQnVmZmVyLmZyb20oc2VjcmV0RnJvbUNvbnRyYWN0LnJlcGxhY2UoL14weC8sICcnKSwgJ2hleCcpKS50b1N0cmluZygnaGV4Jyk7CgogICAgICAgICAgICBpZiAoIShoYXNoRnJvbUNvbnRyYWN0U2VjcmV0ICE9PSBzZWNyZXRIYXNoKSkgewogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnNvbGUud2FybignU2VjcmV0IG9uIGNvbnRyYWN0IGRpc21hdGNoIHdpdGggb3VyIGhhc2guIE1heSBiZSBibG9ja2NoYWluIG5vdCB1cGRhdGVkLiBUcnkgdXNlIHN3YXBzIHZhcicpOwogICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDEyOwogICAgICAgICAgICByZXR1cm4gc3dhcEZsb3cuc3dhcHMoewogICAgICAgICAgICAgIG93bmVyQWRkcmVzczogb3duZXJBZGRyZXNzLAogICAgICAgICAgICAgIHBhcnRpY2lwYW50QWRkcmVzczogcGFydGljaXBhbnRBZGRyZXNzCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIG91clN3YXAgPSBfY29udGV4dDUuc2VudDsKCiAgICAgICAgICAgIGlmICghb3VyU3dhcCkgewogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGhhc2hGcm9tQ29udHJhY3RTd2FwID0gYXBwLmVudi5iaXRjb2luLmNyeXB0by5yaXBlbWQxNjAoQnVmZmVyLmZyb20ob3VyU3dhcC5zZWNyZXQucmVwbGFjZSgvXjB4LywgJycpLCAnaGV4JykpLnRvU3RyaW5nKCdoZXgnKTsKCiAgICAgICAgICAgIGlmICghKGhhc2hGcm9tQ29udHJhY3RTd2FwICE9PSBzZWNyZXRIYXNoKSkgewogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnNvbGUud2FybignU2VjcmV0IG9uIGNvbnRyYWN0IGRpc21hdGNoIHdpdGggb3VyIGhhc2guIE1heSBiZSBibG9ja2NoYWluIG5vdCB1cGRhdGVkJyk7CiAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjI7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgIGNvbnNvbGUud2FybignVXNlIHNlY3JldCBmcm9tIGNvbnRyYWN0IHN3YXAgdmFyaWFibGUuIGdldFNlY3JldCBtZXRob2Qgc3R1Y2tlZCcpOwogICAgICAgICAgICBzZWNyZXRGcm9tQ29udHJhY3QgPSBoYXNoRnJvbUNvbnRyYWN0U3dhcDsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICBzZWNyZXRGcm9tQ29udHJhY3QgPSAiMHgiLmNvbmNhdChzZWNyZXRGcm9tQ29udHJhY3QucmVwbGFjZSgvXjB4LywgJycpKTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHNlY3JldEZyb21Db250cmFjdCk7CgogICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgIGNhc2UgMjg6CiAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzM7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMzA7CiAgICAgICAgICAgIF9jb250ZXh0NS50MCA9IF9jb250ZXh0NVsiY2F0Y2giXSgxKTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgIGNhc2UgMzM6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWU1LCBudWxsLCBbWzEsIDMwXV0pOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGV4dHJhY3RTZWNyZXRGcm9tQ29udHJhY3QoX3g1KSB7CiAgICByZXR1cm4gX3JlZjYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Cgp2YXIgZXh0cmFjdFNlY3JldEZyb21UeCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWY4ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoX3JlZjcpIHsKICAgIHZhciBmbG93LCBzd2FwRmxvdywgYXBwLCBldGhTd2FwV2l0aGRyYXdUcmFuc2FjdGlvbkhhc2gsIHNlY3JldEZyb21UeGhhc2g7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgZmxvdyA9IF9yZWY3LmZsb3csIHN3YXBGbG93ID0gX3JlZjcuc3dhcEZsb3csIGFwcCA9IF9yZWY3LmFwcCwgZXRoU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoID0gX3JlZjcuZXRoU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoOwogICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDM7CiAgICAgICAgICAgIHJldHVybiByZXBlYXRBc3luY1VudGlsUmVzdWx0KCAvKiNfX1BVUkVfXyovX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgICAgICAgdmFyIF9mbG93JHN0YXRlLCBzZWNyZXQsIHNlY3JldEhhc2gsIHNlY3JldEZyb21UeCwgaGFzaEZyb21UeFNlY3JldDsKCiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBfZmxvdyRzdGF0ZSA9IGZsb3cuc3RhdGUsIHNlY3JldCA9IF9mbG93JHN0YXRlLnNlY3JldCwgc2VjcmV0SGFzaCA9IF9mbG93JHN0YXRlLnNlY3JldEhhc2g7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFzZWNyZXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgc2VjcmV0KTsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN3YXBGbG93LmdldFNlY3JldEZyb21UeGhhc2goZXRoU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoKTsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgc2VjcmV0RnJvbVR4ID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBoYXNoRnJvbVR4U2VjcmV0ID0gYXBwLmVudi5iaXRjb2luLmNyeXB0by5yaXBlbWQxNjAoQnVmZmVyLmZyb20oc2VjcmV0RnJvbVR4LCAnaGV4JykpLnRvU3RyaW5nKCdoZXgnKTsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShoYXNoRnJvbVR4U2VjcmV0ID09PSBzZWNyZXRIYXNoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgc2VjcmV0RnJvbVR4KTsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignU2VjcmV0IGZyb20gVHggZGlzbWF0Y2ggd2l0aCBvdXIgaGFzaC4gV2FpdCBjb250cmFjdCcpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlNik7CiAgICAgICAgICAgIH0pKSk7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBzZWNyZXRGcm9tVHhoYXNoID0gX2NvbnRleHQ3LnNlbnQ7CiAgICAgICAgICAgIC8vQAogICAgICAgICAgICBzZWNyZXRGcm9tVHhoYXNoID0gIjB4Ii5jb25jYXQoc2VjcmV0RnJvbVR4aGFzaC5yZXBsYWNlKC9eMHgvLCAnJykpOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgc2VjcmV0RnJvbVR4aGFzaCk7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlNyk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gZXh0cmFjdFNlY3JldEZyb21UeChfeDYpIHsKICAgIHJldHVybiBfcmVmOC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKCmV4cG9ydCBkZWZhdWx0IHsKICByZXBlYXRBc3luY1VudGlsUmVzdWx0OiByZXBlYXRBc3luY1VudGlsUmVzdWx0LAogIHdhaXREZWxheTogd2FpdERlbGF5LAogIGV4dHJhY3RTZWNyZXRGcm9tQ29udHJhY3Q6IGV4dHJhY3RTZWNyZXRGcm9tQ29udHJhY3QsCiAgZXh0cmFjdFNlY3JldEZyb21UeDogZXh0cmFjdFNlY3JldEZyb21UeAp9Ow=="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/core/swap.app/util/helpers.ts"],"names":["repeatAsyncUntilResult","action","delay","Promise","resolve","isStoped","stop","iteration","result","setTimeout","waitDelay","inSeconds","reject","extractSecretFromContract","flow","swapFlow","participantAddress","ownerAddress","app","getSecret","secretFromContract","secretHash","state","hashFromContractSecret","env","bitcoin","crypto","ripemd160","Buffer","from","replace","toString","console","warn","swaps","ourSwap","hashFromContractSwap","secret","extractSecretFromTx","ethSwapWithdrawTransactionHash","getSecretFromTxhash","secretFromTx","hashFromTxSecret","secretFromTxhash"],"mappings":"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","sourcesContent":["/**\r\n * @param {function} action\r\n * @param {number} delay\r\n * @returns {Promise<any>}\r\n */\r\nconst repeatAsyncUntilResult = (action, delay = 10 * 1000): Promise<any> =>\r\n  new Promise(async (resolve) => {\r\n    let isStoped = false\r\n    const stop = () => {\r\n      isStoped = true\r\n    }\r\n    const iteration = async () => {\r\n      const result = await action(stop)\r\n\r\n      if (!isStoped && (!result\r\n        || result === 0\r\n        || typeof result === 'undefined'\r\n        || result === null\r\n        || result === '0x0000000000000000000000000000000000000000')\r\n      ) {\r\n        setTimeout(iteration, delay)\r\n      } else {\r\n        resolve(result)\r\n      }\r\n    }\r\n\r\n    iteration()\r\n  })\r\n\r\n/**\r\n * @param {number} inSeconds\r\n * @returns {Promise<any>}\r\n */\r\nconst waitDelay = async (inSeconds) => \r\n  new Promise(async (resolve, reject) => {\r\n    setTimeout(() => {\r\n      resolve(true)\r\n    }, inSeconds*1000)\r\n  })\r\n\r\nconst extractSecretFromContract = async ({\r\n  flow,\r\n  swapFlow,\r\n  participantAddress,\r\n  ownerAddress,\r\n  app,\r\n}) => {\r\n  try {\r\n    let secretFromContract = await swapFlow.getSecret({\r\n      participantAddress,\r\n    })\r\n\r\n    if (secretFromContract) {\r\n      const {\r\n        secretHash,\r\n      } = flow.state\r\n\r\n      const hashFromContractSecret = app.env.bitcoin.crypto.ripemd160(\r\n        Buffer.from(secretFromContract.replace(/^0x/, ''), 'hex')\r\n      ).toString('hex')\r\n\r\n      if (hashFromContractSecret !== secretHash) {\r\n        console.warn('Secret on contract dismatch with our hash. May be blockchain not updated. Try use swaps var')\r\n        const ourSwap = await swapFlow.swaps({\r\n          ownerAddress,\r\n          participantAddress,\r\n        })\r\n        if (ourSwap) {\r\n          const hashFromContractSwap = app.env.bitcoin.crypto.ripemd160(\r\n            Buffer.from(ourSwap.secret.replace(/^0x/, ''), 'hex')\r\n          ).toString('hex')\r\n\r\n          if (hashFromContractSwap !== secretHash) {\r\n            console.warn('Secret on contract dismatch with our hash. May be blockchain not updated')\r\n          } else {\r\n            console.warn('Use secret from contract swap variable. getSecret method stucked')\r\n            secretFromContract = hashFromContractSwap\r\n            return null\r\n          }\r\n        }\r\n        return null\r\n      }\r\n\r\n      secretFromContract = `0x${secretFromContract.replace(/^0x/, '')}`\r\n\r\n      return secretFromContract\r\n    } else {\r\n      return null\r\n    }\r\n  }\r\n  catch (error) {\r\n    return null\r\n  }\r\n}\r\n\r\nconst extractSecretFromTx = async ({\r\n  flow,\r\n  swapFlow,\r\n  app,\r\n  ethSwapWithdrawTransactionHash,\r\n}) => {\r\n  let secretFromTxhash = await repeatAsyncUntilResult(async () => {\r\n    const {\r\n      secret,\r\n      secretHash,\r\n    } = flow.state\r\n\r\n    \r\n    if (secret) {\r\n      return secret\r\n    } else {\r\n     \r\n      const secretFromTx = await swapFlow.getSecretFromTxhash(ethSwapWithdrawTransactionHash)\r\n\r\n      const hashFromTxSecret = app.env.bitcoin.crypto.ripemd160(\r\n        Buffer.from(secretFromTx, 'hex')\r\n      ).toString('hex')\r\n\r\n      if (hashFromTxSecret === secretHash) {\r\n        return secretFromTx\r\n      } else {\r\n        console.warn('Secret from Tx dismatch with our hash. Wait contract')\r\n        return false\r\n      }\r\n    }\r\n  })\r\n  //@\r\n  secretFromTxhash = `0x${secretFromTxhash.replace(/^0x/, '')}`\r\n\r\n  return secretFromTxhash\r\n}\r\n\r\nexport default {\r\n  repeatAsyncUntilResult,\r\n  waitDelay,\r\n  extractSecretFromContract,\r\n  extractSecretFromTx,\r\n}\r\n"]}]}