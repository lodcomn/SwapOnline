{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\common\\messaging\\pubsubRoom\\index.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\common\\messaging\\pubsubRoom\\index.ts","mtime":1614842913718},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI7CmltcG9ydCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXNzZXJ0VGhpc0luaXRpYWxpemVkIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI7CmltcG9ydCBfZ2V0UHJvdG90eXBlT2YgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9nZXRQcm90b3R5cGVPZiI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9kZWZpbmVQcm9wZXJ0eSI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIkBiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yIjsKCmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CgpmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOyBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkgcmV0dXJuIGZhbHNlOyBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTsgdHJ5IHsgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQoKaW1wb3J0IGRpZmYgZnJvbSAnaHlwZXJkaWZmJzsKaW1wb3J0IEV2ZW50RW1pdHRlciBmcm9tICdldmVudHMnOwppbXBvcnQgeyBjbG9uZURlZXAgYXMgY2xvbmUgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgeyBQUk9UT0NPTCB9IGZyb20gJy4vcHJvdG9jb2wnOwppbXBvcnQgQ29ubmVjdGlvbiBmcm9tICcuL2Nvbm5lY3Rpb24nOwppbXBvcnQgZW5jb2RpbmcgZnJvbSAnLi9lbmNvZGluZyc7CmltcG9ydCBkaXJlY3RDb25uZWN0aW9uIGZyb20gJy4vZGlyZWN0LWNvbm5lY3Rpb24taGFuZGxlcic7CmltcG9ydCBuYW1lZFF1ZXJ5UnVuIGZyb20gJy4uLy4uL3V0aWxzL25hbWVkUXVlcnknOwp2YXIgREVGQVVMVF9PUFRJT05TID0gewogIHBvbGxJbnRlcnZhbDogMTAwMAp9Owp2YXIgaW5kZXggPSAwOwoKdmFyIFB1YlN1YlJvb20gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9FdmVudEVtaXR0ZXIpIHsKICBfaW5oZXJpdHMoUHViU3ViUm9vbSwgX0V2ZW50RW1pdHRlcik7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoUHViU3ViUm9vbSk7CgogIGZ1bmN0aW9uIFB1YlN1YlJvb20obGlicDJwLCB0b3BpYywgb3B0aW9ucykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQdWJTdWJSb29tKTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9saWJwMnAiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl90b3BpYyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX29wdGlvbnMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9wZWVycyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2Nvbm5lY3Rpb25zIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfaGFuZGxlTWVzc2FnZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2ludGVydmFsIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfaWR4Iiwgdm9pZCAwKTsKCiAgICBfdGhpcy5fbGlicDJwID0gbGlicDJwLmxpYnAycCB8fCBsaWJwMnA7CiAgICBfdGhpcy5fdG9waWMgPSB0b3BpYzsKICAgIF90aGlzLl9vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgY2xvbmUoREVGQVVMVF9PUFRJT05TKSwgY2xvbmUob3B0aW9ucykpOwogICAgX3RoaXMuX3BlZXJzID0gW107CiAgICBfdGhpcy5fY29ubmVjdGlvbnMgPSB7fTsKICAgIF90aGlzLl9oYW5kbGVEaXJlY3RNZXNzYWdlID0gX3RoaXMuX2hhbmRsZURpcmVjdE1lc3NhZ2UuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICBfdGhpcy5faGFuZGxlTWVzc2FnZSA9IF90aGlzLl9vbk1lc3NhZ2UuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CgogICAgaWYgKCFfdGhpcy5fbGlicDJwLnB1YnN1YikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ3B1YnN1YiBoYXMgbm90IGJlZW4gY29uZmlndXJlZCcpOwogICAgfQoKICAgIF90aGlzLl9pbnRlcnZhbCA9IHNldEludGVydmFsKF90aGlzLl9wb2xsUGVlcnMuYmluZChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSksIF90aGlzLl9vcHRpb25zLnBvbGxJbnRlcnZhbCk7CgogICAgX3RoaXMuX2xpYnAycC5oYW5kbGUoUFJPVE9DT0wsIGRpcmVjdENvbm5lY3Rpb24uaGFuZGxlcik7CgogICAgZGlyZWN0Q29ubmVjdGlvbi5lbWl0dGVyLm9uKF90aGlzLl90b3BpYywgX3RoaXMuX2hhbmRsZURpcmVjdE1lc3NhZ2UpOwoKICAgIF90aGlzLl9saWJwMnAucHVic3ViLnN1YnNjcmliZShfdGhpcy5fdG9waWMsIF90aGlzLl9oYW5kbGVNZXNzYWdlKTsKCiAgICBfdGhpcy5fbGlicDJwLm9uKCdlcnJvcicsIGZ1bmN0aW9uIChlcnJvcikgewogICAgICBjb25zb2xlLmxvZygnTGlicDJwIGVycm9yJywgZXJyb3IpOwogICAgfSk7CgogICAgX3RoaXMuX2lkeCA9IGluZGV4Kys7CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoUHViU3ViUm9vbSwgW3sKICAgIGtleTogImdldFBlZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQZWVycygpIHsKICAgICAgcmV0dXJuIHRoaXMuX3BlZXJzLnNsaWNlKDApOwogICAgfQogIH0sIHsKICAgIGtleTogImhhc1BlZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhc1BlZXIocGVlcikgewogICAgICByZXR1cm4gQm9vbGVhbih0aGlzLl9wZWVycy5maW5kKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgcmV0dXJuIHAudG9TdHJpbmcoKSA9PT0gcGVlci50b1N0cmluZygpOwogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAibGVhdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9sZWF2ZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsKTsKICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuX2Nvbm5lY3Rpb25zKS5mb3JFYWNoKGZ1bmN0aW9uIChwZWVyKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMi5fY29ubmVjdGlvbnNbcGVlcl0uc3RvcCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBkaXJlY3RDb25uZWN0aW9uLmVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIodGhpcy5fdG9waWMsIHRoaXMuX2hhbmRsZURpcmVjdE1lc3NhZ2UpOwoKICAgICAgICAgICAgICAgIHRoaXMuX2xpYnAycC51bmhhbmRsZShQUk9UT0NPTCwgZGlyZWN0Q29ubmVjdGlvbi5oYW5kbGVyKTsKCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9saWJwMnAucHVic3ViLnVuc3Vic2NyaWJlKHRoaXMuX3RvcGljLCB0aGlzLl9oYW5kbGVNZXNzYWdlKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGxlYXZlKCkgewogICAgICAgIHJldHVybiBfbGVhdmUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGxlYXZlOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiYnJvYWRjYXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfYnJvYWRjYXN0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoX21lc3NhZ2UpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgdmFyIG1lc3NhZ2UsIHBlZXJzSW5Ub3BpYzsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBlbmNvZGluZyhfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICBwZWVyc0luVG9waWMgPSB0aGlzLl9saWJwMnAucHVic3ViLnRvcGljcy5nZXQodGhpcy5fdG9waWMpOwoKICAgICAgICAgICAgICAgIGlmIChwZWVyc0luVG9waWMpIHsKICAgICAgICAgICAgICAgICAgcGVlcnNJblRvcGljLmZvckVhY2goZnVuY3Rpb24gKHBlZXJJZCkgewogICAgICAgICAgICAgICAgICAgIF90aGlzMy5zZW5kVG8ocGVlcklkLCBfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBicm9hZGNhc3QoX3gpIHsKICAgICAgICByZXR1cm4gX2Jyb2FkY2FzdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gYnJvYWRjYXN0OwogICAgfSgpCiAgfSwgewogICAga2V5OiAic2VuZFRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kVG8ocGVlciwgbWVzc2FnZSkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIG5hbWVkUXVlcnlSdW4oewogICAgICAgIG5hbWU6ICJsaWJwMnBfcGVlcl8iLmNvbmNhdChwZWVyKSwKICAgICAgICBkZWxheTogMTAwLAogICAgICAgIGZ1bmM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBfZnVuYyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgICAgICB2YXIgdG9QZWVyLCBjb25uLCBzZXFubywgbXNnOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXM0Ll9saWJwMnAucGVlclN0b3JlLmtleUJvb2suZGF0YS5oYXMocGVlcikpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHRvUGVlciA9IF90aGlzNC5fbGlicDJwLnBlZXJTdG9yZS5rZXlCb29rLmRhdGEuZ2V0KHBlZXIpOwogICAgICAgICAgICAgICAgICAgIGNvbm4gPSBfdGhpczQuX2Nvbm5lY3Rpb25zW3BlZXJdOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbm4pIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbm4gPSBuZXcgQ29ubmVjdGlvbih0b1BlZXIsIF90aGlzNC5fbGlicDJwLCBfdGhpczQpOwogICAgICAgICAgICAgICAgICAgICAgY29ubi5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczQuZW1pdCgnZXJyb3InLCBlcnIpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICBfdGhpczQuX2Nvbm5lY3Rpb25zW3BlZXJdID0gY29ubjsKICAgICAgICAgICAgICAgICAgICAgIGNvbm4ub25jZSgnZGlzY29ubmVjdCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIF90aGlzNC5fY29ubmVjdGlvbnNbcGVlcl07CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNC5fcGVlcnMgPSBfdGhpczQuX3BlZXJzLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwLnRvU3RyaW5nKCkgIT09IHBlZXIudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczQuZW1pdCgncGVlciBsZWZ0JywgcGVlcik7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHNlcW5vID0gQnVmZmVyLmZyb20oWzBdKTsKICAgICAgICAgICAgICAgICAgICBtc2cgPSB7CiAgICAgICAgICAgICAgICAgICAgICB0bzogdG9QZWVyLAogICAgICAgICAgICAgICAgICAgICAgZnJvbTogX3RoaXM0Ll9saWJwMnAucGVlcklkLAogICAgICAgICAgICAgICAgICAgICAgZGF0YTogQnVmZmVyLmZyb20obWVzc2FnZSkudG9TdHJpbmcoJ2hleCcpLAogICAgICAgICAgICAgICAgICAgICAgc2Vxbm86IHNlcW5vLnRvU3RyaW5nKCdoZXgnKSwKICAgICAgICAgICAgICAgICAgICAgIHRvcGljSURzOiBbX3RoaXM0Ll90b3BpY10sCiAgICAgICAgICAgICAgICAgICAgICB0b3BpY0NJRHM6IFtfdGhpczQuX3RvcGljXQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY29ubi5wdXNoKEJ1ZmZlci5mcm9tKEpTT04uc3RyaW5naWZ5KG1zZykpKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUzKTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgICBmdW5jdGlvbiBmdW5jKCkgewogICAgICAgICAgICByZXR1cm4gX2Z1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZnVuYzsKICAgICAgICB9KCkKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3BvbGxQZWVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3BvbGxQZWVyczIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICB2YXIgbmV3UGVlcnM7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbGlicDJwLnB1YnN1Yi5nZXRTdWJzY3JpYmVycyh0aGlzLl90b3BpYyk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIG5ld1BlZXJzID0gX2NvbnRleHQ0LnNlbnQuc29ydCgpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9lbWl0Q2hhbmdlcyhuZXdQZWVycykpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fcGVlcnMgPSBuZXdQZWVyczsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gX3BvbGxQZWVycygpIHsKICAgICAgICByZXR1cm4gX3BvbGxQZWVyczIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9wb2xsUGVlcnM7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJfZW1pdENoYW5nZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9lbWl0Q2hhbmdlcyhuZXdQZWVycykgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciBkaWZmZXJlbmNlcyA9IGRpZmYodGhpcy5fcGVlcnMsIG5ld1BlZXJzKTsKICAgICAgZGlmZmVyZW5jZXMuYWRkZWQuZm9yRWFjaChmdW5jdGlvbiAocGVlcikgewogICAgICAgIHJldHVybiBfdGhpczUuZW1pdCgncGVlciBqb2luZWQnLCBwZWVyKTsKICAgICAgfSk7CiAgICAgIGRpZmZlcmVuY2VzLnJlbW92ZWQuZm9yRWFjaChmdW5jdGlvbiAocGVlcikgewogICAgICAgIHJldHVybiBfdGhpczUuZW1pdCgncGVlciBsZWZ0JywgcGVlcik7CiAgICAgIH0pOwogICAgICByZXR1cm4gZGlmZmVyZW5jZXMuYWRkZWQubGVuZ3RoID4gMCB8fCBkaWZmZXJlbmNlcy5yZW1vdmVkLmxlbmd0aCA+IDA7CiAgICB9CiAgfSwgewogICAga2V5OiAiX29uTWVzc2FnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uTWVzc2FnZShtZXNzYWdlKSB7CiAgICAgIHRoaXMuZW1pdCgnbWVzc2FnZScsIG1lc3NhZ2UpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9oYW5kbGVEaXJlY3RNZXNzYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlRGlyZWN0TWVzc2FnZShtZXNzYWdlKSB7CiAgICAgIGlmIChtZXNzYWdlLnRvLmlkID09PSB0aGlzLl9saWJwMnAucGVlcklkLl9pZEI1OFN0cmluZykgewogICAgICAgIHZhciBtID0gT2JqZWN0LmFzc2lnbih7fSwgbWVzc2FnZSk7CiAgICAgICAgZGVsZXRlIG0udG87CiAgICAgICAgdGhpcy5lbWl0KCdtZXNzYWdlJywgbSk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBQdWJTdWJSb29tOwp9KEV2ZW50RW1pdHRlcik7CgpleHBvcnQgeyBQdWJTdWJSb29tIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/common/messaging/pubsubRoom/index.ts"],"names":["diff","EventEmitter","cloneDeep","clone","PROTOCOL","Connection","encoding","directConnection","namedQueryRun","DEFAULT_OPTIONS","pollInterval","index","PubSubRoom","libp2p","topic","options","_libp2p","_topic","_options","Object","assign","_peers","_connections","_handleDirectMessage","bind","_handleMessage","_onMessage","pubsub","Error","_interval","setInterval","_pollPeers","handle","handler","emitter","on","subscribe","error","console","log","_idx","slice","peer","Boolean","find","p","toString","clearInterval","keys","forEach","stop","removeListener","unhandle","unsubscribe","_message","message","peersInTopic","topics","get","peerId","sendTo","name","delay","func","peerStore","keyBook","data","has","toPeer","conn","err","emit","once","filter","seqno","Buffer","from","msg","to","topicIDs","topicCIDs","push","JSON","stringify","getSubscribers","newPeers","sort","_emitChanges","differences","added","removed","length","id","_idB58String","m"],"mappings":"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","sourcesContent":["import diff from 'hyperdiff'\r\nimport EventEmitter from 'events'\r\nimport { cloneDeep as clone } from 'lodash'\r\nimport PeerId from 'peer-id'\r\n\r\nimport debug from 'debug'\r\n\r\nimport { PROTOCOL } from './protocol'\r\nimport Connection from './connection'\r\nimport encoding from './encoding'\r\nimport directConnection from './direct-connection-handler'\r\nimport namedQueryRun from '../../utils/namedQuery'\r\n\r\nconst DEFAULT_OPTIONS = {\r\n  pollInterval: 1000\r\n}\r\n\r\nlet index = 0\r\n\r\nexport default class PubSubRoom extends EventEmitter {\r\n  _libp2p: any\r\n  _topic: any\r\n  _options: any\r\n  _peers: any[]\r\n  _connections: any\r\n  _handleMessage: any\r\n  _interval: NodeJS.Timeout\r\n  _idx: number\r\n\r\n  constructor (libp2p, topic, options) {\r\n    super()\r\n    this._libp2p = libp2p.libp2p || libp2p\r\n    this._topic = topic\r\n    this._options = Object.assign({}, clone(DEFAULT_OPTIONS), clone(options))\r\n    this._peers = []\r\n    this._connections = {}\r\n\r\n    this._handleDirectMessage = this._handleDirectMessage.bind(this)\r\n    this._handleMessage = this._onMessage.bind(this)\r\n\r\n    if (!this._libp2p.pubsub) {\r\n      throw new Error('pubsub has not been configured')\r\n    }\r\n\r\n    this._interval = setInterval(\r\n      this._pollPeers.bind(this),\r\n      this._options.pollInterval\r\n    )\r\n\r\n    this._libp2p.handle(PROTOCOL, directConnection.handler)\r\n    directConnection.emitter.on(this._topic, this._handleDirectMessage)\r\n\r\n    this._libp2p.pubsub.subscribe(this._topic, this._handleMessage)\r\n\r\n    this._libp2p.on('error', (error) => {\r\n      console.log('Libp2p error', error)\r\n    })\r\n\r\n    this._idx = index++\r\n  }\r\n\r\n  getPeers () {\r\n    return this._peers.slice(0)\r\n  }\r\n\r\n  hasPeer (peer) {\r\n    return Boolean(this._peers.find(p => p.toString() === peer.toString()))\r\n  }\r\n\r\n  async leave () {\r\n    clearInterval(this._interval)\r\n    Object.keys(this._connections).forEach((peer) => {\r\n      this._connections[peer].stop()\r\n    })\r\n    directConnection.emitter.removeListener(this._topic, this._handleDirectMessage)\r\n    this._libp2p.unhandle(PROTOCOL, directConnection.handler)\r\n    await this._libp2p.pubsub.unsubscribe(this._topic, this._handleMessage)\r\n  }\r\n\r\n  async broadcast (_message) {\r\n    const message = encoding(_message)\r\n\r\n    const peersInTopic = this._libp2p.pubsub.topics.get(this._topic)\r\n    if (peersInTopic) {\r\n      peersInTopic.forEach((peerId) => {\r\n        this.sendTo(peerId, _message)\r\n      })\r\n    }\r\n  }\r\n\r\n  sendTo (peer, message) {\r\n    namedQueryRun({\r\n      name: `libp2p_peer_${peer}`,\r\n      delay: 100,\r\n      func: async () => {\r\n        if (!this._libp2p.peerStore.keyBook.data.has(peer)) {\r\n          return\r\n        }\r\n        const toPeer = this._libp2p.peerStore.keyBook.data.get(peer)\r\n\r\n        let conn = this._connections[peer]\r\n\r\n        if (!conn) {\r\n          conn = new Connection(toPeer, this._libp2p, this)\r\n          conn.on('error', (err) => this.emit('error', err))\r\n          this._connections[peer] = conn\r\n\r\n          conn.once('disconnect', () => {\r\n            delete this._connections[peer]\r\n            this._peers = this._peers.filter((p) => p.toString() !== peer.toString())\r\n            this.emit('peer left', peer)\r\n          })\r\n        }\r\n\r\n        const seqno = Buffer.from([0])\r\n\r\n        const msg = {\r\n          to: toPeer,\r\n          from: this._libp2p.peerId,\r\n          data: Buffer.from(message).toString('hex'),\r\n          seqno: seqno.toString('hex'),\r\n          topicIDs: [this._topic],\r\n          topicCIDs: [this._topic]\r\n        }\r\n\r\n        conn.push(Buffer.from(JSON.stringify(msg)))\r\n      },\r\n    })\r\n  }\r\n\r\n  async _pollPeers () {\r\n    const newPeers = (await this._libp2p.pubsub.getSubscribers(this._topic)).sort()\r\n\r\n    if (this._emitChanges(newPeers)) {\r\n      this._peers = newPeers\r\n    }\r\n  }\r\n\r\n  _emitChanges (newPeers) {\r\n    const differences = diff(this._peers, newPeers)\r\n\r\n    differences.added.forEach((peer) => this.emit('peer joined', peer))\r\n    differences.removed.forEach((peer) => this.emit('peer left', peer))\r\n\r\n    return differences.added.length > 0 || differences.removed.length > 0\r\n  }\r\n\r\n  _onMessage (message) {\r\n\r\n    this.emit('message', message)\r\n  }\r\n\r\n  _handleDirectMessage (message) {\r\n    if (message.to.id === this._libp2p.peerId._idB58String) {\r\n      const m = Object.assign({}, message)\r\n      delete m.to\r\n\r\n      this.emit('message', m)\r\n    }\r\n  }\r\n}\r\n"]}]}