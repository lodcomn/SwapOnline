{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\common\\utils\\apiLooper.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\common\\utils\\apiLooper.ts","mtime":1614842913720},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5IjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmltcG9ydCByZXF1ZXN0IGZyb20gJy4vcmVxdWVzdCc7CmltcG9ydCBnZXRVbml4VGltZVN0YW1wIGZyb20gJy4vZ2V0VW5peFRpbWVTdGFtcCc7CnZhciBhcGlTdGF0dXNlcyA9IHt9Owp2YXIgYXBpUXVlcnkgPSB7fTsKdmFyIGFwaVF1ZXJ5VGltZXJzID0ge307CnZhciBhcGlRdWVyeVRpY2tzID0gMTA7CnZhciBhcGlzID0ge307Cgp2YXIgYXBpUXVlcnlUaW1lciA9IGZ1bmN0aW9uIGFwaVF1ZXJ5VGltZXIocXVlcnlOYW1lKSB7CiAgaWYgKGFwaVF1ZXJ5W3F1ZXJ5TmFtZV0ubGVuZ3RoKSB7CiAgICB2YXIgcXVlcnlDaHVuayA9IGFwaVF1ZXJ5W3F1ZXJ5TmFtZV0uc2hpZnQoKTsKICAgIHZhciBtZXRob2QgPSBxdWVyeUNodW5rLm1ldGhvZCwKICAgICAgICBhcGkgPSBxdWVyeUNodW5rLmFwaSwKICAgICAgICBlbmRwb2ludCA9IHF1ZXJ5Q2h1bmsuZW5kcG9pbnQsCiAgICAgICAgb25SZXNvbHZlID0gcXVlcnlDaHVuay5yZXNvbHZlLAogICAgICAgIG9uRXJyb3IgPSBxdWVyeUNodW5rLmVycm9yLAogICAgICAgIG9wdGlvbnMgPSBxdWVyeUNodW5rLm9wdGlvbnMsCiAgICAgICAgZGVsYXkgPSBxdWVyeUNodW5rLm9wdGlvbnMuaW5RdWVyeS5kZWxheTsKICAgIGFwaUxvb3BlcihtZXRob2QsIGFwaSwgZW5kcG9pbnQsIG9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKGFuc3dlcikgewogICAgICBvblJlc29sdmUoYW5zd2VyKTsKICAgICAgYXBpUXVlcnlUaW1lcnNbcXVlcnlOYW1lXSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGFwaVF1ZXJ5VGltZXIocXVlcnlOYW1lKTsKICAgICAgfSwgZGVsYXkpOwogICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgIG9uRXJyb3IoZXJyb3IpOwogICAgICBhcGlRdWVyeVRpbWVyc1txdWVyeU5hbWVdID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgYXBpUXVlcnlUaW1lcihxdWVyeU5hbWUpOwogICAgICB9LCBkZWxheSk7CiAgICB9KTsKICB9IGVsc2UgewogICAgYXBpUXVlcnlUaW1lcnNbcXVlcnlOYW1lXSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBhcGlRdWVyeVRpbWVyKHF1ZXJ5TmFtZSk7CiAgICB9LCBhcGlRdWVyeVRpY2tzKTsKICB9Cn07Cgp2YXIgYXBpUXVlcnlJbml0ID0gZnVuY3Rpb24gYXBpUXVlcnlJbml0KHF1ZXJ5TmFtZSkgewogIGlmICghYXBpUXVlcnlbcXVlcnlOYW1lXSkgYXBpUXVlcnlbcXVlcnlOYW1lXSA9IFtdOwoKICBpZiAoIWFwaVF1ZXJ5VGltZXJzW3F1ZXJ5TmFtZV0pIHsKICAgIGFwaVF1ZXJ5VGltZXJzW3F1ZXJ5TmFtZV0gPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgYXBpUXVlcnlUaW1lcihxdWVyeU5hbWUpOwogICAgfSwgYXBpUXVlcnlUaWNrcyk7CiAgfQp9OwoKdmFyIGluaXRBcGlTdGF0dXMgPSBmdW5jdGlvbiBpbml0QXBpU3RhdHVzKG5hbWUsIGFwaVNlcnZlcnMpIHsKICB2YXIgc3RhdCA9IHsKICAgIG5hbWU6IG5hbWUsCiAgICBlbmRwb2ludHM6IHt9LAogICAgcHJpb3I6IFtdLAogICAgbGFzdDogZmFsc2UKICB9OwoKICBpZiAoYXBpU2VydmVycyBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICBhcGlTZXJ2ZXJzLmZvckVhY2goZnVuY3Rpb24gKHVybCwgaW5kZXgpIHsKICAgICAgc3RhdC5lbmRwb2ludHNbdXJsXSA9IHsKICAgICAgICB1cmw6IHVybCwKICAgICAgICBsYXN0Q2hlY2s6IGdldFVuaXhUaW1lU3RhbXAoKSwKICAgICAgICBvbmxpbmU6IHRydWUKICAgICAgfTsKICAgICAgc3RhdC5wcmlvci5wdXNoKHVybCk7CiAgICB9KTsKICAgIHN0YXQubGFzdCA9IGFwaVNlcnZlcnNbYXBpU2VydmVycy5sZW5ndGggLSAxXTsKICB9IGVsc2UgewogICAgc3RhdC5lbmRwb2ludHNbYXBpU2VydmVyc10gPSB7CiAgICAgIHVybDogYXBpU2VydmVycywKICAgICAgbGFzdENoZWNrOiBnZXRVbml4VGltZVN0YW1wKCksCiAgICAgIG9ubGluZTogdHJ1ZQogICAgfTsKICAgIHN0YXQucHJpb3IucHVzaChhcGlTZXJ2ZXJzKTsKICAgIHN0YXQubGFzdCA9IGFwaVNlcnZlcnM7CiAgfQoKICBhcGlTdGF0dXNlc1tuYW1lXSA9IHN0YXQ7Cn07Cgp2YXIgc3dpdGNoTmV4dCA9IGZ1bmN0aW9uIHN3aXRjaE5leHQoYXBpKSB7CiAgaWYgKGFwaVN0YXR1c2VzW2FwaV0pIHsKICAgIGlmIChhcGlTdGF0dXNlc1thcGldLnByaW9yWzBdID09PSBhcGlTdGF0dXNlc1thcGldLmxhc3QpIHJldHVybiBmYWxzZTsKICAgIHZhciBhcGlQcmlvcml0ZXQgPSBhcGlTdGF0dXNlc1thcGldLnByaW9yOwogICAgdmFyIGN1cnJlbnQgPSBhcGlQcmlvcml0ZXQuc2hpZnQoKTsKICAgIGFwaVByaW9yaXRldC5wdXNoKGN1cnJlbnQpOwogICAgYXBpU3RhdHVzZXNbYXBpXS5wcmlvciA9IGFwaVByaW9yaXRldDsKICAgIGFwaVN0YXR1c2VzW2FwaV0uZW5kcG9pbnRzW2N1cnJlbnRdLm9ubGluZSA9IGZhbHNlOwogICAgYXBpU3RhdHVzZXNbYXBpXS5lbmRwb2ludHNbY3VycmVudF0ubGFzdENoZWNrID0gZ2V0VW5peFRpbWVTdGFtcCgpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICByZXR1cm4gZmFsc2U7Cn07Cgp2YXIgYXBpTG9vcGVyID0gZnVuY3Rpb24gYXBpTG9vcGVyKG1ldGhvZCwgYXBpLCBlbmRwb2ludCwgb3B0aW9ucykgewogIHZhciBfcmVmID0gb3B0aW9ucyB8fCB7fSwKICAgICAgaW5RdWVyeSA9IF9yZWYuaW5RdWVyeSwKICAgICAgaWdub3JlRXJyb3JzID0gX3JlZi5pZ25vcmVFcnJvcnMsCiAgICAgIHJlcG9ydEVycm9ycyA9IF9yZWYucmVwb3J0RXJyb3JzOwoKICB2YXIgYXBpTmFtZSA9IGFwaS5uYW1lLAogICAgICBhcGlTZXJ2ZXJzID0gYXBpLnNlcnZlcnM7CgogIGlmIChpblF1ZXJ5ICYmICFpblF1ZXJ5LmluaXRlZCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCBlcnJvcikgewogICAgICB2YXIgbmFtZSA9IGluUXVlcnkubmFtZTsKICAgICAgdmFyIHF1ZXJ5TmFtZSA9ICIiLmNvbmNhdChhcGksICJfIikuY29uY2F0KG5hbWUpOwogICAgICBhcGlRdWVyeUluaXQocXVlcnlOYW1lKTsKICAgICAgYXBpUXVlcnlbcXVlcnlOYW1lXS5wdXNoKHsKICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICBhcGk6IGFwaSwKICAgICAgICBlbmRwb2ludDogZW5kcG9pbnQsCiAgICAgICAgb3B0aW9uczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBvcHRpb25zKSwge30sIHsKICAgICAgICAgIGluUXVlcnk6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaW5RdWVyeSksIHt9LCB7CiAgICAgICAgICAgIGluaXRlZDogdHJ1ZQogICAgICAgICAgfSkKICAgICAgICB9KSwKICAgICAgICByZXNvbHZlOiByZXNvbHZlLAogICAgICAgIGVycm9yOiBlcnJvcgogICAgICB9KTsKICAgIH0pOwogIH0KCiAgaWYgKCFhcGlTdGF0dXNlc1thcGlOYW1lXSkgewogICAgaW5pdEFwaVN0YXR1cyhhcGlOYW1lLCBhcGlTZXJ2ZXJzKTsKICB9CgogIHZhciBhcGlTdGF0dXMgPSBhcGlTdGF0dXNlc1thcGlOYW1lXTsKCiAgaWYgKGFwaVN0YXR1cykgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCBlcnJvcikgewogICAgICB2YXIgZG9SZXF1ZXN0ID0gZnVuY3Rpb24gZG9SZXF1ZXN0KCkgewogICAgICAgIHZhciBjdXJyZW50RW5kcG9pbnQgPSBhcGlTdGF0dXMuZW5kcG9pbnRzW2FwaVN0YXR1cy5wcmlvclswXV07CgogICAgICAgIGlmIChjdXJyZW50RW5kcG9pbnQub25saW5lKSB7CiAgICAgICAgICB2YXIgdXJsID0gIiIuY29uY2F0KGN1cnJlbnRFbmRwb2ludC51cmwpLmNvbmNhdChlbmRwb2ludCk7CiAgICAgICAgICByZXF1ZXN0W21ldGhvZF0odXJsLCBvcHRpb25zKS50aGVuKGZ1bmN0aW9uIChhbnN3ZXIpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGVja1N0YXR1cyBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CiAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmNoZWNrU3RhdHVzKGFuc3dlcikpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVuZHBvaW50ICIuY29uY2F0KGN1cnJlbnRFbmRwb2ludC51cmwsICIgLSBjaGVja1N0YXR1cyBmYWlsZWQgKG1heSBiZSBkb3duKS4gU3dpdGNoIG5leHQiKSk7CgogICAgICAgICAgICAgICAgaWYgKHN3aXRjaE5leHQoYXBpKSkgewogICAgICAgICAgICAgICAgICBkb1JlcXVlc3QoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGVycm9yKCdBbGwgZW5kcG9pbnRzIG9mIGFwaSBpcyBvZmZsaW5lJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzb2x2ZShhbnN3ZXIpOwogICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGFuc3dlcikgewogICAgICAgICAgICBpZiAocmVwb3J0RXJyb3JzIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKICAgICAgICAgICAgICB2YXIgc2tpcERlZlJlc29sdmUgPSBmYWxzZTsKICAgICAgICAgICAgICB2YXIgc3dpdGhUb05leHRTZXJ2ZXIgPSByZXBvcnRFcnJvcnMoYW5zd2VyLCBmdW5jdGlvbiAocmVzb2x2ZVJlc3VsdCkgewogICAgICAgICAgICAgICAgc2tpcERlZlJlc29sdmUgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNvbHZlUmVzdWx0KTsKICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVqZWN0UmVzdWx0KSB7CiAgICAgICAgICAgICAgICBlcnJvcihyZWplY3RSZXN1bHQpOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoIXN3aXRoVG9OZXh0U2VydmVyKSB7CiAgICAgICAgICAgICAgICBpZiAoIXNraXBEZWZSZXNvbHZlKSByZXNvbHZlKGFuc3dlcik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0lnbm9yZSBlcnJvciBeJyk7CiAgICAgICAgICAgICAgcmVzb2x2ZShhbnN3ZXIpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRW5kcG9pbnQgIi5jb25jYXQoY3VycmVudEVuZHBvaW50LnVybCwgIiBtYXkgYmUgb2ZmbGluZS4gU3dpdGNoIG5leHQiKSk7CgogICAgICAgICAgICBpZiAoc3dpdGNoTmV4dChhcGlOYW1lKSkgewogICAgICAgICAgICAgIGRvUmVxdWVzdCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGVycm9yKCdBbGwgZW5kcG9pbnRzIG9mIGFwaSBpcyBvZmZsaW5lJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlcnJvcignQWxsIGVuZHBvaW50cyBvZiBhcGkgaXMgb2ZmbGluZScpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGRvUmVxdWVzdCgpOwogICAgfSk7CiAgfQoKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIGVycm9yKSB7CiAgICBlcnJvcignQXBpIG5vdCBmb3VuZCcpOwogIH0pOwp9OwoKZXhwb3J0IGRlZmF1bHQgewogIGdldDogZnVuY3Rpb24gZ2V0KGFwaSwgZW5kcG9pbnQsIG9wdGlvbnMpIHsKICAgIHJldHVybiBhcGlMb29wZXIoJ2dldCcsIGFwaSwgZW5kcG9pbnQsIG9wdGlvbnMpOwogIH0sCiAgcG9zdDogZnVuY3Rpb24gcG9zdChhcGksIGVuZHBvaW50LCBvcHRpb25zKSB7CiAgICByZXR1cm4gYXBpTG9vcGVyKCdwb3N0JywgYXBpLCBlbmRwb2ludCwgb3B0aW9ucyk7CiAgfQp9Ow=="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/common/utils/apiLooper.ts"],"names":["request","getUnixTimeStamp","apiStatuses","apiQuery","apiQueryTimers","apiQueryTicks","apis","apiQueryTimer","queryName","length","queryChunk","shift","method","api","endpoint","onResolve","resolve","onError","error","options","delay","inQuery","apiLooper","then","answer","setTimeout","apiQueryInit","initApiStatus","name","apiServers","stat","endpoints","prior","last","Array","forEach","url","index","lastCheck","online","push","switchNext","apiPrioritet","current","ignoreErrors","reportErrors","apiName","servers","inited","Promise","apiStatus","doRequest","currentEndpoint","checkStatus","Function","console","skipDefResolve","swithToNextServer","resolveResult","rejectResult","log","get","post"],"mappings":";;;;;;AAAA,OAAOA,OAAP,MAAoB,WAApB;AACA,OAAOC,gBAAP,MAA6B,oBAA7B;AAGA,IAAMC,WAAW,GAAG,EAApB;AACA,IAAMC,QAAQ,GAAG,EAAjB;AACA,IAAMC,cAAc,GAAG,EAAvB;AACA,IAAMC,aAAa,GAAG,EAAtB;AAEA,IAAMC,IAAI,GAAG,EAAb;;AAEA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,SAAD,EAAe;AACnC,MAAIL,QAAQ,CAACK,SAAD,CAAR,CAAoBC,MAAxB,EAAgC;AAC9B,QAAMC,UAAU,GAAGP,QAAQ,CAACK,SAAD,CAAR,CAAoBG,KAApB,EAAnB;AAD8B,QAG5BC,MAH4B,GAc1BF,UAd0B,CAG5BE,MAH4B;AAAA,QAI5BC,GAJ4B,GAc1BH,UAd0B,CAI5BG,GAJ4B;AAAA,QAK5BC,QAL4B,GAc1BJ,UAd0B,CAK5BI,QAL4B;AAAA,QAMnBC,SANmB,GAc1BL,UAd0B,CAM5BM,OAN4B;AAAA,QAOrBC,OAPqB,GAc1BP,UAd0B,CAO5BQ,KAP4B;AAAA,QAQ5BC,OAR4B,GAc1BT,UAd0B,CAQ5BS,OAR4B;AAAA,QAWxBC,KAXwB,GAc1BV,UAd0B,CAS5BS,OAT4B,CAU1BE,OAV0B,CAWxBD,KAXwB;AAgB9BE,IAAAA,SAAS,CAACV,MAAD,EAASC,GAAT,EAAcC,QAAd,EAAwBK,OAAxB,CAAT,CAA0CI,IAA1C,CAA+C,UAACC,MAAD,EAAY;AACzDT,MAAAA,SAAS,CAACS,MAAD,CAAT;AACApB,MAAAA,cAAc,CAACI,SAAD,CAAd,GAA4BiB,UAAU,CAAC,YAAM;AAC3ClB,QAAAA,aAAa,CAACC,SAAD,CAAb;AACD,OAFqC,EAEnCY,KAFmC,CAAtC;AAID,KAND,WAMS,UAACF,KAAD,EAAW;AAClBD,MAAAA,OAAO,CAACC,KAAD,CAAP;AACAd,MAAAA,cAAc,CAACI,SAAD,CAAd,GAA4BiB,UAAU,CAAC,YAAM;AAC3ClB,QAAAA,aAAa,CAACC,SAAD,CAAb;AACD,OAFqC,EAEnCY,KAFmC,CAAtC;AAGD,KAXD;AAYD,GA5BD,MA4BO;AACLhB,IAAAA,cAAc,CAACI,SAAD,CAAd,GAA4BiB,UAAU,CAAC,YAAM;AAC3ClB,MAAAA,aAAa,CAACC,SAAD,CAAb;AACD,KAFqC,EAEnCH,aAFmC,CAAtC;AAGD;AACF,CAlCD;;AAoCA,IAAMqB,YAAY,GAAG,SAAfA,YAAe,CAAClB,SAAD,EAAe;AAClC,MAAI,CAACL,QAAQ,CAACK,SAAD,CAAb,EAA0BL,QAAQ,CAACK,SAAD,CAAR,GAAsB,EAAtB;;AAC1B,MAAI,CAACJ,cAAc,CAACI,SAAD,CAAnB,EAAgC;AAAEJ,IAAAA,cAAc,CAACI,SAAD,CAAd,GAA4BiB,UAAU,CAAC,YAAM;AAC7ElB,MAAAA,aAAa,CAACC,SAAD,CAAb;AACD,KAFuE,EAErEH,aAFqE,CAAtC;AAEf;AACpB,CALD;;AAOA,IAAMsB,aAAa,GAAG,SAAhBA,aAAgB,CAACC,IAAD,EAAOC,UAAP,EAAsB;AAC1C,MAAMC,IAAI,GAAG;AACXF,IAAAA,IAAI,EAAJA,IADW;AAEXG,IAAAA,SAAS,EAAE,EAFA;AAGXC,IAAAA,KAAK,EAAE,EAHI;AAIXC,IAAAA,IAAI,EAAE;AAJK,GAAb;;AAOA,MAAIJ,UAAU,YAAYK,KAA1B,EAAiC;AAC/BL,IAAAA,UAAU,CAACM,OAAX,CAAmB,UAACC,GAAD,EAAMC,KAAN,EAAgB;AACjCP,MAAAA,IAAI,CAACC,SAAL,CAAeK,GAAf,IAAsB;AACpBA,QAAAA,GAAG,EAAHA,GADoB;AAEpBE,QAAAA,SAAS,EAAErC,gBAAgB,EAFP;AAGpBsC,QAAAA,MAAM,EAAE;AAHY,OAAtB;AAKAT,MAAAA,IAAI,CAACE,KAAL,CAAWQ,IAAX,CAAgBJ,GAAhB;AACD,KAPD;AAQAN,IAAAA,IAAI,CAACG,IAAL,GAAYJ,UAAU,CAACA,UAAU,CAACpB,MAAX,GAAoB,CAArB,CAAtB;AACD,GAVD,MAUO;AACLqB,IAAAA,IAAI,CAACC,SAAL,CAAeF,UAAf,IAA6B;AAC3BO,MAAAA,GAAG,EAAEP,UADsB;AAE3BS,MAAAA,SAAS,EAAErC,gBAAgB,EAFA;AAG3BsC,MAAAA,MAAM,EAAE;AAHmB,KAA7B;AAKAT,IAAAA,IAAI,CAACE,KAAL,CAAWQ,IAAX,CAAgBX,UAAhB;AACAC,IAAAA,IAAI,CAACG,IAAL,GAAYJ,UAAZ;AACD;;AACD3B,EAAAA,WAAW,CAAC0B,IAAD,CAAX,GAAoBE,IAApB;AACD,CA5BD;;AA8BA,IAAMW,UAAU,GAAG,SAAbA,UAAa,CAAC5B,GAAD,EAAS;AAC1B,MAAIX,WAAW,CAACW,GAAD,CAAf,EAAsB;AACpB,QAAIX,WAAW,CAACW,GAAD,CAAX,CAAiBmB,KAAjB,CAAuB,CAAvB,MAA8B9B,WAAW,CAACW,GAAD,CAAX,CAAiBoB,IAAnD,EAAyD,OAAO,KAAP;AAEzD,QAAMS,YAAY,GAAGxC,WAAW,CAACW,GAAD,CAAX,CAAiBmB,KAAtC;AAEA,QAAMW,OAAO,GAAGD,YAAY,CAAC/B,KAAb,EAAhB;AACA+B,IAAAA,YAAY,CAACF,IAAb,CAAkBG,OAAlB;AACAzC,IAAAA,WAAW,CAACW,GAAD,CAAX,CAAiBmB,KAAjB,GAAyBU,YAAzB;AACAxC,IAAAA,WAAW,CAACW,GAAD,CAAX,CAAiBkB,SAAjB,CAA2BY,OAA3B,EAAoCJ,MAApC,GAA6C,KAA7C;AACArC,IAAAA,WAAW,CAACW,GAAD,CAAX,CAAiBkB,SAAjB,CAA2BY,OAA3B,EAAoCL,SAApC,GAAgDrC,gBAAgB,EAAhE;AAEA,WAAO,IAAP;AACD;;AACD,SAAO,KAAP;AACD,CAfD;;AAiBA,IAAMqB,SAAS,GAAG,SAAZA,SAAY,CAACV,MAAD,EAASC,GAAT,EAAcC,QAAd,EAAwBK,OAAxB,EAAoC;AAAA,aAKhDA,OAAO,IAAI,EALqC;AAAA,MAElDE,OAFkD,QAElDA,OAFkD;AAAA,MAGlDuB,YAHkD,QAGlDA,YAHkD;AAAA,MAIlDC,YAJkD,QAIlDA,YAJkD;;AAAA,MAQ5CC,OAR4C,GAUhDjC,GAVgD,CAQlDe,IARkD;AAAA,MASzCC,UATyC,GAUhDhB,GAVgD,CASlDkC,OATkD;;AAYpD,MAAI1B,OAAO,IAAI,CAACA,OAAO,CAAC2B,MAAxB,EAAgC;AAC9B,WAAO,IAAIC,OAAJ,CAAY,UAACjC,OAAD,EAAUE,KAAV,EAAoB;AAAA,UAC7BU,IAD6B,GACpBP,OADoB,CAC7BO,IAD6B;AAErC,UAAMpB,SAAS,aAAMK,GAAN,cAAae,IAAb,CAAf;AAEAF,MAAAA,YAAY,CAAClB,SAAD,CAAZ;AAEAL,MAAAA,QAAQ,CAACK,SAAD,CAAR,CAAoBgC,IAApB,CAAyB;AACvB5B,QAAAA,MAAM,EAANA,MADuB;AAEvBC,QAAAA,GAAG,EAAHA,GAFuB;AAGvBC,QAAAA,QAAQ,EAARA,QAHuB;AAIvBK,QAAAA,OAAO,kCACFA,OADE;AAELE,UAAAA,OAAO,kCACFA,OADE;AAEL2B,YAAAA,MAAM,EAAE;AAFH;AAFF,UAJgB;AAWvBhC,QAAAA,OAAO,EAAPA,OAXuB;AAYvBE,QAAAA,KAAK,EAALA;AAZuB,OAAzB;AAeD,KArBM,CAAP;AAsBD;;AAED,MAAI,CAAChB,WAAW,CAAC4C,OAAD,CAAhB,EAA2B;AACzBnB,IAAAA,aAAa,CAACmB,OAAD,EAAUjB,UAAV,CAAb;AACD;;AAED,MAAMqB,SAAS,GAAGhD,WAAW,CAAC4C,OAAD,CAA7B;;AAEA,MAAII,SAAJ,EAAe;AACb,WAAO,IAAID,OAAJ,CAAY,UAACjC,OAAD,EAAUE,KAAV,EAAoB;AACrC,UAAMiC,SAAS,GAAG,SAAZA,SAAY,GAAM;AACtB,YAAMC,eAAe,GAAGF,SAAS,CAACnB,SAAV,CAAoBmB,SAAS,CAAClB,KAAV,CAAgB,CAAhB,CAApB,CAAxB;;AACA,YAAIoB,eAAe,CAACb,MAApB,EAA4B;AAC1B,cAAMH,GAAG,aAAMgB,eAAe,CAAChB,GAAtB,SAA4BtB,QAA5B,CAAT;AAEAd,UAAAA,OAAO,CAACY,MAAD,CAAP,CAAgBwB,GAAhB,EAAqBjB,OAArB,EACGI,IADH,CACQ,UAACC,MAAD,EAAY;AAChB,gBAAIL,OAAO,IAAIA,OAAO,CAACkC,WAAR,YAA+BC,QAA9C,EAAwD;AACtD,kBAAI,CAACnC,OAAO,CAACkC,WAAR,CAAoB7B,MAApB,CAAL,EAAkC;AAChC+B,gBAAAA,OAAO,CAACrC,KAAR,oBAA0BkC,eAAe,CAAChB,GAA1C;;AACA,oBAAIK,UAAU,CAAC5B,GAAD,CAAd,EAAqB;AACnBsC,kBAAAA,SAAS;AACV,iBAFD,MAEO;AACLjC,kBAAAA,KAAK,CAAC,iCAAD,CAAL;AACD;;AACD;AACD;AACF;;AACDF,YAAAA,OAAO,CAACQ,MAAD,CAAP;AACD,WAdH,WAeS,UAACA,MAAD,EAAY;AACjB,gBAAIqB,YAAY,YAAYS,QAA5B,EAAsC;AACpC,kBAAIE,cAAc,GAAG,KAArB;AACA,kBAAMC,iBAAiB,GAAGZ,YAAY,CACpCrB,MADoC,EAEpC,UAACkC,aAAD,EAAmB;AACjBF,gBAAAA,cAAc,GAAG,IAAjB;AACAxC,gBAAAA,OAAO,CAAC0C,aAAD,CAAP;AACD,eALmC,EAMpC,UAACC,YAAD,EAAkB;AAChBzC,gBAAAA,KAAK,CAACyC,YAAD,CAAL;AACD,eARmC,CAAtC;;AAUA,kBAAI,CAACF,iBAAL,EAAwB;AACtB,oBAAI,CAACD,cAAL,EAAqBxC,OAAO,CAACQ,MAAD,CAAP;AACrB;AACD;AACF;;AACD,gBAAIoB,YAAJ,EAAkB;AAChBW,cAAAA,OAAO,CAACK,GAAR,CAAY,gBAAZ;AACA5C,cAAAA,OAAO,CAACQ,MAAD,CAAP;AACA;AACD;;AACD+B,YAAAA,OAAO,CAACrC,KAAR,oBAA0BkC,eAAe,CAAChB,GAA1C;;AACA,gBAAIK,UAAU,CAACK,OAAD,CAAd,EAAyB;AACvBK,cAAAA,SAAS;AACV,aAFD,MAEO;AACLjC,cAAAA,KAAK,CAAC,iCAAD,CAAL;AACD;AACF,WA5CH;AA6CD,SAhDD,MAgDO;AACLA,UAAAA,KAAK,CAAC,iCAAD,CAAL;AACD;AACF,OArDD;;AAsDAiC,MAAAA,SAAS;AACV,KAxDM,CAAP;AAyDD;;AACD,SAAO,IAAIF,OAAJ,CAAY,UAACjC,OAAD,EAAUE,KAAV,EAAoB;AAAEA,IAAAA,KAAK,CAAC,eAAD,CAAL;AAAwB,GAA1D,CAAP;AAED,CAxGD;;AA2GA,eAAe;AACb2C,EAAAA,GAAG,EAAE,aAAChD,GAAD,EAAMC,QAAN,EAAgBK,OAAhB;AAAA,WAA6BG,SAAS,CAAC,KAAD,EAAQT,GAAR,EAAaC,QAAb,EAAuBK,OAAvB,CAAtC;AAAA,GADQ;AAEb2C,EAAAA,IAAI,EAAE,cAACjD,GAAD,EAAMC,QAAN,EAAgBK,OAAhB;AAAA,WAA6BG,SAAS,CAAC,MAAD,EAAST,GAAT,EAAcC,QAAd,EAAwBK,OAAxB,CAAtC;AAAA;AAFO,CAAf","sourcesContent":["import request from './request'\r\nimport getUnixTimeStamp from './getUnixTimeStamp'\r\n\r\n\r\nconst apiStatuses = {}\r\nconst apiQuery = {}\r\nconst apiQueryTimers = {}\r\nconst apiQueryTicks = 10\r\n\r\nconst apis = {}\r\n\r\nconst apiQueryTimer = (queryName) => {\r\n  if (apiQuery[queryName].length) {\r\n    const queryChunk = apiQuery[queryName].shift()\r\n    const {\r\n      method,\r\n      api,\r\n      endpoint,\r\n      resolve: onResolve,\r\n      error: onError,\r\n      options,\r\n      options: {\r\n        inQuery: {\r\n          delay,\r\n        },\r\n      },\r\n    } = queryChunk\r\n\r\n    apiLooper(method, api, endpoint, options).then((answer) => {\r\n      onResolve(answer)\r\n      apiQueryTimers[queryName] = setTimeout(() => {\r\n        apiQueryTimer(queryName)\r\n      }, delay)\r\n\r\n    }).catch((error) => {\r\n      onError(error)\r\n      apiQueryTimers[queryName] = setTimeout(() => {\r\n        apiQueryTimer(queryName)\r\n      }, delay)\r\n    })\r\n  } else {\r\n    apiQueryTimers[queryName] = setTimeout(() => {\r\n      apiQueryTimer(queryName)\r\n    }, apiQueryTicks)\r\n  }\r\n}\r\n\r\nconst apiQueryInit = (queryName) => {\r\n  if (!apiQuery[queryName]) apiQuery[queryName] = []\r\n  if (!apiQueryTimers[queryName]) { apiQueryTimers[queryName] = setTimeout(() => {\r\n    apiQueryTimer(queryName)\r\n  }, apiQueryTicks) }\r\n}\r\n\r\nconst initApiStatus = (name, apiServers) => {\r\n  const stat = {\r\n    name,\r\n    endpoints: {},\r\n    prior: [],\r\n    last: false,\r\n  }\r\n\r\n  if (apiServers instanceof Array) {\r\n    apiServers.forEach((url, index) => {\r\n      stat.endpoints[url] = {\r\n        url,\r\n        lastCheck: getUnixTimeStamp(),\r\n        online: true,\r\n      }\r\n      stat.prior.push(url)\r\n    })\r\n    stat.last = apiServers[apiServers.length - 1]\r\n  } else {\r\n    stat.endpoints[apiServers] = {\r\n      url: apiServers,\r\n      lastCheck: getUnixTimeStamp(),\r\n      online: true,\r\n    }\r\n    stat.prior.push(apiServers)\r\n    stat.last = apiServers\r\n  }\r\n  apiStatuses[name] = stat\r\n}\r\n\r\nconst switchNext = (api) => {\r\n  if (apiStatuses[api]) {\r\n    if (apiStatuses[api].prior[0] === apiStatuses[api].last) return false\r\n\r\n    const apiPrioritet = apiStatuses[api].prior\r\n\r\n    const current = apiPrioritet.shift()\r\n    apiPrioritet.push(current)\r\n    apiStatuses[api].prior = apiPrioritet\r\n    apiStatuses[api].endpoints[current].online = false\r\n    apiStatuses[api].endpoints[current].lastCheck = getUnixTimeStamp()\r\n\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst apiLooper = (method, api, endpoint, options) => {\r\n  const {\r\n    inQuery,\r\n    ignoreErrors,\r\n    reportErrors,\r\n  } = options || {}\r\n\r\n  const {\r\n    name: apiName,\r\n    servers: apiServers,\r\n  } = api\r\n\r\n  if (inQuery && !inQuery.inited) {\r\n    return new Promise((resolve, error) => {\r\n      const { name } = inQuery\r\n      const queryName = `${api}_${name}`\r\n\r\n      apiQueryInit(queryName)\r\n\r\n      apiQuery[queryName].push({\r\n        method,\r\n        api,\r\n        endpoint,\r\n        options: {\r\n          ...options,\r\n          inQuery: {\r\n            ...inQuery,\r\n            inited: true,\r\n          },\r\n        },\r\n        resolve,\r\n        error,\r\n      })\r\n\r\n    })\r\n  }\r\n\r\n  if (!apiStatuses[apiName]) {\r\n    initApiStatus(apiName, apiServers)\r\n  }\r\n\r\n  const apiStatus = apiStatuses[apiName]\r\n\r\n  if (apiStatus) {\r\n    return new Promise((resolve, error) => {\r\n      const doRequest = () => {\r\n        const currentEndpoint = apiStatus.endpoints[apiStatus.prior[0]]\r\n        if (currentEndpoint.online) {\r\n          const url = `${currentEndpoint.url}${endpoint}`\r\n\r\n          request[method](url, options)\r\n            .then((answer) => {\r\n              if (options && options.checkStatus instanceof Function) {\r\n                if (!options.checkStatus(answer)) {\r\n                  console.error(`Endpoint ${currentEndpoint.url} - checkStatus failed (may be down). Switch next`)\r\n                  if (switchNext(api)) {\r\n                    doRequest()\r\n                  } else {\r\n                    error('All endpoints of api is offline')\r\n                  }\r\n                  return\r\n                }\r\n              }\r\n              resolve(answer)\r\n            })\r\n            .catch((answer) => {\r\n              if (reportErrors instanceof Function) {\r\n                let skipDefResolve = false\r\n                const swithToNextServer = reportErrors(\r\n                  answer,\r\n                  (resolveResult) => {\r\n                    skipDefResolve = true\r\n                    resolve(resolveResult)\r\n                  },\r\n                  (rejectResult) => {\r\n                    error(rejectResult)\r\n                  }\r\n                )\r\n                if (!swithToNextServer) {\r\n                  if (!skipDefResolve) resolve(answer)\r\n                  return\r\n                }\r\n              }\r\n              if (ignoreErrors) {\r\n                console.log('Ignore error ^')\r\n                resolve(answer)\r\n                return\r\n              }\r\n              console.error(`Endpoint ${currentEndpoint.url} may be offline. Switch next`)\r\n              if (switchNext(apiName)) {\r\n                doRequest()\r\n              } else {\r\n                error('All endpoints of api is offline')\r\n              }\r\n            })\r\n        } else {\r\n          error('All endpoints of api is offline')\r\n        }\r\n      }\r\n      doRequest()\r\n    })\r\n  }\r\n  return new Promise((resolve, error) => { error('Api not found') })\r\n\r\n}\r\n\r\n\r\nexport default {\r\n  get: (api, endpoint, options?) => apiLooper('get', api, endpoint, options),\r\n  post: (api, endpoint, options?) => apiLooper('post', api, endpoint, options),\r\n}\r\n"]}]}