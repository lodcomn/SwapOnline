{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.flows\\BTC2ETHTOKEN.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\core\\swap.flows\\BTC2ETHTOKEN.ts","mtime":1614842913755},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyI7CmltcG9ydCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXNzZXJ0VGhpc0luaXRpYWxpemVkIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjsKaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiI7CmltcG9ydCBfZ2V0IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZ2V0IjsKaW1wb3J0IF9nZXRQcm90b3R5cGVPZiBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2dldFByb3RvdHlwZU9mIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiQGJhYmVsL3J1bnRpbWUvcmVnZW5lcmF0b3IiOwoKZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH0KCmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CgppbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnOwppbXBvcnQgeyBjb25zdGFudHMgfSBmcm9tICdzd2FwLmFwcCc7CmltcG9ydCB7IEF0b21pY0FCMlVUWE8gfSBmcm9tICdzd2FwLnN3YXAnOwpleHBvcnQgZGVmYXVsdCAoZnVuY3Rpb24gKHRva2VuTmFtZSkgewogIHZhciBCVEMyRVRIVE9LRU4gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9BdG9taWNBQjJVVFhPKSB7CiAgICBfaW5oZXJpdHMoQlRDMkVUSFRPS0VOLCBfQXRvbWljQUIyVVRYTyk7CgogICAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihCVEMyRVRIVE9LRU4pOwoKICAgIGZ1bmN0aW9uIEJUQzJFVEhUT0tFTihzd2FwKSB7CiAgICAgIHZhciBfdGhpc1N1cGVyLCBfdGhpczsKCiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCVEMyRVRIVE9LRU4pOwoKICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBzd2FwKTsKCiAgICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9mbG93TmFtZSIsIHZvaWQgMCk7CgogICAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJldGhUb2tlblN3YXAiLCB2b2lkIDApOwoKICAgICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiYnRjU3dhcCIsIHZvaWQgMCk7CgogICAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGF0ZSIsIHZvaWQgMCk7CgogICAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRSZWZ1bmRUeEhleCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpcy5idGNTd2FwLmdldFJlZnVuZEhleFRyYW5zYWN0aW9uKHsKICAgICAgICAgIHNjcmlwdFZhbHVlczogX3RoaXMuc3RhdGUudXR4b1NjcmlwdFZhbHVlcywKICAgICAgICAgIHNlY3JldDogX3RoaXMuc3RhdGUuc2VjcmV0CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAodHhIZXgpIHsKICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgcmVmdW5kVHhIZXg6IHR4SGV4CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBfdGhpcy51dHhvQ29pbiA9ICJidGMiOwogICAgICBfdGhpcy5fZmxvd05hbWUgPSBCVEMyRVRIVE9LRU4uZ2V0TmFtZSgpOwogICAgICBfdGhpcy5zdGVwTnVtYmVycyA9IHsKICAgICAgICAnc2lnbic6IDEsCiAgICAgICAgJ3N1Ym1pdC1zZWNyZXQnOiAyLAogICAgICAgICdzeW5jLWJhbGFuY2UnOiAzLAogICAgICAgICdsb2NrLXV0eG8nOiA0LAogICAgICAgICd3YWl0LWxvY2stZXRoJzogNSwKICAgICAgICAnd2l0aGRyYXctZXRoJzogNiwKICAgICAgICAnZmluaXNoJzogNywKICAgICAgICAnZW5kJzogOAogICAgICB9OwogICAgICBfdGhpcy5ldGhUb2tlblN3YXAgPSBzd2FwLm93bmVyU3dhcDsKICAgICAgX3RoaXMuYnRjU3dhcCA9IHN3YXAucGFydGljaXBhbnRTd2FwOwogICAgICBfdGhpcy5hYkJsb2NrY2hhaW4gPSBfdGhpcy5ldGhUb2tlblN3YXA7CiAgICAgIF90aGlzLnV0eG9CbG9ja2NoYWluID0gX3RoaXMuYnRjU3dhcDsKICAgICAgX3RoaXMuaXNVVFhPU2lkZSA9IHRydWU7CgogICAgICBpZiAoIV90aGlzLmV0aFRva2VuU3dhcCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignQlRDMkVUSDogImV0aFRva2VuU3dhcCIgb2YgdHlwZSBvYmplY3QgcmVxdWlyZWQnKTsKICAgICAgfQoKICAgICAgaWYgKCFfdGhpcy5idGNTd2FwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCVEMyRVRIOiAiYnRjU3dhcCIgb2YgdHlwZSBvYmplY3QgcmVxdWlyZWQnKTsKICAgICAgfQoKICAgICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgICAgc3RlcDogMCwKICAgICAgICBpc1N0b3BwZWRTd2FwOiBmYWxzZSwKICAgICAgICBzaWduVHJhbnNhY3Rpb25IYXNoOiBudWxsLAogICAgICAgIGlzU2lnbkZldGNoaW5nOiBmYWxzZSwKICAgICAgICBpc1BhcnRpY2lwYW50U2lnbmVkOiBmYWxzZSwKICAgICAgICBldGhTd2FwQ3JlYXRpb25UcmFuc2FjdGlvbkhhc2g6IG51bGwsCiAgICAgICAgc2VjcmV0SGFzaDogbnVsbCwKICAgICAgICBpc0JhbGFuY2VGZXRjaGluZzogZmFsc2UsCiAgICAgICAgaXNCYWxhbmNlRW5vdWdoOiB0cnVlLAogICAgICAgIGJhbGFuY2U6IG51bGwsCiAgICAgICAgaXNFdGhDb250cmFjdEZ1bmRlZDogZmFsc2UsCiAgICAgICAgYnRjU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoOiBudWxsLAogICAgICAgIGV0aFN3YXBXaXRoZHJhd1RyYW5zYWN0aW9uSGFzaDogbnVsbCwKICAgICAgICBzZWNyZXQ6IG51bGwsCiAgICAgICAgY2FuQ3JlYXRlRXRoVHJhbnNhY3Rpb246IHRydWUsCiAgICAgICAgaXNFdGhXaXRoZHJhd246IGZhbHNlLAogICAgICAgIHJlZnVuZFRyYW5zYWN0aW9uSGFzaDogbnVsbCwKICAgICAgICBpc1JlZnVuZGVkOiBmYWxzZSwKICAgICAgICB3aXRoZHJhd0ZlZTogbnVsbCwKICAgICAgICByZWZ1bmRUeEhleDogbnVsbCwKICAgICAgICBpc0ZpbmlzaGVkOiBmYWxzZSwKICAgICAgICBpc1N3YXBFeGlzdDogZmFsc2UsCiAgICAgICAgdXR4b0Z1bmRFcnJvcjogbnVsbAogICAgICB9OwoKICAgICAgX3RoaXMuX3BlcnNpc3RTdGF0ZSgpOwoKICAgICAgX2dldCgoX3RoaXNTdXBlciA9IF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCBfZ2V0UHJvdG90eXBlT2YoQlRDMkVUSFRPS0VOLnByb3RvdHlwZSkpLCAiX3BlcnNpc3RTdGVwcyIsIF90aGlzU3VwZXIpLmNhbGwoX3RoaXNTdXBlcik7CgogICAgICByZXR1cm4gX3RoaXM7CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKEJUQzJFVEhUT0tFTiwgW3sKICAgICAga2V5OiAiX3BlcnNpc3RTdGF0ZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcGVyc2lzdFN0YXRlKCkgewogICAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKEJUQzJFVEhUT0tFTi5wcm90b3R5cGUpLCAiX3BlcnNpc3RTdGF0ZSIsIHRoaXMpLmNhbGwodGhpcyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX2dldFN0ZXBzIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRTdGVwcygpIHsKICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgdmFyIGZsb3cgPSB0aGlzOwogICAgICAgIHJldHVybiBbCiAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgIC8vIDEuIFNpZ25zCiAgICAgICAgX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF90aGlzMi5zaWduVVRYT1NpZGUoKTsKCiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgfSkpLCAvLyAyLiBDcmVhdGUgc2VjcmV0LCBzZWNyZXQgaGFzaCBhbmQgQlRDIHNjcmlwdAogICAgICAgIGZ1bmN0aW9uICgpIHsvLyB0aGlzLnN1Ym1pdFNlY3JldCgpCiAgICAgICAgfSwgLy8gMy4gQ2hlY2sgc3lzdGVtIHdhbGxldCBiYWxhbmNlCiAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyLnN5bmNCYWxhbmNlKCk7CiAgICAgICAgfSwKICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgLy8gNC4gQ3JlYXRlIEJUQyBTY3JpcHQsIGZ1bmQsIG5vdGlmeSBwYXJ0aWNpcGFudAogICAgICAgIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5idGNTd2FwLmZ1bmRTd2FwU2NyaXB0KHsKICAgICAgICAgICAgICAgICAgICBmbG93OiBmbG93CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICAgIH0pKSwKICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgLy8gNS4gV2FpdCBwYXJ0aWNpcGFudCBjcmVhdGVzIEVUSCBDb250cmFjdAogICAgICAgIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5ldGhUb2tlblN3YXAud2FpdEFCMlVUWE9Db250cmFjdCh7CiAgICAgICAgICAgICAgICAgICAgZmxvdzogZmxvdywKICAgICAgICAgICAgICAgICAgICB1dHhvQ29pbjogImJ0YyIKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgICAgfSkpLAogICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAvLyA2LiBXaXRoZHJhdwogICAgICAgIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsb3cuZXRoVG9rZW5Td2FwLndpdGhkcmF3RnJvbUFCMlVUWE8oewogICAgICAgICAgICAgICAgICAgIGZsb3c6IGZsb3cKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgICAgfSkpLCAvLyA3LiBGaW5pc2gKICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmbG93LnN3YXAucm9vbS5vbmNlKCdzd2FwIGZpbmlzaGVkJywgZnVuY3Rpb24gKF9yZWY1KSB7CiAgICAgICAgICAgIHZhciBidGNTd2FwV2l0aGRyYXdUcmFuc2FjdGlvbkhhc2ggPSBfcmVmNS5idGNTd2FwV2l0aGRyYXdUcmFuc2FjdGlvbkhhc2g7CiAgICAgICAgICAgIGZsb3cuc2V0U3RhdGUoewogICAgICAgICAgICAgIGJ0Y1N3YXBXaXRoZHJhd1RyYW5zYWN0aW9uSGFzaDogYnRjU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICBmbG93LnN3YXAucm9vbS5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGV2ZW50OiAncmVxdWVzdCBzd2FwIGZpbmlzaGVkJwogICAgICAgICAgfSk7CiAgICAgICAgICBmbG93LmZpbmlzaFN0ZXAoewogICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlCiAgICAgICAgICB9LCAnZmluaXNoJyk7CiAgICAgICAgfSwgLy8gOC4gRmluaXNoZWQhCiAgICAgICAgZnVuY3Rpb24gKCkge31dOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInNraXBTeW5jQmFsYW5jZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9za2lwU3luY0JhbGFuY2UgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICB0aGlzLmZpbmlzaFN0ZXAoe30sIHsKICAgICAgICAgICAgICAgICAgICBzdGVwOiAnc3luYy1iYWxhbmNlJwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWU1LCB0aGlzKTsKICAgICAgICB9KSk7CgogICAgICAgIGZ1bmN0aW9uIHNraXBTeW5jQmFsYW5jZSgpIHsKICAgICAgICAgIHJldHVybiBfc2tpcFN5bmNCYWxhbmNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2tpcFN5bmNCYWxhbmNlOwogICAgICB9KCkKICAgIH0sIHsKICAgICAga2V5OiAidHJ5UmVmdW5kIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRyeVJlZnVuZCgpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgdmFyIGZsb3cgPSB0aGlzOwogICAgICAgIHZhciBfZmxvdyRzdGF0ZSA9IGZsb3cuc3RhdGUsCiAgICAgICAgICAgIHV0eG9TY3JpcHRWYWx1ZXMgPSBfZmxvdyRzdGF0ZS51dHhvU2NyaXB0VmFsdWVzLAogICAgICAgICAgICBzZWNyZXQgPSBfZmxvdyRzdGF0ZS5zZWNyZXQ7CiAgICAgICAgcmV0dXJuIGZsb3cuYnRjU3dhcC5yZWZ1bmQoewogICAgICAgICAgc2NyaXB0VmFsdWVzOiB1dHhvU2NyaXB0VmFsdWVzLAogICAgICAgICAgc2VjcmV0OiBzZWNyZXQKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChoYXNoKSB7CiAgICAgICAgICBpZiAoIWhhc2gpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMy5zd2FwLnJvb20uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICBldmVudDogJ3V0eG8gcmVmdW5kIGNvbXBsZXRlZCcKICAgICAgICAgIH0pOwoKICAgICAgICAgIGZsb3cuc2V0U3RhdGUoewogICAgICAgICAgICByZWZ1bmRUcmFuc2FjdGlvbkhhc2g6IGhhc2gsCiAgICAgICAgICAgIGlzUmVmdW5kZWQ6IHRydWUsCiAgICAgICAgICAgIGlzU3dhcEV4aXN0OiBmYWxzZQogICAgICAgICAgfSwgdHJ1ZSk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIGlmICgvQWRkcmVzcyBpcyBlbXB0eS8udGVzdChlcnJvcikpIHsKICAgICAgICAgICAgLy8gVE9ETyAtIGZldGNoIFRYIGxpc3QgdG8gc2NyaXB0IGZvciByZWZ1bmQgVFgKICAgICAgICAgICAgZmxvdy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgaXNSZWZ1bmRlZDogdHJ1ZSwKICAgICAgICAgICAgICBpc1N3YXBFeGlzdDogZmFsc2UKICAgICAgICAgICAgfSwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCdCdGMgcmVmdW5kOicsIGVycm9yKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImlzUmVmdW5kU3VjY2VzcyIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9pc1JlZnVuZFN1Y2Nlc3MgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgICAgICAgIHZhciBfdGhpcyRzdGF0ZSwgcmVmdW5kVHJhbnNhY3Rpb25IYXNoLCBpc1JlZnVuZGVkOwoKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBfdGhpcyRzdGF0ZSA9IHRoaXMuc3RhdGUsIHJlZnVuZFRyYW5zYWN0aW9uSGFzaCA9IF90aGlzJHN0YXRlLnJlZnVuZFRyYW5zYWN0aW9uSGFzaCwgaXNSZWZ1bmRlZCA9IF90aGlzJHN0YXRlLmlzUmVmdW5kZWQ7CgogICAgICAgICAgICAgICAgICBpZiAoIShyZWZ1bmRUcmFuc2FjdGlvbkhhc2ggJiYgaXNSZWZ1bmRlZCkpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ0Y1N3YXAuY2hlY2tUWChyZWZ1bmRUcmFuc2FjdGlvbkhhc2gpOwoKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDYuc2VudCkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHRydWUpOwoKICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdCVEMyRVRIVE9LRU4gLSB1bmtub3duIHJlZnVuZCB0cmFuc2FjdGlvbicpOwogICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICByZWZ1bmRUcmFuc2FjdGlvbkhhc2g6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgaXNSZWZ1bmRlZDogZmFsc2UKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNiwgdGhpcyk7CiAgICAgICAgfSkpOwoKICAgICAgICBmdW5jdGlvbiBpc1JlZnVuZFN1Y2Nlc3MoKSB7CiAgICAgICAgICByZXR1cm4gX2lzUmVmdW5kU3VjY2Vzcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGlzUmVmdW5kU3VjY2VzczsKICAgICAgfSgpCiAgICB9LCB7CiAgICAgIGtleTogInRyeVdpdGhkcmF3IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3RyeVdpdGhkcmF3ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoX3NlY3JldCkgewogICAgICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICAgICAgdmFyIF90aGlzJHN0YXRlMiwgc2VjcmV0LCBzZWNyZXRIYXNoLCBpc0V0aFdpdGhkcmF3biwgX3NlY3JldEhhc2gsIGRhdGE7CgogICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF90aGlzJHN0YXRlMiA9IHRoaXMuc3RhdGUsIHNlY3JldCA9IF90aGlzJHN0YXRlMi5zZWNyZXQsIHNlY3JldEhhc2ggPSBfdGhpcyRzdGF0ZTIuc2VjcmV0SGFzaCwgaXNFdGhXaXRoZHJhd24gPSBfdGhpcyRzdGF0ZTIuaXNFdGhXaXRoZHJhd247CgogICAgICAgICAgICAgICAgICBpZiAoX3NlY3JldCkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJXaXRoZHJhd2FsIGlzIGF1dG9tYXRpYy4gRm9yIG1hbnVhbCB3aXRoZHJhd2FsLCBwcm92aWRlIGEgc2VjcmV0Iik7CgogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICBpZiAoc2VjcmV0ICYmIHNlY3JldCAhPSBfc2VjcmV0KSBjb25zb2xlLndhcm4oIlNlY3JldCBhbHJlYWR5IGtub3duIGFuZCBpcyBkaWZmZXJlbnQuIEFyZSB5b3Ugc3VyZT8iKTsKICAgICAgICAgICAgICAgICAgaWYgKGlzRXRoV2l0aGRyYXduKSBjb25zb2xlLndhcm4oIkxvb2tzIGxpa2UgbW9uZXkgd2VyZSBhbHJlYWR5IHdpdGhkcmF3biwgYXJlIHlvdSBzdXJlPyIpOwogICAgICAgICAgICAgICAgICBkZWJ1Zygnc3dhcC5jb3JlOmZsb3cnKSgiV0lUSERSQVcgdXNpbmcgc2VjcmV0ID0gIi5jb25jYXQoX3NlY3JldCkpOwogICAgICAgICAgICAgICAgICBfc2VjcmV0SGFzaCA9IHRoaXMuYXBwLmVudi5iaXRjb2luLmNyeXB0by5yaXBlbWQxNjAoQnVmZmVyLmZyb20oX3NlY3JldCwgJ2hleCcpKS50b1N0cmluZygnaGV4Jyk7CiAgICAgICAgICAgICAgICAgIGlmIChzZWNyZXRIYXNoICE9IF9zZWNyZXRIYXNoKSBjb25zb2xlLndhcm4oIkhhc2ggZG9lcyBub3QgbWF0Y2ghIHN0YXRlOiAiLmNvbmNhdChzZWNyZXRIYXNoLCAiLCBnaXZlbjogIikuY29uY2F0KF9zZWNyZXRIYXNoKSk7CiAgICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgb3duZXJBZGRyZXNzOiB0aGlzLmFwcC5nZXRQYXJ0aWNpcGFudEV0aEFkZHJlc3ModGhpcy5zd2FwKSwKICAgICAgICAgICAgICAgICAgICBzZWNyZXQ6IF9zZWNyZXQKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXRoVG9rZW5Td2FwLndpdGhkcmF3KGRhdGEsIGZ1bmN0aW9uIChoYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgZGVidWcoJ3N3YXAuY29yZTpmbG93JykoIlRYIGhhc2g9Ii5jb25jYXQoaGFzaCkpOwoKICAgICAgICAgICAgICAgICAgICBfdGhpczQuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgICAgZXRoU3dhcFdpdGhkcmF3VHJhbnNhY3Rpb25IYXNoOiBoYXNoLAogICAgICAgICAgICAgICAgICAgICAgY2FuQ3JlYXRlRXRoVHJhbnNhY3Rpb246IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXM0LmZpbmlzaFN0ZXAoewogICAgICAgICAgICAgICAgICAgICAgaXNFdGhXaXRoZHJhd246IHRydWUKICAgICAgICAgICAgICAgICAgICB9LCAnd2l0aGRyYXctZXRoJyk7CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWU3LCB0aGlzKTsKICAgICAgICB9KSk7CgogICAgICAgIGZ1bmN0aW9uIHRyeVdpdGhkcmF3KF94KSB7CiAgICAgICAgICByZXR1cm4gX3RyeVdpdGhkcmF3LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ5V2l0aGRyYXc7CiAgICAgIH0oKQogICAgfV0sIFt7CiAgICAgIGtleTogImdldE5hbWUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TmFtZSgpIHsKICAgICAgICByZXR1cm4gIiIuY29uY2F0KHRoaXMuZ2V0RnJvbU5hbWUoKSwgIjIiKS5jb25jYXQodGhpcy5nZXRUb05hbWUoKSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0RnJvbU5hbWUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RnJvbU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIGNvbnN0YW50cy5DT0lOUy5idGM7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0VG9OYW1lIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFRvTmFtZSgpIHsKICAgICAgICByZXR1cm4gdG9rZW5OYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gQlRDMkVUSFRPS0VOOwogIH0oQXRvbWljQUIyVVRYTyk7CgogIHJldHVybiBCVEMyRVRIVE9LRU47Cn0pOw=="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/core/swap.flows/BTC2ETHTOKEN.ts"],"names":["debug","constants","AtomicAB2UTXO","tokenName","BTC2ETHTOKEN","swap","btcSwap","getRefundHexTransaction","scriptValues","state","utxoScriptValues","secret","then","txHex","setState","refundTxHex","utxoCoin","_flowName","getName","stepNumbers","ethTokenSwap","ownerSwap","participantSwap","abBlockchain","utxoBlockchain","isUTXOSide","Error","step","isStoppedSwap","signTransactionHash","isSignFetching","isParticipantSigned","ethSwapCreationTransactionHash","secretHash","isBalanceFetching","isBalanceEnough","balance","isEthContractFunded","btcSwapWithdrawTransactionHash","ethSwapWithdrawTransactionHash","canCreateEthTransaction","isEthWithdrawn","refundTransactionHash","isRefunded","withdrawFee","isFinished","isSwapExist","utxoFundError","_persistState","flow","signUTXOSide","syncBalance","fundSwapScript","waitAB2UTXOContract","withdrawFromAB2UTXO","room","once","sendMessage","event","finishStep","refund","hash","error","test","console","warn","checkTX","_secret","_secretHash","app","env","bitcoin","crypto","ripemd160","Buffer","from","toString","data","ownerAddress","getParticipantEthAddress","withdraw","getFromName","getToName","COINS","btc","toUpperCase"],"mappings":"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","sourcesContent":["import debug from 'debug'\r\nimport SwapApp, { constants, util } from 'swap.app'\r\nimport { AtomicAB2UTXO } from 'swap.swap'\r\nimport { BigNumber } from 'bignumber.js'\r\nimport { EthTokenSwap, BtcSwap } from 'swap.swaps'\r\n\r\n\r\nexport default (tokenName) => {\r\n\r\n  class BTC2ETHTOKEN extends AtomicAB2UTXO {\r\n\r\n    _flowName: string\r\n    ethTokenSwap: EthTokenSwap\r\n    btcSwap: BtcSwap\r\n    state: any\r\n\r\n    static getName() {\r\n      return `${this.getFromName()}2${this.getToName()}`\r\n    }\r\n    static getFromName() {\r\n      return constants.COINS.btc\r\n    }\r\n    static getToName() {\r\n      return tokenName.toUpperCase()\r\n    }\r\n    constructor(swap) {\r\n      super(swap)\r\n      this.utxoCoin = `btc`\r\n      this._flowName = BTC2ETHTOKEN.getName()\r\n\r\n      this.stepNumbers = {\r\n        'sign': 1,\r\n        'submit-secret': 2,\r\n        'sync-balance': 3,\r\n        'lock-utxo': 4,\r\n        'wait-lock-eth': 5,\r\n        'withdraw-eth': 6,\r\n        'finish': 7,\r\n        'end': 8\r\n      }\r\n\r\n      this.ethTokenSwap = swap.ownerSwap\r\n      this.btcSwap      = swap.participantSwap\r\n\r\n      this.abBlockchain = this.ethTokenSwap\r\n      this.utxoBlockchain = this.btcSwap\r\n      this.isUTXOSide = true\r\n\r\n      if (!this.ethTokenSwap) {\r\n        throw new Error('BTC2ETH: \"ethTokenSwap\" of type object required')\r\n      }\r\n      if (!this.btcSwap) {\r\n        throw new Error('BTC2ETH: \"btcSwap\" of type object required')\r\n      }\r\n\r\n      this.state = {\r\n        step: 0,\r\n\r\n        isStoppedSwap: false,\r\n\r\n        signTransactionHash: null,\r\n        isSignFetching: false,\r\n        isParticipantSigned: false,\r\n\r\n        ethSwapCreationTransactionHash: null,\r\n\r\n        secretHash: null,\r\n\r\n        isBalanceFetching: false,\r\n        isBalanceEnough: true,\r\n        balance: null,\r\n\r\n        isEthContractFunded: false,\r\n\r\n        btcSwapWithdrawTransactionHash: null,\r\n        ethSwapWithdrawTransactionHash: null,\r\n\r\n        secret: null,\r\n\r\n        canCreateEthTransaction: true,\r\n        isEthWithdrawn: false,\r\n\r\n        refundTransactionHash: null,\r\n        isRefunded: false,\r\n\r\n        withdrawFee: null,\r\n        refundTxHex: null,\r\n        isFinished: false,\r\n        isSwapExist: false,\r\n        utxoFundError: null,\r\n      }\r\n\r\n      this._persistState()\r\n      super._persistSteps()\r\n    }\r\n\r\n    _persistState() {\r\n      super._persistState()\r\n    }\r\n\r\n    _getSteps() {\r\n      const flow = this\r\n\r\n      return [\r\n\r\n        // 1. Signs\r\n\r\n        async () => {\r\n          this.signUTXOSide()\r\n        },\r\n\r\n        // 2. Create secret, secret hash and BTC script\r\n\r\n        () => {\r\n          // this.submitSecret()\r\n        },\r\n\r\n        // 3. Check system wallet balance\r\n\r\n        () => {\r\n          this.syncBalance()\r\n        },\r\n\r\n        // 4. Create BTC Script, fund, notify participant\r\n\r\n        async () => {\r\n          await this.btcSwap.fundSwapScript({\r\n            flow,\r\n          })\r\n        },\r\n\r\n        // 5. Wait participant creates ETH Contract\r\n\r\n        async () => {\r\n          await this.ethTokenSwap.waitAB2UTXOContract({\r\n            flow,\r\n            utxoCoin: `btc`,\r\n          })\r\n        },\r\n\r\n        // 6. Withdraw\r\n\r\n        async () => {\r\n          await flow.ethTokenSwap.withdrawFromAB2UTXO({ flow })\r\n        },\r\n\r\n        // 7. Finish\r\n\r\n        () => {\r\n          flow.swap.room.once('swap finished', ({btcSwapWithdrawTransactionHash}) => {\r\n            flow.setState({\r\n              btcSwapWithdrawTransactionHash,\r\n            })\r\n          })\r\n\r\n          flow.swap.room.sendMessage({\r\n            event: 'request swap finished',\r\n          })\r\n\r\n          flow.finishStep({\r\n            isFinished: true,\r\n          }, 'finish')\r\n        },\r\n\r\n        // 8. Finished!\r\n\r\n        () => {}\r\n      ]\r\n    }\r\n\r\n    async skipSyncBalance() {\r\n      this.finishStep({}, { step: 'sync-balance' })\r\n    }\r\n\r\n    getRefundTxHex = () => {\r\n      this.btcSwap.getRefundHexTransaction({\r\n        scriptValues: this.state.utxoScriptValues,\r\n        secret: this.state.secret,\r\n      })\r\n        .then((txHex) => {\r\n          this.setState({\r\n            refundTxHex: txHex,\r\n          })\r\n        })\r\n    }\r\n\r\n    tryRefund() {\r\n      const flow = this\r\n      const { utxoScriptValues, secret } = flow.state\r\n\r\n      return flow.btcSwap.refund({\r\n        scriptValues: utxoScriptValues,\r\n        secret: secret,\r\n      })\r\n        .then((hash) => {\r\n          if (!hash) {\r\n            return false\r\n          }\r\n\r\n          this.swap.room.sendMessage({\r\n            event: 'utxo refund completed',\r\n          })\r\n\r\n          flow.setState({\r\n            refundTransactionHash: hash,\r\n            isRefunded: true,\r\n            isSwapExist: false,\r\n          }, true)\r\n\r\n          return true\r\n        })\r\n        .catch((error) => {\r\n          if (/Address is empty/.test(error)) {\r\n            // TODO - fetch TX list to script for refund TX\r\n            flow.setState({\r\n              isRefunded: true,\r\n              isSwapExist: false,\r\n            }, true)\r\n            return true\r\n          } else {\r\n            console.warn('Btc refund:', error)\r\n\r\n            return false\r\n          }\r\n        })\r\n    }\r\n\r\n    async isRefundSuccess() {\r\n      const { refundTransactionHash, isRefunded } = this.state\r\n      if (refundTransactionHash && isRefunded) {\r\n        if (await this.btcSwap.checkTX(refundTransactionHash)) {\r\n          return true\r\n        } else {\r\n          console.warn('BTC2ETHTOKEN - unknown refund transaction')\r\n          this.setState( {\r\n            refundTransactionHash: null,\r\n            isRefunded: false,\r\n          } )\r\n          return false\r\n        }\r\n      }\r\n      return false\r\n    }\r\n\r\n    async tryWithdraw(_secret) {\r\n      const { secret, secretHash, isEthWithdrawn } = this.state\r\n\r\n      if (!_secret)\r\n        throw new Error(`Withdrawal is automatic. For manual withdrawal, provide a secret`)\r\n\r\n      if (secret && secret != _secret)\r\n        console.warn(`Secret already known and is different. Are you sure?`)\r\n\r\n      if (isEthWithdrawn)\r\n        console.warn(`Looks like money were already withdrawn, are you sure?`)\r\n\r\n      debug('swap.core:flow')(`WITHDRAW using secret = ${_secret}`)\r\n\r\n      const _secretHash = this.app.env.bitcoin.crypto.ripemd160(Buffer.from(_secret, 'hex')).toString('hex')\r\n\r\n      if (secretHash != _secretHash)\r\n        console.warn(`Hash does not match! state: ${secretHash}, given: ${_secretHash}`)\r\n\r\n      const data = {\r\n        ownerAddress: this.app.getParticipantEthAddress(this.swap),\r\n        secret: _secret,\r\n      }\r\n\r\n      await this.ethTokenSwap.withdraw(data, (hash) => {\r\n        debug('swap.core:flow')(`TX hash=${hash}`)\r\n        this.setState({\r\n          ethSwapWithdrawTransactionHash: hash,\r\n          canCreateEthTransaction: true,\r\n        })\r\n      }).then(() => {\r\n\r\n        this.finishStep({\r\n          isEthWithdrawn: true,\r\n        }, 'withdraw-eth')\r\n      })\r\n    }\r\n  }\r\n\r\n  return BTC2ETHTOKEN\r\n}\r\n"]}]}